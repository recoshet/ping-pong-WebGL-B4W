var b4w="object"===typeof b4w?b4w:function(a){var p={};a.module=p;var e={};a.cleanup=function(a,c){var m=p[a];m&&(m.Ui=null);e[c||"__b4w_default"]=null};a.register=function(a,c){p[a]||(p[a]=c)};a.require=function(a,c){if(!p[a])throw Error('Module "'+a+'" not found');c=c||"__b4w_default";e[c]||(e[c]=function(a){return function(b){var c=p[b];if(!c)throw Error('Module "'+b+'" not found');c.Ui||(c.Ui={});c.Ui[a]||(c.Ui[a]={},c(c.Ui[a],e[a]));return c.Ui[a]}}(c));return e[c](a)};a.module_check=function(a){return p[a]?
!0:!1};a.get_namespace=function(a){for(var c in e)if(e[c]==a)return c;return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.Xq&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function p(){var a=e,b=a.getDate(),b=10>b?"0"+String(b):String(b),k=a.getMonth()+1,k=10>k?"0"+String(k):String(k),r=String(a.getFullYear()),h=a.getHours(),h=10>h?"0"+String(h):String(h),q=a.getMinutes(),q=10>q?"0"+String(q):String(q),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return b+"."+k+"."+r+" "+h+":"+q+":"+a}var e=new Date(2016,3,28,18,24,1),b=[16,4];a.version=function(){return b};a.version_str=function(){for(var a="",e=0;e<b.length;e++)a=1==e?a+(10>b[e]?
"0"+b[e]:b[e]):a+b[e],e!=b.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return e};a.date_str=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Xq&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function e(){return b4w.module_check(a.Ec.on)}function b(){for(var b=a.Ec,e=null,h=document.getElementsByTagName("script"),q=0;q<h.length;q++){for(var g=h[q].src,m=0;m<b.Uw.length;m++)if(0<=g.indexOf(b.Uw[m])){e=g;break}if(null!==e)break}e||(c.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),e=document.location.href);b=e.indexOf("?");0<=b&&(e=e.substring(0,b));return e.substring(0,e.lastIndexOf("/")+1)}var c=p("__print"),
m=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.jD=m.za(a.context);a.q={alpha_sort:!0,alpha_sort_threshold:.1,ki:[5,7],ve:1E4,console_verbose:!1,do_not_load_resources:!1,sp:!1,Nv:1.5,TE:10,background_color:[0,0,0,0],ji:.01,canvas_resolution_factor:1,Ak:3,allow_cors:!1,cr:!1,bn:!0,show_hud_debug_info:!1,eM:!0,gk:!0,stereo:"NONE",im:!0,Gc:!0,Zc:!0,gj:!0,xj:!0,mn:!0,li:!0,bj:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,Rz:!1,mj:!0,
Zl:!0,fc:!0,Po:!0,water_dynamic:!0,shore_smoothing:!0,hk:!0,zb:1024,Ng:512,xz:!0,precision:"highp",quality:a.P_HIGH,an:!0,pH:!1,wy:!1,Qq:!1,Fz:!1,Ve:!1,Rq:!1,Cr:!1,uq:!1,FN:!1,nm:!1,allow_hidpi:!1,gyro_use:!1,Kv:!1,as:!1,enable_selectable:!0,enable_outlining:!0,Kf:!0,kx:128,Yn:!1,UG:!1,Tr:[0,0],vl:!1,Yx:!0,Op:!1,url_params:null,Hc:!0,Dc:4,my:!1,hy:!1,media_auto_activation:!0,jx:4,ro:!1,wu:!1,gl_debug:!1,Qv:""};a.gE=m.za(a.q);a.Ch={On:-1,Ov:!1,Yh:1};a.controls={iH:1/120};a.Qd={dir:"ASSETS=../../assets/",
cH:15,prevent_caching:!0,Zr:!1,Lq:!1};a.kC=m.za(a.Qd);a.Ec={shaders_dir:"",ZI:"include/",AN:"postprocessing/",on:"built_in_data",Uw:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js USER_DEFINED_MODULE".split(" "),iy:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.bG={oculus:{distortion_coefs:[.22,.28],chromatic_aberration_coefs:[-.015,.02,.025,.02]},cardboard_1:{Jg:.06,xg:.035,dg:.042,distortion_coefs:[.441,.156],chromatic_aberration_coefs:[0,0,0,0]},cardboard_2:{Jg:.064,
xg:.035,dg:.039,distortion_coefs:[.34,.55],chromatic_aberration_coefs:[0,0,0,0]},"default":{Jg:.064,xg:.035,dg:.039,distortion_coefs:[0,0],chromatic_aberration_coefs:[0,0,0,0]}};a.lE={Nexus6:{Yq:/Nexus 6 /,th:.132,Lf:.074,yg:.004},GalaxyNote4:{Yq:/SM-N910C/,th:.126,Lf:.071,yg:.004},YotaPhone2:{Yq:/YD201/,th:.11,Lf:.062,yg:.004},"default":{th:.11,Lf:.062,yg:.004}};a.o={enabled:!0,ve:60,ym:"",lq:!1,ping:!1,Dm:!0};a.AH=m.za(a.o);a.ek={Tn:1024,ol:384,pv:32,$D:128,ZD:256,Px:.25,IH:.5,HH:1};a.jI=m.za(a.ek);
a.I={Ot:!0,vo:!1,Eu:!1,cv:!1,Av:!1};a.YI=m.za(a.I);a.Kb={outlining_overview_mode:!1,Xf:[1,.4,.05],Xj:.2,Yj:3.8,Zj:1};a.Mq={enabled:!1,xJ:"COPY",wJ:0,bJ:"COLOR"};a.dE=m.za(a.Mq);a.gC=function(){var b=a.q,c=a.o,e=a.ek;switch(b.quality){case a.P_ULTRA:b.gk=!0;b.shore_smoothing=!0;b.Zc=!0;b.gj=!0;b.xj=!0;b.mn=!0;b.im=!0;b.Gc=!0;b.mj=!0;b.Zl=!0;b.fc=!0;b.Po=!0;e.Tn=2048;b.Ak=3;b.bn=!0;b.sp=!1;b.precision="highp";b.water_dynamic=!0;b.hk=!0;b.antialiasing=!0;b.smaa=!1;b.bj=!0;b.li=!0;b.allow_hidpi=!0;b.enable_outlining=
!0;b.Kf=!0;b.Dc=16;c.ve=120;break;case a.P_HIGH:b.gk=!0;b.shore_smoothing=!0;b.Zc=!0;b.gj=!0;b.xj=!0;b.mn=!0;b.im=!0;b.Gc=!0;b.mj=!0;b.Zl=!0;b.fc=!0;b.Po=!0;e.Tn=1024;b.Ak=3;b.bn=!0;b.sp=!1;b.precision="highp";b.water_dynamic=!0;b.hk=!0;b.antialiasing=!0;b.smaa=!1;b.bj=!0;b.li=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.Kf=!0;b.Dc=4;c.ve=60;break;case a.P_LOW:b.gk=!1,b.shore_smoothing=!1,b.Zc=!1,b.gj=!1,b.xj=!1,b.mn=!1,b.im=!1,b.Gc=!1,b.mj=!1,b.Zl=!1,b.fc=!1,b.Po=!1,e.Tn=512,b.Ak=2,b.bn=!1,b.sp=!0,
b.precision="mediump",b.water_dynamic=!1,b.hk=!1,b.antialiasing=!1,b.smaa=!1,b.bj=!1,b.li=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.Kf=!1,b.Dc=1,c.ve=60}};a.set=function(b,e){switch(b){case "allow_cors":a.q.allow_cors=e;break;case "allow_hidpi":a.q.allow_hidpi=e;break;case "alpha":a.context.alpha=e;break;case "alpha_sort":a.q.alpha_sort=e;break;case "alpha_sort_threshold":a.q.alpha_sort_threshold=e;break;case "anaglyph_use":c.zE();a.q.stereo=e?"ANAGLYPH":a.q.stereo;break;case "animation_framerate":a.Ch.On=
e;break;case "antialiasing":a.q.antialiasing=e;break;case "assets_dds_available":a.Qd.Lq=e;break;case "assets_min50_available":a.Qd.Zr=e;break;case "audio":a.I.Ot=e;break;case "background_color":a.q.background_color=e;break;case "built_in_module_name":a.Ec.on=e;break;case "canvas_resolution_factor":a.q.canvas_resolution_factor=e;break;case "console_verbose":a.q.console_verbose=e;break;case "do_not_load_resources":a.q.do_not_load_resources=e;break;case "gyro_use":a.q.gyro_use=e;break;case "gamepad_setting_cont":a.q.Qv=
e;break;case "stereo":a.q.stereo=e;break;case "media_auto_activation":a.q.media_auto_activation=e;break;case "physics_enabled":a.o.enabled=e;break;case "physics_uranium_path":a.o.ym=e;break;case "physics_calc_fps":a.o.lq=e;break;case "physics_use_workers":a.o.Dm=e;break;case "precision":a.q.precision=e;break;case "prevent_caching":a.Qd.prevent_caching=e;break;case "quality":a.q.quality=e;break;case "sfx_mix_mode":a.I.vo=e;break;case "shaders_dir":a.Ec.shaders_dir=e;break;case "show_hud_debug_info":a.q.show_hud_debug_info=
e;break;case "smaa":a.q.smaa=e;break;case "smaa_search_texture_path":a.Ec.smaa_search_texture_path=e;break;case "smaa_area_texture_path":a.Ec.smaa_area_texture_path=e;break;case "wireframe_debug":a.q.wireframe_debug=e;break;case "enable_selectable":a.q.enable_selectable=e;break;case "enable_outlining":a.q.enable_outlining=e;break;case "outlining_overview_mode":a.Kb.outlining_overview_mode=e;break;case "glow_materials":a.q.Kf=e;break;case "url_params":a.q.url_params=e;break;case "gl_debug":a.q.gl_debug=
e;break;default:c.error("Unknown config property: "+b)}};a.get=function(b){switch(b){case "allow_cors":return a.q.allow_cors;case "allow_hidpi":return a.q.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.q.alpha_sort;case "alpha_sort_threshold":return a.q.alpha_sort_threshold;case "anaglyph_use":return"ANAGLYPH"==a.q.stereo;case "animation_framerate":return a.Ch.On;case "antialiasing":return a.q.antialiasing;case "assets_dds_available":return a.Qd.Lq;case "assets_min50_available":return a.Qd.Zr;
case "audio":return a.I.Ot;case "background_color":return a.q.background_color;case "built_in_module_name":return a.Ec.on;case "canvas_resolution_factor":return a.q.canvas_resolution_factor;case "console_verbose":return a.q.console_verbose;case "do_not_load_resources":return a.q.do_not_load_resources;case "gyro_use":return a.q.gyro_use;case "gamepad_setting_cont":return a.q.Qv;case "is_mobile_device":return a.q.Ve;case "stereo":return a.q.stereo;case "media_auto_activation":return a.q.media_auto_activation;
case "physics_enabled":return a.o.enabled;case "physics_uranium_path":return a.o.ym;case "physics_calc_fps":return a.o.lq;case "physics_use_workers":return a.o.Dm;case "precision":return a.q.precision;case "prevent_caching":return a.Qd.prevent_caching;case "quality":return a.q.quality;case "sfx_mix_mode":return a.I.vo;case "shaders_dir":return a.Ec.shaders_dir;case "show_hud_debug_info":return a.q.show_hud_debug_info;case "smaa":return a.q.smaa;case "smaa_search_texture_path":return a.Ec.smaa_search_texture_path;
case "smaa_area_texture_path":return a.Ec.smaa_area_texture_path;case "wireframe_debug":return a.q.wireframe_debug;case "enable_selectable":return a.q.enable_selectable;case "enable_outlining":return a.q.enable_outlining;case "outlining_overview_mode":return a.Kb.outlining_overview_mode;case "glow_materials":return a.q.Kf;case "url_params":return a.q.url_params;case "gl_debug":return a.q.gl_debug;default:c.error("Unknown config property: "+b)}};a.reset=function(){a.context=m.za(a.jD);a.q=m.za(a.gE);
a.Qd=m.za(a.kC);a.o=m.za(a.AH);a.ek=m.za(a.jI);a.I=m.za(a.YI);a.Mq=m.za(a.dE)};a.iG=e;a.GI=function(){var c=a.Ec,m=a.o;e()||""!=c.shaders_dir||(c.shaders_dir=b()+"../shaders/");if(e())c.smaa_search_texture_path="smaa_search_texture.png",c.smaa_area_texture_path="smaa_area_texture.png";else if(""==c.smaa_search_texture_path||""==c.smaa_area_texture_path){var h=b()+c.iy;c.smaa_search_texture_path=c.smaa_search_texture_path||h+"smaa_search_texture.png";c.smaa_area_texture_path=c.smaa_area_texture_path||
h+"smaa_area_texture.png"}m.enabled&&""==m.ym&&(h=b()+c.iy,m.ym=h+"uranium.js")};a.get_std_assets_path=function(){return a.Qd.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function e(){d=!0;l.get_container().addEventListener("mouseup",function(){function a(){return"visible"==w.style.visibility&&!g&&!J}if(!F&&!z){var d=G;if(d)if("hidden"==d.style.visibility)b(),G=null;else if(1==d.style.opacity){var w=d.querySelector("div"),t=w.querySelector("span"),c=t.innerHTML;d.style.visibility="hidden";w.style.visibility="visible";var l=Math.min(parseInt(w.style.width)||200,r(c)-24),P=h(c,l),g=!1,J=!1,c=d.offsetWidth-24,d=d.offsetHeight-16;P==
d&&(w.style.height=P+"px");l!=c?(F=g=!0,H.animate(c,l,200,function(d){d==l&&(g=!1,J||(F=!1),a&&(t.style.visibility="visible"));w.style.width=d+"px"})):g=!1;P!=d?(F=J=!0,H.animate(d,P,200,function(d){d==P&&(J=!1,g||(F=!1),a&&(t.style.visibility="visible"));w.style.height=d+"px"})):J=!1}}})}function b(){G.querySelector("div").style.visibility="hidden";G.querySelector("div").querySelector("span").style.visibility="hidden";G.style.visibility="visible"}function c(a){a.style.cssText+="color:       #fff;font-family: Arial;font-size:   12px;font-weight: bold;line-height: 15px;"}
function m(a){a.style.cssText+="background-color:   #000;border-radius:      20px 20px 20px 0px;bottom:             0;box-shadow:         0px 0px 10px rgb(180, 180, 200);-webkit-box-shadow: 0px 0px 10px rgb(180, 180, 200);font-size:          12px;left:               0;line-height:        15px;opacity:            1.0;overflow:           hidden;padding:            8px 12px;position:           absolute;z-index:            2;"}function k(a,d,w){var t=document.createElement("div"),l=document.createElement("span");
w&&(t.style.width=w+"px");m(t);c(l);l.innerHTML=a;t.style.visibility="hidden";l.style.visibility="hidden";t.appendChild(l);d.appendChild(t);d.addEventListener("mousedown",function(){F||d==G||1!=d.style.opacity||z||(G&&"hidden"==G.style.visibility&&b(),G=d)})}function r(a){var d=document.createElement("div"),w=document.createElement("span");w.innerHTML=a;c(w);m(d);d.appendChild(w);document.body.appendChild(d);a=d.offsetWidth+1;document.body.removeChild(d);return a}function h(a,d){var w=document.createElement("div"),
b=document.createElement("span");b.innerHTML=a;c(b);m(w);w.style.width=d+"px";w.style.display="inline-block";w.appendChild(b);document.body.appendChild(w);b=w.offsetHeight-16;document.body.removeChild(w);return b}function q(){for(var a=0,d=0;d<E.length;d++)E[d].ej&&a++;J=new Float32Array(3*a)}function g(a,d){return d.depth-a.depth}var y=p("__batch"),f=p("__camera"),l=p("__container"),n=p("__objects"),u=p("__print"),A=p("__renderer"),B=p("__scenes"),H=p("__time"),v=p("__tsr"),E=[],z=!1,G=null,d=!1,
F=!1,J=new Float32Array(0),C=new Uint8Array(16),D=new Float32Array(2),O=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<E.length;b++)if(E[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.anchor.ej&&Boolean(B.Z(B.wj(),"ANCHOR_VISIBILITY"));b={type:a.anchor.type,obj:a,x:0,y:0,depth:0,Dh:"out",ej:b,element:null,Nj:null,IB:a.anchor.dH,cn:0,Sp:0,Jn:a.anchor.Jn};switch(b.type){case "ANNOTATION":var w=b.IB,t=document.createElement("div"),g=document.createElement("span"),J="",P=a.name,f=l.get_container();
a=n.get_meta_tags(a);t.style.cssText+="background-color:   #000;border-radius:      20px 20px 20px 0px;box-shadow:         0px 0px 10px rgb(180, 180, 200);-webkit-box-shadow: 0px 0px 10px rgb(180, 180, 200);font-size:          12px;line-height:        15px;opacity:            1.0;padding:            8px 12px;position:           absolute;";t.style.visibility="hidden";f.appendChild(t);a&&(J=a.description||J,P=a.title||P);g.innerHTML=P;g.style.cssText+="-webkit-touch-callout: none;-webkit-user-select:   none;-khtml-user-select:    none;-moz-user-select:      none;-ms-user-select:       none;user-select:           none;cursor:                default;";
c(g);t.appendChild(g);J&&k(J,t,w);b.element=t;b.cn=b.element.offsetHeight;b.Sp=b.element.offsetWidth;break;case "ELEMENT":b.element=document.getElementById(a.anchor.Jn),b.element?(b.cn=b.element.offsetHeight,b.Sp=b.element.offsetWidth):(u.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}E.push(b);q();d||e()}};a.remove=function(a){for(var d=0;d<E.length;d++){var b=E[d];if(b.obj==a){"ANNOTATION"==b.type&&(a=b,l.get_container().removeChild(a.element));E.splice(d,1);q();
break}}};a.update=function(){for(var a=0,d=E.length;d--;){var b=E[d];if(b.ej){var t=v.get_trans_view(b.obj.g.i);J.set(t,3*a++)}var c;c=b;var t=O,l=B.Hl(B.wj());c=v.get_trans_view(c.obj.g.i);c=t=f.project_point(l,c,t);t=c[0];l=c[1];c=c[2];if(t!=b.x||l!=b.y||c!=b.depth){switch(b.type){case "ANNOTATION":var P=b.element;P.style.left=Math.floor(t)+"px";P.style.top=Math.floor(l-b.cn)+"px";break;case "ELEMENT":var P=b.element,e=P.getBoundingClientRect();P.style.cssText+="left:"+Math.floor(t-e.width/2)+"px;top:"+
Math.floor(l-e.height/2)+"px;"}b.x=t;b.y=l;b.depth=c;b.Nj&&b.Nj(t,l,b.Dh,b.obj,P)}}E.sort(g);for(d=0;d<E.length;d++)b=E[d],"GENERIC"!=b.type&&(b.element.style.zIndex=d);0<a&&(a=B.Z(B.wj(),"ANCHOR_VISIBILITY").v[0].H,y.LJ(a,J))};a.wz=function(){for(var a=l.get_container(),d=E.length;d--;){var b=E[d],t=b.obj,c=b.x,g=b.y,P=b.depth,P=0>c||0>g||0>P||1<P||B.is_hidden(t)||c>=a.clientWidth||g>=a.clientHeight?"out":"visible";if(b.ej&&"out"!=P){var P=b,J=B.Z(B.wj(),"ANCHOR_VISIBILITY").j,f=l.Wk(P.x,P.y,D,J);
A.Bs(J.Zd,f[0],J.height-f[1],2,2,C);P=1020==C[0]+C[4]+C[8]+C[12]?"visible":"out"==P.Dh||0==C[0]+C[4]+C[8]+C[12]?"covered":P.Dh}if(P!=b.Dh){switch(b.type){case "ANNOTATION":case "ELEMENT":var e=b.element;if(!e)break;"out"==P?(e.style.visibility="hidden",e.children.length&&(e.children[0].style.visibility="hidden"),"ANNOTATION"==b.type&&1<e.children.length&&(J=e.children[1],J.style.visibility="hidden",J.children.length&&(J.children[0].style.visibility="hidden"))):"visible"==P?(e.style.visibility="visible",
e.children.length&&(e.children[0].style.visibility="visible"),e.style.opacity=1):(e.style.visibility="visible",e.style.opacity=.1,e.children.length&&(e.children[0].style.visibility="visible"),"ANNOTATION"==b.type&&1<e.children.length&&(J=e.children[1],J.style.visibility="hidden",J.children.length&&(J.children[0].style.visibility="hidden")))}b.Dh=P;b.Nj&&b.Nj(c,g,b.Dh,t,e)}}};a.attach_move_cb=function(a,d){for(var b=0;b<E.length;b++)E[b].obj==a&&(E[b].Nj=d)};a.detach_move_cb=function(a){for(var d=
0;d<E.length;d++)E[d].obj==a&&(E[d].Nj=null)};a.cleanup=function(){for(var a=0;a<E.length;a++){var d=E[a];"ANNOTATION"==d.type&&l.get_container().removeChild(d.element)}E.length=0};a.is_anchor=function(a){for(var d=0;d<E.length;d++)if(E[d].obj==a)return!0;return!1};a.get_element_id=function(a){for(var d=0;d<E.length;d++)if(E[d].obj==a)return E[d].Jn;return!1};a.pause=function(){z=!0};a.resume=function(){z=!1};a.BH=function(a,d){for(var b=-1,t=0;t<E.length;t++){var c;if(c="visible"==E[t].Dh){var l=
E[t];c=Math.round(l.Sp);var P=Math.round(l.cn),g=l.x,l=l.y;c=a>=g&&a<=g+c&&d<l&&d>=l-P?!0:!1}if(c)if(0>b)var J=E[t].depth,b=t;else E[t].depth<J&&(b=t,J=E[t].depth)}return 0>b?null:E[b].obj}};b4w.module.__armature=function(a,p){function e(a){a=a.g;for(var b=a.ap,c=a.lx,l=0;l<b.length;l++){for(var g=b[l],f=c[l],e=0;e<f.length;e+=2)for(var k=f[e],h=f[e+1],d=0;4>d;d++)g.Tc[k+d]=a.Tc[h+d],g.Ad[k+d]=a.Ad[h+d],g.ad[k+d]=a.ad[h+d],g.Kd[k+d]=a.Kd[h+d];g.Yd=a.Yd}}function b(a,c,l,f){var e=a.At,k=a.jh,h=a.vm,z=a.qs;z?(z=z.vm,c?m.multiply(z,e,h):(c=g,m.invert(z,c),m.multiply(c,h,e))):c?m.copy(e,h):m.copy(h,e);e=q;m.invert(k,e);m.multiply(h,e,e);k=a.zg;l[4*k]=e[0];l[4*k+1]=e[1];l[4*k+2]=e[2];l[4*
k+3]=e[3];f[4*k]=e[4];f[4*k+1]=e[5];f[4*k+2]=e[6];f[4*k+3]=e[7];a=a.yv;for(k=0;k<a.length;k++)h=a[k],h.ib||b(h,!0,l,f)}var c=p("__util"),m=p("__tsr"),k=p("__quat"),r=p("__mat4"),h=p("__vec3"),q=m.create(),g=m.create(),y=new Float32Array(4),f=new Float32Array(4),l=new Float32Array(4);a.lh=function(a,b){for(var l=a.data.bones,g=a.pose.bones,f={},e=0;e<g.length;e++){var k=g[e],z=k.bone,G=z.name,d=f[G]={zg:0,Gz:-1,qs:null,yv:[],qn:[],ib:null,um:m.create(),At:m.create(),jh:m.create(),vm:m.create(),mp:m.create(),
Bt:m.create(),np:!1,Xy:new Float32Array(3)},G=new Float32Array(z.matrix_local),F=new Float32Array(16);r.invert(G,F);var k=new Float32Array(k.matrix_basis),J=d.Xy;h.subtract(z.tail_local,z.head_local,J);c.JK(J,F,J);m.from_mat4(G,d.jh);m.from_mat4(k,d.mp);m.copy(d.jh,d.vm)}for(e=0;e<l.length;e++){G=l[e].name;k=c.keysearch("name",G,g);d=f[G];z=k.parent_recursive;d.qn.push(d);for(F=0;F<z.length;F++)k=z[F],k=k.name,k=f[k],d.qn.push(k);z.length?(k=z[0],k=k.name,k=f[k],d.qs=k,m.invert(k.jh,q),m.multiply(q,
d.jh,d.um),k.yv.push(d)):m.copy(d.jh,d.um);d.zg=e;d.name=G;m.multiply(d.um,d.mp,d.At)}b.g.Rd=f};a.get_bone_tsr=function(a,b,c,e,h){var r=a.g,E=r.Yd;b=r.Rd[b];var z=b.zg;a=b.jh;var G=r.ad,d=r.Kd,F=r.Tc,r=r.Ad,J=G[4*z+1],C=G[4*z+2],D=G[4*z+3],O=d[4*z+1],T=d[4*z+2],K=d[4*z+3];y[0]=(1-E)*G[4*z]+E*d[4*z];y[1]=(1-E)*J+E*O;y[2]=(1-E)*C+E*T;y[3]=(1-E)*D+E*K;f[0]=F[4*z];f[1]=F[4*z+1];f[2]=F[4*z+2];f[3]=F[4*z+3];l[0]=r[4*z];l[1]=r[4*z+1];l[2]=r[4*z+2];l[3]=r[4*z+3];k.slerp(f,l,E,f);E=q;m.set_transcale(y,E);
m.set_quat(f,E);c?(c=g,m.translate(a,b.Xy,c),m.multiply(E,c,E)):m.multiply(E,a,E);if(e){if(e=b.qs)c=g,m.invert(e.vm,c),m.multiply(c,E,E);e=g;m.invert(b.um,e);m.multiply(e,E,E)}m.copy(E,h)};a.set_bone_tsr=function(a,c,l,g){var f=a.g;c=f.Rd[c];var k=f.ad,h=f.Tc;g?m.multiply(c.um,l,c.At):m.copy(l,c.vm);b(c,g,k,h);f.Yd=0;e(a)};a.mK=e;a.TJ=b;a.$k=function(a,b){return b in a.g.Rd}};b4w.module.__boundings=function(a,p){function e(a,b){for(var d=a[0],c=a[1],l=a[2],g=a[0],f=a[1],e=a[2],k=3;k<a.length;k+=3)var n=a[k],w=a[k+1],t=a[k+2],d=Math.max(d,n),c=Math.max(c,w),l=Math.max(l,t),g=Math.min(g,n),f=Math.min(f,w),e=Math.min(e,t);b.max_x=d;b.max_y=c;b.max_z=l;b.min_x=g;b.min_y=f;b.min_z=e;return b}function b(a,b){b||(b=new Float32Array(24));var d=a.max_x,c=a.max_y,l=a.max_z,g=a.min_x,f=a.min_y,e=a.min_z;b[0]=g;b[1]=f;b[2]=e;b[3]=d;b[4]=f;b[5]=e;b[6]=d;b[7]=c;b[8]=e;b[9]=g;b[10]=
c;b[11]=e;b[12]=g;b[13]=f;b[14]=l;b[15]=d;b[16]=f;b[17]=l;b[18]=d;b[19]=c;b[20]=l;b[21]=g;b[22]=c;b[23]=l;return b}function c(){return{Ke:new Float32Array(3),Le:new Float32Array(3),Me:new Float32Array(3),quat:new Float32Array([0,0,0,1]),J:new Float32Array([0,0,0])}}function m(a,b,d,c,l){return{Ke:new Float32Array(a),Le:new Float32Array(b),Me:new Float32Array(d),quat:new Float32Array(l),J:new Float32Array([c[0],c[1],c[2]])}}function k(a,b,d){q.add(b,d,a.J);q.scale(a.J,.5,a.J);a.Wa=q.distance(a.J,b);
return a}var r=p("__tsr"),h=p("__util"),q=p("__vec3"),g=p("__math"),y=p("__mat3"),f=p("__quat"),l=new Float32Array(24),n=new Float32Array(3),u=new Float32Array(3),A=new Float32Array(3),B=new Float32Array(3),H=new Float32Array(9),v=new Float32Array(9),E=new Float32Array(9);new Float32Array(9);a.vn=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.NL=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};
a.cd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Ev=function(a,b){var d=a.max_y,c=a.max_z,l=a.min_x,g=a.min_y,f=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,d);a.max_z=Math.max(b.max_z,c);a.min_x=Math.min(b.min_x,l);a.min_y=Math.min(b.min_y,g);a.min_z=Math.min(b.min_z,f)};a.sC=e;a.hq=function(c,g,d){d||(d=a.cd());c=b(c,l);r.transform_vectors(c,g,c);return e(c,d)};a.Hv=b;a.CN=function(b,c,d){d||(d=a.cd());var l=c.min_x,g=c.max_x,
f=c.min_y,e=c.max_y,k=c.min_z;c=c.max_z;if(l>=b.max_x||g<=b.min_x||f>=b.max_y||e<=b.min_y||k>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,l);d.max_x=Math.min(b.max_x,g);d.min_y=Math.max(b.min_y,f);d.max_y=Math.min(b.max_y,e);d.min_z=Math.max(b.min_z,k);d.max_z=Math.min(b.max_z,c);return d};a.KN=function(b,c,d){d||(d=a.cd());var l=b.max_x-b.min_x,g=b.max_y-b.min_y,f=b.max_z-b.min_z;d.min_x=b.min_x-.5*(c-1)*l;d.max_x=b.max_x+
.5*(c-1)*l;d.min_y=b.min_y-.5*(c-1)*g;d.max_y=b.max_y+.5*(c-1)*g;d.min_z=b.min_z-.5*(c-1)*f;d.max_z=b.max_z+.5*(c-1)*f;return d};a.jq=function(b,c,d){d||(d=a.Si());r.transform_vec3(b.J,c,d.J);d.Wa=b.Wa*r.get_scale(c);return d};a.iq=function(a,b,d){d||(d=c());r.transform_vec3(a.J,b,d.J);q.copy(a.Ke,d.Ke);q.copy(a.Le,d.Le);q.copy(a.Me,d.Me);r.transform_dir_vec3(d.Ke,b,d.Ke);r.transform_dir_vec3(d.Le,b,d.Le);r.transform_dir_vec3(d.Me,b,d.Me);return d};a.zn=function(a,b){return{Wa:a,J:new Float32Array(b)}};
a.Si=function(){return{J:new Float32Array([0,0,0]),Wa:0}};a.Dp=c;a.yn=m;a.tC=function(){return{J:new Float32Array([0,0,0]),Wa:1E12}};a.BE=function(a,b){var d=q.subtract(b.J,a.J,q.create());0==q.length(d)&&q.set(1,0,0,d);var c=q.normalize(d,q.create()),d=q.scale(c,a.Wa,q.create());q.add(d,a.J,d);var l=q.scale(c,-a.Wa,q.create());q.add(l,a.J,l);var g=q.scale(c,b.Wa,q.create());q.add(g,b.J,g);var f=q.scale(c,-b.Wa,q.create());q.add(f,b.J,f);d=[d,l,g,f];c=q.normalize(c,q.create());l=d[0];g=d[0];for(f=
1;f<d.length;f++){var e=q.dot(d[f],c);e<q.dot(l,c)&&(l=d[f]);e>q.dot(g,c)&&(g=d[f])}c=[l,g];d=c[0];c=c[1];a.J=q.scale(q.add(d,c,q.create()),.5,q.create());a.Wa=q.length(q.subtract(c,d,q.create()))/2};a.qD=function(a){var b=g.HC(a,B),b=g.EC(a,b,v),b=g.KE(b,H);q.copy(a,n);q.transformMat3(n,b,n);for(var d=n[0],c=d,l=n[1],e=l,k=n[2],h=k,u=0,r=0,w=0,t=0,Q=0,N=0,P=3;P<a.length;P+=3)n[0]=a[P],n[1]=a[P+1],n[2]=a[P+2],q.transformMat3(n,b,n),u=n[0],r=n[1],w=n[2],u>d&&(d=u),u<c&&(c=u),r>l&&(l=r),r<e&&(e=r),
w>k&&(k=w),w<h&&(h=w);l-=e;k-=h;d=Math.max(d-c,1E-9);l=Math.max(l,1E-9);k=Math.max(k,1E-9);Math.max(d,l,k);c=y.identity(v);c[0]=0!=d?1/d:1E8;c[4]=0!=l?1/l:1E8;c[8]=0!=k?1/k:1E8;y.transpose(b,E);n[0]=a[0];n[1]=a[1];n[2]=a[2];q.transformMat3(n,E,n);q.transformMat3(n,c,n);q.transformMat3(n,b,n);u=n[0];r=n[0];w=n[1];t=n[1];Q=n[2];N=n[2];for(P=3;P<a.length;P+=3)n[0]=a[P],n[1]=a[P+1],n[2]=a[P+2],q.transformMat3(n,E,n),q.transformMat3(n,c,n),q.transformMat3(n,b,n),u=Math.max(u,n[0]),r=Math.min(r,n[0]),w=
Math.max(w,n[1]),t=Math.min(t,n[1]),Q=Math.max(Q,n[2]),N=Math.min(N,n[2]);a=Math.sqrt((u-r)*(u-r)+(w-t)*(w-t)+(Q-N)*(Q-N))/2;A[0]=(u+r)/2;A[1]=(w+t)/2;A[2]=(Q+N)/2;c=y.identity(v);c[0]=d;c[4]=l;c[8]=k;q.transformMat3(A,E,A);q.transformMat3(A,c,A);q.transformMat3(A,b,A);P=[b[0],b[3],b[6]];c=[b[1],b[4],b[7]];u=[b[2],b[5],b[8]];q.scale(P,d*a,P);q.scale(c,l*a,c);q.scale(u,k*a,u);a=[0,0,0,1];f.fromMat3(b,a);return m(P,c,u,A,a)};a.RJ=function(a){var b=h.za(a.sf),d=r.Gg(a.i,B);q.subtract(b.J,d,b.J);a.Ne=
b};a.kv=function(a,b){var d=b.max_y,c=b.min_y,l=Math.max(0,d-c-2*a);return{Wa:a,height:l,J:new Float32Array([0,(d+c)/2,0])}};a.mv=function(a,b){var d=b.max_y,c=b.min_y,l=Math.max(0,d-c);return{Wa:a,height:l,J:new Float32Array([0,(d+c)/2,0])}};a.lv=function(a,b){var d=b.max_y,c=b.min_y,l=Math.max(0,d-c);return{Wa:a,height:l,J:new Float32Array([0,(d+c)/2,0])}};a.QL=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.RH=
function(a){for(var b=0,d=0,c=0,l=0,g=0,f=0,e=0,k=0,n=0;n<a.submeshes.length;n++){var w=a.submeshes[n];if(w.position.length){b=l=w.position[0];d=g=w.position[1];c=f=w.position[2];break}}for(n=0;n<a.submeshes.length;n++)for(var w=a.submeshes[n],w=w.position,t=0;t<w.length/3;t++)var Q=w[3*t],N=w[3*t+1],P=w[3*t+2],b=Math.max(Q,b),d=Math.max(N,d),c=Math.max(P,c),l=Math.min(Q,l),g=Math.min(N,g),f=Math.min(P,f),e=Math.max(Math.sqrt(Q*Q+N*N+P*P),e),k=Math.max(Math.sqrt(Q*Q+P*P),k);a.b4w_bounding_box.max_x=
b;a.b4w_bounding_box.min_x=l;a.b4w_bounding_box.max_y=d;a.b4w_bounding_box.min_y=g;a.b4w_bounding_box.max_z=c;a.b4w_bounding_box.min_z=f;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=l;a.b4w_bounding_box_source.max_y=d;a.b4w_bounding_box_source.min_y=g;a.b4w_bounding_box_source.max_z=c;a.b4w_bounding_box_source.min_z=f;a.b4w_bounding_sphere_radius=e;a.b4w_bounding_cylinder_radius=k};a.GF=function(b){var c=b.subarray(0,3),d=b.subarray(6,9),l=b.subarray(12,15),g=b.subarray(18,21);
b=q.subtract(d,c,n);q.normalize(b,b);var f=h.NF(c,d,l,u),f=q.cross(f,b,f);q.normalize(f,f);var e=q.create(),m=q.create();q.subtract(d,c,A);m[0]=q.dot(A,b);m[1]=q.dot(A,f);d=q.create();q.subtract(l,c,A);d[0]=q.dot(A,b);d[1]=q.dot(A,f);l=q.create();q.subtract(g,c,A);l[0]=q.dot(A,b);l[1]=q.dot(A,f);g=a.Si();l=[e,m,d,l];e=k(g,l[0],l[1]);for(g=2;g<l.length;g++)if(q.distance(e.J,l[g])>e.Wa){for(var r=e,e=l,m=l[g],d=g-1,r=k(r,m,e[0]),y=1;y<=d;y++)if(q.distance(r.J,e[y])>r.Wa){for(var w=r,r=e,t=m,Q=e[y],
N=y-1,w=k(w,t,Q),P=0;P<=N;P++)if(q.distance(w.J,r[P])>w.Wa){var S=t,Z=Q,v=r[P],B=q.subtract(Z,v,A),B=q.squaredLength(B),E=q.subtract(S,v,A),p=q.squaredLength(E),E=q.subtract(S,Z,A),ka=q.squaredLength(E),E=B*(p+ka-B),H=p*(ka+B-p),B=ka*(B+p-ka),p=E+H+B;q.copy(S,w.J);q.scale(w.J,E/p,w.J);q.scaleAndAdd(w.J,Z,H/p,w.J);q.scaleAndAdd(w.J,v,B/p,w.J);w.Wa=q.distance(w.J,S)}r=w}e=r}g=e;b=q.scale(b,g.J[0],A);q.scaleAndAdd(b,f,g.J[1],b);q.add(b,c,g.J);return g}};b4w.module.__compat=function(a,p){function e(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function c(){return!window.ActiveXObject&&"ActiveXObject"in window}var m=p("__config"),k=p("__extensions"),r=p("__print"),
h="R600;RV610;RV630;RV620;RV635;RV670;RS780;RS880;RV770;RV730;RV710;RV740;CEDAR;REDWOOD;JUNIPER;CYPRESS;PALM (Wrestler/Ontario);SUMO (Llano);SUMO2 (Llano);ARUBA (Trinity/Richland);BARTS;TURKS;CAICOS;CAYMAN".split(";");a.gu=256;var q=m.Ch,g=m.q,y=m.context,f=m.ek,l=m.I,n=m.o;a.jE=function(a){a.getError()==a.INVALID_ENUM&&r.warn("Possible Tegra invalid enum issue detected, ignoring")};a.xI=function(m){g.kx=m.getParameter(m.MAX_VERTEX_UNIFORM_VECTORS);g.zb=m.getParameter(m.MAX_TEXTURE_SIZE);g.Ng=m.getParameter(m.MAX_CUBE_MAP_TEXTURE_SIZE);
g.Dc=g.Hc?Math.min(g.Dc,m.getParameter(m.MAX_SAMPLES)):1;var A=Boolean(k.BF());e("Firefox/28.0")&&(e("Linux")||e("Macintosh"))&&(r.warn("Firefox 28 detected, applying depth hack"),A=!1);e("Windows Phone")||(e("iPad")||e("iPhone")?(r.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),y.alpha||(g.background_color[3]=1),g.Fz=!0,g.smaa=!1,g.Zc=!1,g.precision=
"highp",g.Cr=!0,f.ol=256):e("Mac OS X")&&e("Safari")&&!e("Chrome")&&(r.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures. Applying canvas alpha hack."),g.my=!0,l.Eu=!0,l.cv=!0));e("Windows")&&(e("Chrome/40")||e("Firefox/33")||e("Firefox/34")||e("Firefox/35")||e("Firefox/36"))&&(r.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),g.uq=!0);e("Mac OS X")&&(g.ro=!0,r.warn("OS X detected, applying shadows hack."));
b()&&(r.warn("Mobile detected, applying various hacks for video textures."),g.Ve=!0,e("iPad")||e("iPhone")||e("Windows Phone")||(r.warn("Mobile (not iOS) detected, disable playback rate for video textures."),l.Av=!0));(e("Firefox/35.0")||e("Firefox/36.0"))&&e("Windows")&&(r.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),g.Kv=!0);if(e("iPhone")||c()||e("Edge"))r.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),g.nm=!0;10>m.getParameter(m.MAX_VARYING_VECTORS)&&
(r.warn("Not enough varyings, disable shadows on blend objects"),g.Qq=!0);e("Windows Phone")&&(r.warn("Windows Phone detected. Disable wireframe mode, glow materials, ssao, smaa, shadows, reflections, refractions."),g.wireframe_debug=!1,g.precision="highp",g.Kf=!1,g.Zc=!1,g.smaa=!1,g.gk=!1,g.im=!1,g.Gc=!1,g.Yx=!1);e("Firefox")&&g.Ve&&(r.warn("Mobile Firefox detected, disable workers."),n.Dm=!1);var B=k.gw();if(B){var p=m.getParameter(B.UNMASKED_VENDOR_WEBGL),B=m.getParameter(B.UNMASKED_RENDERER_WEBGL),
v=/\b4\d{2}\b/;e("Macintosh")&&-1<B.indexOf("Intel HD Graphics 3000")&&(r.warn("OS X / Intel HD 3000 detected, applying depth hack"),A=!1);-1<p.indexOf("ARM")&&v.test(B)&&(r.warn("ARM Mali-400 series detected, applying depth and frames blending hacks"),A=!1,q.Ov=!0);-1<p.indexOf("ARM")&&-1<B.indexOf("Mali-T604")&&(r.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),g.precision="highp",g.gk=!1);-1<p.indexOf("ARM")&&-1<B.indexOf("Mali-T760")&&(r.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),
g.precision="highp",g.Zc=!1,g.Op=!0);-1<p.indexOf("Qualcomm")&&-1<B.indexOf("Adreno")&&(r.warn("Qualcomm Adreno detected, applying shader constants hack."),g.wy=!0,-1<B.indexOf("305")&&(r.warn('Qualcomm Adreno305 detected, set "highp" precision.'),g.precision="highp"),-1<B.indexOf("330")&&(r.warn('Qualcomm Adreno330 detected, set "highp" precision.'),g.precision="highp"),-1<B.indexOf("420")&&(r.warn("Qualcomm Adreno420 detected, setting max cubemap size to 4096, setting max texture size to 4096."),
g.zb=4096,g.Ng=4096));-1<p.indexOf("NVIDIA")&&-1<B.indexOf("Tegra 3")&&(r.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.cr=!0);e("Windows")&&e("Chrome")&&!e("Edge")&&(B.match(/NVIDIA GeForce 8..0/)||B.match(/NVIDIA GeForce 9..0/)||B.match(/NVIDIA GeForce( (G|GT|GTS|GTX))? 2../))&&(r.warn("Chrome / Windows / NVIDIA GeForce 8/9/200 series detected, setting max cubemap size to 256, use canvas for resizing."),g.Ng=a.gu,g.hy=!0);p="";for(v=0;v<h.length;v++)if(-1<
B.indexOf(h[v])){p=h[v];break}p&&(r.warn("Architecture "+p+" detected. Blending between frames and shadows on blend objects will be disabled."),g.Op=!0,g.Qq=!0)}0==m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(r.warn("Vertex textures are not allowed. Disabling vertex textures"),g.an=!1);A||(g.mj=!1,g.Zl=!1,g.fc=!1,g.water_dynamic=!1,g.shore_smoothing=!1,g.hk=!1,g.smaa=!1);g.xz=Boolean(k.hw());g.Fn=A;if(m.getShaderPrecisionFormat)var E=m.getShaderPrecisionFormat(m.FRAGMENT_SHADER,m.HIGH_FLOAT);
m.getShaderPrecisionFormat&&0!==E.precision||(g.precision="mediump");c()&&(r.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),f.ol=512);if(c()&&e("Touch")||e("Edge"))r.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),g.Yn=!0;128>=m.getParameter(m.MAX_FRAGMENT_UNIFORM_VECTORS)&&(r.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.cr=!0);e("Chrome")&&!e("Edge")&&r.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called.");
if(e("Chrome")&&!e("Edge")||e("Firefox"))g.Rq=!0;b()&&e("Firefox")&&(r.log("Mobile firefox detected. Applying autoplay media hack."),g.as=!0);e("Edge")&&(r.warn("Microsoft Edge detected, set up new minimal texture size."),g.vl=!0);e("SamsungBrowser")&&(r.warn("Default Android browser detected, setting max cubemap size to 1024, setting max texture size to 1024."),g.zb=1024,g.Ng=1024)};a.sq=e;a.detect_mobile=b;a.eC=function(){e("Firefox/35.0")&&e("Windows")&&(r.warn("Windows/Firefox 35 detected, forcing context's alpha"),
m.context.alpha=!0)};a.Hr=c};b4w.module.__constraints=function(a,p){function e(a){var d={};d.type=a;return d}function b(a,d){a.ib&&a.ib.fa&&c(a.ib.fa,a);if(d.fa){var b=d.fa;if(-1==b.Kc.indexOf(a))b.Kc.push(a);else throw"Descendant object override is forbidden";}a.ib=d}function c(a,d){var b=a.Kc.indexOf(d);if(-1!=b)a.Kc.splice(b,1);else throw"No descendant object";}function m(a,b,c){switch(b.type){case 1:var w=n.get_quat_view(a.g.i),t=b.fa.g.i;c=n.get_quat_view(b.fa.g.i);b.xc?(l.copy(b.xc,w),l.multiply(c,w,w)):l.copy(c,w);var f=
n.transform_vec3(b.offset,t,v);n.set_trans(f,a.g.i);f=n.get_scale(b.fa.g.i);n.set_scale(b.mm*f,a.g.i);break;case 9:f=n.get_trans_view(a.g.i);w=n.get_quat_view(a.g.i);t=b.fa.g.i;c=n.get_quat_view(b.fa.g.i);l.multiply(l.invert(b.vi,b.vi),w,w);l.multiply(c,w,w);n.transform_vec3(b.offset,t,f);l.copy(c,b.vi);break;case 10:f=n.get_trans_view(a.g.i);w=n.get_quat_view(a.g.i);t=b.fa.g.i;c=n.get_quat_view(b.fa.g.i);l.multiply(l.invert(b.vi,b.vi),w,w);l.multiply(c,w,w);n.transform_vec3(b.offset,t,f);l.copy(c,
b.vi);f=n.get_quat_view(a.g.i);w=n.get_quat_view(b.fa.g.i);w=l.multiply(w,b.xc,d);w=g.$v(w,B);f=g.$v(f,H);g.rotate_eye_camera(a,u.Ih(f[0],w[0]+b.dD,w[0]+b.cD),u.Ih(f[1],w[1]+b.bD,w[1]+b.eD));break;case 13:var f=n.get_trans_view(a.g.i),w=n.get_quat_view(a.g.i),t=b.fa.g.i,e=n.get_trans_view(t),P=b.dJ,k=v,m=d;n.transform_vec3(b.offset,t,k);u.smooth_v(k,f,c,P,f);t=v;A.sub(e,f,t);A.normalize(t,t);var z=w,f=F,e=f.subarray(0,3),k=f.subarray(3,6),G=f.subarray(6,9);A.copy(t,k);A.negate(k,k);A.normalize(k,
k);Boolean(.999999<Math.abs(A.dot(t,u.AXIS_Y)))?(t=y.fromQuat(l.normalize(z,m),J),A.copy(t.subarray(0,3),e)):A.cross(u.AXIS_Y,k,e);A.normalize(e,e);A.cross(e,k,G);A.normalize(G,G);l.fromMat3(f,m);l.normalize(m,m);u.Ey(m,w,c,.16*P,w);break;case 2:w=n.get_quat_view(a.g.i);c=C;q.get_bone_tsr(b.fa,b.Gh,!0,!1,c);n.multiply(b.fa.g.i,c,c);w[0]=c[4];w[1]=c[5];w[2]=c[6];w[3]=c[7];b.xc&&(l.copy(b.xc,w),l.multiply(w,b.xc,w));n.set_scale(b.mm*c[3],a.g.i);f=n.get_trans_view(a.g.i);n.transform_vec3(b.offset,c,
f);break;case 3:f=n.get_trans_view(a.g.i);w=n.get_quat_view(a.g.i);c=n.get_trans_view(b.fa.g.i);r(f,w,c);break;case 4:f=n.get_trans_view(a.g.i);w=n.get_quat_view(a.g.i);c=b.target;r(f,w,c);break;case 5:f=n.get_trans_view(a.g.i);w=n.get_quat_view(a.g.i);c=n.get_trans_view(b.fa.g.i);r(f,w,c);w=A.dist(f,c);if(w=w>b.dist_max?w-b.dist_max:w<b.sl?w-b.sl:0)A.sub(c,f,v),A.normalize(v,v),A.scale(v,w,v),A.add(f,v,f);break;case 6:f=n.get_trans_view(a.g.i);w=n.get_quat_view(a.g.i);c=b.target;r(f,w,c);w=A.dist(f,
c);if(w=w>b.dist_max?w-b.dist_max:w<b.sl?w-b.sl:0)A.sub(c,f,v),A.normalize(v,v),A.scale(v,w,v),A.add(f,v,f);break;case 7:t=b.fa.g.i;f=n.get_trans_view(a.g.i);n.transform_vec3(b.offset,t,f);break;case 8:e=n.get_trans_view(b.fa.g.i);f=n.get_trans_view(a.g.i);A.add(e,b.offset,f);break;case 14:w=n.get_quat_view(a.g.i);t=b.fa.g.i;c=n.get_quat_view(b.fa.g.i);b.xc?(l.copy(b.xc,w),l.multiply(c,w,w)):l.copy(c,w);f=n.get_trans_view(a.g.i);n.transform_vec3(b.offset,t,f);break;case 11:n.multiply(b.fa.g.i,b.op,
a.g.i);break;case 12:f=b.op;c=C;q.get_bone_tsr(b.fa,b.Gh,!0,!1,c);n.multiply(b.fa.g.i,c,c);n.multiply(c,f,a.g.i);break;case 15:w=b.fa,c=g.EF(w),f=n.get_trans_view(a.g.i),t=g.uj(c,"LEFT"),e=g.uj(c,"RIGHT"),P=g.uj(c,"TOP"),m=g.uj(c,"BOTTOM"),k="heights"==b.hor_units?P-m:e-t,b.$w?(t=g.uj(c,"LEFT"),f[0]=t+k*b.Nr):(e=g.uj(c,"RIGHT"),f[0]=e-k*b.Nr),t="heights"==b.vert_units?P-m:e-t,f[2]=b.dz?-(P-t*b.wt):-(m+t*b.wt),g.qG(c)?f[1]=-b.distance:(f[1]=-1,A.normalize(f,f),A.scale(f,b.distance/Math.abs(f[1]),f)),
n.transform_dir_vec3(f,w.g.i,f),c=n.get_trans_view(w.g.i),A.add(c,f,f),f=n.get_quat_view(a.g.i),w=n.get_quat_view(w.g.i),b.xc?(l.copy(b.xc,f),l.multiply(w,f,f)):l.copy(w,f)}"CAMERA"==a.g.type&&(f=u.AXIS_Y,10==b.type&&(c=n.get_quat_view(b.fa.g.i),f=A.transformQuat(f,c,D)),g.Dt(a),h(a,f))}function k(a,b){switch(b.type){case 1:var d=b.target.g.i,c=C;n.invert(a.g.i,c);n.multiply(c,d,c);q.set_bone_tsr(a,b.Gh,c,!1)}a.fs=!0}function r(a,b,d){var c=v;u.quat_to_dir(b,u.AXIS_MY,c);A.normalize(c,c);var t=E;
A.subtract(d,a,t);A.normalize(t,t);a=u.ly(c,t,G);l.multiply(a,b,b);l.normalize(b,b)}function h(a,b,c){var w=a.g,t=n.get_quat_view(w.i),f=u.quat_to_dir(t,u.AXIS_Y,v);A.normalize(f,f);if(.999999<Math.abs(A.dot(b,f)))f=l.identity(d);else{var e=A.cross(b,f,E);A.normalize(e,e);w.Va==g.MS_TARGET_CONTROLS?w.hp&&A.negate(e,e):(w=u.quat_to_dir(t,u.AXIS_Z,z),0<A.dot(w,b)&&A.negate(e,e));w=u.quat_to_dir(t,u.AXIS_X,z);A.normalize(w,w);var P=u.clamp(A.dot(w,e),-1,1),f=-.999999>=P?l.setAxisAngle(f,Math.acos(P),
d):l.rotationTo(w,e,d);l.normalize(f,f)}l.multiply(f,t,t);c&&(c=u.quat_to_dir(t,u.AXIS_MZ,v),0>A.dot(b,c)&&l.rotateY(t,Math.PI,t));g.Dt(a)}var q=p("__armature"),g=p("__camera"),y=p("__mat3"),f=p("__print"),l=p("__quat"),n=p("__tsr"),u=p("__util"),A=p("__vec3");a.kL=1;a.jL=2;a.oL=3;a.pL=4;a.eL=5;a.fL=6;a.lL=7;a.dL=8;a.iL=9;a.hL=10;a.bL=11;a.cL=12;a.gL=13;a.mL=14;a.nL=15;a.aL=1;var B=new Float32Array(2),H=new Float32Array(2),v=new Float32Array(3),E=new Float32Array(3),z=new Float32Array(3),G=new Float32Array(4),
d=new Float32Array(4),F=new Float32Array(9),J=new Float32Array(9),C=n.create(),D=new Float32Array(3);a.zu=function(a,d,c,w,t){var l=e(1);l.fa=d;l.offset=new Float32Array(c);l.xc=w?new Float32Array(w):null;l.mm=t;b(a,l);m(a,l,0)};a.VB=function(a,d,c,w,t,l){var f=e(2);f.fa=d;f.Gh=c;f.offset=new Float32Array(w);f.xc=t?new Float32Array(t):null;f.mm=l;b(a,f);m(a,f,0)};a.UB=function(a,d,c,w){var t=e(9),f=n.get_quat_view(a.g.i),g=n.get_quat_view(d.g.i);t.fa=d;t.offset=new Float32Array(c);t.vi=new Float32Array(g);
w&&(l.copy(w,f),l.multiply(g,f,f));b(a,t);m(a,t,0)};a.TB=function(a,d,c,w,t,f,g,P){var k=e(10),J=n.get_quat_view(a.g.i),C=n.get_quat_view(d.g.i);k.fa=d;k.offset=new Float32Array(c);k.vi=new Float32Array(C);k.cD=u.angle_wrap_0_2pi(t);k.dD=u.angle_wrap_0_2pi(f);k.eD=u.angle_wrap_periodic(g,-Math.PI,Math.PI);k.bD=u.angle_wrap_periodic(P,-Math.PI,Math.PI);w?(k.xc=new Float32Array(w),l.copy(w,J),l.multiply(C,J,J)):k.xc=l.create();b(a,k);m(a,k,0)};a.SB=function(a,d,c,w){var t=e(13);t.fa=d;t.offset=new Float32Array(c);
t.dJ=w;b(a,t);m(a,t,0)};a.YB=function(a,d,c,w){var t=e(14);t.fa=d;t.offset=new Float32Array(c);t.mm=1;t.xc=w?new Float32Array(w):null;b(a,t);m(a,t,0)};a.tN=c;a.aC=function(a,d){var c=e(3);c.fa=d;b(a,c);m(a,c,0)};a.bC=function(a,d){var c=e(4);c.target=new Float32Array(d);b(a,c);m(a,c,0)};a.OB=function(a,d,c,w){var t=e(5);t.fa=d;t.sl=c;t.dist_max=w;b(a,t);m(a,t,0)};a.PB=function(a,d,c,w){var t=e(6);t.target=new Float32Array(d);t.sl=c;t.dist_max=w;b(a,t);m(a,t,0)};a.XB=function(a,d,c){var w=e(7);w.fa=
d;w.offset=new Float32Array(c);b(a,w);m(a,w,0)};a.MB=function(a,d,c){var w=e(8);w.fa=d;w.offset=new Float32Array(c);b(a,w);m(a,w,0)};a.KB=function(a,d,c){var w=e(11);w.fa=d;w.op=new Float32Array(c);b(a,w);m(a,w,0)};a.LB=function(a,d,c,w){var t=e(12);t.fa=d;t.Gh=c;t.op=new Float32Array(w);b(a,t);m(a,t,0)};a.append_stiff_viewport=function(a,d,c){var w=e(15);w.fa=d;if(u.ud(c.left))w.$w=!0,w.Nr=c.left;else if(u.ud(c.right))w.$w=!1,w.Nr=c.right;else{f.error("append_stiff_viewport: Wrong positioning params");
return}if(u.ud(c.top))w.dz=!0,w.wt=c.top;else if(u.ud(c.bottom))w.dz=!1,w.wt=c.bottom;else{f.error("append_stiff_viewport: Wrong positioning params");return}u.ud(c.distance)?(w.distance=c.distance,w.xc=u.ud(c.rotation)?new Float32Array(c.rotation):null,w.hor_units=u.ud(c.hor_units)?c.hor_units:"widths",w.vert_units=u.ud(c.vert_units)?c.vert_units:"heights",b(a,w),m(a,w,0)):f.error("append_stiff_viewport: Wrong positioning params")};a.ZJ=function(a,d){a.ib&&m(a,a.ib,d)};a.WB=function(a,d,b,c,t){var f=
e(1);f.Gh=b;f.target=d;f.offset=new Float32Array(c);f.xc=t?new Float32Array(t):null;f.mm=1;d=f.target;b=f.Gh;c=a.g.Rd[b];t=d.Aq;for(var l=0;l<t;l++){var P=t[l];if(P[0]==a&&P[1]==b){t.splice(l,1);break}}d.Aq.push([a,b]);c.ib=f;k(a,f)};a.SJ=function(a,d){var b=a.g.Rd[d];b.ib&&k(a,b.ib)};a.fI=r;a.correct_up=h;a.TC=function(a){return a.ib?!0:!1};a.remove=function(a){a.ib.fa&&c(a.ib.fa,a);a.ib=null};a.JM=function(a){return a.ib?a.ib.type:null};a.ae=function(a){a=a.ib;return!a||11!=a.type&&12!=a.type?!1:
!0};a.Pn=function(a){if((a=a.ib)&&11==a.type)return a.fa.g.i;if(a&&12==a.type){var d=C;q.get_bone_tsr(a.fa,a.Gh,!0,!1,d);n.multiply(a.fa.g.i,d,d);return d}return null};a.$d=function(a){a=a.ib;return!a||11!=a.type&&12!=a.type?null:a.op}};b4w.module.__container=function(a,p){var e,b,c,m,k;function r(a,d){e=a;b=d}function h(){var a=E.getBoundingClientRect();r(a.left,a.top)}function q(){return v.allow_hidpi&&2<=window.devicePixelRatio?!0:!1}var g=p("__anchors"),y=p("__config"),f=p("__data"),l=p("__hud"),n=p("__print"),u=p("__scenes"),A=p("__time"),B=p("__transform"),H=p("__util"),v=y.q,E=null,z=null,G=null,d=!1;m=c=0;k=1;e=b=0;var F=null;a.Gp=320;a.Fp=240;a.Ed=function(a){F=a};a.get_canvas=function(){return E};a.get_canvas_hud=function(){return z};
a.get_container=function(){return G};a.init=function(a,d){a&&a.parentNode?(E=a,z=d,G=a.parentNode):H.da("canvas container is not available")};a.insert_to_container=function(a,d){d=d||"LAST";switch(d){case "FIRST":G.insertBefore(a,G.firstElementChild);break;case "JUST_BEFORE_CANVAS":G.insertBefore(a,E);break;case "JUST_AFTER_CANVAS":E.nextElementSibling?G.insertBefore(a,E.nextElementSibling):G.appendChild(a,E);break;case "LAST":G.appendChild(a,E);break;default:n.error(d+" invalid stack order")}};a.lw=
function(){return c};a.kw=function(){return m};a.set_canvas_offsets=r;a.update_canvas_offsets=h;a.XI=function(a,d,b){c=a;m=d;k=b;h()};a.force_offsets_updating=function(){d=!0};a.client_to_canvas_coords=function(a,c,f){f||(f=new Float32Array(2));var l=f;d&&(h(),d=!1);l[0]=a-e;a=f;d&&(h(),d=!1);a[1]=c-b;return f};a.Wk=function(a,d,b,f){b||(b=new Float32Array(2));b[0]=a*k;b[1]=d*k;f&&(a=f.width/c,b[0]*=a,b[1]*=a);return b};a.OK=function(a,d,b,f){b||(b=new Float32Array(2));b[0]=a/k;b[1]=d/k;f&&(a=f.width/
c,b[0]/=a,b[1]/=a)};a.Dw=function(d){return d&&d.parentNode?d.parentNode==G?!0:a.Dw(d.parentNode):!1};a.mG=q;a.ME=function(a){var d=document.getElementsByTagName("script");a=H.Ul(a);for(var b=0;b<d.length;b++)if(d[b].src==a)return d[b];return null};a.resize=function(d,b,c){if(!d||!b){d=a.Gp;b=a.Fp;var e=G;e.style.width=a.Gp+"px";e.style.height=a.Fp+"px"}var e=E,k=z;!1!==c&&(e.style.width=d+"px",e.style.height=b+"px",k&&(k.style.width=d+"px",k.style.height=b+"px"));k&&(k.width=d,k.height=b,l.wm());
c=Math.floor(d*v.canvas_resolution_factor);b=Math.floor(b*v.canvas_resolution_factor);q()&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);f.is_primary_loaded()&&(k=u.get_active().k,c=Math.floor(c*k.Vc),b=Math.floor(b*k.Vc));e.width=c;e.height=b;if(c>F.drawingBufferWidth||b>F.drawingBufferHeight)n.warn("Canvas size exceeds platform limits, downscaling"),k=Math.min(F.drawingBufferWidth/c,F.drawingBufferHeight/b),c*=k,b*=k,e.width=c,e.height=b;u.vy(c,b,c/d);u.ma()&&B.n(u.get_active().tg);f.cK(e.width,
e.height);f.is_primary_loaded()&&(g.update(),u.update(A.get_timeline(),0),g.wz())}};b4w.module.__controls=function(a,p){function e(a,b){b||(b=f.get_container());return{type:a,value:0,aa:null,element:b,na:!1,key:0,Ya:"",Pe:!1,xq:null,wq:function(){},vq:null,ev:function(){},eh:null,from:new Float32Array(3),to:new Float32Array(3),Cw:!1,Zn:!1,gm:0,by:function(){},axis:"",Id:0,Bk:new Float32Array(3),Ro:new Float32Array(4),threshold:0,Zx:new Float32Array(4),hn:0,gn:0,ky:0,jn:0,yd:0,repeat:!1,Fu:!1,te:0,callback:function(){}}}function b(a){a||(a=f.get_container());for(var b=0;b<T.length;b++)if(a==
T[b].element)return T[b];var c={element:a,Bj:!1,jo:!0,bs:0,cs:0,Lj:0,Mj:0,Ae:new Float32Array(2),$c:new Float32Array(2),Be:new Float32Array(2),Jd:new Float32Array(2),lp:0,yt:0,iz:0,oE:{},Bp:0,Ns:null,pw:B.create(),Xn:0,Wn:0,Vn:0,vr:0,ur:0,Un:-1E3,eN:null,ag:{},Gx:function(a){B.copy(a,c.pw)},Fx:function(a){a=z.copy(a,t);c.Vn=a[0];c.Wn=a[1];c.Xn=a[2];-1E3==c.Un&&(c.Un=a[0],c.ur=a[1],c.vr=a[2])},sx:function(a){c.Bp+=a*d.iH},ox:function(a){var b=l.get_device_by_type_element(l.DEVICE_MOUSE,c.element),
b=l.get_vector_param(b,l.MOUSE_LOCATION,K);c.bs=b[0];c.cs=b[1];c.Lj=b[0];c.Mj=b[1];c.Bj=!0;c.which=a},qx:function(){var a=l.get_device_by_type_element(l.DEVICE_MOUSE,c.element),a=l.get_vector_param(a,l.MOUSE_LOCATION,K),a=f.client_to_canvas_coords(a[0],a[1],K);c.Ns=n.pick_object(a[0],a[1])},gz:function(a){1==a.length&&(a=f.client_to_canvas_coords(a[0].clientX,a[0].clientY,K),c.Ns=n.pick_object(a[0],a[1]))},rx:function(){c.Bj=!1},px:function(a){if(!F.Yn||c.Bj)c.Lj=a[0],c.Mj=a[1]},Vw:function(a){for(var b=
0;b<D.length;b++){var d=D[b];20==d.type&&a==d.key&&k(d,1)}},Ww:function(a){for(var b=0;b<D.length;b++){var d=D[b];20==d.type&&0==a&&16==d.key&&k(d,0);20==d.type&&a==d.key&&k(d,0)}},hz:function(a){c.jo=!1;if(1==a.length)c.Ae[0]=a[0].clientX,c.Ae[1]=-1,c.Be[0]=a[0].clientY,c.Be[1]=-1;else if(1<a.length){c.lp=c.yt=g(a);c.Ae[0]=a[0].clientX;c.Ae[1]=a[1].clientX;c.Be[0]=a[0].clientY;c.Be[1]=a[1].clientY;var b=a[0];a=a[1];c.iz=Math.atan2(b.clientY-a.clientY,b.clientX-a.clientX)}c.$c.set(c.Ae);c.Jd.set(c.Be)},
fz:function(a){1===a.length?(c.$c[0]=a[0].clientX,c.$c[1]=-1,c.Jd[0]=a[0].clientY,c.Jd[1]=-1):1<a.length&&(c.$c[0]=a[0].clientX,c.$c[1]=a[1].clientX,c.Jd[0]=a[0].clientY,c.Jd[1]=a[1].clientY,c.lp=g(a))},ez:function(a){0==a.length&&(c.jo=!0)}};T.push(c);return c}function c(a,b){if(b in a.ag&&0<a.ag[b])a.ag[b]+=1;else switch(a.ag[b]=1,b){case "orientation_quat":var d=l.get_device_by_type_element(l.DEVICE_GYRO);l.attach_param_cb(d,l.GYRO_ORIENTATION_QUAT,a.Gx);break;case "orientation_angles":d=l.get_device_by_type_element(l.DEVICE_GYRO);
l.attach_param_cb(d,l.GYRO_ORIENTATION_ANGLES,a.Fx);break;case "mouse_wheel":d=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.attach_param_cb(d,l.MOUSE_WHEEL,a.sx);break;case "mouse_down_which":d=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.attach_param_cb(d,l.MOUSE_DOWN_WHICH,a.ox);break;case "mouse_select":d=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.attach_param_cb(d,l.MOUSE_DOWN_WHICH,a.qx);break;case "touch_select":d=l.get_device_by_type_element(l.DEVICE_TOUCH,
a.element);l.attach_param_cb(d,l.TOUCH_START,a.gz);break;case "mouse_up_which":d=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.attach_param_cb(d,l.MOUSE_UP_WHICH,a.rx);break;case "mouse_location":d=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.attach_param_cb(d,l.MOUSE_LOCATION,a.px);break;case "keyboard_downed_keys":d=l.get_device_by_type_element(l.DEVICE_KEYBOARD,a.element);l.attach_param_cb(d,l.KEYBOARD_DOWN,a.Vw);l.attach_param_cb(d,l.KEYBOARD_UP,a.Ww);break;case "touch_start":d=
l.get_device_by_type_element(l.DEVICE_TOUCH,a.element);l.attach_param_cb(d,l.TOUCH_START,a.hz);break;case "touch_move":d=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element);l.attach_param_cb(d,l.TOUCH_MOVE,a.fz);break;case "touch_end":d=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element),l.attach_param_cb(d,l.TOUCH_END,a.ez)}}function m(a,d){if(!(!d in a.ag)&&0<a.ag[d]&&(--a.ag[d],!a.ag[d]))switch(d){case "orientation_quat":var b=l.get_device_by_type_element(l.DEVICE_GYRO);l.detach_param_cb(b,
l.GYRO_ORIENTATION_QUAT,a.Gx);break;case "orientation_angles":b=l.get_device_by_type_element(l.DEVICE_GYRO);l.detach_param_cb(b,l.GYRO_ORIENTATION_ANGLES,a.Fx);break;case "mouse_wheel":b=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.detach_param_cb(b,l.MOUSE_WHEEL,a.sx);break;case "mouse_down_which":b=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.detach_param_cb(b,l.MOUSE_DOWN_WHICH,a.ox);break;case "mouse_select":b=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.detach_param_cb(b,
l.MOUSE_DOWN_WHICH,a.qx);break;case "touch_select":b=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element);l.detach_param_cb(b,l.TOUCH_START,a.gz);break;case "mouse_up_which":b=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.detach_param_cb(b,l.MOUSE_UP_WHICH,a.rx);break;case "mouse_location":b=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element);l.detach_param_cb(b,l.MOUSE_LOCATION,a.px);break;case "keyboard_downed_keys":b=l.get_device_by_type_element(l.DEVICE_KEYBOARD,a.element);l.detach_param_cb(b,
l.KEYBOARD_DOWN,a.Vw);l.detach_param_cb(b,l.KEYBOARD_UP,a.Ww);break;case "touch_start":b=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element);l.detach_param_cb(b,l.TOUCH_START,a.hz);break;case "touch_move":b=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element);l.detach_param_cb(b,l.TOUCH_MOVE,a.fz);break;case "touch_end":b=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element),l.detach_param_cb(b,l.TOUCH_END,a.ez)}}function k(a,b){a.value=Number(b)}function r(a){for(var b=a.Zg,d=a.mI,c=0;c<b.length;c++)d[c]=
b[c].value;return a.TG(d)}function h(a,b){a=a||C;var d=a.ye;if(d){var c=a.Ci;if(b){var w=d[b];if(w){for(var t=w.Zg,f=0;f<t.length;f++){var l=t[f],g;g=D.indexOf(l);g=-1<g?O[g]:[];1==g.length?(q(l),l=D.indexOf(l),-1<l?(D.splice(l,1),O.splice(l,1)):E.da("Sensors cache is corrupted")):1<g.length&&g.splice(g.indexOf(w,1))}delete d[b];f=c.indexOf(w);-1<f?c.splice(f,1):E.da("Incorrect manifolds array");Object.getOwnPropertyNames(d).length||(d=J.indexOf(a),-1<d?J.splice(d,1):u.error("Wrong object"))}}else{c=
[];for(b in d)c.push(b);for(f=0;f<c.length;f++)h(a,c[f])}Q=!0}}function q(a){switch(a.type){case 90:A.remove_collision_test(a.xq,a.Ya,a.wq);a.na=!0;break;case 100:A.clear_collision_impulse_test(a.vq);a.na=!0;break;case 110:A.remove_ray_test(a.gm);a.na=!0;break;case 140:a.na=!0;break;case 20:var d=b(a.element);m(d,"keyboard_downed_keys");a.na=!0;break;case 30:d=b(a.element);m(d,"mouse_wheel");a.na=!0;break;case 40:d=b(a.element);m(d,"mouse_down_which");m(d,"mouse_up_which");m(d,"mouse_location");a.na=
!0;break;case 50:d=b(a.element);m(d,"mouse_down_which");m(d,"mouse_up_which");a.na=!0;break;case 60:d=b(a.element);m(d,"touch_start");m(d,"touch_move");m(d,"touch_end");a.na=!0;break;case 70:d=b(a.element);m(d,"touch_start");m(d,"touch_move");a.na=!0;break;case 75:d=b(a.element);m(d,"touch_start");m(d,"touch_move");a.na=!0;break;case 80:d=b(a.element);m(d,"touch_start");m(d,"touch_end");a.na=!0;break;case 170:d=b(a.element);m(d,"mouse_select");m(d,"touch_select");m(d,"touch_start");m(d,"touch_end");
m(d,"mouse_down_which");m(d,"mouse_up_which");a.na=!0;break;case 180:case 190:d=b(a.element);m(d,"orientation_angles");a.na=!0;break;case 200:d=b(a.element);m(d,"orientation_quat");a.na=!0;break;case 210:case 220:a.na=!0}}function g(a){var d=a[0],b=a[1];a=d.clientX-b.clientX;d=d.clientY-b.clientY;return Math.sqrt(a*a+d*d)}var y=p("__config"),f=p("__container"),l=p("__input"),n=p("__objects"),u=p("__print"),A=p("__physics"),B=p("__quat"),H=p("__time"),v=p("__tsr"),E=p("__util"),z=p("__vec3"),G=p("__vec4"),
d=y.controls,F=y.q,J=[],C={},D=[],O=[],T=[],K=new Float32Array(2),w=new Float32Array(2),t=z.create();B.create();var Q=!1,N=0;a.CT_POSITIVE=10;a.CT_CONTINUOUS=20;a.CT_TRIGGER=30;a.CT_SHOT=40;a.CT_LEVEL=50;a.CT_CHANGE=60;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.PL_MULTITOUCH_MOVE_ROTATE=3;a.update=function(d,c){for(var t=0;t<D.length;t++){var f=D[t],g=d,e=c;if(e)switch(f.type){case 120:var n=f.eh,h=v.get_trans_view(n.g.i),n=v.get_quat_view(n.g.i),m=z.dist(f.Bk,
h),q=f.Zx;B.invert(f.Ro,q);B.multiply(n,q,q);B.normalize(q,q);q=Math.abs(2*Math.acos(q[3]));m/=e;f.hn=E.smooth(m,f.hn,e,.3);f.aa[0]=m;m=q/e;f.gn=E.smooth(m,f.gn,e,.3);f.aa[1]=m;f.hn>=f.threshold||f.gn>=f.ky?k(f,1):k(f,0);z.copy(h,f.Bk);B.copy(n,f.Ro);f.Id=g;break;case 130:n=f.eh;h=v.get_trans_view(n.g.i);n=Math.abs(h[1]-f.Bk[1])/e;f.jn=E.smooth(n,f.jn,e,.3);f.aa=n;f.jn>=f.threshold?k(f,1):k(f,0);z.copy(h,f.Bk);f.Id=g;break;case 140:!f.na&&0<=f.yd&&g-f.Id>=f.yd&&(k(f,1),f.repeat?f.Id=g:f.yd=-f.yd);
break;case 150:f.Id||(f.Id=g);k(f,g-f.Id);f.Id=g;break;case 160:k(f,g);break;case 180:e=b(f.element);f.aa[0]=e.Xn-e.vr;f.aa[1]=e.Wn-e.ur;f.aa[2]=e.Vn-e.Un;e.vr=e.Xn;e.ur=e.Wn;e.Un=e.Vn;break;case 190:e=b(f.element);f.aa[0]=e.Xn;f.aa[1]=e.Wn;f.aa[2]=e.Vn;break;case 200:e=b(f.element);B.copy(e.pw,f.aa);break;case 210:g=l.get_device_by_type_element(l.DEVICE_HMD);l.get_vector_param(g,l.HMD_ORIENTATION_QUAT,f.aa);break;case 220:g=l.get_device_by_type_element(l.DEVICE_HMD);l.get_vector_param(g,l.HMD_POSITION,
f.aa);break;case 240:g=0==f.te?l.get_device_by_type_element(l.Lk):1==f.te?l.get_device_by_type_element(l.Nm):2==f.te?l.get_device_by_type_element(l.Om):l.get_device_by_type_element(l.Pm);f.value=l.HF(g,f.key);break;case 250:g=0==f.te?l.get_device_by_type_element(l.Lk):1==f.te?l.get_device_by_type_element(l.Nm):2==f.te?l.get_device_by_type_element(l.Om):l.get_device_by_type_element(l.Pm);G.copy(g.sj,f.aa);break;case 230:k(f,f.callback());break;case 30:e=b(f.element);k(f,e.Bp);break;case 40:e=b(f.element);
if(!F.Yn||e.Bj)switch(g=e.Lj-e.bs,h=e.Mj-e.cs,f.axis){case "X":k(f,g);f.aa=e.Lj;break;case "Y":k(f,h);f.aa=e.Mj;break;case "XY":n=Math.sqrt(g*g+h*h),k(f,n),f.aa[0]=e.Lj,f.aa[1]=e.Mj}break;case 50:e=b(f.element);k(f,e.Bj);f.aa=e.which;break;case 170:e=b(f.element);f.Fu&&!e.Bj&&e.jo||e.Ns!=f.eh?k(f,0):k(f,1);break;case 60:e=b(f.element);-1==e.$c[1]&&-1==e.Jd[1]?(g=e.$c[0]-e.Ae[0],h=e.Jd[0]-e.Be[0],n=Math.sqrt(g*g+h*h),-1!=e.Ae[1]&&-1!=e.Be[1]&&(m=e.$c[0]-e.Ae[1],e=e.Jd[0]-e.Be[1],q=Math.sqrt(m*m+e*
e),q<n&&(g=m,h=e,n=q)),f.aa=a.PL_SINGLE_TOUCH_MOVE):(h=K,h[0]=(e.$c[0]+e.$c[1])/2,h[1]=(e.Jd[0]+e.Jd[1])/2,n=w,n[0]=(e.Ae[0]+e.Ae[1])/2,n[1]=(e.Be[0]+e.Be[1])/2,g=h[0]-n[0],h=h[1]-n[1],n=Math.sqrt(g*g+h*h),f.aa=a.PL_MULTITOUCH_MOVE_PAN);switch(f.axis){case "X":k(f,g);break;case "Y":k(f,h);break;case "XY":k(f,n)}break;case 70:e=b(f.element);g=e.lp-e.yt;f.aa=a.PL_MULTITOUCH_MOVE_ZOOM;k(f,g);break;case 75:e=b(f.element);-1!=e.$c[1]&&(g=Math.atan2(e.Jd[0]-e.Jd[1],e.$c[0]-e.$c[1]),f.aa=a.PL_MULTITOUCH_MOVE_ROTATE,
k(f,g-e.iz));break;case 80:e=b(f.element),e.jo?k(f,0):k(f,1)}}for(t=0;t<J.length;t++)for(e=J[t],f=e.Ci,g=0;g<f.length;g++)if(h=f[g],h.oz!=N){h.oz=N;q=h;n=0;switch(q.type){case a.CT_POSITIVE:n=(m=r(q))?1:0;break;case a.CT_CONTINUOUS:n=q.Pf;(m=r(q))?(n=1,q.Pf=1):1==n?(n=-1,q.Pf=-1):n=0;break;case a.CT_TRIGGER:n=q.Pf;(m=r(q))&&-1==n?(n=1,q.Pf=1):m||1!=n?n=0:(n=-1,q.Pf=-1);break;case a.CT_SHOT:n=q.Pf;(m=r(q))&&-1==n?(n=1,q.Pf=1):m||1!=n?n=0:(n=0,q.Pf=-1);break;case a.CT_LEVEL:m=r(q);q.Xw!=m?(n=1,q.Xw=
m):n=0;break;case a.CT_CHANGE:for(var m=q.Zg,q=q.xG,u=0;u<m.length;u++){var x=m[u].value;n||x==q[u]||(n=1);q[u]=x}break;default:E.da("Wrong sensor manifold type: "+q.type)}if(n&&(m=e==C?null:e,Q=!1,h.callback(m,h.id,n,h.IC),Q)){t=-1;break}}for(t=0;t<J.length;t++)for(e=J[t],f=e.Ci,g=0;g<f.length;g++)for(h=f[g],e=h.Zg,h=0;h<e.length;h++)switch(n=e[h],n.type){case 30:k(n,0);break;case 40:k(n,0);break;case 60:k(n,0);break;case 70:k(n,0);break;case 75:k(n,0);break;case 80:k(n,0);break;case 140:k(n,0)}for(t=
0;t<T.length;t++)f=T[t],f.Bp=0,f.bs=f.Lj,f.cs=f.Mj,f.oE[0]=!1,f.Ae.set(f.$c),f.Be.set(f.Jd),f.yt=f.lp;N++};a.create_custom_sensor=function(a){var d=e(10);k(d,a);return d};a.create_keyboard_sensor=function(a){var d=e(20,document);d.key=a;d.na=!0;return d};a.create_gamepad_btns_sensor=function(a,d){var b=e(240,document);b.te=a;b.key=d;b.na=!0;return b};a.create_gamepad_axes_sensor=function(a){var d=e(250,document);d.te=a;d.na=!0;return d};a.create_collision_sensor=function(a,d,b){if(!a||!A.T(a))return u.error("Wrong collision object"),
null;var c=e(90);c.xq=a;c.Ya=d;c.Pe=b;c.aa={coll_obj:null,coll_pos:b?new Float32Array(3):null,coll_norm:b?new Float32Array(3):null,coll_dist:0};c.wq=function(a,d,b,f,t){k(c,a);a=c.aa;a.coll_obj=d;c.Pe&&(a.coll_pos.set(b),a.coll_norm.set(f),a.coll_dist=t)};c.na=!0;return c};a.create_collision_impulse_sensor=function(a){if(!a||!a.o)return u.error("Wrong collision impulse object"),null;var d=e(100);d.vq=a;d.ev=function(a){k(d,a)};d.na=!0;return d};a.create_ray_sensor=function(a,d,b,c,f,t,w){var l=e(110);
l.eh=a;l.from=d;l.to=b;l.Ya=c;l.Cw=f;l.Pe=t;l.Zn=w;l.aa={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),gm:0};l.by=function(a,d,b,c,f,t){l.Cw?k(l,-1==d?0:1):k(l,d);l.aa.hit_fract=d;l.aa.obj_hit=b;l.aa.hit_time=c;l.Pe&&(l.aa.hit_pos.set(f),l.aa.hit_norm.set(t))};l.na=!0;return l};a.create_mouse_click_sensor=function(a){a=e(50,a);a.na=!0;return a};a.create_mouse_wheel_sensor=function(a){a=e(30,a);a.na=!0;return a};a.create_mouse_move_sensor=function(a,d){var b=
e(40,d);b.axis=a||"XY";b.aa="XY"==b.axis?new Float32Array(2):0;b.na=!0;return b};a.create_touch_move_sensor=function(a,d){var b=e(60,d);b.axis=a||"XY";b.aa=0;b.na=!0;return b};a.create_touch_zoom_sensor=function(a){a=e(70,a);a.aa=0;a.na=!0;return a};a.create_touch_rotate_sensor=function(a){a=e(75,a);a.aa=0;a.na=!0;return a};a.create_touch_click_sensor=function(a){a=e(80,a);a.aa=0;a.na=!0;return a};a.create_motion_sensor=function(a,d,b){if(!a)return u.error("Wrong collision object"),null;var c=e(120);
c.eh=a;var f=v.get_trans_view(a.g.i);a=v.get_quat_view(a.g.i);c.Zx=new Float32Array(4);c.Bk=new Float32Array(f);c.Ro=new Float32Array(a);c.hn=0;c.gn=0;c.threshold=d||.1;c.ky=b||.1;c.Id=0;c.aa=new Float32Array([0,0]);return c};a.create_vertical_velocity_sensor=function(a,d){if(!a)return u.error("Wrong collision object"),null;var b=e(130);b.eh=a;var c=v.get_trans_view(a.g.i),f=v.get_quat_view(a.g.i);b.Bk=new Float32Array(c);b.Ro=new Float32Array(f);b.jn=0;b.threshold=d||1;b.Id=0;b.aa=0;return b};a.create_timer_sensor=
function(a,d){var b=e(140);b.yd=a;b.repeat=d;b.na=!0;return b};a.reset_timer_sensor=function(a,d,b,c){a=a||C;a=a.ye;if(!a||!a[d])return u.error("reset_timer_sensor(): wrong object"),null;d=a[d].Zg[b];if(!d)return u.error("reset_timer_sensor(): sensor not found"),null;d.Id=H.get_timeline();d.yd=c};a.create_elapsed_sensor=function(){var a=e(150);a.Id=0;return a};a.create_gyro_delta_sensor=function(){var a=e(180,window);a.aa=new Float32Array(3);l.get_device_by_type_element(l.DEVICE_GYRO)?k(a,1):k(a,
0);a.na=!0;return a};a.create_gyro_angles_sensor=function(){var a=e(190,window);a.aa=new Float32Array(3);l.get_device_by_type_element(l.DEVICE_GYRO)?k(a,1):k(a,0);a.na=!0;return a};a.create_gyro_quat_sensor=function(){var a=e(200,window);a.aa=B.create();l.get_device_by_type_element(l.DEVICE_GYRO)?k(a,1):k(a,0);a.na=!0;return a};a.create_hmd_quat_sensor=function(){var a=e(210,window);a.aa=B.create();l.get_device_by_type_element(l.DEVICE_HMD)?k(a,1):k(a,0);a.na=!0;return a};a.create_hmd_position_sensor=
function(){var a=e(220,window);a.aa=z.create();l.get_device_by_type_element(l.DEVICE_HMD)?k(a,1):k(a,0);a.na=!0;return a};a.create_timeline_sensor=function(){return e(160)};a.create_selection_sensor=function(a,d){var b=e(170);b.eh=a;b.Fu=d;b.na=!0;return b};a.create_callback_sensor=function(a,d){var b=e(230);b.callback=a;k(b,d);return b};a.lI=k;a.get_sensor_value=function(a,d,b){a=a||C;a=a.ye;if(!a||!a[d])return u.error("get_sensor_value(): wrong object"),null;d=a[d].Zg[b];return d?d.value:(u.error("get_sensor_value(): sensor not found"),
null)};a.get_sensor_payload=function(a,d,b){a=a||C;a=a.ye;if(!a||!a[d])return u.error("get_sensor_payload(): wrong object"),null;d=a[d].Zg[b];return d?d.aa:(u.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){J=[];C={};for(var a=0;a<D.length;a++)q(D[a]);D.length=0;O.length=0};a.check_sensor_manifold=function(a,d){a=a||C;if(!a.ye)return!1;if(d&&a.ye[d])return!0;if(!d)for(var b in a.ye)return!0;return!1};a.create_sensor_manifold=function(a,d,f,t,w,e,g){a=a||C;a.Ci=a.Ci||[];
a.ye=a.ye||{};var k=a.ye,n=a.Ci;k[d]&&h(a,d);f={id:d,type:f,Zg:t.slice(0),TG:w,mI:Array(t.length),callback:e,IC:g,Pf:-1,Xw:0,xG:Array(t.length),oz:-1};k[d]=f;n.push(f);-1==J.indexOf(a)&&J.push(a);t=f.Zg;for(a=0;a<t.length;a++){k=d=t[a];if(k.na){switch(k.type){case 90:A.append_collision_test(k.xq,k.Ya,k.wq,k.Pe);break;case 100:A.apply_collision_impulse_test(k.vq,k.ev);break;case 110:k.gm=A.append_ray_test(k.eh,k.from,k.to,k.Ya,k.by,!1,!1,k.Pe,k.Zn);k.aa.gm=k.gm;break;case 140:k.Id=H.get_timeline();
0>k.yd&&(k.yd=-k.yd);break;case 20:n=b(k.element);c(n,"keyboard_downed_keys");break;case 30:n=b(k.element);c(n,"mouse_wheel");break;case 40:n=b(k.element);c(n,"mouse_down_which");c(n,"mouse_up_which");c(n,"mouse_location");break;case 50:n=b(k.element);c(n,"mouse_down_which");c(n,"mouse_up_which");break;case 60:n=b(k.element);c(n,"touch_start");c(n,"touch_move");c(n,"touch_end");break;case 70:n=b(k.element);c(n,"touch_start");c(n,"touch_move");break;case 75:n=b(k.element);c(n,"touch_start");c(n,"touch_move");
break;case 80:n=b(k.element);c(n,"touch_start");c(n,"touch_end");break;case 170:n=b(k.element);c(n,"mouse_select");c(n,"touch_select");c(n,"touch_start");c(n,"touch_end");c(n,"mouse_down_which");c(n,"mouse_up_which");break;case 180:case 190:n=b(k.element);c(n,"orientation_angles");break;case 200:n=b(k.element);c(n,"orientation_quat");break;case 240:0==k.te?l.get_device_by_type_element(l.Lk):1==k.te?l.get_device_by_type_element(l.Nm):2==k.te?l.get_device_by_type_element(l.Om):l.get_device_by_type_element(l.Pm);
break;case 250:k.aa=[0,0,0,0]}k.na=!1}k=D.indexOf(d);-1==k?(D.push(d),O.push([f])):O[k].push(f)}Q=!0};a.uv=function(a){for(var d=0;d<a.length;d++)if(!a[d])return a[d];return a[a.length-1]};a.vv=function(a){for(var d=0;d<a.length;d++)if(a[d])return a[d];return a[a.length-1]};a.remove_sensor_manifold=h;a.reset=function(){for(var a=0;a<J.length;a++){var d=J[a],b=d.ye,d=d.Ci,c;for(c in b)delete b[c];d.length=0}for(a=0;a<D.length;a++)q(D[a]);J.length=0;D.length=0;O.length=0};a.debug=function(){u.log(String(J.length)+
" objects with manifolds",J);u.log(String(D.length)+" sensors",D);for(var a=[],d=[],b=0;b<D.length;b++){var c=D[b];90==c.type&&a.push(c);110==c.type&&d.push(c)}u.log(String(a.length)+" collision sensors",a);u.log(String(d.length)+" ray sensors",d)}};b4w.module.__curve=function(a,p){function e(a,b,c,f,l){var e=f.length;l||(l=new Float32Array(e));for(var k=e+a,h=new Float32Array(k),m=1;m<=k-1;m++)h[m-1]=b>=c[m-1]&&b<c[m+1-1]?1:0;for(var r=2;r<=a;r++)for(m=1;m<=k-r;m++)h[m-1]=(0!=h[m-1]?(b-c[m-1])*h[m-1]/(c[m+r-1-1]-c[m-1]):0)+(0!=h[m+1-1]?(c[m+r-1]-b)*h[m+1-1]/(c[m+r-1]-c[m+1-1]):0);b==c[k-1]&&(h[e-1]=1);a=0;for(m=1;m<=e;m++)a+=h[m-1]*f[m-1];for(m=1;m<=e;m++)l[m-1]=0!=a?h[m-1]*f[m-1]/a:0;return l}function b(a){a=a.ko;return a[a.length-1]}function c(a){a=
a.qv;return a[a.length-1]}function m(a,b,c,f,l,e,h,r){var B=a+(b-a)/2,p=k(B,f,l,e,h)-c;r=r?r:.01;return Math.abs(p)<r?B:0<p?m(a,B,c,f,l,e,h,r):m(B,b,c,f,l,e,h,r)}function k(a,b,c,f,l){var e=1-a;return b*e*e*e+3*c*e*e*a+3*f*e*a*a+l*a*a*a}p("__print");var r=p("__util"),h=p("__vec3");a.OD=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var f=a.order_u;b.Qg=f;a=a.points;var l=a.length/5,k=[],h=l+f,l=l+2;k[0]=0;for(var m=2;m<=h;m++)k[m-1]=m>f&&m<l?k[m-
2]+1:k[m-2];b.ko=k;if("2D"==c.dimensions)b.Kg=!1;else if("3D"==c.dimensions)b.Kg=!0;else throw"Wrong curve dimensions";f=[];k=[];for(c=0;c<a.length;c+=5)f.push(a[c]),f.push(a[c+1]),f.push(a[c+2]),b.Kg&&f.push(a[c+3]),k.push(a[c+4]);b.Bq=f;b.Pt=k;a=[];for(var c=b.Bq,f=b.Kg?4:3,k=b.Pt,h=b.ko,l=b.Qg,m=c.length/f,r=m+l,p=0,v=h[r-1]/999,E=0;1E3>E;E++){5E-6>h[r-1]-p&&(p=h[r-1]);for(var z=e(l,p,h,k),G=0;G<f;G++)for(var d=a[f*E+G]=0;d<m;d++)a[f*E+G]+=z[d]*c[f*d+G];p+=v}f=b.Kg?4:3;k=new Float32Array(1E3);
k[0]=0;for(c=1;1E3>c;c+=1)h=a[(c-1)*f],l=a[(c-1)*f+1],m=a[(c-1)*f+2],r=a[c*f],p=a[c*f+1],v=a[c*f+2],k[c]=k[c-1]+Math.sqrt((r-h)*(r-h)+(p-l)*(p-l)+(v-m)*(v-m));b.qv=k;return b};a.nJ=function(a,c,k){k||(k=[]);var f=c,l=Math.max(f,0);c=l=Math.min(f,b(a));var f=a.Bq,l=a.Kg?4:3,n=a.Pt,h=a.ko,m=a.Qg;a=f.length/l;var r=a+m;5E-6>h[r-1]-c&&(c=h[r-1]);r=new Float32Array(a);e(m,c,h,n,r);for(c=0;c<l;c++)for(n=k[c]=0;n<a;n++)k[c]+=r[n]*f[l*n+c]};a.kJ=function(a,b,c){c||(c=[]);var f=a.Bq,l=a.Kg?4:3,e=a.Pt,k=a.ko,
h=a.Qg;a=f.length/l;var m=a+h;5E-6>k[m-1]-b&&(b=k[m-1]);var m=new Float32Array(a),r=b;b=m;var v=e.length;b||(b=new Float32Array(v));var E=new Float32Array(v),z=new Float32Array(v),G=E,d=z;G||(G=new Float32Array(v));d||(d=new Float32Array(v));for(var F=v+h,J=new Float32Array(F),C=new Float32Array(F),D=1;D<=F-1;D++)J[D-1]=r>=k[D-1]&&r<k[D+1-1]?1:0;r==k[F-1]&&(J[v-1]=1);for(var O=2;O<=h;O++)for(D=1;D<=F-O;D++){var T=0!=J[D-1]?J[D-1]/(k[D+O-1-1]-k[D-1]):0,K=0!=J[D+1-1]?-J[D+1-1]/(k[D+O-1]-k[D+1-1]):0,
w=0!=C[D-1]?(r-k[D-1])*C[D-1]/(k[D+O-1-1]-k[D-1]):0,t=0!=C[D+1-1]?(k[D+O-1]-r)*C[D+1-1]/(k[D+O-1]-k[D+1-1]):0;J[D-1]=(0!=J[D-1]?(r-k[D-1])*J[D-1]/(k[D+O-1-1]-k[D-1]):0)+(0!=J[D+1-1]?(k[D+O-1]-r)*J[D+1-1]/(k[D+O-1]-k[D+1-1]):0);C[D-1]=T+K+w+t}for(D=1;D<=v;D++)G[D-1]=J[D-1],d[D-1]=C[D-1];k=0;for(h=1;h<=v;h++)k+=E[h-1]*e[h-1];r=0;for(h=1;h<=v;h++)r+=z[h-1]*e[h-1];for(h=1;h<=v;h++)b[h-1]=0!=k?z[h-1]*e[h-1]/k+E[h-1]*e[h-1]*r/(k*k):0;for(e=0;e<l;e++)for(k=c[e]=0;k<a;k++)c[e]+=m[k]*f[l*k+e]};a.HN=b;a.mJ=
c;a.lJ=function(a,e){if(0>=e)return 0;var k=b(a);if(e>=c(a))return k;var f=a.qv,l=r.ln(f,e,0,f.length-1);return k*(l+(e-f[l])/(f[l+1]-f[l]))/1E3};a.po=function(a,b,c,f,e){return c+(e-f)*(a-c)/(b-f)};a.bx=function(a,b,c){var f=b[0];b=b[1];c=(c[1]-b)/(c[0]-f);return c*a+(b-c*f)};a.Hu=function(a,b,c,f,e,n){return k(m(0,1,a,b[0],c[0],f[0],e[0],n),b[1],c[1],f[1],e[1])};a.nq=function(a,b,c,f,e){var k=new Float32Array(3),m=new Float32Array(3),r=new Float32Array(3),B=new Float32Array(3),p=new Float32Array(3),
v=new Float32Array(3);h.copy(a[1],m);null==b?(h.copy(c[1],r),k[0]=2*m[0]-r[0],k[1]=2*m[1]-r[1]):h.copy(b[1],k);null==c?(h.copy(b[1],k),r[0]=2*m[0]-k[0],r[1]=2*m[1]-k[1]):h.copy(c[1],r);h.subtract(m,k,B);h.subtract(r,m,p);b=h.length(B);c=h.length(p);0==b&&(b=1);0==c&&(c=1);if("AUTO"==f||"AUTO"==e)v[0]=p[0]/c+B[0]/b,v[1]=p[1]/c+B[1]/b,k=2.5614*h.length(v),0!=k&&("AUTO"==f&&h.scaleAndAdd(m,v,-(b/k),a[0]),"AUTO"==e&&h.scaleAndAdd(m,v,c/k,a[2]));"VECTOR"==f&&h.scaleAndAdd(m,B,-1/3,a[0]);"VECTOR"==e&&h.scaleAndAdd(m,
p,1/3,a[2])};a.kD=function(a,b,c,f){var e=[],k=[],h,m,r;e[0]=a[0]-b[0];e[1]=a[1]-b[1];k[0]=f[0]-c[0];k[1]=f[1]-c[1];r=f[0]-a[0];h=Math.abs(e[0]);m=Math.abs(k[0]);0!=h+m&&h+m>r&&(h=r/(h+m),b[0]=a[0]-h*e[0],b[1]=a[1]-h*e[1],c[0]=f[0]-h*k[0],c[1]=f[1]-h*k[1])}};b4w.module.__dds=function(a,p){function e(a,b,c,e){var k=new Uint16Array(4),g=new Uint16Array(c*e),h=0,m=0,q=0,r=m=h=0,z=0,G=0,d=0,F=c/4;e/=4;for(var J=0;J<e;J++)for(var C=0;C<F;C++)q=b+4*(J*F+C),k[0]=a[q],k[1]=a[q+1],h=k[0]&31,m=k[0]&2016,r=k[0]&63488,z=k[1]&31,G=k[1]&2016,d=k[1]&63488,k[2]=5*h+3*z>>3|5*m+3*G>>3&2016|5*r+3*d>>3&63488,k[3]=5*z+3*h>>3|5*G+3*m>>3&2016|5*d+3*r>>3&63488,h=a[q+2],m=4*J*c+4*C,g[m]=k[h&3],g[m+1]=k[h>>2&3],g[m+2]=k[h>>4&3],g[m+3]=k[h>>6&3],m+=c,g[m]=k[h>>8&3],g[m+1]=k[h>>
10&3],g[m+2]=k[h>>12&3],g[m+3]=k[h>>14],h=a[q+3],m+=c,g[m]=k[h&3],g[m+1]=k[h>>2&3],g[m+2]=k[h>>4&3],g[m+3]=k[h>>6&3],m+=c,g[m]=k[h>>8&3],g[m+1]=k[h>>10&3],g[m+2]=k[h>>12&3],g[m+3]=k[h>>14];return g}function b(a,b,c,n){var m=new Int32Array(c,0,31),p,B,H,v,E,z;if(542327876!=m[0])return r.error("Invalid magic number in DDS header"),0;if(!m[20]&4)return r.error("Unsupported format, must contain a FourCC code"),0;p=m[21];switch(p){case h:B=8;H=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case q:B=16;H=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case g:B=16;H=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return r.error("Unsupported FourCC code:",k(p)),null}z=1;m[2]&131072&&!1!==n&&(z=Math.max(1,m[7]));v=m[4];E=m[3];m=m[1]+4;if(b)for(p=0;p<z;++p)n=Math.max(4,v)/4*Math.max(4,E)/4*B,b=new Uint8Array(c,m,n),a.compressedTexImage2D(a.TEXTURE_2D,p,H,v,E,0,b),m+=n,v=Math.max(.5*v,1),E=Math.max(.5*E,1);else if(p==h)Math.max(4,v),Math.max(4,E),b=new Uint16Array(c),c=e(b,m/2,v,E),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,v,E,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),n&&a.generateMipmap(a.TEXTURE_2D);else return r.error("No manual decoder for",k(p),"and no native support"),0;return z}function c(a,c,e,k,g,m){var h=new XMLHttpRequest;h.open("GET",e,!0);h.responseType="arraybuffer";h.onload=function(){if(200==h.status){a.bindTexture(a.TEXTURE_2D,k);var e=b(a,c,h.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<e?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}m&&
m(k)};h.send(null);return k}function m(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function k(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var r=p("__print"),h=m("DXT1"),q=m("DXT3"),g=m("DXT5");a.fM=e;a.qK=b;a.mw=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.zF=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case h:b=6;break;case q:case g:b=4;break;default:r.error("Unsupported FourCC code:",k(a))}return b};
a.iN=c;a.hN=function(a,b,e,k){var g=a.createTexture();c(a,b,e,g,!0,k);return g}};b4w.module.__debug=function(a,p){function e(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a){for(var b=r.Qn(),c=a.Dn,f=0;f<c.length;f++){var e=c[f],k=b.oF(e,b.wL),l=u.getParameter(b.sL);k&&!l&&(e=b.oF(e,b.xL)/1E6,a.zf=a.zf?y.smooth(e,a.zf,1,10):e,c.splice(f,1),f--)}}function c(a,b){typeof a!=typeof b&&y.da("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var c in a)c in b||y.da("Structure assertion failed: missing key in the first object: "+
c);for(c in b)c in a||y.da("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&y.da("Structure assertion failed: incompatible types for key "+c)}}var m=p("__compat"),k=p("__config"),r=p("__extensions"),h=p("__print"),q=p("__textures"),g=p("__time"),y=p("__util"),f=p("__graph"),l=k.q,n={},u=null,A={},B=[],H=-1,v=null,E=!1;a.WM_NONE=0;a.WM_OPAQUE_WIREFRAME=1;a.WM_TRANSPARENT_WIREFRAME=2;a.WM_FRONT_BACK_VIEW=3;a.WM_DEBUG_SPHERES=4;a.Ed=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),
c;for(c in b){var f=b[c];f in a&&(n[a[f]]=f)}u=a};a.rq=function(a){if(l.gl_debug){var b=u.getError();b!=u.NO_ERROR&&(b in n?y.da("GL Error: "+b+", gl."+n[b]+" ("+a+")"):y.da("Unknown GL error: "+b+" ("+a+")"))}};a.QC=function(){if(l.gl_debug)switch(u.checkFramebufferStatus(u.FRAMEBUFFER)){case u.FRAMEBUFFER_COMPLETE:break;case u.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:h.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case u.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:h.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
break;case u.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:h.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case u.FRAMEBUFFER_UNSUPPORTED:h.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:h.error("FRAMEBUFFER CHECK FAILED")}};a.UC=function(){if(-1!=H)return H;u.bindFramebuffer(u.FRAMEBUFFER,u.createFramebuffer());var a=q.ll("DEBUG",q.Ti);q.resize(a,1,1);u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,a.Gb,a.Ra,0);u.checkFramebufferStatus(u.FRAMEBUFFER)!=
u.FRAMEBUFFER_COMPLETE?(H=!0,h.warn("depth-only issue was found")):H=!1;u.bindFramebuffer(u.FRAMEBUFFER,null);return H};a.WC=function(){return m.sq("Firefox")&&u.getError()==u.OUT_OF_MEMORY?(h.warn("Firefox/old GPUs cubemap issue was found."),!0):!1};a.XC=function(a,b,c){if(l.gl_debug&&!u.getShaderParameter(a,u.COMPILE_STATUS)){var f=l.wu&&r.lr();f&&(c=f.getTranslatedShaderSource(a));c=e(c);h.error("shader compilation failed:\n"+c+"\n"+u.getShaderInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";
}};a.YC=function(a,b,c,f,k,g){if(l.gl_debug&&!u.getProgramParameter(a,u.LINK_STATUS)){var n=l.wu&&r.lr();n&&(k=n.getTranslatedShaderSource(c),g=n.getTranslatedShaderSource(f));k=e(k);g=e(g);h.error("shader linking failed:\n"+k+"\n\n\n"+g+"\n"+u.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";}};a.Ds=function(a){if(l.show_hud_debug_info||"PERFORMANCE"==a.type){var b=r.Qn();if(b){var c=b.XL();a.Dn.push(c);b.ML(b.zB,c)}else a.Dn.push(performance.now())}};a.Es=function(a){if(l.show_hud_debug_info||
"PERFORMANCE"==a.type){var d=r.Qn();d?(d.gM(d.zB),b(a)):(d=performance.now()-a.Dn.pop(),a.zf=a.zf?y.smooth(d,a.zf,1,10):d)}};a.OH=b;a.hM=function(a){A[a]=a in A?A[a]+1:1};a.update=function(){for(var a in A)h.log(a,A[a]),A[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(y.is_vector(c))for(var f=0;f<c.length;f++)a.push(c[f]);else a.push(arguments[b])}B.push(a)};a.msg=function(){for(var a=1,b=0;b<B.length;b++){var c=B[b];c[1]==arguments[0]&&a++}c=
[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],y.is_vector(a))for(var f=0;f<a.length;f++)c.push(a[f]);else c.push(arguments[b]);B.push(c)};var z=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},f=Math.max(0,performance.now()-1E3*a),e=0;e<B.length;e++){var k=B[e];a=k[0];if(!(a<f)){var l=String(k[1]);c[l]||(c[l]=z[b++%z.length]);a=["%c"+(a/1E3).toFixed(6),c[l],l];for(l=2;l<k.length;l++)a.push(k[l]);h.log.apply(this,
a)}}B.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),f=0;f<B.length;f++){var e=B[f];a=e[0];if(!(a<c))for(var k=2;k<e.length;k++){var l=String(e[1]);3<e.length&&(l+="_"+String(k-2));b[l]||(b[l]=l+"\n");b[l]+=String(a)+" "+e[k]+"\n"}}a="";for(l in b)a+=b[l]+"\n\n";h.log(a);B.splice(0)};a.RL=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&
b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(y.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.FL=function(a,b){a.constructor!=b&&y.da("Type assertion failed: value <"+a+
"> has type <"+a.constructor+">, required <"+b+">")};a.GL=c;a.HL=function(a){E?c(a,v):E=!0;v=a};a.fake_load=function(a,b,c,f,e){(a=a||null)||y.da("Stage load callback is undefined");b=b||5E3;c=c||0;f=f||100;100<f&&y.da("Max percentage must be less than 100");0>c&&y.da("Min percentage must be greater than 0");c>f&&y.da("Max percentage must be greater than min percentage");var l=g.animate(c,f,b,function(b){b=b.toFixed();a(b);100==b&&(g.clear_animation(l),e&&e())})};a.nN=function(a){return f.cE(a,function(a,
b){return b.type},function(b,c,e){b=f.Ka(a,b);c=f.Ka(a,c);return b.Da[e[0]].identifier+"\n==>\n"+c.K[e[1]].identifier})}};b4w.module.__extensions=function(a,p){function e(a){if(a in r)return r[a];var b=k.getExtension(a)||null;r[a]=b;c.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}var b=p("__config"),c=p("__print"),m=b.q,k=null,r={};a.Ed=function(a){k=a};a.hw=function(){return e("WEBGL_compressed_texture_s3tc")||e("WEBKIT_WEBGL_compressed_texture_s3tc")||e("MOZ_WEBGL_compressed_texture_s3tc")};a.BF=function(){return m.Hc?{}:e("WEBGL_depth_texture")||e("WEBKIT_WEBGL_depth_texture")||e("MOZ_WEBGL_depth_texture")};
a.sF=function(){return e("EXT_texture_filter_anisotropic")||e("WEBKIT_EXT_texture_filter_anisotropic")||e("MOZ_EXT_texture_filter_anisotropic")};a.lr=function(){return e("WEBGL_debug_shaders")};a.gw=function(){return e("WEBGL_debug_renderer_info")};a.cw=function(){return m.Hc?{}:e("OES_element_index_uint")};a.jw=function(){return m.Hc?null:e("OES_standard_derivatives")};a.Qn=function(){return e("EXT_disjoint_timer_query")};a.cleanup=function(){r={}}};b4w.module.__graph=function(a,p){function e(a,d,c){c||(c=null);if(b(a,d))throw"Graph already has node with given ID";a.D.push(d,c)}function b(a,b){for(var d=a.D,c=0;c<d.length;c+=2)if(d[c]==b)return!0;return!1}function c(a,d,c,f){f||(f=null);if(b(a,d)&&b(a,c))a.ka.push(d,c,f);else throw"Wrong node IDs";}function m(a,d){if(!b(a,d))throw"Node not found";for(var c=a.D,f=0;f<c.length;f+=2)c[f]==d&&(c.splice(f,2),f-=2)}function k(a,b,d,c){if(!J(a,b,d))throw"Edge not found";a=a.ka;for(var f=0,e=0;e<a.length;e+=
3)if(a[e]==b&&a[e+1]==d){if(-1==c)a.splice(e,3);else{if(c==f){a.splice(e,3);break}f++}e-=3}}function r(a){a=a.D;for(var b=-1,d=0;d<a.length;d+=2)b=Math.max(b,a[d]);return++b}function h(a,b){for(var d=a.D,c=0;c<d.length;c+=2)if(d[c+1]==b)return d[c];return-1}function q(a){var b=[],d={};g(a,d);for(var c=a.D,f=0;f<c.length;f+=2)0==G(a,c[f])&&y(a,c[f],d,b);return{D:b,ka:a.ka.slice(0)}}function g(a,b){for(var d=a.D,c=0;c<d.length;c+=2)b[d[c]]=!1}function y(a,b,c,f){if(!c[b]){c[b]=!0;for(var e=0;e<z(a,
b);e++)y(a,d(a,b,e),c,f);f.unshift(b,E(a,b))}}function f(a,b,c,e){if(!c[b]){c[b]=!0;if(10==e||30==e)for(var l=0;l<z(a,b);l++){var k=d(a,b,l);f(a,k,c,e)}if(20==e||30==e)for(l=0;l<G(a,b);l++)k=F(a,b,l),f(a,k,c,e)}}function l(a){for(var d=a.ka,c=0;c<d.length;c+=3){var f=d[c+1];b(a,d[c])&&b(a,f)||(d.splice(c,3),c-=3)}}function n(a){for(var b=[],d=a.D,c=0;c<d.length;c+=2){var f=d[c];z(a,f)||b.push(f)}return b}function u(a){var b=a.D;a=a.ka;for(var d=[],c=[],f=[],e=0;e<b.length;e++)f[b[2*e]]=e,d.push(e,
b[2*e+1]);for(e=0;e<a.length;e+=3)c.push(f[a[e]],f[a[e+1]],a[e+2]);return{D:d,ka:c}}function A(a,b,c){if(c.Qe==c.Pg){for(var f=0,e=0;f<c.Pg;f++)-1!=c.wf[f]&&(a[e]=f,b[e]=c.wf[f],e++);return!0}if(c.Pg>c.Qj||c.fh>c.gh||c.xk>c.zk||c.wk>c.yk)return!1;for(var e=f=-1,l=!1;!l&&B(c,K,f,e);)if(f=K[0],e=K[1],H(c,f,e)){var k;k=c;l={};l.El=k.El;l.Fl=k.Fl;l.ks=k.ks;l.In=k.In;l.Pg=k.Pg;l.Qj=k.Qj;l.Qg=k.Qg;l.Qe=l.Co=k.Qe;l.wk=k.wk;l.xk=k.xk;l.fh=k.fh;l.yk=k.yk;l.zk=k.zk;l.gh=k.gh;l.Pk=-1;l.wf=k.wf;l.Nh=k.Nh;l.bi=
k.bi;l.ci=k.ci;l.si=k.si;l.ti=k.ti;l.$o=k.$o;k.$o[0]+=1;var l=k=l,g=f,n=e,m=l.El,J=l.Fl,h=l.Pg,C=l.Qj,q=l.wf,D=l.Nh,x=l.bi,r=l.ci,aa=l.si,u=l.ti;v(g<h);v(n<C);v(l.Qe<h);v(l.Qe<C);h=++l.Qe;l.Pk=g;x[g]||(x[g]=h,l.wk++,aa[g]&&l.fh++);aa[g]||(aa[g]=h,l.xk++,x[g]&&l.fh++);r[n]||(r[n]=h,l.yk++,u[n]&&l.gh++);u[n]||(u[n]=h,l.zk++,r[n]&&l.gh++);q[g]=n;D[n]=g;for(q=0;q<G(m,g);q++)D=F(m,g,q),x[D]||(x[D]=h,l.wk++,aa[D]&&l.fh++);for(q=0;q<z(m,g);q++)D=d(m,g,q),aa[D]||(aa[D]=h,l.xk++,x[D]&&l.fh++);for(q=0;q<G(J,
n);q++)D=F(J,n,q),r[D]||(r[D]=h,l.yk++,u[D]&&l.gh++);for(q=0;q<z(J,n);q++)D=d(J,n,q),u[D]||(u[D]=h,l.zk++,r[D]&&l.gh++);l=A(a,b,k);v(1>=k.Qe-k.Co);v(-1!=k.Pk);D=k.El;g=k.Fl;n=k.Qe;m=k.Pk;J=k.wf;x=k.Nh;h=k.bi;r=k.ci;C=k.si;aa=k.ti;if(k.Co<n){h[m]==n&&(h[m]=0);for(u=0;u<G(D,m);u++)q=F(D,m,u),h[q]==n&&(h[q]=0);C[m]==n&&(C[m]=0);for(u=0;u<z(D,m);u++)q=d(D,m,u),C[q]==n&&(C[q]=0);D=J[m];r[D]==n&&(r[D]=0);for(u=0;u<G(g,D);u++)q=F(g,D,u),r[q]==n&&(r[q]=0);aa[D]==n&&(aa[D]=0);for(u=0;u<z(g,D);u++)q=d(g,D,
u),aa[q]==n&&(aa[q]=0);J[m]=-1;x[D]=-1;k.Qe=k.Co;k.Pk=-1}}return l}function B(a,b,d,c){-1==d&&(d=0);-1==c?c=0:c++;var f=a.fh,e=a.gh,l=a.xk,k=a.zk,g=a.wk,n=a.yk,m=a.Qe,h=a.Pg,J=a.Qj,C=a.wf,F=a.Nh,x=a.bi,q=a.ci,D=a.si,r=a.ti;if(f>m&&e>m)for(;d<h&&(-1!=C[d]||0==D[d]||0==x[d]);)d++,c=0;else if(l>m&&k>m)for(;d<h&&(-1!=C[d]||0==D[d]);)d++,c=0;else if(g>m&&n>m)for(;d<h&&(-1!=C[d]||0==x[d]);)d++,c=0;else if(0==d&&0!=a.Qg){for(x=0;x<h&&-1!=C[d=a.Qg[x]];)x++;x==h&&(d=h)}else for(;d<h&&-1!=C[d];)d++,c=0;if(f>
m&&e>m)for(;c<J&&(-1!=F[c]||0==r[c]||0==q[c]);)c++;else if(l>m&&k>m)for(;c<J&&(-1!=F[c]||0==r[c]);)c++;else if(g>m&&n>m)for(;c<J&&(-1!=F[c]||0==q[c]);)c++;else for(;c<J&&-1!=F[c];)c++;return d<h&&c<J?(b[0]=d,b[1]=c,!0):!1}function H(a,b,c){var f=a.El,e=a.Fl,l=a.Qj,k=a.wf,g=a.Nh,n=a.bi,m=a.ci,h=a.si,q=a.ti;v(b<a.Pg);v(c<l);v(-1==k[b]);v(-1==g[c]);if(!(0,a.ks)(E(f,b),E(e,c)))return!1;for(var D=l=0,r=0,u=0,x=0,y=0,aa=0;aa<z(f,b);aa++){var O=d(f,b,aa);if(-1!=k[O]){var K=k[O];if(!J(e,c,K)||!C(a.In,f,b,
O,e,c,K))return!1}else n[O]&&r++,h[O]&&l++,n[O]||h[O]||x++}for(aa=0;aa<G(f,b);aa++)if(O=F(f,b,aa),-1!=k[O]){if(K=k[O],!J(e,K,c)||!C(a.In,f,O,b,e,K,c))return!1}else n[O]&&r++,h[O]&&l++,n[O]||h[O]||x++;for(aa=0;aa<z(e,c);aa++)if(K=d(e,c,aa),-1!=g[K]){if(O=g[K],!J(f,b,O))return!1}else m[K]&&u++,q[K]&&D++,m[K]||q[K]||y++;for(aa=0;aa<G(e,c);aa++)if(K=F(e,c,aa),-1!=g[K]){if(O=g[K],!J(f,O,b))return!1}else m[K]&&u++,q[K]&&D++,m[K]||q[K]||y++;return r<=u&&l<=D&&x<=y}function v(a){if(!a)throw"Assertion failed";
}function E(a,b){for(var d=a.D,c=0;c<d.length;c+=2)if(d[c]==b)return d[c+1];return null}function z(a,b){for(var d=a.ka,c=0,f=0;f<d.length;f+=3)d[f]==b&&c++;return c}function G(a,b){for(var d=a.ka,c=0,f=0;f<d.length;f+=3)d[f+1]==b&&c++;return c}function d(a,b,d){a=a.ka;for(var c=0,f=0;f<a.length;f+=3)if(a[f]==b){if(c==d)return a[f+1];c++}return-1}function F(a,b,d){a=a.ka;for(var c=0,f=0;f<a.length;f+=3)if(a[f+1]==b){if(c==d)return a[f];c++}return-1}function J(a,b,d){a=a.ka;for(var c=0;c<a.length;c+=
3)if(a[c]==b&&a[c+1]==d)return!0;return!1}function C(a,b,d,c,f,e,l){for(var k=D(b,d,c),g=D(f,e,l),n=0;n<k;n++){for(var m=!1,h=0;h<g;h++)if(a(O(b,d,c,n),O(f,e,l,h))){m=!0;break}if(!m)return!1}return!0}function D(a,b,d){var c=0;a=a.ka;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==d&&c++;return c}function O(a,b,d,c){a=a.ka;for(var f=0,e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==d){if(f==c)return a[e+2];f++}return null}p("__print");var T=p("__util"),K=[-1,-1];a.fu=-1;a.rL=10;a.Mm=20;a.zL=30;a.create=function(){for(var a=
arguments,b=[],d=[],c=0;c<a.length;c++){var f=a[c];switch(f.length){case 2:b.push(f[0],f[1]);break;case 3:d.push(f[0],f[1],f[2]);break;default:throw"Wrong graph constructor params";}}return{D:b,ka:d}};a.clone=function(a,b,d){if(b)for(var c=Array(a.D.length),f=0;f<a.D.length;f+=2)c[f]=a.D[f],c[f+1]=b(a.D[f+1]);else c=T.za(a.D);if(d)for(b=Array(a.ka.length),f=0;f<a.ka.length;f+=3)b[f]=a.ka[f],b[f+1]=a.ka[f+1],b[f+2]=d(a.ka[f+2]);else b=T.za(a.ka);return a={D:c,ka:b}};a.ZL=function(a,b){for(var d=[],
c=[],f=0;f<a.length;f++)d.push(a[f][0],a[f][1]);for(f=0;f<b.length;f++)c.push(b[f][0],b[f][1],b[f][2]);return{D:d,ka:c}};a.Wi=e;a.OM=b;a.rc=c;a.df=m;a.Ai=k;a.To=function(a,b,d,c){if(!J(a,b,d))throw"Edge not found";a=a.ka;for(var f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==d&&a[f+2][0]==c[0]&&a[f+2][1]==c[1]){a.splice(f,3);break}};a.B=function(a,b){if(-1==h(a,b)){var d=r(a);e(a,d,b);return d}throw"Non-unique attribute";};a.$H=function(a,b,d,c,f){a=a.ka;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==d&&a[e+
2]==c&&(a[e+2]=f)};a.ZB=function(a,b,d){var f;d=d||[];f=f||[];for(var l={},k=0;k<a.D.length;k+=2){var g=a.D[k],n=a.D[k+1],m=r(b);e(b,m,n);l[g]=m}for(k=0;k<a.ka.length;k+=3)n=l[a.ka[k]],m=l[a.ka[k+1]],g=a.ka[k+2],c(b,n,m,g);for(k=0;k<d.length;k+=3)n=l[d[k]],a=d[k+1],g=d[k+2],c(b,n,a,g);for(k=0;k<f.length;k+=3)d=f[k],m=l[f[k+1]],g=f[k+2],c(b,d,m,g)};a.Gl=r;a.Ze=h;a.m=function(a,b,d,f){b=h(a,b);d=h(a,d);if(-1!=b&&-1!=d)c(a,b,d,f);else throw"Attributes not found";};a.ea=function(a,b){for(var d=a.D,c=
0;c<d.length&&!b(d[c],d[c+1]);c+=2);};a.Ce=function(a,b){for(var d=a.ka,c=0;c<d.length&&!b(d[c],d[c+1],d[c+2]);c+=3);};a.De=function(a,b,d){for(var c=a.ka,f=0;f<c.length;f+=3)if(c[f+1]==b){var e=c[f];if(d(e,E(a,e),c[f+2]))break}};a.ih=function(a,b,d){for(var c=a.ka,f=0;f<c.length;f+=3)if(c[f]==b){var e=c[f+1];if(d(e,E(a,e),c[f+2]))break}};a.xt=q;a.BJ=function(a){a=q(a).D;for(var b=[],d=0;d<a.length;d+=2)b.push(a[d+1]);return b};a.ZM=function(){};a.fp=function(a,d,c){if(!b(a,d))throw"No such node";
var e={};g(a,e);f(a,d,e,c);d=[];for(var k in e)e[k]&&(k=Number(k),d.push(k,E(a,k)));a={D:d,ka:a.ka.slice(0)};l(a);return a};a.tq=l;a.PF=function(a){for(var b=[],d=a.D,c=0;c<d.length;c+=2){var f=d[c];G(a,f)||b.push(f)}return b};a.Jl=n;a.match=function(a,b,d,c){var f={};f.El=u(a);f.Fl=u(b);f.ks=d||function(a,b){return a==b};f.In=c||function(a,b){return a==b};c=a.D.length/2;var e=b.D.length/2;f.Pg=c;f.Qj=e;f.Qg=0;f.Qe=f.Co=0;f.fh=f.wk=f.xk=0;f.gh=f.yk=f.zk=0;f.Pk=-1;f.wf=Array(c);f.Nh=Array(e);f.bi=
Array(c);f.ci=Array(e);f.si=Array(c);f.ti=Array(e);f.$o=[1];for(d=0;d<c;d++)f.wf[d]=-1,f.bi[d]=0,f.si[d]=0;for(d=0;d<e;d++)f.Nh[d]=-1,f.ci[d]=0,f.ti[d]=0;e=Array(c);c=Array(c);if(A(e,c,f)){for(d=0;d<e.length;d++)e[d]=a.D[2*e[d]],c[d]=b.D[2*c[d]];return[e,c]}return null};a.LF=function(a,b){for(var d=a.D,c=1;c<d.length;c+=2)if(d[c]==b)return d[c-1];return null};a.Ka=E;a.Rg=z;a.$n=G;a.Fg=d;a.vj=F;a.zM=D;a.Jf=O;a.replace=function(a,b,d){for(var c=a.ka,f=r(a),k=0;k<b.length;k++){var l=b[k];m(a,l);for(var g=
0;g<c.length;g+=3)c[g]==l&&(c[g]=f),c[g+1]==l&&(c[g+1]=f),c[g]==c[g+1]&&(c.splice(g,3),g-=3)}e(a,f,d)};a.dy=function(a,b,d,c,f){if(!J(a,b,d))throw"Edge not found";a=a.ka;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==d&&(a[e]=c,a[e+1]=f)};a.yE=function(a,b){function d(a,b){if(-1!=g.indexOf(a)){var c=g.slice(g.indexOf(a));if(-1!=f[c[c.length-1]].indexOf(c[0])){m.push([a,c[c.length-1]]);return}}g.push(a);for(c=0;c<b.length;c++)b[c]in f&&d(b[c],f[b[c]])}b||(b=n(a)[0]);var c=a.ka;if(c.length){for(var f=
{},e=0,l=0;l<c.length;l+=3)c[l+1]in f?f[c[l+1]].push(c[l]):f[c[l+1]]=[c[l]],e++;var g=[],m=[];d(b,f[b]);for(l=0;l<m.length;l++)for(var h=e=0;h<c.length;h+=3)m[l][1]==c[h+1]&&m[l][0]==c[h]&&k(a,c[h],c[h+1],e),e++}};a.cE=function(a,b,d){var c=a.D;a=a.ka;var f;f="digraph debug {\n    node [shape=box];\n";for(var e=0;e<c.length;e+=2){var l=c[e],k=c[e+1],k=b?b(l,k):String(l);f+="    ";f+=String(l)+' [label="'+k.replace(/\"/g,'\\"')+'"];\n'}for(e=0;e<a.length;e+=3)b=a[e],c=a[e+1],k=a[e+2],f+="    ",f+=
String(b)+" -> "+String(c),d&&(f+=' [label="'+d(b,c,k)+'"]'),f+=";\n";return f+="}"}};b4w.module.__ipc=function(a,p){function e(a,b,c){for(var e=0;e<l.length;e+=2)l[e+1]==a&&(f[e+Number(!b)]=c)}function b(a){for(var b=0;b<a.length;b++){var c=a[b],f=0,e;for(e in c){var l=c[e];switch(l.constructor){case Float32Array:f+=l.length;break;case Number:f+=1}}--f;c.len=f}}var c=!0;a.pA=0;var m=a.hA=1,k=a.jA=2;a.iA=3;a.lA=4;a.mA=5;a.nA=6;a.qA=7;var r=a.sA=8,h=a.Zt=9,q=a.tA=10;a.uA=11;var g=a.vA=12;a.wA=13;a.rA=14;a.oA=15;a.kA=16;a.aB=100;a.CA=101;a.DA=102;a.EA=103;a.FA=104;a.HA=105;a.GA=106;
a.IA=107;a.JA=108;a.KA=109;a.LA=110;a.MA=111;a.NA=112;a.PA=113;a.QA=114;a.dB=115;a.RA=116;a.SA=117;a.TA=118;a.VA=119;a.WA=120;a.XA=121;a.ZA=122;a.$A=123;a.bB=124;a.OA=125;a.fB=126;a.UA=127;a.iu=128;a.eB=129;a.gB=130;a.hB=131;a.iB=132;a.jB=133;a.kB=134;a.lB=135;a.mB=136;a.nB=137;a.oB=138;a.pB=139;a.ju=140;var y=a.Sm=141;a.qB=142;a.hu=143;a.rB=144;a.sB=145;a.cB=146;a.YA=147;a.tB=148;var f=b4w.worker_listeners,l=b4w.worker_namespaces,n={wd:g,C:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),
We:new Float32Array(3),Je:new Float32Array(3),len:0},u={wd:r,qq:0,xs:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},A={wd:h,id:0,$i:0,hit_fract:0,hit_time:0,len:0},B={wd:q,id:0,$i:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},H={wd:m,Eh:0,Fh:0,result:0,len:0},v={wd:k,Eh:0,Fh:0,result:0,Mh:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},E={wd:y,C:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},z=[n,u,A,B,H,v,E];
a.WD=function(a,b){var k={io:a?!0:!1,sh:null,Oe:[],Vd:""};if(b)if(k.sh={addEventListener:function(a,b){"message"!=a&&panic("Wrong web worker event");e(k.Vd,k.io,b)},removeEventListener:function(a){"message"!=a&&panic("Wrong web worker event");e(k.Vd,k.io,null)},postMessage:function(a){var b;a:{for(b=0;b<l.length;b+=2)if(l[b+1]==k.Vd){b=f[b+Number(!!k.io)];break a}b=null}b({data:a})},terminate:function(){for(var a=0;a<l.length;a+=2)if(l[a+1]==k.Vd){f.splice(a,2);l.splice(a,2);break}}},k.io){var g=
p("__util"),m=p("__container"),n=b4w.get_namespace(p),g=g.Ck(n+"_worker");l.push(n);l.push(g);f.push(null);f.push(null);k.Vd=g;(m=m.ME(a))?c?m.addEventListener("load",function(){b4w.require("__bindings",k.Vd)},!1):(b4w.cleanup("__bindings",k.Vd),b4w.cleanup("__ipc",k.Vd),b4w.require("__bindings",k.Vd)):(m=document.createElement("script"),m.src=a,m.defer="defer",m.async="async",m.addEventListener("load",function(){c=!1;b4w.require("__bindings",k.Vd)},!1),document.head.appendChild(m))}else k.Vd=b4w.get_namespace(p);
else k.sh=a?new Worker(a):self;return k};a.pC=function(a,d){function c(b){if(b.constructor==ArrayBuffer)b=new Float32Array(b);else if(b[0].constructor==ArrayBuffer){for(var f=0;f<b.length;f++)c(b[f]);return}f=b[0]|0;switch(f){case g:var e=n;e.C=b[1]|0;e.time=b[2];e.trans[0]=b[3];e.trans[1]=b[4];e.trans[2]=b[5];e.quat[0]=b[6];e.quat[1]=b[7];e.quat[2]=b[8];e.quat[3]=b[9];e.We[0]=b[10];e.We[1]=b[11];e.We[2]=b[12];e.Je[0]=b[13];e.Je[1]=b[14];e.Je[2]=b[15];break;case r:e=u;e.qq=b[1]|0;e.xs=b[2]|0;e.trans[0]=
b[3];e.trans[1]=b[4];e.trans[2]=b[5];e.quat[0]=b[6];e.quat[1]=b[7];e.quat[2]=b[8];e.quat[3]=b[9];break;case h:e=A;e.id=b[1]|0;e.$i=b[2]|0;e.hit_fract=b[3];e.hit_time=b[4];break;case q:e=B;e.id=b[1]|0;e.$i=b[2]|0;e.hit_fract=b[3];e.hit_time=b[4];e.hit_pos[0]=b[5];e.hit_pos[1]=b[6];e.hit_pos[2]=b[7];e.hit_norm[0]=b[8];e.hit_norm[1]=b[9];e.hit_norm[2]=b[10];break;case m:e=H;e.Eh=b[1]|0;e.Fh=b[2]|0;e.result=!!b[3];break;case k:e=v;e.Eh=b[1]|0;e.Fh=b[2]|0;e.result=!!b[3];e.Mh[0]=b[4];e.Mh[1]=b[5];e.Mh[2]=
b[6];e.coll_norm[0]=b[7];e.coll_norm[1]=b[8];e.coll_norm[2]=b[9];e.coll_dist=b[10];break;case y:e=E;e.C=b[1]|0;e.trans[0]=b[2];e.trans[1]=b[3];e.trans[2]=b[4];e.quat[0]=b[5];e.quat[1]=b[6];e.quat[2]=b[7];e.quat[3]=b[8];break;default:e=b}d(a,f,e)}b(z);a.sh.addEventListener("message",function(a){c(a.data)},!1)};a.cleanup=function(){};a.F=function(a,b){if(a)switch(b){case g:var c=n,f=new Float32Array(c.len);f[0]=c.wd;f[1]=c.C;f[2]=c.time;f[3]=c.trans[0];f[4]=c.trans[1];f[5]=c.trans[2];f[6]=c.quat[0];
f[7]=c.quat[1];f[8]=c.quat[2];f[9]=c.quat[3];f[10]=c.We[0];f[11]=c.We[1];f[12]=c.We[2];f[13]=c.Je[0];f[14]=c.Je[1];f[15]=c.Je[2];a.Oe.push(f.buffer);break;case r:c=u;f=new Float32Array(c.len);f[0]=c.wd;f[1]=c.qq;f[2]=c.xs;f[3]=c.trans[0];f[4]=c.trans[1];f[5]=c.trans[2];f[6]=c.quat[0];f[7]=c.quat[1];f[8]=c.quat[2];f[9]=c.quat[3];a.Oe.push(f.buffer);break;case h:c=A;f=new Float32Array(c.len);f[0]=c.wd;f[1]=c.id;f[2]=c.$i;f[3]=c.hit_fract;f[4]=c.hit_time;a.Oe.push(f.buffer);break;case q:c=B;f=new Float32Array(c.len);
f[0]=c.wd;f[1]=c.id;f[2]=c.$i;f[3]=c.hit_fract;f[4]=c.hit_time;f[5]=c.hit_pos[0];f[6]=c.hit_pos[1];f[7]=c.hit_pos[2];f[8]=c.hit_norm[0];f[9]=c.hit_norm[1];f[10]=c.hit_norm[2];a.Oe.push(f.buffer);break;case m:c=H;f=new Float32Array(c.len);f[0]=c.wd;f[1]=c.Eh;f[2]=c.Fh;f[3]=c.result;a.Oe.push(f.buffer);break;case k:c=v;f=new Float32Array(c.len);f[0]=c.wd;f[1]=c.Eh;f[2]=c.Fh;f[3]=c.result;f[4]=c.Mh[0];f[5]=c.Mh[1];f[6]=c.Mh[2];f[7]=c.coll_norm[0];f[8]=c.coll_norm[1];f[9]=c.coll_norm[2];f[10]=c.coll_dist;
a.Oe.push(f.buffer);break;case y:c=E;f=new Float32Array(c.len);f[0]=c.wd;f[1]=c.C;f[2]=c.trans[0];f[3]=c.trans[1];f[4]=c.trans[2];f[5]=c.quat[0];f[6]=c.quat[1];f[7]=c.quat[2];f[8]=c.quat[3];a.Oe.push(f.buffer);break;default:f=[];for(c=1;c<arguments.length;c++)f.push(arguments[c]);a.sh.postMessage(f)}};a.JH=function(a){a&&a.Oe.length&&(a.sh.postMessage(a.Oe),a.Oe.length=0)};a.ew=function(a){switch(a){case g:return n;case r:return u;case h:return A;case q:return B;case m:return H;case k:return v;case y:return E;
default:return null}};a.terminate=function(a){a.sh.terminate();a.sh=null};a.eo=function(a){return!!a.sh};a.Gw=function(a){return!!a.Vd}};b4w.module.__hud=function(a,p){function e(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){c(' SCENE "'+a.name+'"');c(" Active        Subscene       Lamps      Size   RenderCalls  Time");if(a.k){var b=0,e=0,k=0;h.ea(a.k.jb,function(a,f){if("SINK"!=f.type){var g=f.type,m=Math.round(f.j.width)+"x"+Math.round(f.j.height),h=f.v.length,q=f.pl;if("MAIN_CUBE_REFLECT"==f.type||"MAIN_CUBE_REFLECT_BLEND"==f.type)h*=6;var r=f.Ib,d=r?f.zf:0;f.enqueue||(f.zf=
0);c(r?" (\u2713)":" (\u2715)",g,f.Bo,m,q,"of",h,"  ",d.toFixed(3));f.pl=0;r&&(b+=h,e+=q,k+=d)}});return[b,e,k]}c("No INFO")}function c(){for(var a=80+20*y[0],b=arguments[0],c=1;c<arguments.length;c++){for(var e="",k=0;k<q[c]-String(arguments[c]).length;k++)e+=" ";b+=e+arguments[c]}y[0]++;g.fillText(b,30,a)}function m(a,b,c){b*=a.qb;c.x=a.x+b;c.y=a.y;c.qb=a.qb-2*b;c.eb=a.eb}function k(a){return a.x+a.qb/2}function r(a){var b=g,c={x:0,y:0,qb:0,eb:0},e=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.qb=
e;c.eb=b;m(c,.01,c);e=.02*c.eb;c.x=c.x;c.y+=e;c.qb=c.qb;c.eb-=2*e;e=c.qb/8;c.x+=e*a;c.y=c.y;c.qb=e;c.eb=c.eb;m(c,.02,c);return c}var h=p("__graph");p("__print");var q=[5,24,7,10,4,3,6],g=null,y=[0,0];a.init=function(a){a=a.getContext("2d");e(a);return g=a};a.wm=function(){g&&e(g)};a.reset=function(){var a=g;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),y[0]=0,y[1]=0)};a.aJ=function(a,e){var k=g;if(k){k.textAlign="left";
k.fillStyle="rgba(0,255,0,255)";c(" FPS",(1/e).toFixed(2));y[0]++;for(var m=k=0,h=0,q=0;q<a.length;q++){var r=b(a[q]),k=k+r[0],m=m+r[1],h=h+r[2];y[0]++}c(" -----------------------------------------------");c("    ","TOTAL ACTIVE","","",m,"of",k,"  ",h.toFixed(3))}};a.print=function(){var a=g;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",c.apply(Math,arguments))};a.plot_array=function(a,b,c,e,m,h,q){var v=g;if(v){b=r(b);var y=b.eb/5;b.x=b.x;b.y+=4*y;b.qb=b.qb;b.eb=y;v.textAlign="center";v.fillStyle=
"#00FF00";g.fillText(a,k(b),b.y-10);v.strokeStyle="#00FF00";v.lineWidth=.5;v.beginPath();v.moveTo(b.x,b.y);v.lineTo(b.x+b.qb,b.y);v.lineTo(b.x+b.qb,b.y+b.eb);v.lineTo(b.x,b.y+b.eb);v.closePath();v.stroke();if(!h&&!q)for(h=1E6,q=-1E6,a=0;a<c.length;a++)h=Math.min(h,c[a]),q=Math.max(q,c[a]);v.textAlign="right";g.fillText(String(h),b.x-10,b.y+b.eb);g.fillText(String(q),b.x-10,b.y);v.textAlign="center";g.fillText(String(e),b.x,b.y+b.eb+15);g.fillText(String(m),b.x+b.qb,b.y+b.eb+15);v.strokeStyle="#FF0000";
v.lineWidth=1.5;v.beginPath();e=b.qb/(c.length-1);q=b.eb/(q-h);for(a=0;a<c.length;a++)m=b.x+e*a,y=b.y+b.eb-(c[a]-h)*q,0==a?v.moveTo(m,y):v.lineTo(m,y);v.stroke()}};a.draw_mixer_strip=function(a,b,c,e,m,h,q){var v=g;if(v)for(v.textAlign="center",v.fillStyle="#00FF00",v.font="bold 12px Courier",c=r(c),g.fillText(b?"["+a+"]":a,k(c),c.y),0<=h&&g.fillText(h?"[M]":"[ ]",k(c)-15,c.y+30),0<=q&&g.fillText(q?"[S]":"[ ]",k(c)+15,c.y+30),a={x:0,y:0,qb:0,eb:0},b=0;b<e.length;b++){h=e[b];var y="VOLUME"==h[0];if(y){q=
c.y+350;var z=c.qb,p=a;p.x=c.x;p.y=q;p.qb=z;p.eb=250}else{q=c.y+10+50*b;var z=c.qb,p=c.eb,d=a;d.x=c.x;d.y=q;d.qb=z;d.eb=p}q=v;var z=a,d=b==m,F=h[0],p=h[1],J=h[2],C=h[3],D=(C-J)/h[4],D=1>D?Math.floor(1/D-1E-5).toFixed(0).length:0;h=h[5]?Math.log(p/J)/Math.log(C/J):(p-J)/(C-J);q.textAlign="center";d?q.fillText("["+F+"]",k(z),z.y):q.fillText(F,k(z),z.y);q.strokeStyle="#00FF00";q.lineWidth=y?3:1;y?(q.textAlign="right",q.fillText(C.toFixed(D),k(z)-10,z.y+15),q.textAlign="right",q.fillText(J.toFixed(D),
k(z)-10,z.y+z.eb-15)):(q.textAlign="right",q.fillText(J.toFixed(D),z.x+28,z.y+15),q.textAlign="left",q.fillText(C.toFixed(D),z.x+z.qb-28,z.y+15));q.beginPath();if(y){var O=z.y+15+(z.eb-30)*(1-h);q.moveTo(k(z),z.y+15);q.lineTo(k(z),z.y+z.eb-15);q.moveTo(k(z)-5,z.y+15);q.lineTo(k(z)+5,z.y+15);q.moveTo(k(z)-5,z.y+z.eb-15);q.lineTo(k(z)+5,z.y+z.eb-15);q.moveTo(k(z)-5,O);q.lineTo(k(z)+5,O)}else{var T=z.x+30+(z.qb-60)*h;q.moveTo(z.x+30,z.y+15);q.lineTo(z.x+z.qb-30,z.y+15);q.moveTo(z.x+30,z.y+15-5);q.lineTo(z.x+
30,z.y+15+5);q.moveTo(z.x+z.qb-30,z.y+15-5);q.lineTo(z.x+z.qb-30,z.y+15+5);q.moveTo(T,z.y+15-5);q.lineTo(T,z.y+15+5)}q.stroke();"EQ_Q"==F?(h=Math.log(1+1/(2*p*p)+Math.sqrt((2+1/(p*p))*(2+1/(p*p))/4-1))/Math.log(2),y?(q.textAlign="left",q.fillText(p.toFixed(D),k(z)+10,O),q.textAlign="left",q.fillText("("+h.toFixed(D+1)+")",k(z)+10,O+10)):(q.textAlign="right",q.fillText(p.toFixed(D),T,z.y+30),q.textAlign="left",q.fillText("("+h.toFixed(D+1)+")",T,z.y+30))):y?(q.textAlign="left",q.fillText(p.toFixed(D),
k(z)+10,O)):(q.textAlign="center",q.fillText(p.toFixed(D),T,z.y+30))}}};b4w.module.__renderer=function(a,p){function e(a){for(var b=a.j,f=a.v,e=0;e<f.length;e++){var l=f[e];if(l.Ib){var g=a,h=b,n=l.$e,w=l.H,t=w.$b;v.useProgram(t.ck);for(var l=w.X,q=w.fn,N=t.lz,r=N.length;r--;){var u=N[r];u.gr(v,u.ii,g,n,w,h)}if(t.zo&&!t.hs){t.bm.length||k(t);N=t.bm;for(r=N.length;r--;)u=N[r],u.gr(v,u.ii,g,n,w,h);t.zo=!1}v.depthMask(w.wa);w.pb?v.enable(v.CULL_FACE):v.disable(v.CULL_FACE);h=w.Y;for(w=0;w<h.length;w++)r=h[w],v.activeTexture(v.TEXTURE0+w),v.bindTexture(r.Gb,r.Ra);if("SKY"==
g.type){h=g;t=t.Ji;w=h.j.Db.Ra;r=h.Ph;for(u=0;6>u;u++)if(N=m(u),G.uq?(v.bindTexture(v.TEXTURE_CUBE_MAP,w),v.texImage2D(N,0,v.RGBA,1,1,0,v.RGBA,v.UNSIGNED_BYTE,H)):(v.uniformMatrix4fv(t.u_cube_view_matrix,!1,r[u]),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,N,w,0),c(l,q,n.It)),h.xo&&3!=u){var N=h,y=u,p=z;G.uq?p.set(H):(v.readPixels(191,191,1,1,v.RGBA,v.UNSIGNED_BYTE,p),255!=p[0]&&255!=p[1]&&255!=p[2]||v.readPixels(191,220,1,1,v.RGBA,v.UNSIGNED_BYTE,p));var E=p[0],B=p[1],p=p[2],E=E/255,
B=B/255,p=p/255;2===y?(N.md[3]=E,N.md[7]=B,N.md[11]=p):2>y?(N.md[4*y]=E,N.md[4*y+1]=B,N.md[4*y+2]=p):(N.md[4*(y-2)]=E,N.md[4*(y-2)+1]=B,N.md[4*(y-2)+2]=p)}g.pl+=6}else c(l,q,n.It),g.pl++}}}function b(a){if(a){var b=(a.Fa?v.COLOR_BUFFER_BIT:0)|(a.Ha?v.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=B;break;case "SHADOW_CAST":a=n;break;case "SHADOW_RECEIVE":a=u;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=A;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=
B;break;default:a=G.background_color}}else b=v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT,a=G.background_color;v.colorMask(!0,!0,!0,!0);v.depthMask(!0);v.clearColor(a[0],a[1],a[2],a[3]);v.clear(b)}function c(a,b,c){v.bindBuffer(v.ARRAY_BUFFER,a.nh);for(var f=0;f<b.length;f++){var e=b[f];v.enableVertexAttribArray(e.ii);v.vertexAttribPointer(e.ii,e.fe,v.FLOAT,!1,0,e.qC+e.VE*c)}a.Mf?(v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,a.Mf),v.drawElements(a.mode,a.count,a.Ar,0)):v.drawArrays(a.mode,0,a.count);for(f=0;f<b.length;f++)e=
b[f],v.disableVertexAttribArray(e.ii)}function m(a){switch(a){case 0:return v.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return v.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return v.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return v.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return v.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return v.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function k(a){var b=a.Ji,c=[],e=[],k={},l;for(l in b){var g=!1;switch(l){case "u_proj_matrix":var h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.nb)},g=!0;break;case "u_view_matrix":h=
function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Xa)};g=!0;break;case "u_view_tsr":case "u_view_tsr_frag":h=function(a,b,c,d,f,e){e.Zb?a.uniformMatrix3fv(b,!1,e.cy):a.uniformMatrix3fv(b,!1,e.He)};g=!0;break;case "u_shadow_cast_billboard_view_tsr":h=function(a,b,c,d,f,e){a.uniformMatrix3fv(b,!1,e.Vs)};g=!0;break;case "u_view_proj_prev":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.NH)};g=!0;break;case "u_view_proj_matrix":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Ge)};g=!0;break;case "u_view_proj_inverse":h=
function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Mz)};g=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.ef)};g=!0;break;case "u_camera_eye":case "u_camera_eye_frag":h=function(a,b,c,d,e,k){a.uniform3fv(b,f.Gg(k.i,E))};g=!0;break;case "u_camera_quat":h=function(a,b,c,d,e,k){a.uniform4fv(b,f.get_quat_view(k.i))};g=!0;break;case "u_view_max_depth":h=function(a,b,c,d,f,e){a.uniform1f(b,e.far)};g=!0;break;case "u_camera_range":h=function(a,b,c,d,f,e){a.uniform2f(b,e.near,
e.far)};break;case "u_csm_center_dists":h=function(a,b,c,d,f,e){a.uniform4fv(b,e.ov)};break;case "u_cam_water_depth":h=function(a,b,c){a.uniform1f(b,c.oq)};g=!0;break;case "u_waves_height":h=function(a,b,c){a.uniform1f(b,c.Mt)};break;case "u_waves_length":h=function(a,b,c){a.uniform1f(b,c.Nt)};break;case "u_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.zc)};break;case "u_fog_params":h=function(a,b,c){a.uniform4fv(b,c.Xd)};break;case "u_underwater_fog_color_density":h=function(a,b,c){a.uniform4fv(b,
c.Ie)};break;case "u_bloom_key":h=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":h=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":h=function(a,b,c){a.uniform1f(b,c.time)};g=!0;break;case "u_wind":h=function(a,b,c){a.uniform3fv(b,c.ng)};g=!0;break;case "u_sky_tex_dvar":h=function(a,b,c){a.uniform1f(b,c.By)};break;case "u_sky_tex_fac":h=function(a,b,c){a.uniform4fv(b,c.Cy)};break;case "u_sky_tex_color":h=function(a,b,c){a.uniform3fv(b,c.Ay)};break;case "u_horizon_color":h=
function(a,b,c){a.uniform3fv(b,c.be)};break;case "u_zenith_color":h=function(a,b,c){a.uniform3fv(b,c.ne)};break;case "u_environment_energy":h=function(a,b,c){a.uniform1f(b,c.Ef)};break;case "u_sky_color":h=function(a,b,c){a.uniform3fv(b,c.kk)};break;case "u_rayleigh_brightness":h=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":h=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":h=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;
case "u_scatter_strength":h=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":h=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":h=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":h=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":h=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":h=function(a,b,c){a.uniform1f(b,
c.mie_distribution)};break;case "u_light_positions":h=function(a,b,c){a.uniform3fv(b,c.no)};break;case "u_light_directions":h=function(a,b,c){a.uniform3fv(b,c.Pr)};break;case "u_light_color_intensities":h=function(a,b,c){a.uniform3fv(b,c.mo)};break;case "u_light_factors":h=function(a,b,c){a.uniform4fv(b,c.Qr)};break;case "u_sun_quaternion":h=function(a,b,c){a.uniform4fv(b,c.Ty)};break;case "u_sun_intensity":h=function(a,b,c){a.uniform3fv(b,c.Sy)};break;case "u_sun_direction":h=function(a,b,c){a.uniform3fv(b,
c.nt)};break;case "u_height":h=function(a,b,c,d,f,e){a.uniform1f(b,e.height)};g=!0;break;case "u_model_tsr":h=function(a,b,c,d){a.uniformMatrix3fv(b,!1,d.i)};g=!0;break;case "u_transb":h=function(a,b,c,d){a.uniform4fv(b,d.ad)};g=!0;break;case "u_transa":h=function(a,b,c,d){a.uniform4fv(b,d.Kd)};g=!0;break;case "u_arm_rel_trans":h=function(a,b,c,d){a.uniform4fv(b,d.Up)};g=!0;break;case "u_arm_rel_quat":h=function(a,b,c,d){a.uniform4fv(b,d.Tp)};g=!0;break;case "u_quat":h=function(a,b,c,d){c=f.get_quat_view(d.i);
a.uniform4fv(b,c)};g=!0;break;case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,d.Tc)};g=!0;break;case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,d.Ad)};g=!0;break;case "u_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.Yd)};g=!0;break;case "au_center_pos":h=function(){};g=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.mf)};g=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.og)};g=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,
d.Bf)};g=!0;break;case "au_detail_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Af)};g=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.tf)};g=!0;break;case "u_node_values":h=function(a,b,c,d,f){a.uniform1fv(b,f.oi)};g=!0;break;case "u_node_rgbs":h=function(a,b,c,d,f){a.uniform3fv(b,f.xd)};g=!0;break;case "u_diffuse_color":h=function(a,b,c,d,f){a.uniform4fv(b,f.vc)};g=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,f){a.uniform1f(b,f.Dg)};g=!0;break;case "u_diffuse_params":h=
function(a,b,c,d,f){a.uniform2fv(b,f.pd)};g=!0;break;case "u_emit":h=function(a,b,c,d,f){a.uniform1f(b,f.Df)};g=!0;break;case "u_ambient":h=function(a,b,c,d,f){a.uniform1f(b,f.pf)};g=!0;break;case "u_specular_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.ff)};g=!0;break;case "u_specular_alpha":h=function(a,b,c,d,f){a.uniform1f(b,f.et)};g=!0;break;case "u_specular_params":h=function(a,b,c,d,f){a.uniform3fv(b,f.Yc)};g=!0;break;case "u_reflect_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.reflect_factor)};
g=!0;break;case "u_mirror_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.$r)};g=!0;break;case "u_grass_map_dim":h=function(a,b,c,d,f){a.uniform3fv(b,f.Nc)};g=!0;break;case "u_grass_size":h=function(a,b,c,d,f){a.uniform1f(b,f.sr)};g=!0;break;case "u_scale_threshold":h=function(a,b,c,d,f){a.uniform1f(b,f.nw)};g=!0;break;case "u_cube_fog":h=function(a,b,c,d,f){a.uniformMatrix4fv(b,!1,f.md)};break;case "u_jitter_amp":h=function(a,b,c,d,f){a.uniform1f(b,f.Sw)};g=!0;break;case "u_jitter_freq":h=function(a,
b,c,d,f){a.uniform1f(b,f.Tw)};g=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,f){a.uniform1i(b,f.wireframe_mode)};break;case "u_wireframe_edge_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.wireframe_edge_color)};break;case "u_subpixel_jitter":h=function(a,b,c){a.uniform2fv(b,c.rG)};g=!0;break;case "u_subsample_indices":h=function(a,b,c){a.uniform4fv(b,c.sG)};g=!0;break;case "u_refr_bump":h=function(a,b,c,d,f){a.uniform1f(b,f.fy)};g=!0;break;case "u_line_width":h=function(a,b,c,d,f){a.uniform1f(b,
f.oo)};g=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d,f){a.uniform3fv(b,f.Lr)};break;case "u_lamp_light_directions":h=function(a,b,c,d,f){a.uniform3fv(b,f.Jr)};break;case "u_lamp_light_color_intensities":h=function(a,b,c,d,f){a.uniform3fv(b,f.Ir)};break;case "u_lamp_light_factors":h=function(a,b,c,d,f){a.uniform4fv(b,f.Kr)};break;case "u_halo_size":h=function(a,b,c,d,f){a.uniform1f(b,f.uw)};g=!0;break;case "u_halo_hardness":h=function(a,b,c,d,f){a.uniform1f(b,f.rw)};g=!0;break;case "u_halo_rings_color":h=
function(a,b,c,d,f){a.uniform3fv(b,f.tw)};g=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.sw)};g=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d,f){a.uniform1f(b,f.vw)};g=!0;break;case "u_halo_stars_height":h=function(a,b,c,d,f){a.uniform1f(b,f.ww)};g=!0;break;case "u_fresnel_params":h=function(a,b,c,d,f){a.uniform4fv(b,f.se)};g=!0;break;case "u_texture_scale":h=function(a,b,c,d,f){a.uniform3fv(b,f.hh)};g=!0;break;case "u_parallax_scale":h=function(a,b,c,d,f){a.uniform1f(b,
f.parallax_scale)};g=!0;break;case "u_color_id":h=function(a,b,c,d){a.uniform3fv(b,d.sn)};g=!0;break;case "u_line_points":h=function(a,b,c,d,f){a.uniform3fv(b,f.gN)};g=!0;break;case "u_diffuse_color_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Cg)};g=!0;break;case "u_alpha_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.vg)};g=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Hi)};g=!0;break;case "u_normal_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.yx)};g=!0;break;case "u_normalmap0_scale":h=
function(a,b,c,d,f){a.uniform2fv(b,f.pi[0])};g=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.pi[1])};g=!0;break;case "u_normalmap2_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.pi[2])};g=!0;break;case "u_normalmap3_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.pi[3])};g=!0;break;case "u_foam_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.foam_factor)};g=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,f){a.uniform2fv(b,f.Mv)};g=!0;break;case "u_foam_mag":h=function(a,b,
c,d,f){a.uniform2fv(b,f.Lv)};g=!0;break;case "u_foam_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.br)};g=!0;break;case "u_water_norm_uv_velocity":h=function(a,b,c,d,f){a.uniform1f(b,f.Ik)};g=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,f){a.uniform3fv(b,f.shallow_water_col)};g=!0;break;case "u_shore_water_col":h=function(a,b,c,d,f){a.uniform3fv(b,f.shore_water_col)};g=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,f){a.uniform1f(b,f.shallow_water_col_fac)};g=!0;break;case "u_water_shore_col_fac":h=
function(a,b,c,d,f){a.uniform1f(b,f.shore_water_col_fac)};g=!0;break;case "u_p_length":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.bz)};g=!0;break;case "u_p_cyclic":h=function(a,b,c,d,f){a.uniform1i(b,f.xa.cyclic)};g=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.ax)};g=!0;break;case "u_p_fade_in":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.Wh)};g=!0;break;case "u_p_fade_out":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.rd)};g=!0;break;case "u_p_size":h=function(a,b,c,d,f){a.uniform1f(b,
f.xa.size)};g=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.yu)};g=!0;break;case "u_p_alpha_end":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.xu)};g=!0;break;case "u_p_nfactor":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.gs)};g=!0;break;case "u_p_gravity":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.ow)};g=!0;break;case "u_p_mass":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.Xe)};g=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,f){a.uniform4fv(b,f.xa.fv)};g=!0;break;case "u_p_wind_fac":h=
function(a,b,c,d,f){a.uniform1f(b,f.xa.Sz)};g=!0;break;case "u_texel_size":h=function(a,b,c){a.uniform2fv(b,c.ut)};g=!0;break;case "u_p_time":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.time)};g=!0;break;case "u_p_tilt":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.$y)};g=!0;break;case "u_p_tilt_rand":h=function(a,b,c,d,f){a.uniform1f(b,f.xa.az)};g=!0;break;case "u_position":h=function(a,b,c,d,f){a.uniform3fv(b,f.ak)};g=!0;break;case "u_va_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.Az)};g=!0;break;
case "u_normal_offset":h=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":h=function(a,b,c,d,f,e){a.uniform4fv(b,e.Jo)};break;case "u_v_light_ts":h=function(a,b,c){a.uniform4fv(b,c.xp)};g=!0;break;case "u_v_light_r":h=function(a,b,c){a.uniform4fv(b,c.wp)};g=!0;break;case "u_v_light_tsr":h=function(a,b,c){a.uniformMatrix3fv(b,!1,c.Ht)};g=!0;break;case "u_p_light_matrix0":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ui[0])};g=!0;break;case "u_p_light_matrix1":h=
function(a,b,c){a.uniformMatrix4fv(b,!1,c.ui[1])};g=!0;break;case "u_p_light_matrix2":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ui[2])};g=!0;break;case "u_p_light_matrix3":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ui[3])};g=!0;break;case "u_motion_blur_exp":h=function(a,b,c){a.uniform1f(b,c.nx)};g=!0;break;case "u_motion_blur_decay_threshold":h=function(a,b,c){a.uniform1f(b,c.mb_decay_threshold)};g=!0;break;case "u_refl_plane":h=function(a,b,c,d){a.uniform4fv(b,d.Zb)};g=!0;break;case "u_radial_blur_step":h=
function(a,b,c){a.uniform1f(b,c.So)};break;case "u_god_rays_intensity":h=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":h=function(a,b,c){a.uniform1f(b,c.pk)};break;case "u_ssao_blur_discard_value":h=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};g=!0;break;case "u_ssao_influence":h=function(a,b,c){a.uniform1f(b,c.nk)};break;case "u_ssao_dist_factor":h=function(a,b,c){a.uniform1f(b,c.mk)};break;case "u_dof_dist":h=function(a,b,c,d,f,e){e.dof_on?
a.uniform1f(b,e.dof_distance):a.uniform1f(b,0)};g=!0;break;case "u_dof_front":h=function(a,b,c,d,f,e){a.uniform1f(b,e.dof_front)};g=!0;break;case "u_dof_rear":h=function(a,b,c,d,f,e){a.uniform1f(b,e.dof_rear)};g=!0;break;case "u_outline_intensity":h=function(a,b,c,d){a.uniform1f(b,d.Yf)};g=!0;break;case "u_outline_color":h=function(a,b,c){a.uniform3fv(b,c.Xf)};break;case "u_draw_outline":h=function(a,b,c){a.uniform1f(b,c.Tq)};g=!0;break;case "u_glow_mask_small_coeff":h=function(a,b,c){a.uniform1f(b,
c.small_glow_mask_coeff)};g=!0;break;case "u_glow_mask_large_coeff":h=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};g=!0;break;case "u_brightness":h=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":h=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":h=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":h=function(a,b,c){a.uniform1f(b,c.saturation)};break;case "u_enable_hmd_stereo":h=function(a,b,c){a.uniform1i(b,c.enable_hmd_stereo)};
break;case "u_distortion_params":h=function(a,b,c){a.uniform4fv(b,c.Sh)};break;case "u_chromatic_aberration_coefs":h=function(a,b,c){a.uniform4fv(b,c.chromatic_aberration_coefs)};break;default:h=null}h&&(h={name:l,gr:h,ii:b[l]},g?c.push(h):(e.push(h),k[l]=h))}a.lz=c;e.length?(a.bm=e,a.ts=k):a.hs=!0}var r=p("__batch"),h=p("__camera"),q=p("__config"),g=p("__debug"),y=p("__textures"),f=p("__tsr"),l=p("__util"),n=[1,1,1,1],u=[1,1,1,1],A=[0,0,0,1],B=[0,0,0,0],H=new Uint8Array([91.8,142.8,.96*255,255]);
new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var v=null,E=new Float32Array(3),z=new Uint8Array(4);new Float32Array(9);new Float32Array(8);var G=q.q;a.Ed=function(a){var b=G.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);v=a};a.ij=function(a){if(a.Ib)if("RESOLVE"==
a.type){g.Ds(a);var c=a.j;v.bindFramebuffer(v.READ_FRAMEBUFFER,c.er);v.bindFramebuffer(v.DRAW_FRAMEBUFFER,c.Zd);var k=0;c.Db&&(k|=v.COLOR_BUFFER_BIT);c.od&&(k|=v.DEPTH_BUFFER_BIT);v.blitFramebuffer(0,0,c.width,c.height,0,0,c.width,c.height,k,v.NEAREST);g.Es(a);g.rq("draw resolve")}else if("COPY"==a.type)g.Ds(a),c=a.j,v.bindFramebuffer(v.FRAMEBUFFER,c.er),v.bindTexture(v.TEXTURE_2D,c.Db.Ra),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,c.width,c.height,0),g.Es(a),g.rq("draw copy");else{g.Ds(a);c=a.j;
v.bindFramebuffer(v.FRAMEBUFFER,c.Zd);a.Wp&&(k=c.Db,v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,k.Gb,k.Ra,0));v.viewport(0,0,c.width,c.height);"MAIN_CUBE_REFLECT"!=a.type&&"MAIN_CUBE_REFLECT_BLEND"!=a.type&&b(a);a.Ga?v.enable(v.BLEND):v.disable(v.BLEND);a.tc?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST);switch(a.type){case "SHADOW_CAST":v.enable(v.POLYGON_OFFSET_FILL);v.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);v.cullFace(v.BACK);break;case "MAIN_PLANE_REFLECT":case "MAIN_PLANE_REFLECT_BLEND":v.disable(v.POLYGON_OFFSET_FILL);
v.cullFace(v.FRONT);break;case "MAIN_GLOW":if(1<G.Dc){v.enable(v.POLYGON_OFFSET_FILL);v.polygonOffset(-2,-2);break}default:v.disable(v.POLYGON_OFFSET_FILL),v.cullFace(v.BACK)}if("MAIN_CUBE_REFLECT"==a.type||"MAIN_CUBE_REFLECT_BLEND"==a.type)for(var c=a.j,k=c.Db.Ra,l=0;6>l;l++){var n=m(l);c.Xa=a.Ph[l];f.from_mat4(c.Xa,c.He);h.mq(c);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,n,k,0);b(a);for(var n=a.v,q=0;q<n.length;q++)n[q].Ib=n[q].Sq[l];e(a)}else e(a);g.Es(a);g.rq("draw subscene: "+a.type);
v.bindFramebuffer(v.FRAMEBUFFER,null)}};a.clear=function(a){v.bindFramebuffer(v.FRAMEBUFFER,a.j.Zd);b(a)};a.Vp=function(a){var b=a.fn;b.length=0;var c=a.X;a=a.$b;c&&a||l.da("Incomplete batch");c=c.sb;a=a.attributes;for(var f in a){var e=c[f];b.push({ii:a[f],qC:4*e.offset,VE:1<e.frames?4*e.length:0,fe:e.fe})}};a.oC=k;a.Cu=function(a){var b=a.$b,c=a.Y;a=a.nc;v.useProgram(b.ck);for(var f=0;f<c.length;f++)v.uniform1i(b.Ji[a[f]],f)};a.Bs=function(a,b,c,f,e,k){f||(f=1);e||(e=1);k||(k=new Uint8Array(4*f*
e));k.length!=4*f*e&&l.da("read_pixels(): Wrong storage");v.bindFramebuffer(v.FRAMEBUFFER,a);v.readPixels(b,c,f,e,v.RGBA,v.UNSIGNED_BYTE,k);v.bindFramebuffer(v.FRAMEBUFFER,null);return k};a.QJ=function(a){var b=a.$b;b.hs||(v.useProgram(b.ck),b.bm.length||k(b),b=b.ts.u_cube_fog,b.gr(v,b.ii,null,null,a,null))};a.ZH=function(a,b){var c=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,c);if(y.Cj(a)){var f=a.Md;v.framebufferRenderbuffer(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.RENDERBUFFER,f)}else if(y.Ej(a)){var e=
a,f=e.Ra,e=e.Gb==v.TEXTURE_CUBE_MAP?v.TEXTURE_CUBE_MAP_NEGATIVE_Z:e.Gb;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,e,f,0)}y.Cj(b)?(f=b.Md,v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,f)):y.Ej(b)&&(e=b,f=e.Ra,e=e.Gb,v.framebufferTexture2D(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,e,f,0));g.QC();v.bindFramebuffer(v.FRAMEBUFFER,null);return c};a.YH=function(a,b,c,f,e){null==a?(v.bindFramebuffer(v.FRAMEBUFFER,a),v.viewport(0,0,f,e),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT)):
(y.Cj(b)?v.deleteRenderbuffer(b.Md):y.Ej(b)&&v.deleteTexture(b.Ra),y.Cj(c)?v.deleteRenderbuffer(c.Md):y.Ej(c)&&v.deleteTexture(c.Ra),v.deleteFramebuffer(a))};a.SM=function(){};a.pE=function(a,b,f,e,k,g){a=a.Ra;v.viewport(0,0,f,f);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,b,a,0);b=r.Dq("FLIP_CUBEMAP_COORDS");a=b.$b;v.activeTexture(v.TEXTURE0);v.bindTexture(v.TEXTURE_2D,k);var l=k=0;f!=e&&(k=1/(6*e),l=1/(4*e));v.uniform1i(a.Ji.u_tex_number,g);v.uniform2fv(a.Ji.u_delta,[k,l]);v.useProgram(a.ck);
c(b.X,b.fn,0);v.bindTexture(v.TEXTURE_2D,null)};a.qE=function(a,b,f,e,k){v.bindFramebuffer(v.FRAMEBUFFER,e);e=a.Ra;a=a.Gb;v.bindTexture(a,e);v.viewport(0,0,b,f);v.texImage2D(a,0,v.RGBA,b,f,0,v.RGBA,v.UNSIGNED_BYTE,null);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,a,e,0);b=r.Dq("NONE");f=b.$b;v.bindTexture(a,null);v.activeTexture(v.TEXTURE0);v.bindTexture(a,k);v.useProgram(f.ck);c(b.X,b.fn,0);v.bindFramebuffer(v.FRAMEBUFFER,null);v.bindTexture(a,null)};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function e(a,c,d){var f=a.Eg;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<f.length;a++)if(f[a][0]==c){f[a][1]=d;return}f.push([c,d])}function b(a,b){for(var c=a.Eg,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function c(a,b){var c=a+b;if(v[c])return v[c];if(E){var d=E[b];if(!d)return null;d=p("__gpp_parser").qN.parse(d)}else if(d=p("shader_texts")[b],!d)return null;return v[c]=d}function m(a,b,d){function f(b){b=b.b;for(var d=0;d<b.length;d++){var n=
b[d];switch(n.type){case "condition":a:for(var n=n.b,C=0;C<n.length;C++){var x=n[C];switch(x.type){case "if":case "elif":if(e(x.d)){f(x.group);break a}break;case "else":f(x.group);break a;case "ifdef":x.name in m&&f(x.group);break;case "ifndef":x.name in m||f(x.group)}}break;case "include":n=c(B.shaders_dir,B.ZI+n.file);f(n);break;case "var":case "export":case "import":break;case "define":C=n.name;m[C]=n.a;n.s&&(q[C]=n.s);break;case "error":throw"Shader error: #error "+n.a.join(" ");case "line":break;
case "pragma":h.push("#pragma "+n.name+" "+n.a.join(" "));break;case "undef":n=n.name;delete m[n];delete q[n];break;case "warning":u.warn("Shader warning: #warning "+n.a.join(" "));break;case "extension":n=k(n.a,m,q,!1);h.push("#extension "+n.join(" "));break;case "#":break;case "node":r[n.name]=n;break;case "nodes_global":n=l;for(C=0;C<n.length;C++){var x=n[C],F=r[x.id];if(F)for(var D=0,N=0;N<F.h.length;N++){var G=F.h[N];if("node_param"==G.type){var A;if("PARTICLE_INFO"==x.id&&G.c)if(1==m.PARTICLE_BATCH)switch(A=
!1,D){case 0:A=y(x.Na,"PART_INFO_IND")||y(x.Na,"PART_INFO_AGE")||y(x.Na,"PART_INFO_LT")||y(x.Na,"PART_INFO_SIZE");break;case 1:A=y(x.Na,"PART_INFO_LOC");break;case 2:A=y(x.Na,"PART_INFO_VEL");break;case 3:A=y(x.Na,"PART_INFO_A_VEL");break;case 4:A=y(x.Na,"PART_INFO_IND")}else A=!1;else A=!0;A&&(G=G.qualifier.join(" ")+" ","vert"==a?G+=x.ph[D]:"frag"==a&&(G+=x.s[D],null!==x.Fo[D]&&(G+=" = "+x.Fo[D])),G+=";",h.push(G));D++}}}break;case "nodes_main":n=l;for(C=0;C<n.length;C++)if(x=n[C],F=r[x.id]){D=
{};N={};for(G=0;G<x.Na.length;G++)N[x.Na[G][0]]=[x.Na[G][1]];E=p=v=0;G=x;A=F.h;for(var H=D,M=N,la=0;la<A.length;la++){var da=A[la];switch(da.type){case "node_in":var L=G.K[v];if(null!==G.Dr[v]){if(("MATERIAL_BEGIN"==G.id&&3===v||!M.MATERIAL_EXT&&("MATERIAL_BEGIN"==G.id&&4===v||"MATERIAL_END"==G.id&&3===v||"MATERIAL_END"==G.id&&4===v||"MATERIAL_END"==G.id&&5===v)||"TEXTURE_COLOR"==G.id||"TEXTURE_NORMAL"==G.id)&&da.c){H[da.name]=G.Dr[v];v++;continue}var V=da.qualifier.join(" ")+" ",V=V+L,V=V+(" = "+
G.Dr[v]),V=V+";";h.push(V)}H[da.name]=L;v++;break;case "node_out":L=G.Da[p];if(!da.c||-1<z.indexOf(L))V=da.qualifier.join(" ")+" ",V+=L,V+=";",h.push(V),H[da.name]=L;-1<z.indexOf(L)&&(M["USE_OUT_"+da.name]=[1]);p++;break;case "node_param":"vert"==a?L=G.ph[E]:"frag"==a&&(L=G.s[E]),H[da.name]=L,E++}}h.push("{");g(x,F.f,D,N);h.push("}")}break;case "textline":n=k(n.a,m,q,!1);h.push(n.join(" "));break;default:throw"Unknown element type: "+n.type;}}}function e(a,b){var c;c=k(a,m,q,!0,b);for(var d=[],f=
0;f<c.length;f++)if(c[f]instanceof Object)switch(c[f].type){case "conditional_expr":var g=d.pop(),l=d.pop();d.pop()?d.push(l):d.push(g);break;case "logical_or_expr":g=d.pop();for(l=0;l<c[f].e-1;l++)h=d.pop(),g=g||h;d.push(g);break;case "logical_and_expr":g=d.pop();for(l=0;l<c[f].e-1;l++)h=d.pop(),g=g&&h;d.push(g);break;case "logical_bitor_expr":g=d.pop();for(l=0;l<c[f].e-1;l++)g|=d.pop();d.push(g);break;case "logical_bitxor_expr":g=d.pop();for(l=0;l<c[f].e-1;l++)g^=d.pop();d.push(g);break;case "logical_bitand_expr":g=
d.pop();for(l=0;l<c[f].e-1;l++)g&=d.pop();d.push(g);break;case "equal_expr":g=d.pop();l=d.pop();d.push(l==g);break;case "non_equal_expr":g=d.pop();l=d.pop();d.push(l!=g);break;case "le_expr":g=d.pop();l=d.pop();d.push(l<=g);break;case "ge_expr":g=d.pop();l=d.pop();d.push(l>=g);break;case "l_expr":g=d.pop();l=d.pop();d.push(l<g);break;case "g_expr":g=d.pop();l=d.pop();d.push(l>g);break;case "left_shift_expr":l=d.pop();g=d.pop();d.push(l<<g);break;case "right_shift_expr":l=d.pop();g=d.pop();d.push(l>>
g);break;case "add_expr":l=d.pop();g=d.pop();d.push(l+g);break;case "sub_expr":l=d.pop();g=d.pop();d.push(l-g);break;case "mul_expr":l=d.pop();g=d.pop();d.push(l*g);break;case "div_expr":l=d.pop();g=d.pop();d.push(l/g);break;case "mod_expr":l=d.pop();g=d.pop();d.push(l%g);break;case "pre_inc_expr":case "post_inc_expr":h=d.pop();d.push(++h);break;case "pre_dec_expr":case "post_dec_expr":h=d.pop();d.push(--h);break;case "positive_expr":h=d.pop();d.push(+h);break;case "negative_expr":h=d.pop();d.push(-h);
break;case "one_compl_expr":h=d.pop();d.push(~h);break;case "logic_negative_expr":h=d.pop();d.push(!h);break;default:A.da("Unknown operation type: "+c[f].type)}else{var h=c[f];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(h)?d.push(0):d.push(parseFloat(c[f]))}1==d.length?c=d[0]:(A.da("Incorrect expression: "+c.join(" ")),c=void 0);return c}function g(a,b,c,d){for(var f=0;f<b.length;f++){var l=b[f];switch(l.type){case "node_condition":a:for(var n=a,l=l.b,C=c,w=d,r=0;r<l.length;r++){var J=l[r];switch(J.type){case "node_if":case "node_elif":if(e(J.d,
w)){g(n,J.f,C,w);break a}break;case "node_else":g(n,J.f,C,w);break a;case "node_ifdef":(J.name in m||J.name in w)&&g(n,J.f,C,w);break;case "node_ifndef":J.name in m||J.name in w||g(n,J.f,C,w)}}break;case "textline":n=[];for(C=0;C<l.a.length;C++)w=l.a[C],w in c?n.push(c[w]):n.push(w);n=k(n,m,q,!0,d);h.push(n.join(" "))}}}var l=d.ni;d=d.Eg||[];for(var h=[],m={},n=0;n<d.length;n++)m[d[n][0]]=[d[n][1]];for(n=0;n<l.length;n++)m["USE_NODE_"+l[n].id]=[1];var q={},r={},z=[];for(n in l)for(var F in l[n].K)z.push(l[n].K[F]);
f(b);var v=0,p=0,E=0;return h.join("\n")}function k(a,b,c,d,f){var e=[];r(a,b,c,d,e,f);return e}function r(a,b,c,d,f,e){for(var k=0;k<a.length;k++){var g=a[k];g in b||e&&g in e?(g=e&&e[g]||b[g],0==g.length&&d?f.push(0):r(g,b,c,d,f,e)):f.push(g)}}function h(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);n.XC(d,b,c);return d}function q(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return g(a);case 2:return"vec2("+g(a[0])+","+g(a[1])+")";case 3:return"vec3("+g(a[0])+","+
g(a[1])+","+g(a[2])+")";case 4:return"vec4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+")";case 9:return"mat3("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+")";case 16:return"mat4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+","+g(a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(a[13])+","+g(a[14])+","+g(a[15])+")";default:throw"Wrong glsl value dimension";}}function g(a){return a%
1?String(a):String(a)+".0"}function y(a,b){for(var c=0;c<a.length;c++)if(a[c][0]==b)return!0;return!1}var f=p("__assets"),l=p("__config"),n=p("__debug"),u=p("__print"),A=p("__util"),B=l.Ec,H={},v={},E=null,z="anchors.glslf anchors.glslv color_id.glslf color_id.glslv shadow.glslf shadow.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv line.glslf line.glslv main.glslf main.glslv main_stack.glslf particle_system.glslf particle_system_stack.glslf particle_system.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/performance.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf postprocessing/stereo.glslf include/blending.glslf include/caustics.glslf include/color_util.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/fxaa.glslf include/halo_color.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/particles_nodes.glslf include/particles_nodes.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
G=[],d=null,F=!1;a.Ed=function(a){d=a};a.N=e;a.CF=b;a.$M=function(a,b){for(var c=a.Eg,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.oI=function(a){a.Eg=[];for(var b="ALPHA ALPHA_CLIP ANAGLYPH BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_DISTORTION_CORRECTION DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WEBGL2 WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS NUM_CAST_LAMPS SUN_NUM MAC_OS_SHADOW_HACK USE_COLOR_RAMP HALO_PARTICLES PARTICLE_BATCH".split(" "),
c=0;c<b.length;c++){var d=b[c],f;switch(d){case "ALPHA":case "ALPHA_CLIP":case "ANAGLYPH":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_DISTORTION_CORRECTION":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":case "NUM_CAST_LAMPS":case "SUN_NUM":case "MAC_OS_SHADOW_HACK":case "USE_COLOR_RAMP":case "HALO_PARTICLES":case "PARTICLE_BATCH":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "WEBGL2":f=l.q.Hc|0;break;case "EPSILON":f="highp"==l.q.precision?1E-6:1E-4;break;case "SHADOW_TEX_RES":f=q(2048);break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f=
"POST_EFFECT_NONE";break;case "SHADOW_USAGE":f="NO_SHADOWS";break;case "SSAO_QUALITY":f="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":f=l.q.precision;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":f="u_va_frame_factor";break;default:u.error("Unknown directive ("+a.Gk+", "+a.oj+"): "+d)}e(a,d,f)}};a.KM=function(a){return a.Gk};a.BM=function(a){return a.oj};a.TM=function(a,c){for(var d=c.Eg,f=0;f<
d.length;f++){var g=d[f][0],k=d[f][1];b(a,g)&&e(a,g,k)}};a.yF=function(a){var b=JSON.stringify(a),f=H[b];if(f)return f;var e=a.oj,f=c(B.shaders_dir,a.Gk),e=c(B.shaders_dir,e);if(!f||!e)return null;var g=m("vert",f,a),k=m("frag",e,a),f=d,l=h(f,b,g,f.VERTEX_SHADER),t=h(f,b,k,f.FRAGMENT_SHADER),e=f.createProgram();f.attachShader(e,l);f.attachShader(e,t);f.linkProgram(e);f.validateProgram(e);f.getProgramParameter(e,f.VALIDATE_STATUS)==f.qL&&u.error("shader program is not valid",b);n.YC(e,b,l,t,g,k);a=
{Lt:l,Pv:t,ck:e,attributes:{},Ji:{},bm:[],ts:{},zo:!0,hs:!1,lz:[],Fb:a};k=f.getProgramParameter(e,f.ACTIVE_ATTRIBUTES);for(g=0;g<k;g++)l=f.getActiveAttrib(e,g).name,a.attributes[l]=f.getAttribLocation(e,l);k=f.getProgramParameter(e,f.ACTIVE_UNIFORMS);for(g=0;g<k;g++)l=f.getActiveUniform(e,g).name.split("[0]").join(""),a.Ji[l]=f.getUniformLocation(e,l);return H[b]=f=a};a.MG=function(){F=!1;if(b4w.module_check("shader_texts"))F=!0;else{for(var a=[],b=f.AT_TEXT,c=0;c<z.length;c++){var d=A.Ul(B.shaders_dir+
z[c]);a.push({id:z[c],type:b,url:d})}b=function(a,b){E||(E={});E[b]=a};a.length?f.enqueue(a,b,function(){F=!0}):u.error("Shaders have not been found.")}};a.ZC=function(){return F};a.bM=function(){return G};a.aw=function(){return H};a.cleanup=function(){for(var a in H){var b=H[a];d.deleteProgram(b.ck);d.deleteShader(b.Lt);d.deleteShader(b.Pv);delete H[a]}for(var c in v)delete v[c];for(var f in G)delete G[f]};a.cM=function(a){var b=a.Eg;u.log("Shader: "+a.Gk+" "+a.oj+", "+String(b.length)+" directives: ");
for(a=0;a<b.length;a++)u.log("  "+b[a][0],b[a][1])};a.r=q;a.bv=function(a,b){return b in a.Ji?!0:!1};a.TF=function(a){return(d.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function e(a,b){for(var c=1;c<a.va.length;c++){for(var d=a.va[c].Ac,f=d.a_position,e=d.a_normal,g=b.a_position,k=b.a_normal,l=f.length,h=a.va[c].co,m=0;m<l;m++)g[m]+=h*f[m],k[m]+=h*e[m];d=d.a_tangent;f=b.a_tangent;e=d.length;for(m=0;m<e;m++)f[m]+=h*d[m]}}function b(a){return 65536<a.ha?G.cw()?!1:!0:!1}function c(a){return 0<a.Ma.length?!0:!1}function m(a,b,f){if(!c(a))return a;f||d.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.ha*(b||
1)+", will use drawArrays","color: #aa0");b=a.Ma;f=a.ha;var e=a.U,g=a.G,l;for(l in e){var h=e[l],m=u(h,f);e[l]=k(b,h,m)}for(e=0;e<g.length;e++){var n=g[e];for(l in n)h=n[l],m=u(h,f),n[l]=k(b,h,m)}for(e=0;e<a.va.length;e++){l=a.va[e].Ac;for(var q in l)h=l[q],m=u(h,f),l[q]=k(b,h,m)}a.ha=b.length;a.Ma=new Uint16Array(0);return a}function k(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),f=0;f<a.length;f++)for(var e=a[f],g=0;g<c;g++)d[c*f+g]=b[c*e+g];return d}function r(a,
b){var c=a.oc,d=a.sb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function h(b,c){var d,f;switch(c){case a.Mk:case a.Rm:d=K.TRIANGLES;f=K.STATIC_DRAW;break;case a.Yt:d=K.POINTS;f=K.STATIC_DRAW;break;case a.Qm:d=K.TRIANGLES;f=K.DYNAMIC_DRAW;break;case a.aA:d=K.POINTS;f=K.DYNAMIC_DRAW;break;case a.bA:d=K.LINES;f=K.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.zm=f}function q(a){a.Ig?(a.Mf||(a.Mf=K.createBuffer()),K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,
a.Mf),K.bufferData(K.ELEMENT_ARRAY_BUFFER,a.Ig,a.zm),a.Cn=a.Ig.byteLength):a.Cn=0;a.nh||(a.nh=K.createBuffer());K.bindBuffer(K.ARRAY_BUFFER,a.nh);K.bufferData(K.ARRAY_BUFFER,a.oc,a.zm);a.tv=a.oc.byteLength}function g(a){for(var b=J.Vb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].Ma.length;b.Ma=new Uint32Array(c);var f=c=0,e=0;if(0<a[0].va.length)for(var g=0;g<a[0].va.length;g++){for(d=0;d<a.length;d++)c+=a[d].va[g].Ac.a_position.length,f+=a[d].va[g].Ac.a_normal.length,e+=a[d].va[g].Ac.a_tangent.length;
d={a_position:new Float32Array(c),a_normal:new Float32Array(f),a_tangent:new Float32Array(e)};b.va.push({co:a[0].va[g].co,Ac:d})}for(d=c=0;d<a.length;d++)c+=a[d].ha;b.ha=c;var f=a[0],k;for(k in f.U){for(d=c=0;d<a.length;d++)c+=a[d].U[k].length;b.U[k]=new Float32Array(c)}for(k in f.G[0]){for(d=c=0;d<a.length;d++)c+=a[d].G[0][k].length;for(d=0;d<f.G.length;d++)b.G[d]=b.G[d]||{},b.G[d][k]=new Float32Array(c)}for(k=f=c=0;k<a.length;k++){for(var e=a[k],l=e.Ma,g=e.ha,h=e.U,d=0;d<l.length;d++)b.Ma[c+d]=
l[d]+f;var c=c+l.length,m;for(m in h){var l=h[m],n=f*u(l,g);b.U[m].set(l,n)}for(d=0;d<e.G.length;d++){var h=e.G[d],q=b.G[d];for(m in h)l=h[m],n=f*u(l,g),q[m].set(l,n)}f+=g}if(0<b.va.length)for(k=0;k<b.va.length;k++)for(m=b.va[k].Ac,d=e=f=c=0;d<a.length;d++)g=a[d].va[k].Ac,m.a_position.set(g.a_position,c),m.a_normal.set(g.a_normal,f),m.a_tangent.set(g.a_tangent,e),c+=g.a_position.length,f+=g.a_normal.length,e+=g.a_tangent.length;return b}function y(a,b,c,e,g,k){var h=a.submeshes[b],q=h.base_length,
C=a.materials[b],r=J.Vb("SUBMESH_"+a.name+"_"+C.name);r.ha=q;var F=!1;if(l(c,"a_texcoord")){var z=null,D=a.materials[b];b=a.submeshes[b];if(D.texture_slots.length)switch(D=D.texture_slots[0],D.texture_coords){case "UV":D=a.uv_textures.indexOf(D.uv_layer);0==D?z=new Float32Array(b.texcoord):1==D&&(z=new Float32Array(b.texcoord2));break;case "ORCO":for(var u=a.b4w_bounding_box_source,z=new Float32Array(2*b.base_length),D=(u.max_x+u.min_x)/2,y=(u.max_z+u.min_z)/2,x=u.max_x-u.min_x,u=u.max_z-u.min_z,
p=0,aa=0;aa<b.position.length;aa+=3)z[p++]=(b.position[aa]-D)/x+.5,z[p++]=(y-b.position[aa+2])/u+.5}null===z&&(z=new Float32Array(2*b.base_length));b=z}else b=new Float32Array(0);if(l(c,"a_orco_tex_coord")){z=a.b4w_bounding_box_source;D=new Float32Array(3*h.base_length);y=z.max_x-z.min_x;x=z.max_y-z.min_y;u=z.max_z-z.min_z;for(aa=p=0;aa<h.position.length;aa+=3)0==y?D[p++]=.5:D[p++]=J.clamp(parseFloat(((h.position[aa]-z.min_x)/y).toFixed(5)),0,1),0==u?D[p++]=.5:D[p++]=J.clamp(parseFloat(((z.max_z-
h.position[aa+2])/u).toFixed(5)),0,1),0==x?D[p++]=.5:D[p++]=J.clamp(parseFloat(((h.position[aa+1]-z.min_y)/x).toFixed(5)),0,1);z=D}else z=new Float32Array(0);var G,D=h.group;if(l(c,"a_influence")&&e){y=new Float32Array(4*q);x=D.length/q;u=new Float32Array(x);for(p=0;p<x;p++)for(G in u[p]=-1,e)if(aa=e[G],aa.Gz===p){u[p]=aa.Nq;break}var E=3<x?x:4;e=new Float32Array(E);G=new Uint32Array(E);for(var p=new Float32Array(4),aa=new Float32Array(E),E=new Uint32Array(E),O=new Float32Array(4),B=0;B<q;B++)e.set(aa),
G.set(E),p.set(O),y.set(n(D,x,B,q,u,e,G,p),4*B)}else y=new Float32Array(0);G=y;e=g?J.za(g):{};e.a_color={$h:!0};e.a_color.src=l(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,ce:7}]:[];g={a_texcoord:b,a_influence:G,a_orco_tex_coord:z};G=h.vertex_colors;b=h.color;z=a.name;D=[];for(y=0;y<G.length;y++)D.push(G[y].name);for(var A in e)if(y=e[A].src,y.length){for(u=x=0;u<y.length;u++)x+=J.Bi(y[u].ce);g[A]=new Float32Array(x*q);for(u=p=0;u<y.length;u++){var K=y[u].name,aa=y[u].ce,E=J.jy(aa),
da=D.indexOf(K);-1==da&&J.da('vertex color "'+K+'" for mesh "'+z+'" not found.');O=G[da].mask;B=J.Bi(O);(aa&O)!==aa&&d.error("Wrong color extraction from "+K+" to "+A+".");for(var L=K=0;L<da;L++)K+=J.Bi(G[L].mask);da=K*q;for(K=0;K<q;K++)for(L=0;3>L;L++)E[L]&&(g[A][K*x+(p+J.lm(aa,L))]=b[da+K*B+J.lm(O,L)]);p+=B}}else g[A]=new Float32Array(0);A=a.uv_textures;e=h.texcoord;G=h.texcoord2;if(k)for(var V in k){b=A.indexOf(V);if(0==b)var oa=new Float32Array(e);else 1==b&&(oa=new Float32Array(G));g[k[V]]=oa}r.U=
g;r.Ma=new Uint32Array(h.indices);k=h.position.length/q/3;oa=(V=l(c,"a_normal")&&h.normal.length?!0:!1)&&l(c,"a_tangent")&&h.tangent.length?!0:!1;A=C.texture_slots[0];A=V&&C.texture_slots.length&&l(c,"a_tangent")&&"ORCO"==A.texture_coords&&A.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&(F=!0);for(g=0;g<k;g++){C=f(h,c,q,V,oa,A,g,a.name);if(F)if(e={},e.name=a.b4w_shape_keys[g].name,r.va.push(e),0!=g){e.Ac=C;e.co=a.b4w_shape_keys[g].value;continue}else e.Ac=f(h,c,q,V,oa,A,g,a.name),e.co=1;r.G.push(C)}if(1<
k&&!F){a=r.G[0];var C={},T;for(T in a)C[T]=new Float32Array(a[T]);r.G.push(C)}l(c,"a_polyindex")&&(m(r,1,!0),r.U.a_polyindex=v(r));return r}function f(a,b,c,f,e,g,k,h){var m={},n=new Float32Array(3*c),q=new Float32Array(f?3*c:0),r=new Float32Array(e||g?4*c:0),z=k*c*3;n.set(a.position.subarray(z,z+3*c),0);f&&(z=k*c*3,q.set(a.normal.subarray(z,z+3*c),0));if(e)z=k*c*4,r.set(a.tangent.subarray(z,z+4*c),0);else if(g)for(a=r,d.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+
h+'". Please add a UV-map.'),h=0;h<c;h++)b=D,f=O,b[0]=q[3*h],b[1]=q[3*h+1],b[2]=q[3*h+2],C.cross(b,J.AXIS_Z,f),0==C.length(f)&&C.cross(b,J.AXIS_X,f),C.normalize(f,f),a[4*h]=f[0],a[4*h+1]=f[1],a[4*h+2]=f[2],a[4*h+3]=1;else if(f&&l(b,"a_tangent"))for(r=new Float32Array(4*c),c=0;c<r.length;c++)r[c]=1;m.a_position=n;m.a_normal=q;m.a_tangent=r;return m}function l(a,b){return-1<a.indexOf(b)?!0:!1}function n(b,c,d,f,e,g,k,l){for(var h=!0,m=0;m<c;m++){var n=b[m*f+d];if(-1!==n){var q=e[m];-1!==q&&(g[m]=n,
k[m]=q,h=!1)}}if(h)return l;A(g,k,a.Jp,!1);for(m=b=0;4>m;m++)b+=g[m];if(.01>b)return l;for(m=0;4>m;m++)g[m]/=b;if(.01>Math.abs(g[0]-1))l[0]=k[0]+1;else for(m=0;4>m;m++)l[m]=k[m]+g[m];return l}function u(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function A(b,c,d,f){for(var e=b.length,g=e,k=!1,l=f?-1:1;1<g||k;){1<g&&(g=Math.floor(g/1.247330950103979));for(var k=!1,h=0;g+h<e;h++)if(d==
a.Jp?0>l*(b[h]-b[h+g]):b[h]<b[h+g]&&f)k=b[h],b[h]=b[h+g],b[h+g]=k,k=c[h],c[h]=c[h+g],c[h+g]=k,k=!0}}function B(a,b,c){var d=[],f=[];C.subtract(b,a,d);C.subtract(c,a,f);C.normalize(d,d);C.normalize(f,f);return Math.acos(C.dot(d,f))}function H(a,b,d){b||(b=[]);d=d?a.G[0].a_normal:a.G[0].a_position;if(c(a)){a=a.Ma;for(var f=a.length/3,e=0;e<f;e++){var g=new Float32Array(9),k=a[3*e];g[0]=d[3*k];g[1]=d[3*k+1];g[2]=d[3*k+2];k=a[3*e+1];g[3]=d[3*k];g[4]=d[3*k+1];g[5]=d[3*k+2];k=a[3*e+2];g[6]=d[3*k];g[7]=
d[3*k+1];g[8]=d[3*k+2];b[e]=g}}else for(e=0;e<d.length;e++)g=new Float32Array(9),g[0]=d[9*e],g[1]=d[9*e+1],g[2]=d[9*e+2],g[3]=d[9*e+3],g[4]=d[9*e+4],g[5]=d[9*e+5],g[6]=d[9*e+6],g[7]=d[9*e+7],g[8]=d[9*e+8],b[e]=g;return b}function v(a){for(var b=new Float32Array(a.ha),c=0;c<a.ha;c++)b[c]=c%3;return b}function E(a,b,c){var d=C.dist(a,b);a=C.dist(a,c);b=C.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function z(a,b,c,d,f){c-=b;for(var e=0;e<c;e+=d)e%d==f&&vec3.normalize(a.subarray(e+b-f,e+b+1),a.subarray(e+
b-f,e+b+1))}var G=p("__extensions"),d=p("__print"),F=p("__tsr"),J=p("__util"),C=p("__vec3"),D=new Float32Array(3),O=new Float32Array(3),T=new Float32Array(3);a.of=10;a.nu=20;a.AL=30;a.Rm=10;a.Yt=20;a.Qm=30;a.aA=40;a.bA=50;a.Jp=0;a.uB=1;a.Mk=a.Rm;var K=null;a.Ed=function(a){K=a};a.dM=function(a){var b=_buffers[a];K.deleteBuffer(b.Mf);K.deleteBuffer(b.nh);delete _buffers[a]};a.vJ=function(d,f,g,k){b(d)&&m(d);var l=d.Ma,n=d.ha,C=d.G,r={},J;for(J in d.U)J in k&&!k[J].$h||(r[J]=d.U[J]);k={Ig:null,oc:null,
Ar:0,count:0,sb:{},mode:0,zm:0,Cn:0,tv:0,nh:null,Mf:null,ao:null,va:null};0<d.va.length&&e(d,C[0]);if(l.length)if(J=l.length,65536>=n)var z=new Uint16Array(l),F=K.UNSIGNED_SHORT;else z=new Uint32Array(l),F=K.UNSIGNED_INT;else J=n,z=null;var D=0,v=C.length,y;for(y in C[0])var p=C[0][y],D=D+p.length*v;for(y in r)p=r[y],D+=p.length;y=new Float32Array(D);var D=0,v={},x;for(x in r){var G=r[x];if(p=G.length)y.set(G,D),v[x]={IL:x,fe:u(G,n),offset:D,frames:1,length:p},D+=p}r=C.length;for(x in C[0])if(G=C[0][x],
p=G.length,G=u(G,n),p){v[x]={fe:G,offset:D,frames:r,length:p};1<r&&(v[x+"_next"]={fe:G,offset:D+p,frames:r,length:p});for(var aa=0;aa<r;aa++)G=C[aa][x],y.set(G,D),D+=p}k.count=J;k.Ig=z;k.oc=y;k.Ar=F;k.sb=v;h(k,g);q(k);f!=a.of&&c(d)&&(k.ao={fH:new Float32Array(l.length),gH:new Float32Array(l.length),nE:new Float32Array(l.length/3),type:f});k.va=d.va;return k};a.tJ=e;a.oG=b;a.nG=c;a.gp=m;a.nz=function(a,b,c){h(a,b);a.count=c.length;a.Ig=c;a.Ar=c instanceof Uint16Array?K.UNSIGNED_SHORT:K.UNSIGNED_INT};
a.mz=function(a,b,c,d){var f=a.oc,e=a.sb,g=e[b];g?(c&&g.fe!=c&&J.da('invalid num_comp for "'+b+'"'),f.set(d,g.offset)):(f=f.length,g=new Float32Array(f+d.length),g.set(a.oc),g.set(d,f),a.oc=g,e[b]={fe:c,offset:f});q(a)};a.EE=r;a.lN=function(a){a.zm=K.STATIC_DRAW};a.XG=function(a){a.zm=K.DYNAMIC_DRAW};a.Et=q;a.dv=function(a){a.Mf&&K.deleteBuffer(a.Mf);a.nh&&K.deleteBuffer(a.nh)};a.yw=function(a,b){return a.submeshes[b].base_length?!1:!0};a.lt=function(a,b){for(var c=0;c<a.G.length;c++){var d=a.G[c].a_position;
F.transform_vectors(d,b,d,0);d=a.G[c].a_normal;0<d.length&&F.transform_dir_vectors(d,b,d,0);d=a.G[c].a_tangent;0<d.length&&F.transform_tangents(d,b,d,0)}(c=a.U.au_center_pos)&&c.length&&F.transform_vectors(c,b,c,0);return a};a.sJ=function(a,b){var c=a.U.au_center_pos;if(c&&c.length){var d=new Float32Array(c);F.transform_vectors(d,b,d,0);for(var f=0;f<a.G.length;f++)for(var e=0;e<d.length;e++)a.G[f].a_position[e]+=d[e]-c[e];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';
};a.rJ=function(a,b){var c=a.ha,d;for(d in b){var f=b[d].length;a.U[d]=new Float32Array(f*c);for(var e=0;e<c;e++)for(var g=0;g<f;g++)a.U[d][e*f+g]=b[d][g]}};a.uJ=g;a.WG=function(a,b,c){if(!a.ha)return J.Vb("EMPTY");var d=c.length;65536<a.ha*d&&!G.cw()&&m(a,d);var f=a.Ma,e=a.ha,g=a.U;a=a.G;for(var k in b){var l=b[k].length,h=l*e;g[k]=new Float32Array(h);for(var n=0;n<e;n++)for(h=0;h<l;h++)g[k][n*l+h]=b[k][h]}b=J.Vb("CLONE_"+d+"_SUBMESHES");b.ha=e*d;b.Ma=new Uint32Array(f.length*d);for(n=0;n<d;n++)for(l=
f.length*n,k=e*n,h=0;h<f.length;h++)b.Ma[l+h]=f[h]+k;for(var q in g)for(f=g[q],h=f.length*d,l=u(f,e),b.U[q]=new Float32Array(h),n=0;n<d;n++)k=e*l*n,b.U[q].set(f,k);for(q in a[0])for(n=0;n<a.length;n++)for(f=a[n][q],h=f.length*d,l=u(f,e),b.G[n]=b.G[n]||{},b.G[n][q]=new Float32Array(h),h=0;h<d;h++)switch(g=c[h],k=e*l*h,q){case "a_position":F.transform_vectors(f,g,b.G[n][q],k);break;case "a_normal":F.transform_dir_vectors(f,g,b.G[n][q],k);break;case "a_tangent":F.transform_tangents(f,g,b.G[n][q],k);
break;default:throw"Wrong attribute name: "+q;}return b};a.Iv=y;a.GE=function(a){var b=a.ha,c=a.G[0].a_position,d=new Float32Array(12*b),f=new Float32Array(8*b);a=new Uint32Array(4*a.Ma.length);for(var e=new Float32Array(4*b),g=0;g<b;g++){d[12*g]=c[3*g];d[12*g+1]=c[3*g+1];d[12*g+2]=c[3*g+2];d[12*g+3]=c[3*g];d[12*g+4]=c[3*g+1];d[12*g+5]=c[3*g+2];d[12*g+6]=c[3*g];d[12*g+7]=c[3*g+1];d[12*g+8]=c[3*g+2];d[12*g+9]=c[3*g];d[12*g+10]=c[3*g+1];d[12*g+11]=c[3*g+2];f[8*g]=-.5;f[8*g+1]=-.5;f[8*g+2]=-.5;f[8*g+
3]=.5;f[8*g+4]=.5;f[8*g+5]=.5;f[8*g+6]=.5;f[8*g+7]=-.5;a[6*g]=4*g+2;a[6*g+1]=4*g+1;a[6*g+2]=4*g;a[6*g+3]=4*g+2;a[6*g+4]=4*g;a[6*g+5]=4*g+3;var k=Math.random();e[4*g]=k;e[4*g+1]=k;e[4*g+2]=k;e[4*g+3]=k}c=J.Vb("HALO");c.G=[];c.G[0]={};c.ha=4*b;c.G[0].a_position=d;c.U.a_halo_bb_vertex=f;c.U.a_random_vals=e;c.Ma=a;return c};a.YF=l;a.Jv=function(a,b,c){for(var d=[],f=0;f<a.submeshes.length;f++){var e=y(a,f,b,null,c,null);e.ha&&d.push(e)}return 0==d.length?J.Vb("EMPTY"):1==d.length?d[0]:g(d)};a.UJ=function(a,
b,c){for(var d=a.Ig,f=r(a,"a_position"),e=a.ao,g=e.fH,k=e.gH,e=e.nE,l=d,h=l.length/3,m=0;m<h;m++){var n=l[3*m],q=l[3*m+1],C=l[3*m+2],J=f[3*n+1],x=f[3*n+2],z=f[3*q+1],D=f[3*q+2],u=f[3*C+1],v=f[3*C+2];g[3*m]=(f[3*n]+f[3*q]+f[3*C])/3;g[3*m+1]=(J+z+u)/3;g[3*m+2]=(x+D+v)/3}F.transform_vectors(g,b,k);b=k.length/3;for(f=0;f<b;f++)g=k[3*f]-c[0],l=k[3*f+1]-c[1],h=k[3*f+2]-c[2],e[f]=g*g+l*l+h*h;c=d;d=e.length;if(!(2>d))for(k=d,f=!1;1<k||f;)for(1<k&&(k=Math.floor(k/1.247330950103979)),f=!1,b=0;k+b<d;b++)0>e[b]-
e[b+k]&&(f=e[b],e[b]=e[b+k],e[b+k]=f,f=c,g=b,l=b+k,h=f[3*g],m=f[3*g+1],n=f[3*g+2],f[3*g]=f[3*l],f[3*g+1]=f[3*l+1],f[3*g+2]=f[3*l+2],f[3*l]=h,f[3*l+1]=m,f[3*l+2]=n,f=!0);d=c;K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,a.Mf);K.bufferData(K.ELEMENT_ARRAY_BUFFER,d,K.DYNAMIC_DRAW)};a.Fy=A;a.Pu=function(a,b,c){for(var d=b.length/3,f=a.length/3,e=[],g=Array(3),k=Array(3),l=Array(3),h=0;h<f;h++){for(var m=a[3*h],n=a[3*h+1],q=a[3*h+2],r=0;3>r;r++)g[r]=b[3*m+r],k[r]=b[3*n+r],l[r]=b[3*q+r];if(c)var r=B(g,k,l),J=B(k,
l,g),x=Math.PI-r-J;else x=J=r=1;var z=e,F;F=g;var D=l,u=[],v=[],y=[];C.subtract(k,F,u);C.subtract(D,F,v);C.cross(u,v,y);C.normalize(y,y);F=y;for(D=0;3>D;D++)u=3*n+D,v=3*q+D,z[3*m+D]=r*F[D],z[u]=J*F[D],z[v]=x*F[D]}if(c)for(var p in c)for(h=c[p],a=0;3>a;a++){b=3*h[0]+a;for(f=1;f<h.length;f++)g=3*h[f]+a,e[b]+=e[g];for(f=1;f<h.length;f++)g=3*h[f]+a,e[g]=e[b]}for(h=0;h<d;h++){c=h;p=e;a=new Float32Array(3);for(b=0;3>b;b++)f=3*c+b,a[b]=p[f];C.normalize(a,a);for(b=0;3>b;b++)f=3*c+b,p[f]=a[b]}return e};a.Qu=
function(a,b,c){for(var d={},f=b.length/3,e=0;e<f;e++){var g=String(b[3*e])+String(b[3*e+1])+String(b[3*e+2]);d[g]=[]}f=a.length;for(e=0;e<f;e++)b=a[e],g=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),g in d&&d[g].push(b);return d};a.jr=function(a,b,c,d){var f=H(a,null,!1);if(c)var e=H(a,null,!0);var g=f.length,k=new Float32Array(g),l=D,h=O;for(a=0;a<g;a++){var m=f[a];l.set(m.subarray(0,3));h.set(m.subarray(3,6));T.set(m.subarray(6));k[a]=Math.sqrt(E(l,h,T))}l=new Float32Array(g);l[0]=k[0];for(a=
1;a<g;a++)l[a]=l[a-1]+k[a];g=l[k.length-1];k=[];for(a=0;a<b;a++){var h=g*J.ie(d),h=J.ln(l,h,0,l.length-1),m=c?e[h]:f[h],h=a,n=m,q=d,m=void 0,m=new Float32Array(3),C=n[0],r=n[1],x=n[2],z=n[3],F=n[4],u=n[5],v=n[6],y=n[7],p=n[8],n=J.ie(q),q=J.ie(q);1<n+q&&(n=1-n,q=1-q);var G=1-n-q,r=G*r+n*F+q*y,x=G*x+n*u+q*p;m[0]=G*C+n*z+q*v;m[1]=r;m[2]=x;k[h]=m}return k};a.iM=H;a.$q=v;a.PN=E;a.ny=function(a,b,c){a=a.G[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],
a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.Au=function(a,b,c){var d=a.u[0].P;a=a.g.ah;for(var f=1;f<a.length;f++)a[f].name==b&&(a[f].value=c);for(f=0;f<d.length;f++)if(!d[f].Ue&&d[f].Ee&&!d[f].Qh){c=d[f].X.sb;b=d[f].X.oc;K.bindBuffer(K.ARRAY_BUFFER,d[f].X.nh);var e=c.a_position,g=d[f],k=b,l=a;if(e){for(var h=e.offset,e=e.length+h,m=g.X.va[0].Ac.a_position,n=h;n<e;n++)k[n]=m[n-h];for(n=1;n<g.X.va.length;n++){var m=g.X.va[n].Ac.a_position,q=l[n].value;if(q)for(var C=h;C<e;C++)k[C]+=q*m[C-h]}K.bufferSubData(K.ARRAY_BUFFER,
4*h,k.subarray(h))}e=c.a_normal;g=d[f];k=b;l=a;if(e){h=e.offset;e=e.length+h;m=g.X.va[0].Ac.a_normal;for(n=h;n<e;n++)k[n]=m[n-h];for(n=1;n<g.X.va.length;n++)if(m=g.X.va[n].Ac.a_normal,q=l[n].value)for(C=h;C<e;C++)k[C]+=q*m[C-h];z(k,h,e,3,2);K.bufferSubData(K.ARRAY_BUFFER,4*h,k.subarray(h))}l=c.a_tangent;c=d[f];g=a;if(l){k=l.offset;l=l.length+k;e=c.X.va[0].Ac.a_tangent;for(h=k;h<l;h++)b[h]=e[h-k];for(h=1;h<c.X.va.length;h++)if(e=c.X.va[h].Ac.a_tangent,n=g[h].value)for(m=k;m<l;m++)b[m]+=n*e[m-k];z(b,
k,l,4,3);K.bufferSubData(K.ARRAY_BUFFER,4*k,b.subarray(k))}}};a.check_shape_keys=function(a){return a.g.Ee};a.get_shape_keys_names=function(a){var b=[];if(a.g)for(var c=1;c<a.g.ah.length;c++)b.push(a.g.ah[c].name);return b};a.get_shape_key_value=function(a,b){if(a.g)for(var c=1;c<a.g.ah.length;c++)if(b==a.g.ah[c].name)return a.g.ah[c].value;return 0};a.yr=function(a,b){var c=a.g.ah;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.yj=function(a){return a&&a.g&&a.g.Re?!0:!1};a.draw_line=
function(b,c,d){var f=b.X;if(f){for(var e=d?c.length/3/2:c.length/3-1,g=new Float32Array(12*e),k=new Float32Array(12*e),l=new Uint16Array(6*e),h=0;h<e;h++){if(d)var m=6*h,n=6*h+3;else m=3*h,n=3*(h+1);var C=c[m],r=c[m+1],m=c[m+2],J=c[n],z=c[n+1],n=c[n+2],x=J-C,F=z-r,D=n-m;g[12*h]=C;g[12*h+1]=r;g[12*h+2]=m;k[12*h]=x;k[12*h+1]=F;k[12*h+2]=D;g[12*h+3]=J;g[12*h+4]=z;g[12*h+5]=n;k[12*h+3]=-x;k[12*h+4]=-F;k[12*h+5]=-D;g[12*h+6]=C;g[12*h+7]=r;g[12*h+8]=m;k[12*h+6]=-x;k[12*h+7]=-F;k[12*h+8]=-D;g[12*h+9]=J;
g[12*h+10]=z;g[12*h+11]=n;k[12*h+9]=x;k[12*h+10]=F;k[12*h+11]=D;l[6*h]=4*h;l[6*h+1]=4*h+1;l[6*h+2]=4*h+2;l[6*h+3]=4*h;l[6*h+4]=4*h+3;l[6*h+5]=4*h+1}d=0;for(var u in f.sb)c=f.sb[u],d+=g.length/3*c.fe;f.oc=new Float32Array(d);d=f.oc;a.nz(f,b.Cf,l);b=0;for(u in f.sb)switch(c=f.sb[u],u){case "a_position":d.set(g,b);c.offset=b;c.length=g.length;b+=c.length;break;case "a_direction":d.set(k,b);c.offset=b;c.length=k.length;b+=c.length;break;default:c.offset=b,c.length=g.length/3*c.fe,l=new Float32Array(c.length),
d.set(l,b),b+=c.length}q(f)}}};b4w.module.__objects=function(a,p){function e(a){var b=a.u;a=a.g;for(var c=0;c<b.length;c++){var d=b[c].Ca;d.k.outline&&a.Yf&&D.bI(d)}}function b(a){a.g.Yf=0;a=ka.indexOf(a);-1!=a&&ka.splice(a,1)}function c(a){if(a.kj)for(var b=a.u,c=0;c<b.length;c++)D.$J(b[c].Ca,a)}function m(a,b){for(var c=a.u,d=b.u,f=0;f<c.length;f++){for(var e=!1,g=0;g<d.length;g++)if(c[f].Ca==d[g].Ca){e=!0;break}e||k(b,c[f].Ca)&&z.Xi(b,c[f].Ca)}}function k(a,b){return!b.pu&&"SPEAKER"==a.type||!b.CB&&("LAMP"==a.type||"CAMERA"==
a.type)?!1:!0}function r(a,b){if(a.dg_parent&&a.dg_parent.Lp||a.parent&&a.parent.Lp)return!0;switch(a.type){case "MESH":var c=a.b4w_do_not_batch,d=a.b4w_collision,e=a.b4w_vehicle,g=a.b4w_floating,k=a.b4w_character,l=G.$F(a),h=E.Nu(a),m=0<a.data.b4w_shape_keys.length,n=a.b4w_dynamic_geometry;if(!(c=f.Ou(a,b)||c||d||e||m||g))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=!0;break a}c=!1}return c||l||k||h||n;case "EMPTY":return k=E.Nu(a),l=a.b4w_do_not_batch,h=
Boolean(a.b4w_anchor),f.Ou(a,b)||k||l||h;default:return!0}}function h(a,b){var c=a.animation_data,d=a.data?a.data.animation_data:null;c&&c.action&&(c=c.action,(c.k.type==f.Zz||c.k.type==f.Wz&&"ARMATURE"==b.type||c.k.type==f.Yz&&"LAMP"==b.type||c.k.type==f.Xz&&"WORLD"==b.type)&&b.actions.push(c));d&&d.action&&("SPEAKER"==b.type||"LAMP"==b.type)&&b.actions.push(d.action);"MESH"==b.type&&b.actions.push.apply(b.actions,f.vF(a))}function q(a,b,c){b=M[b]||[];for(var d=[],f=0;f<b.length;f++){var e=b[f];
if(e.g.Lc==c||-1==c)for(var g=e.u,k=0;k<g.length;k++)g[k].Ca==a&&d.push(e)}return d}function g(a,b,c,d){for(var f=null,e=0;e<b.length;e++){var g=b[e];if((c?g.ri:g.name)==a&&(g.g.Lc==d||-1==d)&&(f=g,!z.get_dg_parent(f)))break}return f}function y(a){M.ALL.push(a);M[a.type]||(M[a.type]=[]);M[a.type].push(a);var b=a.g.zd;if(null!=b)for(var c=0;c<Y.length;c++){var d=Y[c];d.g.zd==b&&d.jm.push(a)}}var f=p("__animation"),l=p("__batch"),n=p("__boundings"),u=p("__camera"),A=p("__config"),B=p("__constraints"),
H=p("__geometry"),v=p("__lights"),E=p("__nla"),z=p("__obj_util"),G=p("__particles"),d=p("__physics"),F=p("__print"),J=p("__primitives"),C=p("__quat"),D=p("__scenes"),O=p("__sfx"),T=p("__transform"),K=p("__textures"),w=p("__tsr"),t=p("__util"),Q=p("__vec3"),N=p("__armature"),P=p("__anchors"),S=A.q,Z=A.Kb,M={ALL:[]},U=0,ea=0,Y=[],ka=[],ga=new Float32Array(3),ma=new Float32Array(4);a.Ip=0;a.Hp=1;a.cc=2;a.DATA_ID_ALL=-1;a.update=function(a){for(var c=M.ARMATURE,d=0;d<ka.length;d++){var f=ka[d],g=f,k=
a,l=0,h=g.Hx;0==h.ip&&(h.ip=k);k-=h.ip;if(h.Cs&&k/h.yd>=h.Cs)b(g);else{k%=h.yd;if(k<h.os)switch(h=k/(h.os/5),k=Math.floor(h),k){case 0:l=(h-k)/2;break;case 1:l=(h-k)/2+.5;break;case 2:l=1;break;case 3:l=1-(h-k)/2;break;case 4:l=.5-(h-k)/2}g.g.Yf=l}f.g.Yf&&e(f)}if(c)for(d=0;d<c.length;d++)a=c[d],a.fs&&(T.n(a),a.fs=!1)};a.set_outline_intensity=function(a,b){a.g.Yf=b;e(a)};a.apply_outline_anim=function(a,b,c,d){var f=a.Hx;f.ip=0;f.os=b;f.yd=c;f.Cs=d;-1==ka.indexOf(a)&&ka.push(a)};a.clear_outline_anim=
b;a.lh=function(a,b){b.mh=a.uuid;b.Hh=!0;h(a,b);a.Lp=b.oa=r(a,b);a.DB=!0;b.Pc=a.b4w_vehicle;b.is_character=a.b4w_character;b.fi=a.b4w_floating;b.Li=a.b4w_collision;b.Ya=a.b4w_collision_id;b.xn=a.b4w_correct_bounding_offset;var c=a.game;b.xe={Ko:c.physics_type,Cm:c.use_ghost,zz:c.use_sleep,Xe:c.mass,Dz:c.velocity_min,Cz:c.velocity_max,Kq:c.damping,Js:c.rotation_damping,NG:c.lock_location_x,OG:c.lock_location_y,PG:c.lock_location_z,QG:c.lock_rotation_x,RG:c.lock_rotation_y,SG:c.lock_rotation_z,fl:c.collision_margin,
cl:c.collision_group,hl:c.collision_mask,Ft:c.use_collision_bounds,rn:c.collision_bounds_type,Am:c.use_collision_compound};if(c=a.b4w_vehicle_settings)b.bd={name:c.name,Rc:c.part,yJ:c.suspension_rest_length,ot:c.suspension_compression,qt:c.suspension_stiffness,pt:c.suspension_damping,Qt:c.wheel_friction,Hs:c.roll_influence,Yr:c.max_suspension_travel_cm,Bl:c.force_max,Uk:c.brake_max,rk:c.steering_max,Jj:c.max_speed_angle,ql:c.delta_tach_angle,qm:c.speed_ratio,tm:c.steering_ratio,Ol:c.inverse_control,
Xh:c.floating_factor,Qi:c.water_lin_damp,Ri:c.water_rot_damp,Uy:c.synchronize_position};if(c=a.b4w_floating_settings)b.lj={name:c.name,Rc:c.part,Xh:c.floating_factor,Qi:c.water_lin_damp,Ri:c.water_rot_damp,Uy:c.synchronize_position};if(c=a.b4w_character_settings)b.Yu={RK:c.walk_speed,hI:c.run_speed,qJ:c.step_height,uG:c.jump_strength,TK:c.waterline};for(c=0;c<a.constraints.length;c++){var d=a.constraints[c];"RIGID_BODY_JOINT"==d.type&&b.us.push({target:d.target.qa,DH:d.pivot_type,EH:d.pivot_x,FH:d.pivot_y,
GH:d.pivot_z,Ke:d.axis_x,Le:d.axis_y,Me:d.axis_z,wK:d.use_limit_x,xK:d.use_limit_y,yK:d.use_limit_z,rK:d.use_angular_limit_x,sK:d.use_angular_limit_y,tK:d.use_angular_limit_z,EG:d.limit_max_x,FG:d.limit_max_y,GG:d.limit_max_z,HG:d.limit_min_x,IG:d.limit_min_y,JG:d.limit_min_z,yG:d.limit_angle_max_x,zG:d.limit_angle_max_y,AG:d.limit_angle_max_z,BG:d.limit_angle_min_x,CG:d.limit_angle_min_y,DG:d.limit_angle_min_z})}c=b.g=z.Oh("MESH"===b.type?b.oa?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent.qa,
"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.$l=a.parent_bone),a.pinverse_tsr&&(b.Lo=w.create(),w.copy(a.pinverse_tsr,b.Lo))):a.dg_parent&&(b.parent=a.dg_parent.qa,b.Ug=!0);var d=a.location,e=a.scale[0];t.ys(a.rotation_quaternion,ma);T.set_translation(b,d);T.set_rotation(b,ma);T.set_scale(b,e);b.Bm=a.b4w_use_default_animation;b.Ah=f.Pp(a.b4w_anim_behavior);a.b4w_object_tags&&(b.uo={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});
a.b4w_viewport_alignment&&(b.zp={FB:a.b4w_viewport_alignment.alignment,distance:a.b4w_viewport_alignment.distance});switch(a.type){case "ARMATURE":N.lh(a,b);d=c.Rd;e=f.FC(d);a.b4w_animation_mixing?(c.Tc=new Float32Array(e.Ea),c.Ad=new Float32Array(e.Ea),c.ad=new Float32Array(e.trans),c.Kd=new Float32Array(e.trans)):(c.Tc=e.Ea,c.Ad=e.Ea,c.ad=e.trans,c.Kd=e.trans);for(var g in d){var k=d[g];1==k.qn.length&&N.TJ(k,!0,e.trans,e.Ea)}c.vs=e;c.Yd=0;c.Bh=a.b4w_animation_mixing;break;case "MESH":c.fj=a.b4w_do_not_render;
c.Zi=l.rC(a.data.b4w_bounding_box);c.Yg=Z.outlining_overview_mode||a.b4w_selectable;c.Eo=a.b4w_selectable;c.Kb=Z.outlining_overview_mode||a.b4w_outlining;c.Do=a.b4w_outlining;c.Ix=Z.outlining_overview_mode||a.b4w_outline_on_select;c.pe=a.b4w_billboard;c.cq=a.b4w_pres_glob_orientation;c.Sk="BASIC";c.Rk="SPHERICAL"==a.b4w_billboard_geometry;g=c.Wj;g.Xj=a.b4w_outline_settings.outline_duration;g.Yj=a.b4w_outline_settings.outline_period;g.Zj=a.b4w_outline_settings.outline_relapses;c.Yg&&(c.sn=t.Rv(U),
U++);for(g=0;g<a.data.b4w_vertex_anim.length;g++)d=a.data.b4w_vertex_anim[g],b.ac.push({name:d.name,ba:d.frame_start,ra:d.frame_end,KL:d.averaging,LL:d.averaging_interval,GB:d.allow_nla});b.g.ac=b.ac.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;g=b.g;if(a.data.b4w_shape_keys.length)for(g.Ee=!0,d=0;d<a.data.b4w_shape_keys.length;d++)e={},e.value=a.data.b4w_shape_keys[d].value,e.name=a.data.b4w_shape_keys[d].name,g.ah.push(e);else g.Ee=!1;c.Fd=a.b4w_shadow_cast;c.Xc=a.b4w_shadow_receive;
c.Wc=a.b4w_shadow_cast_only&&c.Fd;c.Fc=a.b4w_reflexible;c.wc=a.b4w_reflexible_only&&c.Fc;c.Uc=a.b4w_reflective;c.cf=a.b4w_reflection_type;c.uf=a.b4w_caustics;c.Nd=a.b4w_wind_bending;c.Jm=a.b4w_wind_bending_angle;g=l.UK(a.b4w_wind_bending_angle,c.Zi,a.scale[0]);c.mf=g;c.og=a.b4w_wind_bending_freq;c.Bf=a.b4w_detail_bending_freq;c.Af=a.b4w_detail_bending_amp;c.tf=a.b4w_branch_bending_amp;c.ai=!1;c.Qf=a.b4w_main_bend_stiffness_col;g=a.b4w_detail_bend_colors;c.uc={};c.uc.Zw=g.leaves_stiffness_col;c.uc.Yw=
g.leaves_phase_col;c.uc.Jx=g.overall_stiffness_col;c.Th=a.b4w_do_not_cull;c.Gn=a.b4w_disable_fogging;c.Re=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";g=a.data.materials[0];c.Dl=g.physics.friction;c.wl=g.physics.elasticity;c.Tl=0;c.Mg=1E6;c.ji=a.b4w_lod_transition;c.lo=!0;break;case "LINE":c.Th=!0;c.dc=n.cd();c.Sd=n.Si();c.Ne=n.Dp();c.wb=n.cd();c.ec=n.Si();c.sf=n.Dp();break;case "CAMERA":u.JC(a,b);u.lC(b);break;case "LAMP":v.vG(a,b);break;case "SPEAKER":b.I=O.LD();c=!1;for(g=0;g<
b.u.length;g++)if(b.u[g].Ca.b4w_enable_audio){c=!0;break}c&&O.lh(a,b);break;case "EMPTY":c.dc=n.cd(),g=n.Si(),c.Sd=g,a.field&&(b.kj={type:a.field.type,Py:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,ej:a.b4w_anchor.detect_visibility,Jn:a.b4w_anchor.element_id,dH:a.b4w_anchor.max_width})}y(b)};a.pK=function(a,b){b.mh=a.uuid;b.Hh=!0;h(a,b);a.Lp=b.oa=r(a,b);a.DB=!0;b.g=z.Oh(b.type);b.Bm=a.b4w_use_default_animation;b.Ah=f.Pp(a.b4w_anim_behavior);y(b)};a.eK=function(a,b){var c=b.g;
if(b.parent){!b.Ug&&b.xe.Am&&b.parent.xe.Am&&(b.Li=!1);for(var e=!1,g=0;g<b.u.length;g++)if(b.u[g].Ca.ub){e=!0;break}if(g=e)g=b.xe,g=b.Pc||b.fi||d.is_character(b)||b.Li&&!g.Cm&&0<g.Xe&&("DYNAMIC"==g.Ko||"RIGID_BODY"==g.Ko);if(g)g=b.Ug?w.copy(c.i,w.create()):c.i,w.multiply(b.parent.g.i,g,c.i),T.set_translation(b,w.get_trans_view(c.i)),T.set_scale(b,w.get_scale(c.i)),T.set_rotation(b,w.get_quat_view(c.i));else if(b.Ug||!b.$l)if(g=w.copy(c.i,w.create()),b.zp&&"CAMERA"==b.parent.type){g={distance:b.zp.distance,
rotation:w.get_quat_view(g)};switch(b.zp.FB){case "TOP_LEFT":g.top=0;g.left=0;break;case "TOP":g.top=0;g.left=.5;break;case "TOP_RIGHT":g.top=0;g.right=0;break;case "LEFT":g.top=.5;g.left=0;break;case "CENTER":g.top=.5;g.left=.5;break;case "RIGHT":g.top=.5;g.right=0;break;case "BOTTOM_LEFT":g.bottom=0;g.left=0;break;case "BOTTOM":g.bottom=0;g.left=.5;break;case "BOTTOM_RIGHT":g.bottom=0,g.right=0}B.append_stiff_viewport(b,b.parent,g)}else B.KB(b,b.parent,g);else g=w.copy(c.i,w.create()),B.LB(b,b.parent,
b.$l,g)}if("ARMATURE"==b.type)for(e=a.pose.bones,g=0;g<e.length;g++){var k=e[g],l=k.constraints;if(l)for(var h=0;h<l.length;h++){var n=l[h];"COPY_TRANSFORMS"!=n.type||n.subtarget||n.mute||B.WB(b,n.target.qa,k.name,t.mu,t.lu)}}if("MESH"==b.type)var q=f.Zv(a);if(q){l=q.qa;g=l.g.vs;e=b.g;k=a.data;b.en=l;k=k.vertex_groups;if(k.length){var l=l.g.Rd,h=0,n={},r;for(r in l){var L=t.keysearch("name",r,k);L&&(n[r]={Gz:L.index,zg:l[r].zg,Nq:h++})}e.aj=n;r=h;k=f.dw();e.Rf=r;r>2*k?(e.Dj=!1,F.error('too many bones for "'+
a.name+'" / '+e.Rf+" bones (max "+k+" with blending, "+2*k+" without blending). Skinning will be disabled.")):e.Dj=!0}r=f.HE(g.trans,g.Ea,c.aj);q.b4w_animation_mixing?(c.Tc=new Float32Array(r.Ea),c.Ad=new Float32Array(r.Ea),c.ad=new Float32Array(r.trans),c.Kd=new Float32Array(r.trans)):(c.Tc=r.Ea,c.Ad=r.Ea,c.ad=r.trans,c.Kd=r.trans);c.Up=new Float32Array(4);c.Tp=C.create();c.vs=r;c.Yd=0}if(c.Uc)if(c=b.g,"CUBE"==c.cf)c.Td=ea++;else if("PLANE"==c.cf){a:{q=a.constraints;for(r=0;r<q.length;r++)if(g=q[r],
"LOCKED_TRACK"==g.type&&"REFLECTION PLANE"==g.name){if(g.target.qa){q=g.target.qa;break a}F.warn('Reflection plane target "'+g.target.name+'" for object: "'+b.name+"\" is not present on the scene. Using object's Z-axis.")}q=null}q||(q=t.Ck("%reflection%"),q=z.dj(q,"EMPTY"),r=z.Oh("EMPTY"),q.g=r,m(b,q),B.zu(q,b,[0,0,0],null,1),y(q));r=null;for(g=0;g<Y.length;g++)if(Y[g]==q){r=g;break}null==r&&(r=Y.length,Y.push(q));q.g.zd=r;c.zd=r;q.jm.push(b)}};a.qz=c;a.WL=m;a.SC=k;a.fK=function(a){for(var b=0;b<
a.length;b++){var c=a[b];!c.g||"DYNAMIC"!=c.g.type&&"CAMERA"!=c.g.type||T.n(c);c.Bm&&f.Ex(c)&&(f.apply_def(c),c.O.length&&f.play(c,null,f.SLOT_ALL))}};a.get_meta_tags=function(a){return t.za(a.uo)};a.cleanup=function(){ea=U=0;Y.length=0;ka.length=0;M={ALL:[]}};a.copy=function(a,b,c){var d=b,f=z.get_dg_parent(a);b=f?z.Sv(f.name,b):b;if(g(b,M.ALL,!1,-1)){for(var f=1,e;;){e="."+(3>String(f).length?("000"+String(f)).slice(-3):String(f));if(!g(b+e,M.ALL,!1,-1))break;f++}F.error('Object "'+b+'" already exists. Name was replaced by "'+
b+e+'".');d+=e;b+=e}d=z.dj(b,a.type,d);d.Hh=a.Hh;d.oa=a.oa;d.Ql=a.Ql;d.Bm=a.Bm;d.g=z.cj(a.g);d.uo=z.cj(a.uo);m(a,d);d.Vi=z.wn(a.Vi);d.parent=z.wn(a.parent);d.Ug=a.Ug;d.$l=a.$l;d.ac=z.wn(a.ac);d.Ah=a.Ah;!a.o||a.Pc||a.is_character||a.fi||(d.Li=a.Li,d.o=null);d.Ya=a.Ya;d.xn=a.xn;d.xe=z.cj(a.xe);b=[];for(f=0;f<a.u.length;f++){var k=d.u[f];e=a.u[f].P;if(c){for(var k=k.P,h=0;h<e.length;h++)if(!e[h].Ue){var n=z.cj(e[h]);k.push(n);b.push(e[h].X)}for(h=0;h<e.length;h++)if(e[h].Ue){n=z.cj(e[h]);k.push(n);for(var q=
0;q<b.length;q++)b[q]==e[h].X&&(n.X=k[q].X)}for(h=0;h<k.length;h++)k[h].X&&H.Et(k[h].X),k[h].Vj=d.mh,l.NJ(k[h],l.GC(d.g));K.$I(k)}else k.P=z.wn(e)}z.Ls(d,!1);y(d);d.g.Ew=!0;d.g.sn=t.Rv(U);U++;return d};a.update_boundings=function(a){for(var b=a.g,c=a.u[0].P,d,f,e,g,k,h,m=0;m<c.length;m++)if("MAIN"==c[m].type){var q=c[m].X.oc,C=c[m].X.sb.a_position.offset;d=g=q[C];f=k=q[C+1];e=h=q[C+2];break}for(m=0;m<c.length;m++)if(q=c[m],"MAIN"==q.type)for(var q=q.X.oc,r=c[m].X.sb,C=r.a_position.offset,r=r.a_position.length+
C,z=C;z<r;z+=3){var C=q[z],t=q[z+1],F=q[z+2];d=Math.max(C,d);f=Math.max(t,f);e=Math.max(F,e);g=Math.min(C,g);k=Math.min(t,k);h=Math.min(F,h)}var D={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(f.toFixed(3)),max_z:parseFloat(e.toFixed(3)),min_x:parseFloat(g.toFixed(3)),min_y:parseFloat(k.toFixed(3)),min_z:parseFloat(h.toFixed(3))},u=d-g,v=f-k,y=e-h;g=.5*(d+g);var p=.5*(f+k),w=.5*(e+h),G=g,ja=w;k=Math.max(u,Math.max(v,y))/2;h=Math.max(u,y)/2;var E=[g/(u?u:1),p/(v?v:1),w/(y?y:1)],O=.5;if(b.pe)C=Math.max(Math.abs(D.max_x),
Math.abs(D.min_x)),t=Math.max(Math.abs(D.max_y),Math.abs(D.min_y)),F=Math.max(Math.abs(D.max_z),Math.abs(D.min_z)),k=Math.sqrt(C*C+t*t+F*F),h=Math.sqrt(C*C+t*t),D.max_x=D.max_y=D.max_z=k,D.min_x=D.min_y=D.min_z=-k,g=new Float32Array([0,0,0]),y=new Float32Array([k,k,k]),v=new Float32Array([0,0,0]);else{for(m=0;m<c.length;m++)if(q=c[m],"MAIN"==q.type)for(q=q.X.oc,r=c[m].X.sb,C=r.a_position.offset,r=r.a_position.length+C,z=C;z<r;z+=3){var C=q[z],t=q[z+1],F=q[z+2],B=Math.sqrt((g-C)*(g-C)+(p-t)*(p-t)+
(w-F)*(w-F));if(B>k){var N=g-k*(C-g)/B,Ia=p-k*(t-p)/B,B=w-k*(F-w)/B;g=(N+C)/2;p=(Ia+t)/2;w=(B+F)/2;k=Math.sqrt((g-C)*(g-C)+(p-t)*(p-t)+(w-F)*(w-F))}Ia=Math.sqrt((G-C)*(G-C)+(ja-F)*(ja-F));Ia>h&&(N=G-h*(C-G)/Ia,B=ja-h*(F-ja)/Ia,G=(N+C)/2,ja=(B+F)/2,h=Math.sqrt((G-C)*(G-C)+(ja-F)*(ja-F)));C/=u?u:1;t/=v?v:1;F/=y?y:1;B=Math.sqrt((E[0]-C)*(E[0]-C)+(E[1]-t)*(E[1]-t)+(E[2]-F)*(E[2]-F));B>O&&(N=E[0]-O*(C-E[0])/B,Ia=E[1]-O*(t-E[1])/B,B=E[2]-O*(F-E[2])/B,E[0]=(N+C)/2,E[1]=(Ia+t)/2,E[2]=(B+F)/2,O=Math.sqrt((E[0]-
C)*(E[0]-C)+(E[1]-t)*(E[1]-t)+(E[2]-F)*(E[2]-F)))}m=u?u*E[0]:d;f=v?v*E[1]:f;e=y?y*E[2]:e;u*=O;v*=O;y*=O;g=new Float32Array([g,p,w]);y=new Float32Array([u,v,y]);v=new Float32Array([m,f,e]);h=parseFloat(h.toFixed(3))}b.dc=D;l.DI(b,h,h,D);D=n.zn(k,g);b.Sd=D;D=n.yn([y[0],0,0],[0,y[1],0],[0,0,y[2]],v,[0,0,0,1]);b.Ne=D;T.n(a);if(S.wireframe_debug)for(m=0;m<c.length;m++)if("WIREFRAME"===c[m].type&&c[m].Qh){a=J.ir(1,D.J);H.ny(a,[D.Ke[0],D.Le[1],D.Me[2]],D.J);H.gp(a,1,!0);a.U.a_polyindex=H.$q(a);l.MJ(c[m],
a);break}};a.Pa=q;a.OF=function(a,b){for(var c=M.ALL||[],d=[],f=0;f<c.length;f++){var e=c[f];if((e.g.Lc==b||-1==b)&&e.Hh)for(var g=e.u,k=0;k<g.length;k++)g[k].Ca==a&&d.push(e)}return d};a.get_all_objects=function(a){var b=M.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var f=b[d];f.g.Lc==a&&c.push(f)}return c};a.fJ=function(a){var b=q(a,"LAMP",-1);if(b.length==a.k.oN){for(var c=[],d=0;d<b.length;d++){var f=b[d],f=z.R(f,a);c[f.gi]=d}for(d=0;d<c.length-1;d++)for(f=d+1;f<c.length;f++){var e=
b[c[d]].Qa,g=b[c[f]].Qa;if(g.Ek&&g.Mi&&(!e.Ek||!e.Mi)||!e.Ek&&(g.Ek||!e.Mi&&g.Mi))e=c[d],c[d]=c[f],c[f]=e}for(d=0;d<c.length;d++)f=b[c[d]],z.R(f,a).gi=d,D.rp(b[c[d]],a)}};a.KJ=function(a){for(var b=q(a,"LAMP",-1),c=q(a,"MESH",-1),d=0;d<c.length;d++)for(var f=z.R(c[d],a).P,e=0;e<f.length;e++){var g=f[e];"MAIN"==g.type&&(l.OJ(g,b,a),l.Rb(g))}};a.get_selectable_objects=function(){for(var a=[],b=M.MESH,c=0;c<b.length;c++){var d=b[c];d.g.Yg&&d.Hh&&a.push(d)}return a};a.get_outlining_objects=function(){for(var a=
[],b=M.MESH,c=0;c<b.length;c++){var d=b[c];d.g.Kb&&d.Hh&&a.push(d)}return a};a.Jb=function(b,c,d,f){var e=null,k=M.ALL;switch(b){case a.Ip:e=g(c,k,!0,d);break;case a.Hp:a:{for(b=0;b<k.length;b++)if(e=k[b],e.ri==d&&(e.g.Lc==f||-1==f)){var l=z.get_dg_parent(e);if(l&&l.ri==c)break a}e=null}break;case a.cc:a:{for(f=0;f<k.length;f++){b=k[f];for(var e=c.length-1,l=b,h=!0;0<=e&&h;)h=l&&l.ri==c[e]&&(l.g.Lc==d||-1==d),l&&(l=z.get_dg_parent(l)),e--;if(h&&!l){e=b;break a}}e=null}}return e};a.get_world_by_name=
function(a,b){return g("%meta_world%"+a,M.WORLD,!0,b)};a.pick_object=function(b,c){var d=D.wj();if(!d)return F.error("No active scene"),null;var f=P.BH(b,c);if(f)return f;f=D.CH(d,b,c);if(!f)return null;for(var d=q(d,"MESH",-1),e=0;e<d.length;e++){var g=d[e].g,k=g.sn;if(k&&3>Math.abs(255*k[0]-f[0])&&3>Math.abs(255*k[1]-f[1])&&3>Math.abs(255*k[2]-f[2]))return g.Kb&&g.Ix&&(Z.outlining_overview_mode?a.apply_outline_anim(d[e],Z.Xj,Z.Yj,Z.Zj):(f=g.Wj,a.apply_outline_anim(d[e],f.Xj,f.Yj,f.Zj))),d[e]}return null};
a.set_wind_params=function(a,b){for(var d=q(a,"EMPTY",-1),f=0;f<d.length;f++){var e=d[f];if(e.kj&&"WIND"===e.kj.type)var g=e}if(!g)return F.error("There is no wind on the scene"),0;"number"==typeof b.wind_dir&&(d=t.deg_to_rad(b.wind_dir),Q.set(Math.sin(d),0,Math.cos(d),ga),t.dir_to_quat(ga,t.AXIS_Y,ma),T.set_rotation(g,ma));"number"==typeof b.wind_strength&&(g.kj.Py=b.wind_strength);c(g)};a.remove_object=function(a){B.TC(a)&&B.remove(a);var b=M.ALL,c=M[a.type],d=b.indexOf(a);a=c.indexOf(a);-1!=d&&
b.splice(d,1);-1!=a&&c.splice(a,1)};a.tH=y;a.uH=function(a){return M[a.type]&&-1<M[a.type].indexOf(a)}};b4w.module.__obj_util=function(a,p){function e(a){if(!(a instanceof Object))return a;var b=null,c=null,k=null;a.Y&&(b=a.Y,a.Y=null);a.nc&&(c=a.nc,a.nc=null);a.va&&(k=a.va,a.va=null);var h;h=a.constructor;switch(h){case Float32Array:case Uint32Array:case Uint16Array:h=new h(a);break;case Array:h=new h(a.length);for(var m=0;m<a.length;m++)h[m]=e(a[m]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:h=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:h=null;break;case Function:h=
a;break;default:for(m in h=new h,a)h[m]=e(a[m])}b&&(h.Y=b,a.Y=b);c&&(h.nc=c,a.nc=c);k&&(h.va=k,a.va=k);return h}function b(a,b){for(var c=a.u,e=0;e<c.length;e++){var k=c[e];if(k.Ca==b)return k}return null}function c(a){return a.Ug?a.parent:a.parent?c(a.parent):null}var m=p("__tsr"),k=p("__util"),r=p("__vec3"),h=p("__vec4"),q=p("__config").q;new Float32Array(4);new Float32Array(4);new Float32Array(4);m.create();m.create();a.Oh=function(a){a={id:0,type:a,Lc:0,XF:[0,0],i:m.An(),pivot:new Float32Array(3),
fb:new Float32Array(3),zj:0,Aj:0,Ew:!1,sn:null,Yf:0,hp:!1,Fe:r.create(),use_panning:!1,Va:0,Fm:1,Em:1,Gm:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,qd:null,IJ:!1,La:null,ga:null,Oa:null,jc:null,ic:null,he:null,zl:!0,Wj:{Xj:1,Yj:1,Zj:0},Td:null,zd:null,Zb:new Float32Array(4),Dl:0,wl:0,Tl:0,ji:0,fj:!1,Fd:!1,Xc:!1,Wc:!1,Fc:!1,wc:!1,Uc:!1,cf:"",uf:!1,Nd:!1,Gn:!1,Re:!1,fc:!1,Th:!1,ai:!1,lo:!1,Yg:!1,Eo:!1,Kb:!1,Do:!1,Ix:!1,ho:!1,is_visible:!1,dr:!1,Jm:0,mf:0,og:0,Bf:0,Af:0,tf:0,Qf:"",uc:null,kn:!1,
pe:!1,cq:!1,Sk:"",Rk:!1,Yd:0,time:0,It:0,Az:0,Rf:0,Cl:!1,ac:!1,Ee:!1,ah:[],Dj:!1,Bh:!1,wg:1,Rp:0,Qp:1,pp:new Int8Array([-1,-1]),ap:[],lx:[],zy:[],Tc:null,Ad:null,ad:null,Kd:null,Rd:null,aj:null,vs:null,Up:null,Tp:null,Zi:null,dc:null,$p:null,Yp:null,Zp:null,wb:null,Sd:null,ec:null,Ne:null,sf:null,Mg:1E4};r.copy(k.AXIS_Y,a.Fe);return a};a.dj=function(a,b,c){c||(c=a);return{name:a,mh:k.hr(),ri:c,type:b,Hh:!1,oa:!1,Ql:!1,Bm:!1,g:null,ib:null,I:null,Qa:null,en:null,anchor:null,kj:null,uo:null,u:[],ac:[],
Kc:[],Aq:[],O:[],jm:[],ee:[],Vi:[],ye:null,Ci:[],parent:null,Ug:!1,$l:"",zp:null,Lo:null,Li:!1,Ya:"",xn:"AUTO",Pc:!1,is_character:!1,fi:!1,o:null,l:null,Wd:null,bd:null,lj:null,Yu:null,us:[],xe:{Ko:"NO_COLLISION",Cm:!1,zz:!1,Xe:0,Dz:0,Cz:0,Kq:0,Js:0,NG:!1,OG:!1,PG:!1,QG:!1,RG:!1,SG:!1,fl:0,cl:0,hl:0,Ft:!1,rn:"BOX",Am:!1},Hx:{ip:0,os:0,yd:0,Cs:0},Ah:0,actions:[],fs:!1,mx:[]}};a.wn=function(a){return a instanceof Array?a.slice():a};a.cj=e;a.oa=function(a){return a.oa};a.di=function(a){return"MESH"==
a.type&&a.oa};a.Xi=function(a,b){a.u.push({Ca:b,eo:!1,P:[],af:[],xf:null,Ws:[],gi:0,Dx:!1,M:[],yy:[]})};a.dn=function(a,c,f){b(a,c).P.push(f)};a.uN=function(a,b){for(var c=a.u,e=0;e<c.length;e++)if(c[e].Ca==b){c.splice(e,1);break}};a.R=b;a.sz=function(a,b){for(var c=0;c<a.length;c++)h.copy(b,a[c].g.Zb)};a.Ls=function(a,b,c){for(var e=0;e<a.u.length;e++){var k=a.u[e];c&&k.Ca!=c||(k.eo=b)}};a.Rn=function(a,b){for(var c=[],e=b?q.jx-1:q.jx,k=0;k<a.length;k++){var h=a[k];h.Qa.Vv&&c.length<e&&c.push(h)}return c.length?
c:a[0]?[a[0]]:[]};a.$u=function(a,b){if(b.b4w_enable_soft_particles&&0<b.b4w_particles_softness){var c=b.material-1,e=a.data.materials;if(0<=c&&c<e.length&&("ADD"==e[c].game_settings.alpha_blend||"ALPHA"==e[c].game_settings.alpha_blend||"ALPHA_SORT"==e[c].game_settings.alpha_blend))return!0}return!1};a.Sv=function(a,b){return a+"*"+b};a.get_parent=function(a){return a.Ug?null:a.parent};a.get_dg_parent=c;a.mr=function(a,b){for(var f=[],e=0;e<b.length;e++){var k=b[e];c(k)==a&&f.push(k)}return f};a.is_mesh=
function(a){return"MESH"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===a.type};a.is_empty=function(a){return"EMPTY"===a.type};a.is_line=function(a){return"LINE"===a.type};a.is_world=function(a){return"WORLD"===a.type}};b4w.module.__particles=function(a,p){function e(){throw"_rand() undefined";}function b(a,b,c,f,e,k){var d=a.En,h=a.re,l=a.time;a=a.Ux;for(var m=0;m<d.length;m+=4){var q=d[m];if(l>a&&l>=q&&q>a||l<a&&(q>a||l>=q))for(q=0;8>q;q++)h[8*m+q]=f[q],n[q]=f[q];else for(q=0;8>q;q++)n[q]=h[8*m+q];q=u;q[0]=b[3*m];q[1]=b[3*m+1];q[2]=b[3*m+2];g.transform_vec3(q,n,q);e[3*m]=q[0];e[3*m+1]=q[1];e[3*m+2]=q[2];var r=u;r[0]=c[3*m];r[1]=c[3*m+1];r[2]=c[3*m+2];g.transform_dir_vec3(r,n,r);k[3*m]=r[0];k[3*m+1]=r[1];k[3*m+
2]=r[2];for(q=1;4>q;q++)e[3*(m+q)]=e[3*m],e[3*(m+q)+1]=e[3*m+1],e[3*(m+q)+2]=e[3*m+2],k[3*(m+q)]=r[0],k[3*(m+q)+1]=r[1],k[3*(m+q)+2]=r[2]}}function c(a){a?(y.oJ(a),e=function(){return y.QH()}):e=function(){return Math.random()}}var m=p("__config"),k=p("__batch"),r=p("__geometry"),h=p("__textures"),q=p("__time"),g=p("__tsr"),y=p("__util"),f=p("__vec3"),l=m.q,n=new Float32Array(8),u=new Float32Array(3),A=[];a.update=function(){for(var a=0;a<A.length;a++)for(var c=A[a],f=c.u,e=0;e<f.length;e++)for(var g=
c,k=f[e].P,d=0;d<k.length;d++){var h=k[d],l=h.xa;l&&l.vp&&!h.Ue&&(b(l,l.ak,l.zx,g.g.i,l.ws,l.ms),l.oH=!0)}};a.Tj=function(a){a=a.u;for(var b=0;b<a.length;b++)for(var c=a[b].P,f=0;f<c.length;f++)if(c[f].xa)return!0;return!1};a.Cx=function(a){a=a.u;for(var b=0;b<a.length;b++)for(var c=a[b].P,f=0;f<c.length;f++){var e=c[f].xa;if(e&&"EMITTER"==e.ps)return!0}return!1};a.AC=function(a){return 0<a.particle_systems.length};a.zC=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.$F=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.eG=function(a,b,c){var f=a.xa={name:b.name,ps:b.settings.type,time:0,Ux:-1,vp:!1,ba:0,ra:0,bz:0,Or:0,ax:0,cyclic:!1,Xe:0,gs:0,ow:0,Wh:0,rd:0,Sz:0,size:0,yu:0,xu:0,gv:0,fv:new Float32Array(16),ak:null,ws:null,zx:null,ms:null,En:null,Oq:null,re:null,Kx:null,$y:0,az:0};f.ba=b.settings.frame_start;f.ra=b.settings.frame_end;f.bz=(f.ra-
f.ba)/q.Xb();f.Or=b.settings.lifetime;f.ax=f.Or/q.Xb();f.cyclic=b.settings.b4w_cyclic?1:0;f.Xe=b.settings.mass;f.gs=b.settings.normal_factor;f.ow=9.81*b.settings.effector_weights.gravity;f.Wh=b.settings.b4w_fade_in/q.Xb();f.rd=b.settings.b4w_fade_out/q.Xb();f.Sz=b.settings.effector_weights.wind;f.vp="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var e,g,d;a.wr?(e=c.halo.size,g=c.halo.hardness,30>g?(g=.5,d=.9):40>g?(g=.1,d=1):50>g?(g=0,d=.8):(g=0,d=.5)):(e=b.settings.particle_size,d=g=1);f.size=e;
f.yu=g;f.xu=d;c.use_nodes&&"BILLBOARD"==b.settings.render_type&&(k.ya(a,"NODES",1),k.ya(a,"PARTICLE_BATCH",1),a.SN=!0,a.Kl=!0);b=b.settings.texture_slots;b[0]&&b[0].use_map_size&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp&&l.an&&(e=[],h.DC(b[0].texture.color_ramp,h.ku,e),e=new Uint8Array(e.map(function(a){return y.clamp(255*a,0,255)})),k.$B(a,e,"u_color_ramp_tex",h.ku),k.ya(a,"USE_COLOR_RAMP",1));c=c.texture_slots;a=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(c[0]&&"STRAND"==
c[0].texture_coords&&c[0].texture&&"BLEND"==c[0].texture.type&&c[0].texture.use_color_ramp){c=c[0].texture.color_ramp.elements;b=Math.min(4*c.length,a.length);for(e=0;e<b;e+=4)g=c[e/4],a[e]=g.position,a[e+1]=g.color[0],a[e+2]=g.color[1],a[e+3]=g.color[2];f.gv=c.length}f.fv.set(a)};a.fF=function(a,g,k,h){var l=a.xa,m=k.settings.count,d=k.settings.frame_start/q.Xb(),n=k.settings.frame_end/q.Xb(),J=k.settings.lifetime/q.Xb(),C=k.settings.lifetime_random,D=k.settings.emit_from,u=k.settings.factor_random,
p=k.settings.angular_velocity_mode,A=k.settings.angular_velocity_factor,w=k.settings.b4w_randomize_emission,t=k.settings.b4w_cyclic;l.$y=k.settings.billboard_tilt;l.az=k.settings.billboard_tilt_random;c(k.seed);g=r.Jv(g,["a_position","a_normal"],null);switch(D){case "VERT":k=g.G[0].a_position;g=g.G[0].a_normal;for(var Q=k.length/3,D=[],N=0;N<m;N++){var P=Math.round((Q-1)*e());D.push(P);D.push(P);D.push(P);D.push(P)}Q=[];for(N=0;N<D.length;N++)Q.push(k[3*D[N]]),Q.push(k[3*D[N]+1]),Q.push(k[3*D[N]+
2]);k=new Float32Array(Q);Q=[];for(N=0;N<D.length;N++)Q.push(g[3*D[N]]),Q.push(g[3*D[N]+1]),Q.push(g[3*D[N]+2]);D=new Float32Array(Q);break;case "FACE":k=[];D=[];N=[];y.bo(0,N);Q=r.jr(g,m,!1,N);y.bo(0,N);g=r.jr(g,m,!0,N);for(N=0;N<Q.length;N++)k.push(Q[N][0],Q[N][1],Q[N][2]),k.push(Q[N][0],Q[N][1],Q[N][2]),k.push(Q[N][0],Q[N][1],Q[N][2]),k.push(Q[N][0],Q[N][1],Q[N][2]),D.push(g[N][0],g[N][1],g[N][2]),D.push(g[N][0],g[N][1],g[N][2]),D.push(g[N][0],g[N][1],g[N][2]),D.push(g[N][0],g[N][1],g[N][2]);k=
new Float32Array(k);D=new Float32Array(D);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}D=[k,D];g=D[0];D=D[1];l.ak=new Float32Array(g);l.zx=new Float32Array(D);l.ws=new Float32Array(g.length);l.ms=new Float32Array(D.length);k=[];n=(n-d)/m;for(Q=0;Q<m;Q++)N=w?n*Q+10*n*(.5-e()):n*Q,t||(N+=d),k.push(N),k.push(N),k.push(N),k.push(N);d=new Float32Array(k);l.En=new Float32Array(d);l.Oq=new Float32Array(d);if(l.vp){l.re=new Float32Array(8*
d.length);for(w=0;w<8*d.length;w++)for(t=0;8>t;t++)l.re[8*w+t]=h[t];b(l,g,D,h,g,D)}h=y.Vb("EMITTER_PARTICLES");w=y.qe();w.a_position=g;w.a_normal=D;h.G[0]=w;a.Cf=r.Qm;a=[];for(w=0;w<m;w++)a.push(4*w,4*w+2,4*w+1,4*w,4*w+3,4*w+2);a=new Uint16Array(a);h.Ma=a;a=h.U;w=[];for(t=0;t<m;t++)w.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);w=new Float32Array(w);a.a_p_bb_vertex=w;h.ha=g.length/3;a=[];C*=J;for(w=0;w<m;w++)t=C*e(),a.push(J-t),a.push(J-t),a.push(J-t),a.push(J-t);J=h.U;C=[];for(w=0;w<m;w++)t=Math.random(),C.push(a[4*
w],d[4*w],t),C.push(a[4*w+1],d[4*w+1],t),C.push(a[4*w+2],d[4*w+2],t),C.push(a[4*w+3],d[4*w+3],t);C=new Float32Array(C);J.a_p_data=C;J=h.U;C=[];for(a=0;a<m;a++){d=[e()-.5,e()-.5,e()-.5];f.normalize(d,d);C.push(u*d[0]);C.push(u*d[1]);C.push(u*d[2]);switch(p){case "NONE":C.push(0);break;case "SPIN":case "VELOCITY":C.push(A);break;case "RAND":C.push(2*A*(e()-.5));break;default:throw"Undefined velocity factor";}d=C.slice(-4);for(w=0;12>w;w++)C.push(d[w%4])}m=new Float32Array(C);J.a_p_vels=m;l.Kx=new Float32Array(h.U.a_p_data);
return h};a.MI=function(a,b,c){a=a.u;for(var f=0;f<a.length;f++)for(var e=a[f].P,g=0;g<e.length;g++){var d=e[g].xa;d&&d.name==b&&!e[g].Ue&&(d.Ux=d.time,d.time=c)}};a.KH=function(a){for(var b=a.ha,c=a.G[0].a_position,f=a.U.a_texcoord,e=[],g=[],d=0;d<b;d++)g.push(c[3*d]),g.push(c[3*d+1]),e.push(c[3*d+2]);e=new Float32Array(e);g=new Float32Array(g);a.U.a_lf_dist=e;a.U.a_lf_bb_vertex=g;a.U.a_texcoord=f;return a};a.set_size=function(a,b,c){a=a.u;for(var f=0;f<a.length;f++)for(var e=a[f].P,g=0;g<e.length;g++){var d=
e[g].xa;d&&d.name==b&&(d.size=c)}};a.set_normal_factor=function(a,b,c){a=a.u;for(var f=0;f<a.length;f++)for(var e=a[f].P,g=0;g<e.length;g++){var d=e[g].xa;d&&d.name==b&&(d.gs=c)}};a.set_factor=function(a,b,c){a=a.u;for(var f=0;f<a.length;f++)for(var e=a[f].P,g=0;g<e.length;g++){var d=e[g],k=d.xa;if(k&&k.name==b){var h=k.En;if(1==c)var l=h;else if(0==c)for(var l=k.Oq,m=0;m<l.length;m+=4)l[m]=1E4,l[m+1]=l[m],l[m+2]=l[m],l[m+3]=l[m];else for(var n=4/c,l=k.Oq,q=0,m=0;m<l.length;m+=4)m>=q?(l[m]=h[m],q+=
n):l[m]=1E4,l[m+1]=l[m],l[m+2]=l[m],l[m+3]=l[m];d=d.X;if(d.sb.a_p_data){k=k.Kx;for(m=0;m<k.length;m+=3)k[m+1]=l[Math.round(m/3)];r.mz(d,"a_p_data",3,k)}}}};a.oK=function(a,b,c){a=a.u;for(var f=0;f<a.length;f++)for(var e=a[f].P,g=0;g<e.length;g++){var d=e[g].xa;if(d&&d.vp)for(var k=0;k<8*d.En.length;k++)d.re[8*k]=b[0],d.re[8*k+1]=b[1],d.re[8*k+2]=b[2],d.re[8*k+3]=b[3],d.re[8*k+4]=c[0],d.re[8*k+5]=c[1],d.re[8*k+6]=c[2],d.re[8*k+7]=c[3]}};a.iK=function(a,b,c){if(b.Go){for(var f=[],e=0;e<c;e++)f.push(1,
0,0,1,1,0,0,1,1,0,0,1,1,0,0,1);a.U.a_tangent=new Float32Array(f)}if(b.rs){f=[];for(e=0;e<c;e++)f.push(e,e,e,e);a.U[b.rs.name]=new Float32Array(f)}};a.hK=function(a){-1==A.indexOf(a)&&A.push(a)};a.UH=function(a){a=A.indexOf(a);-1!=a&&A.splice(a,1)};a.cleanup=function(){A.length=0}};b4w.module.__primitives=function(a,p){function e(a,b,c,e){for(var k=[],m=[],q=[],r=[],p=2*c/(a-1),v=2*e/(b-1),E=0;E<a;E++)for(var z=-c+E*p,G=0;G<b;G++)if(m.push(z,0,-e+G*v),q.push(0,1,0),r.push(E/(a-1),G/(b-1)),E&&G){var d=E*b+G,F=d-1,J=(E-1)*b+G,C=J-1;k.push(d,F,J);k.push(F,C,J)}a=h.qe();a.a_position=new Float32Array(m);a.a_normal=new Float32Array(q);q=h.Vb("GRID_PLANE");q.G[0]=a;q.U.a_texcoord=new Float32Array(r);q.Ma=new Uint32Array(k);q.ha=m.length/3;return q}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],e=[],k=0;k<b;k+=4){var q=a[k+1],r=a[k+2],p=a[k+3];m(a[k],e);m(q,e);m(r,e);m(p,e);c.push(k,k+1,k+2);c.push(k,k+2,k+3)}a=h.qe();a.a_position=new Float32Array(e);b=h.Vb("FROM_QUADS");b.G[0]=a;b.Ma=new Uint32Array(c);b.ha=e.length/3;return b}function c(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function m(a,b){b.push(a[0],a[1],a[2])}var k=p("__config"),r=p("__geometry");p("__print");var h=p("__util"),q=k.q;a.jF=function(){var a=h.Vb("LINE"),b=h.qe();b.a_position=new Float32Array(3);
b.a_direction=new Float32Array(3);a.G[0]=b;a.Ma=new Uint32Array(1);a.ha=1;return a};a.xM=function(a,b){var c=e(2,2,a,b);c.name="PLANE";return c};a.wM=e;a.mF=function(a,b,c){function e(a,b){return 1==a%2&&(0==b||b==B-1)||1==b%2&&(0==a||a==p-1)?!0:!1}var k=c/=Math.pow(2,a-1),m=c,p=b+1,B=b+1;b=[];c=[];for(var H=[],v=[],E=0,z=0,G=-1,d=[],F=0;F<a;F++){for(var J=2*k/(p-1),C=2*m/(B-1),D=[],O=[],T=0,K=0;K<p;K++){for(var w=-k+K*J,t=[],Q=0;Q<B;Q++){var N=-m+Q*C;if(w>-E&&w<E&&N>-z&&N<z)t.push(-1),T++;else{for(var P=
null,S=0;S<d.length;S+=3)if(w==d[S]&&N==d[S+1]){P=d[S+2];break}S=null!==P?P:G+1;e(K,Q)?(t.push(-2),T++):(null==P&&(0==Q||Q==B-1||0==K||K==p-1?(P=F==a-1?J:2*J,D.push(w,N,S)):P=J,c.push(w,P,N),v.push(0,1,0),H.push(1,0,0),G++),t.push(S));if(K&&Q)if(1==K)if(e(K-1,Q)){if(1<Q){var N=S-1,P=O[K-1][Q+1],Z=P-1;b.push(S,N,Z)}else P=O[K-1][Q+1],Z=P-1;b.push(S,Z,P)}else e(K,Q)||(N=S-1,P=O[K-1][Q],b.push(S,N,P));else if(K==p-1){if(!e(K,Q))if(Q==B-1)N=S-1,P=O[K-1][Q-1],Z=O[K-2][Q],b.push(S,N,P),b.push(S,P,Z);else{var N=
S-1,P=O[K-1][Q],Z=P-1,M=P+1;b.push(S,N,Z);b.push(S,Z,P);b.push(S,P,M);2==Q&&(M=O[K-2][Q-2],b.push(N,M,Z))}}else 1==Q?e(K,Q-1)?(N=O[K-1][Q],P=O[K-1][Q-1],b.push(S,P,N)):(N=t[Q-1],P=O[K-1][Q],Z=O[K-2][Q-1],b.push(S,N,P),b.push(N,Z,P)):Q==B-1?e(K,Q)||(N=t[Q-1],P=O[K-1][Q-1],Z=O[K-2][Q],b.push(S,N,P),b.push(S,P,Z)):-1!=O[K-1][Q]&&-1!=O[K-1][Q-1]&&-1!=t[Q-1]?(N=t[Q-1],P=O[K-1][Q],Z=O[K-1][Q-1],b.push(S,N,P),b.push(N,Z,P),Q==B-2&&e(K,Q+1)&&(M=O[K-1][Q+1],b.push(S,P,M))):Q==B-2&&e(K,Q+1)&&(P=O[K-1][Q],M=
O[K-1][Q+1],b.push(S,P,M))}}O.push(t)}d=D;E=k;z=m;k*=2;m*=2}if(2E4>E)for(a=-(2*E)/(p-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-E,a,-z),c.push(-E,a,z),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(E,a,-z),c.push(E,a,z),S=G+1,b.push(S+3,S+2,S+1,S+2,S+0,S+1,S+6,S+4,S+2,S+4,S+0,S+2,S+5,S+7,S+1,S+7,S+3,S+1,S+5,S+4,S+7,S+7,S+4,S+6),K=0;8>K;K++)v.push(0,1,0),H.push(1,0,0);a=h.qe();a.a_position=new Float32Array(c);a.a_tangent=new Float32Array(H);a.a_normal=new Float32Array(v);k=h.Vb("multigrid_plane");
k.G[0]=a;k.Ma=new Uint32Array(b);k.ha=c.length/3;q.Rz&&(r.gp(k,1,!0),a.a_polyindex=r.$q(k));return k};a.vM=function(a){var b=a.length;if(b%3)throw"Wrong array";for(var c=[],e=[],k=0;k<b;k+=3){var q=a[k+1],r=a[k+2];m(a[k],e);m(q,e);m(r,e);c.push(k,k+1,k+2)}a=h.qe();a.a_position=new Float32Array(e);b=h.Vb("FROM_TRIANGLES");b.G[0]=a;b.Ma=new Uint32Array(c);b.ha=e.length/3;return b};a.uM=b;a.gF=function(a){a=h.KK(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],
a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.Pb=function(){var a=h.Vb("FULLSCREEN_TRI"),b=h.qe();b.a_position=new Float32Array([0,0,1,0,0,1]);a.G[0]=b;a.Ma=new Uint32Array([0,1,2]);a.ha=3;return a};a.hF=function(){var a=h.Vb("FULLSCREEN_QUAD"),b=h.qe();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.G[0]=b;a.Ma=new Uint32Array([0,2,1,1,2,3]);a.ha=4;return a};a.cF=function(){var a=h.Vb("BILLBOARD"),b=h.qe();b.a_bb_vertex=
new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.G[0]=b;a.Ma=new Uint32Array([0,2,1,0,3,2]);a.ha=4;return a};a.dF=function(){var a=h.Vb("CUBEMAP_BOARD"),b=h.qe();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.G[0]=b;a.Ma=new Uint32Array([0,2,1,0,3,2]);a.ha=4;return a};a.ir=function(a,b){var f=h.Vb("UV_SPHERE"),e,k,q=[],p=[],B=[];for(k=0;8>=k;k++)for(e=0;16>=e;e++){var H=e/16,v=k/8;p.push(-a*Math.cos(2*H*Math.PI)*Math.sin(v*Math.PI)+b[0],a*Math.cos(v*Math.PI)+b[1],a*Math.sin(2*H*Math.PI)*
Math.sin(v*Math.PI)+b[2])}for(k=H=0;8>k;k++)for(e=0;16>e;e++){var v=c(p,17*k+e+1),E=c(p,17*k+e),z=c(p,17*(k+1)+e),G=c(p,17*(k+1)+e+1);Math.abs(v[1])==a+b[1]?(m(v,q),m(z,q),m(G,q),B.push(H,H+1,H+2),H+=3):Math.abs(z[1])==a+b[1]?(m(v,q),m(E,q),m(z,q),B.push(H,H+1,H+2),H+=3):(m(v,q),m(E,q),m(z,q),m(G,q),B.push(H,H+1,H+2),B.push(H,H+2,H+3),H+=4)}e={};e.a_position=q;p=r.Qu(B,p,q);e.a_normal=r.Pu(B,q,p);e.a_tangent=[];f.U.a_influence=[];f.U.a_color=[];f.U.a_texcoord=[];f.G[0]=e;f.Ma=B;f.ha=q.length/3;return f};
a.Uv=function(a){var b=h.Vb("INDEX"),c=h.qe();c.a_index=new Float32Array(a);for(var e=0;e<a;e++)c.a_index[e]=e;b.G[0]=c;b.Ma=new Uint16Array(0);b.ha=a;return b}};b4w.module.__prerender=function(a,p){function e(a,b){var c=a.$e;c.is_visible=!1;if(c.ai)return!1;var f=b.j,e="SHADOW_CAST"==b.type?f.fx:h.Gg(f.i,l),k=c.ec.J,g=c.Mg,e=Math.sqrt((k[0]-e[0])*(k[0]-e[0])+(k[1]-e[1])*(k[1]-e[1])+(k[2]-e[2])*(k[2]-e[2])),k=c.ji*c.ec.Wa;if(!(e>=c.Tl&&e<g+k))return!1;c.is_visible=!0;(g="OUTLINE_MASK"==b.type&&!Boolean(c.Yf))||(c.Th?g=!1:(c=c.sf,g=q.vE(c.J,f.qj,c.Ke,c.Le,c.Me)));return g?!1:"WIREFRAME"==b.type?a.H.wireframe_mode==m.WM_DEBUG_SPHERES?a.H.Qh:!a.H.Qh:!0}function b(a){var b=
a.xa;if(b&&b.oH){a=a.X;k.XG(a);var c=a.oc,f=a.sb,e=f.a_normal;c.set(b.ws,f.a_position.offset);c.set(b.ms,e.offset);k.Et(a)}}var c=p("__config"),m=p("__debug"),k=p("__geometry"),r=p("__renderer"),h=p("__tsr"),q=p("__util"),g=p("__vec3"),y=c.q,f="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND MAIN_GLOW SHADOW_CAST SHADOW_RECEIVE OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" "),l=new Float32Array(3);a.Oo=function(a){if(-1<
f.indexOf(a.type)){for(var c=!1,m=a.v,q=0;q<m.length;q++){var p=m[q],v=p.H;if("MAIN_CUBE_REFLECT"==a.type||"MAIN_CUBE_REFLECT_BLEND"==a.type)for(var E=0;6>E;E++)a.j.qj=a.nl[E],p.Sq[E]=e(p,a),p.Sq[E]&&(c=!0,b(v));else p.Ib=e(p,a),p.Ib&&(c=!0,b(v));a.ia&&(v.$b.zo=!0)}a.ia=!1;switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"SHADOW_RECEIVE"===a.type||"MAIN_GLOW"===a.type||"MAIN_PLANE_REFLECT"===a.type||"MAIN_CUBE_REFLECT"===a.type||c?a.Ib=!0:(a.Ib&&r.clear(a),a.Ib=!1)}}else if(a.ia){m=
a.v;for(q=0;q<m.length;q++)a.ia&&(m[q].H.$b.zo=!0);a.ia=!1}if("MAIN_BLEND"==a.type&&y.alpha_sort&&a.v){c=h.Gg(a.j.i,l);m=g.dist(c,a.Vz)>y.alpha_sort_threshold;for(q=0;q<a.v.length;q++)if(v=a.v[q],p=v.$e,p.dr||m){if((E=v.H)&&E.Ga&&E.rg!=k.of){E=E.X;if(!E||!v.Ib)continue;(v=E.ao)&&v.type==k.nu&&k.UJ(E,p.i,c)}p.dr=!1}m&&g.copy(c,a.Vz)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var f=1;f<a.length;f++)c.push(a[f]);return c}function e(){k++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)}function b(a){a in h||(h[a]=a,e([a]))}function c(a,c){b(a+"() is deprecated, use "+c+"() instead.")}var m=!1,k=0,r=0,h={};a.NI=function(a){m=a};a.Ur=function(){console.log.apply(console,arguments)};a.log=function(){if(m){var a=p(arguments,
"B4W LOG");console.log.apply(console,a)}};a.error=e;a.gc=b;a.Ia=c;a.Se=function(a,e){switch(1<e.length){case !0:b(a+"() is deprecated, use "+e.slice(0,-1).join("(), ")+"() or "+e[e.length-1]+"() instead.");break;case !1:c(a,e[0])}};a.zE=function(){b('Config option "anaglyph_use" is deprecated, use "stereo" instead.')};a.warn=function(){r++;var a=p(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=p(arguments,"B4W INFO");console.info.apply(console,a)};a.CE=function(){k++;
var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.DE=function(){r++;var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){m&&console.time.apply(console,arguments)};a.timeEnd=function(){m&&console.timeEnd.apply(console,arguments)};a.group=function(){m&&console.group.apply(console,arguments)};a.groupCollapsed=function(){m&&console.groupCollapsed.apply(console,arguments)};a.groupEnd=function(){m&&console.groupEnd.apply(console,arguments)};a.clear=
function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.UF=function(){return r};a.DF=function(){return k};a.clear_errors_warnings=function(){k=r=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function e(a){switch(a.type){case "VALTORGB":a.color_ramp||(a.color_ramp={elements:[{position:.5,color:[1,1,1,1]}]},c("node Color Ramp",a,"color_ramp"));break;case "CURVE_RGB":a.curve_mapping||(a.curve_mapping={curves_data:[[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]]],curves_handle_types:["EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED"],curve_extend:[["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"]]},c("node RGB Curves",a,
"curve_mapping"));break;case "CURVE_VEC":a.curve_mapping||(a.curve_mapping={curves_data:[[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]]],curves_handle_types:["EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED"],curve_extend:[["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"]]},c("node Vector Curves",a,"curve_mapping"));break;case "MAPPING":a.vector_type||(a.vector_type="POINT",c("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,c("node material",a,"alpha"));"darkness"in
a||(a.darkness=1,c("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,c("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,c("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in a||(a.diffuse_intensity=1,c("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",c("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,c("node material",a,"specular_ior"));"specular_hardness"in
a||(a.specular_hardness=50,c("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,c("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,c("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,c("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,c("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",c("node material",
a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,c("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,c("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,c("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,c("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a){if(a=a.nla_tracks)for(var b=0;b<a.length;b++)for(var f=a[b],e=0;e<f.strips.length;e++){var d=f.strips[e];"action"in d||(d.action=null,c("strip",d,"action"));"action_frame_start"in d||(d.action_frame_start=0,c("strip",d,"action_frame_start"));"action_frame_end"in d||(d.action_frame_end=d.frame_end-d.frame_start,c("strip",d,"action_frame_end"));"repeat"in d||(d.repeat=1,c("strip",d,"repeat"));"use_reverse"in d||(d.use_reverse=!1,c("strip",d,"use_reverse"));"scale"in
d||(d.scale=1,c("strip",d,"scale"))}}function c(a,b,c){c=c+">>"+a;c in H||(H[c]={kt:[],gy:"undefined",type:a});H[c].kt.push(b.name)}function m(a,b,c){c=c+">>"+a;c in H||(H[c]={kt:[],gy:"deprecated",type:a});H[c].kt.push(b.name)}function k(a){y.warn(a)}function r(a,b){b||(b=a.name+"_COPY");var c=a.materials,f=a.submeshes;a.materials=null;a.submeshes=null;var d=l.Kh(a);a.materials=c;a.submeshes=f;d.name=b;d.materials=a.materials.slice(0);d.submeshes=[];for(c=0;c<f.length;c++){var e=l.bl(f[c]);d.submeshes.push(e)}return d}
var h=p("__boundings"),q=p("__curve"),g=p("__mat4"),y=p("__print"),f=p("__quat"),l=p("__util"),n=p("__vec3"),u=p("__vec4"),A=p("__logic_nodes"),B=[5,4],H={};a.av=function(a){return-1!=l.Ez(a,B)};a.RC=function(a){H={};var f=a.worlds;if(0==f.length){y.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var g={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},
fog_settings:{use_fog:!1,intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};f.push(g)}for(var f=a.worlds,h=0;h<f.length;h++){g=f[h];"use_sky_blend"in g||(c("world",g,"use_sky_blend"),g.use_sky_blend=!1);"use_sky_paper"in g||(c("world",g,"use_sky_paper"),g.use_sky_paper=!1);"use_sky_real"in g||(c("world",g,"use_sky_real"),g.use_sky_real=!1);"b4w_sky_settings"in g&&"rayleigh_brightness"in
g.b4w_sky_settings||(c("world",g,"rayleigh_brightness"),g.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in g||(c("world",g,"fog_settings"),g.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,
color:[.5,.5,.5]},"b4w_fog_color"in g&&(g.fog_settings.use_custom_color=!0,g.fog_settings.color=g.b4w_fog_color),"b4w_fog_density"in g&&0<g.b4w_fog_density&&(g.fog_settings.depth=1/g.b4w_fog_density));"render_sky"in g.b4w_sky_settings||(c("world",g,"render_sky"),g.b4w_sky_settings.render_sky=!1);for(var d=g.texture_slots,q=0;q<d.length;q++){var n=d[q];"blend_type"in n||(n.blend_type="MIX",c("world_texture_slot",n,"blend_type"));"use_map_blend"in n||(n.use_map_blend=!1,c("world_texture_slot",n,"use_map_blend"));
"use_map_horizon"in n||(n.use_map_horizon=!0,c("world_texture_slot",n,"use_map_horizon"));"use_map_zenith_up"in n||(n.use_map_zenith_up=!1,c("world_texture_slot",n,"use_map_zenith_up"));"use_rgb_to_intensity"in n||(n.use_rgb_to_intensity=!1,c("world_texture_slot",n,"use_rgb_to_intensity"));"invert"in n||(n.invert=!1,c("world_texture_slot",n,"invert"));"color"in n||(n.color=[1,0,1],c("world_texture_slot",n,"color"));"blend_factor"in n||(n.blend_factor=0,c("world_texture_slot",n,"blend_factor"));"horizon_factor"in
n||(n.horizon_factor=1,c("world_texture_slot",n,"horizon_factor"));"zenith_up_factor"in n||(n.zenith_up_factor=0,c("world_texture_slot",n,"zenith_up_factor"));"zenith_down_factor"in n||(n.zenith_down_factor=0,c("world_texture_slot",n,"zenith_down_factor"));"default_value"in n||(n.default_value=1,c("world_texture_slot",n,"default_value"))}"b4w_use_default_animation"in g||(c("world",g,"b4w_use_default_animation"),g.b4w_use_default_animation=!1);"b4w_anim_behavior"in g||(c("world",g,"b4w_anim_behavior"),
g.b4w_anim_behavior="CYCLIC")}q=a.scenes;for(h=0;h<q.length;h++)d=q[h],n=d.world,"timeline_markers"in d||(d.timeline_markers=null,c("scene",d,"timeline_markers")),"b4w_reflection_quality"in d||(d.b4w_reflection_quality="MEDIUM",c("scene",d,"b4w_reflection_quality")),"b4w_use_nla"in d||(d.b4w_use_nla=!1,c("scene",d,"b4w_use_nla")),"fps"in d||(d.fps=24,c("scene",d,"fps")),"b4w_nla_cyclic"in d||(d.b4w_nla_cyclic=!1,c("scene",d,"b4w_nla_cyclic")),"b4w_logic_nodes"in d||(d.b4w_logic_nodes=[],c("scene",
d,"b4w_logic_nodes")),"b4w_detect_collisions"in d&&(m("scene",d,"b4w_detect_collisions"),delete d.b4w_detect_collisions),"audio_doppler_speed"in d||(d.audio_doppler_speed=343.3),"audio_doppler_factor"in d||(d.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in d||(d.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},c("scene",d,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in d||(d.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in
d||(d.b4w_enable_bloom=!1,c("scene",d,"b4w_enable_bloom")),"b4w_enable_motion_blur"in d||(d.b4w_enable_motion_blur=!1,c("scene",d,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in d||(d.b4w_enable_color_correction=!1,c("scene",d,"b4w_enable_color_correction")),"b4w_antialiasing_quality"in d||(d.b4w_antialiasing_quality="MEDIUM",c("scene",d,"b4w_antialiasing_quality")),"b4w_tags"in d||(d.b4w_tags={title:"",description:""},c("scene",d,"b4w_tags")),"b4w_enable_object_selection"in d||(d.b4w_enable_object_selection=
"AUTO",c("scene",d,"b4w_enable_object_selection")),"b4w_enable_outlining"in d||(d.b4w_enable_outlining="AUTO",c("scene",d,"b4w_enable_outlining")),"b4w_enable_glow_materials"in d||(d.b4w_enable_glow_materials="AUTO",c("scene",d,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in d||(d.b4w_enable_anchors_visibility="AUTO",c("scene",d,"b4w_enable_anchors_visibility")),"b4w_outline_color"in d||(d.b4w_outline_color=[1,1,1],c("scene",d,"b4w_outline_color")),"b4w_outline_factor"in d||(d.b4w_outline_factor=
"b4w_glow_factor"in d?d.b4w_glow_factor:1,c("scene",d,"b4w_outline_factor")),"b4w_shadow_settings"in d||(c("scene",d,"b4w_shadow_settings"),f=n.b4w_shadow_settings,d.b4w_shadow_settings=f?f:{csm_resolution:2048,self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),f=d.b4w_shadow_settings,"csm_resolution"in f||(c("scene",d,"b4w_shadow_settings.csm_resolution"),
f.csm_resolution=2048),"self_shadow_polygon_offset"in f||(c("scene",d,"b4w_shadow_settings.self_shadow_polygon_offset"),f.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in f||(c("scene",d,"b4w_shadow_settings.self_shadow_normal_offset"),f.self_shadow_normal_offset=.01),"b4w_enable_csm"in f||(c("scene",d,"b4w_shadow_settings.b4w_enable_csm"),f.b4w_enable_csm=!1),"csm_num"in f||(c("scene",d,"b4w_shadow_settings.csm_num"),f.csm_num=1),"csm_first_cascade_border"in f||(c("scene",d,"b4w_shadow_settings.csm_first_cascade_border"),
f.csm_first_cascade_border=10),"first_cascade_blur_radius"in f||(c("scene",d,"b4w_shadow_settings.first_cascade_blur_radius"),f.first_cascade_blur_radius=3),"csm_last_cascade_border"in f||(c("scene",d,"b4w_shadow_settings.csm_last_cascade_border"),f.csm_last_cascade_border=100),"last_cascade_blur_radius"in f||(c("scene",d,"b4w_shadow_settings.last_cascade_blur_radius"),f.last_cascade_blur_radius=1.5),"fade_last_cascade"in f||(c("scene",d,"b4w_shadow_settings.fade_last_cascade"),f.fade_last_cascade=
!0),"blend_between_cascades"in f||(c("scene",d,"b4w_shadow_settings.blend_between_cascades"),f.blend_between_cascades=!0),"b4w_ssao_settings"in d||(c("scene",d,"b4w_ssao_settings"),f=n.b4w_ssao_settings,d.b4w_ssao_settings=f?f:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),f=d.b4w_ssao_settings,"dist_factor"in f||(c("scene",d,"b4w_ssao_settings.dist_factor"),f.dist_factor=0),"samples"in f||(c("scene",d,"b4w_ssao_settings.samples"),f.samples=16),"hemisphere"in f||(c("scene",
d,"b4w_ssao_settings.hemisphere"),f.hemisphere=!1),"blur_depth"in f||(c("scene",d,"b4w_ssao_settings.blur_depth"),f.blur_depth=!1),"blur_discard_value"in f||(c("scene",d,"b4w_ssao_settings.blur_discard_value"),f.blur_discard_value=1),"b4w_bloom_settings"in d||(c("scene",d,"b4w_bloom_settings"),f=n.b4w_bloom_settings,d.b4w_bloom_settings=f?f:{key:.2,blur:4,edge_lum:1}),"key"in d.b4w_bloom_settings||(c("scene",d,"b4w_bloom_settings.key"),d.b4w_bloom_settings.key=.2),"blur"in d.b4w_bloom_settings||(c("scene",
d,"b4w_bloom_settings.blur"),d.b4w_bloom_settings.blur=4),"edge_lum"in d.b4w_bloom_settings||(c("scene",d,"b4w_bloom_settings.edge_lum"),d.b4w_bloom_settings.edge_lum=1),"b4w_motion_blur_settings"in d||(c("scene",d,"b4w_motion_blur_settings"),f=n.b4w_motion_blur_settings,d.b4w_motion_blur_settings=f?f:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in d.b4w_motion_blur_settings||(c("scene",d,"b4w_motion_blur_settings.motion_blur_factor"),d.b4w_motion_blur_settings.motion_blur_factor=
.01),"motion_blur_decay_threshold"in d.b4w_motion_blur_settings||(c("scene",d,"b4w_motion_blur_settings.motion_blur_decay_threshold"),d.b4w_motion_blur_settings.motion_blur_decay_threshold=.01),"b4w_color_correction_settings"in d||(c("scene",d,"b4w_color_correction_settings"),f=n.b4w_color_correction_settings,d.b4w_color_correction_settings=f?f:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in d||(c("scene",d,"b4w_god_rays_settings"),f=n.b4w_god_rays_settings,d.b4w_god_rays_settings=
f?f:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in d.b4w_god_rays_settings||(c("scene",d,"b4w_god_rays_settings.steps_per_pass"),d.b4w_god_rays_settings.steps_per_pass=10),"b4w_glow_settings"in d||(c("scene",d,"b4w_glow_settings"),d.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},f=d.b4w_glow_settings,"b4w_render_glow_over_blend"in n&&(f.render_glow_over_blend=n.b4w_render_glow_over_blend),
"b4w_small_glow_mask_coeff"in n&&(f.small_glow_mask_coeff=n.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in n&&(f.large_glow_mask_coeff=n.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in n&&(f.small_glow_mask_width=n.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in n&&(f.large_glow_mask_width=n.b4w_large_glow_mask_width)),n=d.b4w_render_shadows,"AUTO"!=n&&"OFF"!=n&&"ON"!=n&&(d.b4w_render_shadows=n?"ON":"OFF"),n=d.b4w_render_reflections,"OFF"!=n&&"ON"!=n&&(d.b4w_render_reflections=
n?"ON":"OFF"),n=d.b4w_render_refractions,"AUTO"!=n&&"OFF"!=n&&"ON"!=n&&(d.b4w_render_refractions=n?"ON":"OFF"),"b4w_render_dynamic_grass"in d||(c("scene",d,"b4w_render_dynamic_grass"),d.b4w_render_dynamic_grass="AUTO"),d.b4w_nla_script&&m("scene",d,"b4w_nla_script");d=a.meshes;for(h=0;h<d.length;h++){n=d[h];n.b4w_bounding_box||(c("mesh",n,"b4w_bounding_box"),n.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});n.b4w_bounding_box_source||(c("mesh",n,"b4w_bounding_box_source"),n.b4w_bounding_box_source=
n.b4w_bounding_box);n.uv_textures||(c("mesh",n,"uv_textures"),n.uv_textures=[]);n.b4w_bounding_sphere_center||(n.b4w_bounding_sphere_center=[0,0,0]);n.b4w_bounding_cylinder_center||(n.b4w_bounding_cylinder_center=[0,0,0]);n.b4w_bounding_ellipsoid_center||(n.b4w_bounding_ellipsoid_center=[0,0,0]);n.b4w_bounding_ellipsoid_axes||(q=n.b4w_bounding_box,n.b4w_bounding_ellipsoid_axes=[(q.max_x-q.min_x)/2,(q.max_y-q.min_y)/2,(q.max_z-q.min_z)/2]);"b4w_shape_keys"in n||(n.b4w_shape_keys=[],c("mesh",n,"b4w_shape_keys"));
for(var q=n,f=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],g=null,r=0;r<f.length;r++)q[f[r]]&&(g?(q[f[r]]=!1,y.warn('WARNING property "'+f[r]+'" of object "'+q.name+'" has been set to "false". Foreground property "'+g+'" already exists.')):g=f[r]);for(q=0;q<n.b4w_vertex_anim.length;q++)f=n.b4w_vertex_anim[q],"allow_nla"in f||(c('mesh["b4w_vertex_anim"]',n,"allow_nla"),f.allow_nla=!0)}q=a.cameras;for(h=0;h<q.length;h++)d=q[h],d.type||
(d.type="PERSP",c("camera",d,"type")),"b4w_eye_target_dist"in d&&(delete d.b4w_eye_target_dist,m("camera",d,"b4w_eye_target_dist")),"b4w_hover_zero_level"in d||(d.b4w_hover_zero_level=0,c("camera",d,"b4w_hover_zero_level")),"b4w_trans_velocity"in d||(d.b4w_trans_velocity=1,c("camera",d,"b4w_trans_velocity")),"b4w_rot_velocity"in d||(d.b4w_rot_velocity=1,c("camera",d,"b4w_rot_velocity")),"b4w_zoom_velocity"in d||(d.b4w_zoom_velocity=.1,c("camera",d,"b4w_zoom_velocity")),"b4w_use_target_distance_limits"in
d||(d.b4w_use_target_distance_limits=d.b4w_use_distance_limits||!1,c("camera",d,"b4w_use_target_distance_limits")),"b4w_use_zooming"in d||(d.b4w_use_zooming=d.b4w_use_distance_limits||!1,c("camera",d,"b4w_use_zooming")),"b4w_distance_min"in d||(d.b4w_distance_min=1,c("camera",d,"b4w_distance_min")),"b4w_distance_max"in d||(d.b4w_distance_max=100,c("camera",d,"b4w_distance_max")),"b4w_horizontal_translation_min"in d||(d.b4w_horizontal_translation_min=-100,c("camera",d,"b4w_horizontal_translation_min")),
"b4w_horizontal_translation_max"in d||(d.b4w_horizontal_translation_max=100,c("camera",d,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in d||(d.b4w_vertical_translation_min=-100,c("camera",d,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in d||(d.b4w_vertical_translation_max=100,c("camera",d,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in d||(d.b4w_use_horizontal_clamping=!1,c("camera",d,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in
d||(d.b4w_rotation_left_limit=-Math.PI,c("camera",d,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in d||(d.b4w_rotation_right_limit=Math.PI,c("camera",d,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in d||(d.b4w_horizontal_clamping_type="LOCAL",c("camera",d,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in d||(d.b4w_use_vertical_clamping=!1,c("camera",d,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in d||(d.b4w_rotation_down_limit=-Math.PI/2,c("camera",d,
"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in d||(d.b4w_rotation_up_limit=Math.PI/2,c("camera",d,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in d||(d.b4w_vertical_clamping_type="LOCAL",c("camera",d,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in d||(d.b4w_hover_angle_min=Math.PI/6,c("camera",d,"b4w_hover_angle_min")),"b4w_hover_angle_max"in d||(d.b4w_hover_angle_max=Math.PI/6,c("camera",d,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in d||(d.b4w_enable_hover_hor_rotation=
!0,c("camera",d,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in d||(d.b4w_use_panning=!0,c("camera",d,"b4w_use_panning")),"b4w_use_pivot_limits"in d||(d.b4w_use_pivot_limits=!1,d.b4w_pivot_z_min=0,d.b4w_pivot_z_max=10,c("camera",d,"b4w_use_pivot_limits"));q=a.lamps;for(h=0;h<q.length;h++)d=q[h],"b4w_generate_shadows"in d||(d.b4w_generate_shadows=!1,c("lamp",d,"b4w_generate_shadows")),"b4w_dynamic_intensity"in d||(d.b4w_dynamic_intensity=!1,c("lamp",d,"b4w_dynamic_intensity")),"use_diffuse"in
d||(d.use_diffuse=!0,c("lamp",d,"use_diffuse")),"use_specular"in d||(d.use_specular=!0,c("lamp",d,"use_specular"));q=a.speakers;for(h=0;h<q.length;h++)d=q[h],"b4w_behavior"in d||(d.b4w_behavior=d.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in d||(d.b4w_disable_doppler=!1),"b4w_delay"in d||(d.b4w_delay=0),"b4w_delay_random"in d||(d.b4w_delay_random=0),"b4w_volume_random"in d||(d.b4w_volume_random=0),"b4w_pitch_random"in d||(d.b4w_pitch_random=0),"b4w_fade_in"in d||(d.b4w_fade_in=
0),"b4w_fade_out"in d||(d.b4w_fade_out=0),"b4w_loop"in d||(d.b4w_loop=!1),"b4w_loop_count"in d||(d.b4w_loop_count=0),"b4w_loop_count_random"in d||(d.b4w_loop_count_random=0),"b4w_playlist_id"in d||(d.b4w_playlist_id=""),d.animation_data&&b(d.animation_data);q=a.textures;for(h=0;h<q.length;h++)d=q[h],"b4w_anisotropic_filtering"in d||(d.b4w_anisotropic_filtering="OFF",c("texture",d,"b4w_anisotropic_filtering")),"b4w_water_foam"in d||(d.b4w_water_foam=!1,c("texture",d,"b4w_water_foam")),"b4w_foam_uv_freq"in
d||(d.b4w_foam_uv_freq=[1,1],c("texture",d,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in d||(d.b4w_foam_uv_magnitude=[1,1],c("texture",d,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in d||(d.b4w_parallax_steps=5,c("material",d,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in d||(d.b4w_parallax_lod_dist=10,c("material",d,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in d||(d.b4w_shore_dist_map=!1,c("texture",d,"b4w_shore_dist_map")),"b4w_shore_boundings"in d||(d.b4w_shore_boundings=new Float32Array(4),
d.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],c("texture",d,"b4w_shore_boundings")),"b4w_max_shore_dist"in d||(d.b4w_max_shore_dist=100,c("texture",d,"b4w_max_shore_dist")),"b4w_disable_compression"in d||(d.b4w_disable_compression=!1,c("texture",d,"b4w_disable_compression")),"b4w_source_type"in d||(d.b4w_source_type="",c("texture",d,"b4w_source_type")),"b4w_source_id"in d||(d.b4w_source_id="",c("texture",d,"b4w_source_id")),"b4w_source_size"in d||(d.b4w_source_size=1024,c("texture",d,"b4w_source_size")),
"b4w_enable_canvas_mipmapping"in d||(d.b4w_enable_canvas_mipmapping=!0,c("texture",d,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in d||(d.b4w_nla_video=!1,c("texture",d,"b4w_nla_video"));f=a.materials;for(h=0;h<f.length;h++){g=f[h];"ALPHA_ANTIALIASING"==g.game_settings.alpha_blend&&(g.game_settings.alpha_blend="CLIP");"b4w_node_mat_type"in g&&m("material",g,"b4w_node_mat_type");"b4w_skydome"in g&&m("material",g,"b4w_skydome");"b4w_procedural_skydome"in g&&m("material",g,"b4w_procedural_skydome");
g.b4w_water&&("b4w_water_shore_smoothing"in g||(g.b4w_water_shore_smoothing=!1,c("material",g,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in g||(g.b4w_water_dynamic=!1,c("material",g,"b4w_water_dynamic")),"b4w_waves_height"in g||(g.b4w_waves_height=1,c("material",g,"b4w_waves_height")),"b4w_waves_length"in g||(g.b4w_waves_length=1,c("material",g,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in g||(g.b4w_water_dst_noise_scale0=.05,c("material",g,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in
g||(g.b4w_water_dst_noise_scale1=.03,c("material",g,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in g||(g.b4w_water_dst_noise_freq0=1.3,c("material",g,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in g||(g.b4w_water_dst_noise_freq1=1,c("material",g,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in g||(g.b4w_water_dir_min_shore_fac=.4,c("material",g,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in g||(g.b4w_water_dir_freq=.5,c("material",g,"b4w_water_dir_freq")),
"b4w_water_dir_noise_scale"in g||(g.b4w_water_dir_noise_scale=.05,c("material",g,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in g||(g.b4w_water_dir_noise_freq=.07,c("material",g,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in g||(g.b4w_water_dir_min_noise_fac=.5,c("material",g,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in g||(g.b4w_water_dst_min_fac=.2,c("material",g,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in g||(g.b4w_water_waves_hor_fac=5,c("material",
g,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in g||(g.b4w_water_absorb_factor=6,c("material",g,"b4w_water_absorb_factor")),"b4w_water_fog_color"in g||(g.b4w_water_fog_color=new Float32Array(3),g.b4w_water_fog_color=[.5,.7,.7],c("material",g,"b4w_water_fog_color")),"b4w_foam_factor"in g||(g.b4w_foam_factor=5,c("material",g,"b4w_foam_factor")),"b4w_generated_mesh"in g||(g.b4w_generated_mesh=!1,c("material",g,"b4w_generated_mesh")),"b4w_water_num_cascads"in g||(g.b4w_water_num_cascads=5,c("material",
g,"b4w_water_num_cascads")),"b4w_water_subdivs"in g||(g.b4w_water_subdivs=64,c("material",g,"b4w_water_subdivs")),"b4w_water_detailed_dist"in g||(g.b4w_water_detailed_dist=1E3,c("material",g,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in g||(g.b4w_water_enable_caust=!1,c("material",g,"b4w_water_enable_caust")),"b4w_water_caust_scale"in g||(g.b4w_water_caust_scale=.25,c("material",g,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in g||(g.b4w_water_caust_brightness=.5,c("material",g,
"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in g||(g.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in g||(g.b4w_dynamic_grass_color="");"diffuse_intensity"in g||(g.diffuse_intensity=1,c("material",g,"diffuse_intensity"));"b4w_use_ghost"in g||(g.b4w_use_ghost=!1);"b4w_collision_margin"in g||(g.b4w_collision_margin=.04,c("material",g,"b4w_collision_margin"));"b4w_collision_group"in g||(g.b4w_collision_group=128,c("material",g,"b4w_collision_group"));"b4w_collision_mask"in g||(g.b4w_collision_mask=
127,c("material",g,"b4w_collision_mask"));"b4w_do_not_render"in g||(g.b4w_do_not_render=!1,c("material",g,"b4w_do_not_render"));"HALO"!=g.type||"b4w_halo_sky_stars"in g||(g.b4w_halo_sky_stars=!1,c("material",g,"b4w_halo_sky_stars"));"HALO"!=g.type||"b4w_halo_stars_blend_height"in g||(g.b4w_halo_stars_blend_height=10,c("material",g,"b4w_halo_stars_blend_height"));"HALO"!=g.type||"b4w_halo_stars_min_height"in g||(g.b4w_halo_stars_min_height=0,c("material",g,"b4w_halo_stars_min_height"));"specular_shader"in
g||(g.specular_shader="COOKTORR",c("material",g,"specular_shader"));"diffuse_shader"in g||(g.diffuse_shader="LAMBERT",c("material",g,"diffuse_shader"));"roughness"in g||(g.roughness=.5,c("material",g,"roughness"));"diffuse_fresnel"in g||(g.diffuse_fresnel=.1,c("material",g,"diffuse_fresnel"));"diffuse_fresnel_factor"in g||(g.diffuse_fresnel_factor=.5,c("material",g,"diffuse_fresnel_factor"));"specular_slope"in g||(g.specular_slope=.2,c("material",g,"specular_slope"));"specular_toon_size"in g||(g.specular_toon_size=
.5,c("material",g,"specular_toon_size"));"specular_toon_smooth"in g||(g.specular_toon_smooth=.1,c("material",g,"specular_toon_smooth"));"specular_alpha"in g||(g.specular_alpha=1,c("material",g,"specular_alpha"));"b4w_wettable"in g||(g.b4w_wettable=!1,c("material",g,"b4w_wettable"));"b4w_refractive"in g||(g.b4w_refractive=!1,c("material",g,"b4w_refractive"));"b4w_refr_bump"in g||(g.b4w_refr_bump=0,c("material",g,"b4w_refr_bump"));"b4w_shallow_water_col"in g||(g.b4w_shallow_water_col=[0,.8,.3],c("material",
g,"b4w_shallow_water_col"));"b4w_shore_water_col"in g||(g.b4w_shore_water_col=[0,.9,.2],c("material",g,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in g||(g.b4w_shallow_water_col_fac=1,c("material",g,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in g||(g.b4w_shore_water_col_fac=.5,c("material",g,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in g||(g.b4w_water_sss_strength=5.9,c("material",g,"b4w_water_sss_strength"));"b4w_water_sss_width"in g||(g.b4w_water_sss_width=.45,c("material",
g,"b4w_water_sss_width"));"b4w_render_above_all"in g||(g.b4w_render_above_all=!1,c("material",g,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in g||(g.b4w_water_norm_uv_velocity=.05,c("material",g,"b4w_water_norm_uv_velocity"));"specular_ior"in g||(g.specular_ior=1,c("material",g,"specular_ior"));"darkness"in g||(g.darkness=0,c("material",g,"darkness"));"diffuse_toon_size"in g||(g.diffuse_toon_size=0,c("material",g,"diffuse_toon_size"));"diffuse_toon_smooth"in g||(g.diffuse_toon_smooth=0,c("material",
g,"diffuse_toon_smooth"));d=g.texture_slots;for(q=0;q<d.length;q++)n=d[q],"blend_type"in n||(n.blend_type="MIX",c("texture_slot",n,"blend_type"));if(g.node_tree){d=g.node_tree.nodes;for(q=0;q<d.length;q++)e(d[q]);g.node_tree.animation_data&&b(g.node_tree.animation_data)}}n=a.node_groups;for(h=0;h<n.length;h++)for(d=n[h].node_tree.nodes,q=0;q<d.length;q++)e(d[q]);d=a.objects;for(h=0;h<d.length;h++){n=d[h];switch(n.type){case "MESH":"b4w_dynamic_geometry"in n||(n.b4w_dynamic_geometry=!1);"b4w_reflexible"in
n||(n.b4w_reflexible=!1);"b4w_reflexible_only"in n||(n.b4w_reflexible_only=!1);"b4w_reflective"in n||(n.b4w_reflective=!1);"b4w_reflection_type"in n||(n.b4w_reflection_type="PLANE",c("object",n,"b4w_reflection_type"));"b4w_wind_bending"in n||(n.b4w_wind_bending=!1,c("object",n,"b4w_wind_bending"));"b4w_wind_bending_angle"in n||(n.b4w_wind_bending_angle=10,n.b4w_wind_bending_freq=.25,c("object",n,"wind bending params"));"b4w_detail_bending_amp"in n||(n.b4w_detail_bending_amp=.1,n.b4w_branch_bending_amp=
.3,c("object",n,"detail bending params"));"b4w_detail_bending_freq"in n||(n.b4w_detail_bending_freq=1,c("object",n,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in n||(n.b4w_main_bend_stiffness_col="",c("object",n,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in n||(n.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},c("object",n,"b4w_detail_bend_colors"));"b4w_caustics"in n||(n.b4w_caustics=!1);"vertex_groups"in n&&n.vertex_groups.length&&
n.data&&0==n.data.vertex_groups.length&&(n.data.vertex_groups=n.vertex_groups,delete n.vertex_groups,c("object",n,"vertex_groups"));"b4w_vertex_anim"in n&&n.b4w_vertex_anim.length&&n.data&&0==n.data.b4w_vertex_anim.length&&(n.data.b4w_vertex_anim=n.b4w_vertex_anim,delete n.b4w_vertex_anim,c("object",n,"b4w_vertex_anim"));"b4w_do_not_render"in n||(n.b4w_do_not_render=!1);"use_ghost"in n.game||(n.game.use_ghost=!1);"use_sleep"in n.game||(n.game.use_sleep=!1);"velocity_min"in n.game||(n.game.velocity_min=
0);"velocity_max"in n.game||(n.game.velocity_max=0);"collision_group"in n.game||(n.game.collision_group=1);"collision_mask"in n.game||(n.game.collision_mask=255);"b4w_vehicle_settings"in n?n.b4w_vehicle_settings&&("steering_ratio"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.steering_ratio=10),"steering_max"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.steering_max=1),"inverse_control"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.inverse_control=!1),"force_max"in n.b4w_vehicle_settings||
(n.b4w_vehicle_settings.force_max=1500),"brake_max"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.brake_max=100),"speed_ratio"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in
n.b4w_vehicle_settings||(n.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.floating_factor=
3),"floating_factor"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in n.b4w_vehicle_settings||(n.b4w_vehicle_settings.water_rot_damp=.9)):(n.b4w_vehicle_settings=null,c("object",n,"b4w_vehicle_settings"));"b4w_floating_settings"in n?n.b4w_floating_settings&&("floating_factor"in n.b4w_floating_settings||(n.b4w_floating_settings.floating_factor=3),"water_lin_damp"in n.b4w_floating_settings||
(n.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in n.b4w_floating_settings||(n.b4w_floating_settings.water_rot_damp=.8)):(n.b4w_floating_settings=null,c("object",n,"b4w_floating_settings"));"b4w_character_settings"in n?n.b4w_character_settings&&("walk_speed"in n.b4w_character_settings||(n.b4w_character_settings.walk_speed=4),"run_speed"in n.b4w_character_settings||(n.b4w_character_settings.run_speed=8),"step_height"in n.b4w_character_settings||(n.b4w_character_settings.step_height=.25),
"jump_strength"in n.b4w_character_settings||(n.b4w_character_settings.jump_strength=5),"waterline"in n.b4w_character_settings||(n.b4w_character_settings.waterline=0)):(n.b4w_character_settings=null,c("object",n,"b4w_character_settings"));"b4w_selectable"in n||(n.b4w_selectable=!1,c("object",n,"b4w_selectable"));"b4w_outlining"in n||(n.b4w_outlining=!1,c("object",n,"b4w_outlining"));"b4w_outline_on_select"in n||(n.b4w_outline_on_select=!1,c("object",n,"b4w_outline_on_select"));"b4w_billboard"in n||
(n.b4w_billboard=!1,c("object",n,"b4w_billboard"));"b4w_billboard_geometry"in n||(n.b4w_billboard_geometry="SPHERICAL",c("object",n,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in n||(n.b4w_pres_glob_orientation=!1,c("object",n,"b4w_pres_glob_orientation"));"b4w_outline_settings"in n||("b4w_glow_settings"in n?n.b4w_outline_settings=n.b4w_glow_settings:(n.b4w_outline_settings={},n.b4w_outline_settings.outline_duration=1,n.b4w_outline_settings.outline_period=1,n.b4w_outline_settings.outline_relapses=
0),c("object",n,"b4w_outline_settings"));"b4w_lod_transition"in n||(n.b4w_lod_transition=.01,c("object",n,"b4w_lod_transition"));"lod_levels"in n||(n.lod_levels=[],c("object",n,"lod_levels"));"b4w_animation_mixing"in n||(n.b4w_animation_mixing=!1,c("object",n,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in n||(n.b4w_anchor=null,c("object",n,"b4w_anchor")),!n.b4w_anchor||"max_width"in n.b4w_anchor||(n.b4w_anchor.max_width=250)}"collision_margin"in n.game||(n.game.collision_margin=.04,c("object",
n,"collision_margin"));"b4w_anim_behavior"in n||(n.b4w_anim_behavior=n.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",c("object",n,"b4w_anim_behavior"));if(!("rotation_quaternion"in n)){q=[0,0,0,1];l.euler_to_quat(n.rotation_euler,q);var f=q,g=q[0],r=q[1],D=q[2];f[0]=q[3];f[1]=g;f[2]=r;f[3]=D;n.rotation_quaternion=q;c("object",n,"rotation_quaternion")}"webgl_do_not_batch"in n&&(n.b4w_do_not_batch=n.webgl_do_not_batch)&&m("object",n,"webgl_do_not_batch");"b4w_shadow_cast_only"in n||(n.b4w_shadow_cast_only=
!1,c("object",n,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in n||(n.b4w_correct_bounding_offset="AUTO",c("object",n,"b4w_correct_bounding_offset"));f=n.particle_systems;for(q=0;q<f.length;q++)g=f[q],r=g.settings,"use_rotation_dupli"in r||(r.use_rotation_dupli=!1,c("particle_settings",r,"use_rotation_dupli")),"use_whole_group"in r||(r.use_whole_group=!1,c("particle_settings",r,"use_whole_group")),g.transforms||(g.transforms=new Float32Array,c("particle_system",g,"transforms")),"b4w_billboard_align"in
r||(r.b4w_billboard_align="VIEW",c("particle_settings",r,"b4w_billboard_align")),"b4w_dynamic_grass"in r||(r.b4w_dynamic_grass=!1,c("object",r,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in r||(r.b4w_dynamic_grass_scale_threshold=.01,c("object",r,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in r||(r.b4w_initial_rand_rotation=!1,c("particle_settings",r,"b4w_initial_rand_rotation")),"b4w_rotation_type"in r||(r.b4w_rotation_type="Z",c("particle_settings",r,"b4w_rotation_type")),
"b4w_rand_rotation_strength"in r||(r.b4w_rand_rotation_strength=1,c("particle_settings",r,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in r||(r.b4w_hair_billboard=!1,c("particle_settings",r,"b4w_hair_billboard")),"b4w_hair_billboard_type"in r||(r.b4w_hair_billboard_type="BASIC",c("particle_settings",r,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in r||(r.b4w_hair_billboard_jitter_amp=0,c("particle_settings",r,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in
r||(r.b4w_hair_billboard_jitter_freq=0,c("particle_settings",r,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in r||(r.b4w_hair_billboard_geometry="SPHERICAL",c("particle_settings",r,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in r||(r.b4w_wind_bend_inheritance="PARENT",c("particle_settings",r,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in r||(r.b4w_shadow_inheritance="PARENT",c("particle_settings",r,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in
r||(r.b4w_reflection_inheritance="PARENT",c("particle_settings",r,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in r||(r.b4w_vcol_from_name="",c("particle_settings",r,"b4w_vcol_from_name")),"b4w_vcol_to_name"in r||(r.b4w_vcol_to_name="",c("particle_settings",r,"b4w_vcol_to_name")),"b4w_coordinate_system"in r||(r.b4w_coordinate_system="LOCAL",c("particle_settings",r,"b4w_coordinate_system")),"b4w_allow_nla"in r||(r.b4w_allow_nla=!0,c("particle_settings",r,"b4w_allow_nla")),"b4w_enable_soft_particles"in
r||(r.b4w_enable_soft_particles=!1,c("particle_settings",r,"b4w_enable_soft_particles")),"b4w_particles_softness"in r||(r.b4w_particles_softness=1,c("particle_settings",r,"b4w_particles_softness")),"billboard_tilt"in r||(r.billboard_tilt=0,c("particle_settings",r,"billboard_tilt")),"billboard_tilt_random"in r||(r.billboard_tilt_random=0,c("particle_settings",r,"billboard_tilt_random"));"constraints"in n||(n.constraints=[],c("object",n,"constraints"));f=n.modifiers;for(q=0;q<f.length;q++){a:{g=f[q];
switch(g.type){case "ARRAY":if(!("fit_type"in g)){y.error("WARNING Incomplete modifier "+String(g.type)+' for "'+n.name+'", reexport "'+a.b4w_filepath_blend+'" scene');g=!1;break a}}g=!0}g||(f.splice(q,1),q--)}"animation_data"in n||(n.animation_data={action:null,nla_tracks:[]},c("object",n,"animation_data"));n.animation_data&&("action"in n.animation_data||(n.animation_data.action=null,k("no action in animation data "+n.name)),"nla_tracks"in n.animation_data||(n.animation_data.nla_tracks=[],k("no NLA in animation data "+
n.name)),b(n.animation_data));"b4w_collision_id"in n||(n.b4w_collision_id="",c("object",n,"b4w_collision_id"));"b4w_viewport_alignment"in n||(n.b4w_viewport_alignment=null,c("object",n,"b4w_viewport_alignment"));"pinverse_tsr"in n||(n.pinverse_tsr=null,c("object",n,"pinverse_tsr"));(0>n.scale[0]||0>n.scale[1]||0>n.scale[2])&&k('negative scale for object "'+n.name+'", can lead to some errors');q=n.scale;0==q[0]&&0==q[1]&&0==q[2]?q=!0:(f=Math.abs((q[1]-q[2])/q[1]),q=.005>Math.abs((q[0]-q[1])/q[0])&&
.005>f);q||k("non-uniform scale for object "+n.name)}for(var p in H)h=H[p],q=p.match(/.*?(?=>>|$)/i)[0],y.warn('Property "'+String(q)+'" is '+h.gy+' for "'+h.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.OC=function(a,b){"num_channels"in a||(a.num_channels=1,k('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.fC=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var e=b[c].type;if("ARRAY"==e||"CURVE"==e){b=!0;break a}}b=!1}if(!b)return null;
b=r(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var d=a[c];switch(d.type){case "ARRAY":for(var e=b,k=d,m=0,C=0,D=0,p=new Float32Array(16),d=[],y=1;y<k.count;y++){k.use_constant_offset&&(m+=k.constant_offset_displace[0],C+=k.constant_offset_displace[1],D+=k.constant_offset_displace[2]);if(k.use_relative_offset)var K=e.b4w_bounding_box,m=m+(K.max_x-K.min_x)*k.relative_offset_displace[0],C=C+(K.max_y-K.min_y)*k.relative_offset_displace[1],D=D+(K.max_z-K.min_z)*k.relative_offset_displace[2];
l.CJ(m,C,D,p);for(var w=K=r(e),t=p,A=0;A<w.submeshes.length;A++){var N=w.submeshes[A];l.bk(N.position,t,N.position,0);l.LK(N.normal,t,N.normal);l.zJ(N.tangent,t,N.tangent)}d.push(K)}for(y=0;y<d.length;y++)for(k=e,m=d[y],C=0;C<k.submeshes.length;C++){D=k.submeshes[C];p=m.submeshes[C];K=D.base_length;w=D.indices.length;D.base_length+=p.base_length;for(var P in D)if("base_length"!=P)if("indices"==P)for(D[P]=l.HJ(D[P],p[P]),t=w;t<D.indices.length;t++)D.indices[t]+=K;else"vertex_colors"!=P&&(D[P]=l.NE(D[P],
p[P]))}break;case "CURVE":for(var e=b,y=q.OD(d.object),k=new Float32Array(16),C=y.Kg?4:3,m=new Float32Array(C),C=new Float32Array(C),D=new Float32Array(3),p=new Float32Array(4),K=new Float32Array(4),w=new Float32Array(3),t=new Float32Array(3),A=new Float32Array(3),N=new Float32Array(4),B=new Float32Array(4),H=0;H<e.submeshes.length;H++){var M=e.submeshes[H],U=M.position,ea=M.normal,M=M.tangent,Y;a:switch(Y=d.deform_axis,Y){case "POS_X":case "NEG_X":Y=0;break a;case "POS_Y":case "NEG_Y":Y=1;break a;
case "POS_Z":case "NEG_Z":Y=2;break a;default:throw"Wrong deform axis value "+Y;}w[0]=0;w[1]=0;w[2]=0;w[Y]=1;for(var ka=q.mJ(y),ga=0;ga<U.length/3;ga++){A[0]=U[3*ga];A[1]=U[3*ga+1];A[2]=U[3*ga+2];var ma=A[Y],ba=q.lJ(y,ma);q.nJ(y,ba,m);D[0]=m[0];D[1]=m[1];D[2]=m[2];q.kJ(y,ba,C);t[0]=C[0];t[1]=0;t[2]=C[2];n.normalize(t,t);f.rotationTo(w,t,p);0>ma?(m[0]=t[0],m[1]=t[1],m[2]=t[2],n.scale(m,ma,m),n.add(D,m,D)):ma>ka&&(m[0]=t[0],m[1]=t[1],m[2]=t[2],n.scale(m,ma-ka,m),n.add(D,m,D));g.fromRotationTranslation(p,
D,k);y.Kg&&(f.setAxisAngle(w,m[3],K),n.transformQuat(A,K,A));A[Y]=0;n.transformMat4(A,k,A);U[3*ga]=A[0];U[3*ga+1]=A[1];U[3*ga+2]=A[2];ea.length&&(N[0]=ea[3*ga],N[1]=ea[3*ga+1],N[2]=ea[3*ga+2],N[3]=0,u.transformMat4(N,k,N),ea[3*ga]=N[0],ea[3*ga+1]=N[1],ea[3*ga+2]=N[2]);M.length&&(B[0]=M[3*ga],B[1]=M[3*ga+1],B[2]=M[3*ga+2],B[3]=0,u.transformMat4(B,k,B),M[3*ga]=B[0],M[3*ga+1]=B[1],M[3*ga+2]=B[2])}}}h.RH(b)}return b};a.CD=function(){return{name:"DEFAULT",uuid:l.hr(),use_nodes:!1,diffuse_shader:"LAMBERT",
diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,
b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,
b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.mC=function(a,b){function c(b,d){for(var f in b){var e=b[f],g=e[0];if(1<e.length)for(var k=1;k<e.length;k++)g+="*"+e[k];for(k=0;k<a.length;k++)if(e=a[k],e.name==g)for(var h in d)e[h]=d[h]}}for(var f=b.b4w_logic_nodes,d=0;d<f.length;d++)for(var e=f[d],g=0;g<e.length;g++){var h=e[g],l={register1:"variable1",register2:"variable2",registerd:"variabled"},n;for(n in l)n in h&&(h[l[n]]=h[n]);for(var m in h.variables)"boolean"!=typeof h.variables[m][0]&&
(h.variables[m]=[!1,h.variables[m]]);0<=["MATH","CONDJUMP","PAGEPARAM","REGSTORE"].indexOf(h.type)&&("variable1"in h&&(h.variables.v1=[!1,h.variable1]),"variable2"in h&&(h.variables.v2=[!1,h.variable2]),"variabled"in h&&(h.variables.vd=[!1,h.variabled]));switch(h.type){case "SELECT":for(var q=0;q<a.length;q++)l=a[q],l.name==h.object&&(l.b4w_selectable=!0);h.bools||(h.bools={});h.bools.not_wait||(h.bools.not_wait=!1);k('Logic nodes type "SELECT" is deprecated');break;case "SWITCH_SELECT":c(h.objects_paths,
{b4w_selectable:!0});if(h.links instanceof Array){k('Format of a "SWITCH_SELECT" node is outdated. It is recommended to reexport the scene "'+b.name+'"');var l={},r=0;for(q in h.objects_paths)l[q]=h.links[r],r++;h.links=l}break;case "SELECT_PLAY":k('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport the scene "'+b.name+'"');h.mute=!0;break;case "SELECT_PLAY_ANIM":k('Logic nodes type "SELECT_PLAY_ANIM" is deprecated');break;case "SHOW":case "HIDE":case "SET_SHADER_NODE_PARAM":case "INHERIT_MAT":c(h.objects_paths,
{b4w_do_not_batch:!0});break;case "PLAY":b.b4w_use_nla=!0;break;case "MOVE_TO":c(h.objects_paths,{b4w_do_not_batch:!0});break;case "TRANSFORM_OBJECT":c(h.objects_paths,{b4w_do_not_batch:!0});break;case "OUTLINE":c(h.objects_paths,{b4w_outlining:!0});break;case "CONDJUMP":h.condition&&(h.common_usage_names.condition=h.condition);if("cnd"in h.floats)h.common_usage_names.condition=h.floats.cnd;else switch(h.common_usage_names.condition){case "GEQUAL":h.common_usage_names.condition=A.au;break;case "LEQUAL":h.common_usage_names.condition=
A.cu;break;case "GREATER":h.common_usage_names.condition=A.bu;break;case "LESS":h.common_usage_names.condition=A.du;break;case "NOTEQUAL":h.common_usage_names.condition=A.eu;break;case "EQUAL":h.common_usage_names.condition=A.$t}void 0!=h.number1&&(h.input1=h.number1);void 0!=h.number2&&(h.input2=h.number2);h.bools||(h.bools={});void 0===h.bools.str&&(h.bools.str=!1,h.floats.inp1=h.input1,h.floats.inp2=h.input2);break;case "SEND_REQ":h.bools||(h.bools={});h.strings||(h.strings={});void 0===h.bools.ct&&
(h.bools.ct=!1);void 0!=h.url&&(h.bools.url=!1,h.strings.url=h.url);break;case "MATH":void 0!=h.number1&&(h.input1=h.number1);void 0!=h.number2&&(h.input2=h.number2);void 0!=h.input1&&(h.floats.inp1=h.input1);void 0!=h.input2&&(h.floats.inp2=h.input2);break;case "REGSTORE":h.floats||(h.floats={});h.strings||(h.strings={});void 0!=h.number1&&(h.input1=h.number1);if(void 0!=h.input1)switch(typeof h.input1){case "number":h.floats.inp1=h.input1;h.common_usage_names.variable_type="NUMBER";break;default:h.strings.inp1=
h.input1,h.common_usage_names.variable_type="STRING"}switch(h.common_usage_names.variable_type){case "NUMBER":h.common_usage_names.variable_type=A.AA;break;case "STRING":h.common_usage_names.variable_type=A.BA}break;case "PAGEPARAM":h.bools||(h.bools={});void 0===h.bools.hsh&&(h.bools.hsh=!1);h.floats||(h.floats={});void 0===h.floats.ptp&&(h.floats.ptp=0);break;case "PLAY_ANIM":c(h.objects_paths,{b4w_do_not_batch:!0});h.bools||(h.bools={});void 0===h.bools.env&&(h.bools.env=!1);break;case "STOP_ANIM":h.bools||
(h.bools={});void 0===h.bools.env&&(h.bools.env=!1);break;case "STRING":if("cnd"in h.floats)h.common_usage_names.condition=h.floats.cnd;else switch(h.common_usage_names.condition){case "GEQUAL":h.common_usage_names.condition=A.au;break;case "LEQUAL":h.common_usage_names.condition=A.cu;break;case "GREATER":h.common_usage_names.condition=A.bu;break;case "LESS":h.common_usage_names.condition=A.du;break;case "NOTEQUAL":h.common_usage_names.condition=A.eu;break;case "EQUAL":h.common_usage_names.condition=
A.$t}break;case "REDIRECT":void 0!=h.url&&(h.bools.url=!1,h.strings.url=h.url);break;case "ENTRYPOINT":h.bools||(h.bools={});void 0===h.bools.js&&(h.bools.js=!1);h.bools.js&&(h.mute=!0);break;case "JS_CALLBACK":for(n in h=h.common_usage_names.js_cb_params,h)switch(h[n]){case "OBJECT":h[n]=A.yA;break;case "VARIABLE":h[n]=A.zA}}}}};b4w.module.__scenegraph=function(a,p){function e(a){var b=a.qd;a.qd=null;var c=ua.za(a);c.qd=b;a.qd=b;c.Zd=null;c.Db=null;c.od=null;return c}function b(a,b){var f=[];I.Ce(a,function(b,c,e){-1<f.indexOf(e)?I.$H(a,b,c,e,d(e)):f.push(e)});I.ea(a,function(c,e){for(var g=0;g<e.pa.length;g++){var k=e.pa[g];b||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&"MAIN_XRAY"!=e.type||(k.me=!0);-1<f.indexOf(k)?e.pa[g]=d(k):f.push(k)}"ANTIALIASING"==e.type&&I.De(a,c,function(a,b){if("MOTION_BLUR"==b.type)for(var c=
0;c<b.pa.length;c++){var d=b.pa[c];d.ua=W.A;d.sa=W.A}});b||I.De(a,c,function(a,b,c){"DEPTH"==c.from&&(c.me=!0)})});I.ea(a,function(b){var d={};c(a,b,d);for(var f in d){b=d[f];for(var e=b[0],g=0;g<b.length;g++)if(b[g].ua==W.A){e=b[g];break}for(var k=b[0],g=0;g<b.length;g++)if(b[g].sa==W.A){k=b[g];break}for(var h=b[0],g=0;g<b.length;g++)if(!b[g].me){h=b[g];break}for(g=0;g<b.length;g++)b[g].ua=e.ua,b[g].sa=k.sa,b[g].me=h.me}})}function c(a,b,d){I.De(a,b,function(b,f,e){e.Bb&&e.from==e.to&&(d[e.from]=
d[e.from]||[],-1==d[e.from].indexOf(e)&&d[e.from].push(e),c(a,b,d))});I.ih(a,b,function(a,b,c){c.Bb&&(d[c.from]=d[c.from]||[],-1==d[c.from].indexOf(c)&&d[c.from].push(c))});b=I.Ka(a,b);if("MOTION_BLUR"==b.type)for(var f=0;f<b.pa.length;f++){var e=b.pa[f];d[e.from].push(e)}}function m(a){var b=["MOTION_BLUR","SMAA_RESOLVE","SMAA_NEIGHBORHOOD_BLENDING","MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"],c=I.xt(a),d=[];I.ea(c,function(a,f){for(var e=0;e<f.pa.length;e++){var l=f.pa[e];-1<b.indexOf(f.type)&&(l.qp=
!0);var n=g(d,l,k(l));l.Aa=n;f.hf[e]=n}for(e=0;e<f.hf.length;e++)n=f.hf[e],q(d,n);I.ih(c,a,function(e,l,n){-1<b.indexOf(f.type)&&(n.qp=!0);n.Aa||((e=r(c,a,n.from))&&n.Bb&&!n.Aa?h(d,e):e=g(d,n,k(n)),n.Aa=e)});I.De(c,a,function(a,b,c){q(d,c.Aa)});I.ih(c,a,function(a,b,c){c.Aa&&"NONE"==c.to&&q(d,c.Aa)})})}function k(a){a=ua.Kh(a);delete a.to;delete a.Bb;delete a.Aa;return JSON.stringify(a)}function r(a,b,c){var d=null;I.De(a,b,function(a,b,f){if(f.Bb&&f.from==f.to&&f.from==c&&f.Aa)return d=f.Aa,!0});
I.ih(a,b,function(a,b,f){if(f.Bb&&f.from==c&&f.Aa)return d=f.Aa,!0});return d}function h(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tt===b&&d.hm++}}function q(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tt===b&&d.hm&&d.hm--}}function g(a,b,c){if(b.am)return h(a,b.am.Aa),b.am.Aa;if(b.qp)return y(b);for(var d=null,f=0;f<a.length;f++){var e=a[f];if(e.id==c&&0===e.hm){d=e;break}}if(d&&!Da.UG)return d.hm++,d.tt;b=y(b);a.push({id:c,hm:1,tt:b});return b}function y(a){var b=a.Ei*a.size,c=a.Fi*a.size;
switch(a.from){case "COLOR":if(a.me){var d=W.ll("COLOR_RB",a.Pj?W.Wm:W.Vm);W.resize(d,b,c)}else d=W.ll("COLOR",W.vh),W.resize(d,b,c),W.Rs(d,a.ua,a.sa);return d;case "DEPTH":return a.me?(d=W.ll("DEPTH_RB",a.Pj?W.Um:W.Tm),W.resize(d,b,c)):(d=W.ll("DEPTH_TEX",W.Ti),W.resize(d,b,c),W.Rs(d,a.ua,a.sa)),d;case "CUBEMAP":return d=W.tD(b);case "SCREEN":case "NONE":return null;default:throw"Wrong slink param: "+a.from;}}function f(a,b){var c=!1;I.Ce(a,function(d,f,e){if(e&&(d=I.Ka(a,d),f=I.Ka(a,f),b(e,!1,d,
f)))return c=!0});c||I.ea(a,function(a,c){for(var d=0;d<c.pa.length;d++)if(b(c.pa[d],!0,c,null))return!0})}function l(a){I.ea(a,function(b,c){if("SINK"!=c.type){var d=c.j;I.ih(a,b,function(a,b,c){c.Bb&&c.Aa&&(X.Yo(d,c.from,c.Aa),c.from==c.to&&b.j&&X.Yo(b.j,c.from,c.Aa))});for(var f=0;f<c.pa.length;f++){var e=c.pa[f];e.Bb&&e.from==e.to&&X.Yo(d,e.from,c.hf[f])}!d.Db&&!d.od||d.Zd||(d.Zd=qa.ZH(d.Db,d.od))}});I.ea(a,function(b,c){if("RESOLVE"==c.type||"COPY"==c.type){var d=V(a,c);c.j.er=d[0].j.Zd}})}function n(a){var b=
null,c=0;I.ea(a,function(a,d){if(d.type==ja.xJ){if(c==ja.wJ)return b=d,!0;c++}});return b}function u(a,b){var c=I.Ze(a,b),d=J("NONE"),f=I.B(a,d),e=I.Jl(a)[0];I.Ce(a,function(b,c){c==e&&I.dy(a,b,e,b,f)});I.Ce(a,function(f,e,g){if(f==c)return I.m(a,b,d,G(ja.bJ,"u_color",g.size,g.Ei,g.Fi,g.wm)),!0});I.rc(a,f,e,G("SCREEN","NONE",.5,.5,.5,!0))}function A(a,b,c){var f=c.M,e=b.antialiasing,g=b.Aw,k=b.bf.af,h=b.bf.Mo,l,n,m;g&&e?I.ea(a,function(b,c){if("ANTIALIASING"==c.type){var d=L(a,c,"COMPOSITING");l=
d?I.LF(a,d):b}else"COMPOSITING"==c.type&&(l=b)}):l=I.Jl(a)[0];I.De(a,l,function(b,c){if(da(a,c,"MAIN_OPAQUE"))return n=b,m=c,!0});for(var e=I.fp(a,n,I.Mm),q=[],r=[],t=[],e=I.clone(e,function(b){var d;if(-1<Ha.indexOf(b.type))r.push(b),d=b;else{d=z(b);if("MAIN_PLANE_REFLECT"==d.type)for(var e=0;e<k.length;e++)if(k[e][0]==b){k[e]=[b,d];d.j.Zb=b.j.Zb;c.M.push(d.j);break}if("MAIN_PLANE_REFLECT_BLEND"==b.type)for(e=0;e<k.length;e++){if(h[e][0]==b){h[e]=[b,d];d.j=k[e][1].j;break}}else-1<f.indexOf(b.j)&&
(g?(X.so(b.j,X.dd),X.so(d.j,X.ed)):(X.so(b.j,X.Hb),X.so(d.j,X.Mb)),f.push(d.j));var l=I.Ze(a,b);I.De(a,l,function(a,b,c){-1<Ha.indexOf(b.type)&&q.push([b,d,c])});for(e=0;e<b.pa.length;e++)d.pa[e].am=b.pa[e];b=!0;for(e=0;e<I.$n(a,l);e++){var n=I.vj(a,l,e),n=I.Ka(a,n);-1==Ha.indexOf(n.type)&&(b=!1)}b&&t.push(d)}return d},function(a){var b=d(a,!0);b.am=a;return b}),C=0;C<r.length;C++)I.df(e,I.Ze(e,r[C]));I.tq(e);var V=aa(g),C=I.B(a,V);I.dy(a,n,l,C,l);b=fa();I.B(a,b);var x=G("COLOR","COPY",1,1,1,!0);
I.m(a,m,b,x);var p=G("COLOR","u_sampler_left",1,1,1,!0);p.qp=!0;p.ua=W.A;p.sa=W.A;I.m(a,b,V,p);V=G("COLOR","u_sampler_right",1,1,1,!0);V.ua=W.A;V.sa=W.A;V.am=x;I.ZB(e,a,[I.Jl(e)[0],C,V]);for(C=0;C<q.length;C++)I.m(a,q[C][0],q[C][1],q[C][2]);e=G("SCREEN","NONE",0,0,0,!1);for(C=0;C<t.length;C++)I.m(a,b,t[C],e);g&&B(a,.5,1)}function B(a,b,c){var d=[];I.ea(a,function(b,c){if(-1==Ha.indexOf(c.type)&&c.pa.length&&la(a,c,"STEREO"))for(var f=0;f<c.pa.length;f++){var e=c.pa[f];-1==d.indexOf(e)&&d.push(e)}});
I.Ce(a,function(b,c,f){b=I.Ka(a,b);c=I.Ka(a,c);-1==Ha.indexOf(b.type)&&la(a,c,"STEREO")&&-1==d.indexOf(f)&&d.push(f)});for(var f=0;f<d.length;f++)d[f].Ei*=b,d[f].Fi*=c}function H(a,b){a.Bo=b;a.Pr=new Float32Array(3*b);a.no=new Float32Array(3*b);a.mo=new Float32Array(3*b);a.Qr=new Float32Array(0==b%2?2*b:2*b+2)}function v(a,b,c,d){var f=E("SHADOW_CAST");f.Eq=a;f.self_shadow_polygon_offset=c.self_shadow_polygon_offset;f.ze=b;switch(c.ue[b]){case "SPOT":case "POINT":f.j=X.Ob(X.pc);a=ua.rad_to_deg(c.Jy[b]);
X.Zo(f.j,a,.1,2*c.Bv[b]);break;default:f.j=X.Ob(X.wh)}H(f,d);return f}function E(a){a={type:a,hb:"",Ga:!1,Lx:!1,Wp:!1,xo:!1,pl:0,zf:0,Dn:[],time:0,j:null,Ph:null,nl:[],v:[],pa:[],hf:[],ng:new Float32Array(3),Vz:new Float32Array(3),Nc:new Float32Array(3),zc:new Float32Array(4),Xd:new Float32Array(4),md:new Float32Array(16),By:0,Ef:0,Bo:0,Pr:null,no:null,mo:null,Qr:null,be:new Float32Array(3),ne:new Float32Array(3),Cy:new Float32Array(4),Sy:new Float32Array([0,0,0]),nt:new Float32Array(3),Ty:new Float32Array(4),
Ay:new Float32Array(3),Wl:0,Tq:0,Pl:!1,Xf:new Float32Array(3),qh:0,oq:0,Ie:null,Mt:0,Nt:0,rh:0,uf:!1,Uu:0,Vu:new Float32Array(2),Tu:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,kk:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,pk:0,nk:0,mk:0,Ly:0,ssao_only:0,ssao_white:0,brightness:0,
contrast:0,exposure:0,saturation:0,god_rays_intensity:0,Ij:0,So:0,uk:0,Eq:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,xp:null,wp:null,Ht:null,ui:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,dq:0,Zq:0,mb_decay_threshold:0,mb_factor:0,nx:0,No:"",rG:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,ut:new Float32Array(2),tb:new Float32Array(2),Sh:new Float32Array(4),chromatic_aberration_coefs:new Float32Array(4),enable_hmd_stereo:!1,
ze:0,Ib:!0,enqueue:!0,Fa:!0,Ha:!0,tc:!0,ia:!0,ig:1};a.tb[0]=1;a.tb[1]=1;a.Sh[2]=.5;a.Sh[3]=0;return a}function z(a){var b=a.j;a.j=null;var c=ua.za(a);a.j=b;c.j=e(b);return c}function G(a,b,c,d,f,e){return{from:a,to:b,size:c,Ei:d,Fi:f,wm:e,Bb:!0,Aa:null,Pj:!1,me:!1,ua:W.oe,sa:W.oe,qp:!1}}function d(a,b){if(b){var c=a.Aa;a.Aa=null}a.Aa&&ua.da("Failed to clone slink with attached texture");var d=ua.Kh(a);b&&(a.Aa=c,d.Aa=c);return d}function F(){var a=E("GRASS_MAP");a.j=X.Ob(X.sg);return a}function J(a){var b=
E("POSTPROCESSING");b.Fa=!1;b.Ha=!1;b.tc=!1;b.j=X.Ob(X.Tb);b.No=a;switch(a){case "NONE":b.tb[0]=1;b.tb[1]=1;break;case "GRAYSCALE":b.tb[0]=1;b.tb[1]=1;break;case "X_BLUR":b.tb[0]=1;b.tb[1]=0;break;case "Y_BLUR":b.tb[0]=0;b.tb[1]=1;break;case "X_GLOW_BLUR":b.tb[0]=1;b.tb[1]=0;break;case "Y_GLOW_BLUR":b.tb[0]=0;b.tb[1]=1;break;case "X_EXTEND":b.tb[0]=1;b.tb[1]=0;break;case "Y_EXTEND":b.tb[0]=0;b.tb[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function C(a){var b=E("BLOOM_BLUR");
b.Fa=!1;b.Ha=!1;b.tc=!1;b.j=X.Ob(X.Tb);b.No=a;switch(a){case "X_BLUR":b.tb[0]=1;b.tb[1]=0;break;case "Y_BLUR":b.tb[0]=0;b.tb[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}return b}function D(a,b){var c=E("GLOW_COMBINE");c.Fa=!1;c.Ha=!1;c.tc=!1;c.small_glow_mask_coeff=b.Hg.small_glow_mask_coeff;c.large_glow_mask_coeff=b.Hg.large_glow_mask_coeff;c.small_glow_mask_width=b.Hg.small_glow_mask_width;c.large_glow_mask_width=b.Hg.large_glow_mask_width;c.j=a;return c}function O(a,
b,c,d,f,e,g,k,h){var l=E("MAIN_"+a);if("OPAQUE"===a)l.Fa=!0,l.Ha=c,l.Ga=!1;else if("BLEND"===a)l.Fa=!1,l.Ha=!1,l.Ga=!0;else if("XRAY"===a)l.Fa=!1,l.Ha=!0,l.Ga=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)l.Fa=!0,l.Ha=!0,l.Ga=!1;else if("PLANE_REFLECT_BLEND"===a||"CUBE_REFLECT_BLEND"===a)l.Fa=!1,l.Ha=!1,l.Ga=!0;else if("GLOW"===a)l.Fa=!0,l.Ha=!1,l.Ga=!0;else throw"wrong main subscene type";l.Ga&&k&&(l.self_shadow_normal_offset=k.self_shadow_normal_offset);l.j=b;if(a=g.at)l.Cy.set([a.uC,a.cG,
a.XK,a.WK]),l.Ay.set(a.color),l.By=a.Ta;l.be.set(g.be);l.ne.set(g.ne);l.Ef=g.Ef;l.zc=e.zc;l.Xd=e.Xd;d&&(l.Sb=d,d.zc&&(l.Ie=new Float32Array(d.zc)),l.Mt=d.waves_height,l.Nt=d.waves_length,l.rh=d.rh,d.uf&&h&&(l.uf=!0,l.Uu=d.LC,l.Tu=d.KC,l.Vu.set(d.MC)));H(l,f);return l}function T(){var a=E("RESOLVE");a.j=X.Ob(X.Tb);return a}function K(a,b,c){var d=E("COLOR_PICKING");b&&(d.type+="_XRAY",d.Fa=!1,d.Ha=!0);d.enqueue=!1;d.j=a;H(d,c);return d}function w(a){var b=E("WIREFRAME");b.Ib=!1;b.Fa=!1;b.Ha=!1;b.j=
a;return b}function t(a){var b=E("ANCHOR_VISIBILITY");b.Fa=!0;b.Ha=!1;b.j=a;return b}function Q(a,b){var c=E("SHADOW_RECEIVE");c.j=a;H(c,b);return c}function N(a){var b=E("DEPTH_PACK");b.Fa=!1;b.Ha=!1;b.j=a;return b}function P(a,b,c){var d=E("SSAO");d.Fa=!1;d.Ha=!1;d.tc=!1;d.j=a;d.zc=b.zc;d.Ie=new Float32Array(b.zc);d.pk=c.radius_increase;d.ssao_hemisphere=c.aG;d.nk=c.influence;d.mk=c.dist_factor;d.Ly=c.iI;return d}function S(a,b){var c=E("SSAO_BLUR");c.Fa=!1;c.Ha=!1;c.tc=!1;c.j=a;c.ssao_blur_depth=
b.xC;c.ssao_blur_discard_value=b.Mu;return c}function Z(a){var b=E("ANTIALIASING");b.Fa=!1;b.Ha=!1;b.tc=!1;b.ig=1/a.Vc;b.bF=a.qu;b.j=X.Ob(X.Tb);return b}function M(a,b){var c=E(a);c.Fa="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;c.Ha=!1;c.tc=!1;c.ig=1/b.Vc;c.j=X.Ob(X.Tb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(c.sG=new Float32Array(4));return c}function U(a,b,c,d){var f=E("COMPOSITING");f.Fa=!1;f.Ha=!1;f.tc=!1;f.j=X.Ob(X.Tb);f.brightness=a;f.contrast=b;f.exposure=c;f.saturation=
d;return f}function ea(a,b){var c=E("MOTION_BLUR");c.Fa=!1;c.Ha=!1;c.tc=!1;c.j=X.Ob(X.Tb);c.Wp=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function Y(a){var b=E("DOF");b.Fa=!1;b.Ha=!1;b.tc=!1;b.j=a;b.ig=b.j.dof_power;return b}function ka(a,b){var c=E("OUTLINE_MASK");c.tc=!1;c.j=a;H(c,b);return c}function ga(a){var b=E("OUTLINE");ia.outlining_overview_mode?b.Xf.set(ia.Xf):b.Xf.set(a.Xf);b.Wl=a.Wl;b.Zq=5;b.dq=3;b.tc=!1;b.j=X.Ob(X.Tb);return b}function ma(a,b,c,d,f,e,g){var k=E("GOD_RAYS");k.Fa=
!1;k.Ha=!1;k.tc=!1;k.be=new Float32Array([1,1,1]);k.ne=new Float32Array([1,1,1]);k.Ef=1;k.Lx=d;k.qh=b;k.So=f;k.Ij=c;k.uk=g;k.j=a;H(k,e);return k}function ba(a,b){var c=E("GOD_RAYS_COMBINE");c.Fa=!1;c.Ha=!1;c.tc=!1;c.j=X.Ob(X.Tb);c.god_rays_intensity=a;H(c,b);return c}function x(a,b){var c=E("SKY");c.enqueue=!1;c.Fa=!1;c.Ha=!1;c.tc=!1;var d=X.Ob(X.Tb);d.width=ta.ol;d.height=ta.ol;c.j=d;c.Ph=ua.eF();H(c,a);c.be=new Float32Array([1,1,1]);c.ne=new Float32Array([1,1,1]);c.Ef=1;c.kk.set(b.kk);c.procedural_skydome=
b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function fa(){var a=E("COPY");a.Fa=!1;a.Ha=!1;a.j=
X.Ob(X.Tb);return a}function aa(a){var b=E("STEREO");b.Fa=!1;b.Ha=!1;b.hb=a?"HMD":"ANAGLYPH";b.j=X.Ob(X.Tb);return b}function ha(){var a=E("LUMINANCE");a.Fa=!1;a.Ha=!1;a.j=X.Ob(X.Tb);return a}function Aa(){var a=E("AVERAGE_LUMINANCE");a.Fa=!1;a.Ha=!1;a.j=X.Ob(X.Tb);return a}function ca(a,b,c,d){var f=E("LUMINANCE_TRUNCED");f.Fa=!1;f.Ha=!1;f.bloom_key=a;f.bloom_edge_lum=b;f.j=d;H(f,c);return f}function R(a){var b=E("BLOOM");b.Fa=!1;b.Ha=!1;b.j=X.Ob(X.Tb);b.bloom_blur=a;return b}function xa(){var a=
E("SINK");a.enqueue=!1;return a}function la(a,b,c){if(b.type===c)return!0;b=oa(a,b);for(var d=0;d<b.length;d++)if(la(a,b[d],c))return!0;return!1}function da(a,b,c){if(b.type===c)return!0;b=V(a,b);for(var d=0;d<b.length;d++)if(da(a,b[d],c))return!0;return!1}function L(a,b,c){if(b.type===c)return b;b=V(a,b);for(var d=0;d<b.length;d++){var f=L(a,b[d],c);if(f)return f}return null}function V(a,b){var c=I.Ze(a,b);if(c==I.fu)throw"Subscene not in graph";for(var d=[],f=I.$n(a,c),e=0;e<f;e++){var g=I.vj(a,
c,e);g!=c&&d.push(I.Ka(a,g))}return d}function oa(a,b){var c=I.Ze(a,b);if(c==I.fu)throw"Subscene not in graph";for(var d=[],f=I.Rg(a,c),e=0;e<f;e++){var g=I.Fg(a,c,e);g!=c&&d.push(I.Ka(a,g))}return d}function Ca(a){var b=[],c=[];f(a,function(a){a.Aa&&-1==b.indexOf(a.Aa)&&(b.push(a.Aa),c.push(a.Aa,b.length-1))});return c}function ya(a,b){var c;c=""+(a.from+"\\n");c+="NONE"!=a.to?a.to+"\\n":"";c+="(";if(a.wm){var d=a.Ei,f=a.Fi;Math.round(d)!=d&&(d=d.toFixed(2));Math.round(f)!=f&&(f=f.toFixed(2));c+=
(1==d?"":d)+"Sx"+((1==f?"":f)+"S")}else d=a.Ei,f=a.Fi,c+=a.size*d+"x"+a.size*f;if("SCREEN"!=a.from){c+=" ";if(a.me)c+="RR";else{var d=a.ua,f=a.sa,e="";d==W.A?e+="L":d==W.oe&&(e+="N");f==W.A?e+="L":f==W.oe&&(e+="N");c+=e}for(d=0;d<b.length;d+=2)b[d]==a.Aa&&(c+=" "+b[d+1])}return c+")\\n"}var X=p("__camera"),pa=p("__config"),sa=p("__debug"),I=p("__graph"),qa=p("__renderer");p("__scenes");var W=p("__textures"),ua=p("__util"),ja=pa.Mq,Da=pa.q,ia=pa.Kb,ta=pa.ek,Ha=["GRASS_MAP","SHADOW_CAST","MAIN_CUBE_REFLECT",
"MAIN_CUBE_REFLECT_BLEND"];a.$C=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "NONE":return!1;default:return!0}};a.GJ=f;a.ID=function(a,c,f,g){function k(b){var d=e(ib);c.M.push(d);d=O(b,d,!1,B,ia,La,jb,kb,a.hg);I.B(h,d);"XRAY"==b?(I.m(h,q[0],d,G("COLOR","COLOR",1,1,1,!0)),d.pa.push(G("DEPTH","DEPTH",1,1,1,!0))):(b=bb&&"RESOLVE"==q[0].type?Xa:q[0],I.m(h,b,d,Hb),I.m(h,b,d,Dc));Ib&&(I.m(h,Ib,d,Ec),I.m(h,Ib,d,Mc));for(b=
0;b<L.length;b++)I.m(h,L[b],d,p[b]);$a&&I.m(h,$a,d,Ma);if(da.length){var f=da.length;for(b=0;b<f;b++)I.m(h,da[b],d,y[b])}if(z.length)for(b=0;b<z.length;b++)I.m(h,z[b],d,aa[b]);yb&&I.m(h,yb,d,G("COLOR","u_refractmap",1,1,1,!0));return d}var h=I.create(),q=[],r=[],L=[],p=[],da=[],y=[],z=[],aa=[],ia=a.wG,B=a.Sb,E=a.shore_smoothing,H=a.cJ,Ca=a.Zc,Ha=a.xj,ya=a.bf,la=a.aH,tb=a.wC,Xc=a.li,pa=a.bj,Cc=a.antialiasing,jb=a.Rt,La=a.Uz,kb=a.mc,Yc=a.eH,pc=a.NC,vc=a.VF,qa=a.wH,wc=a.gj,nc=a.iE,jd=a.Gc,lb=Boolean(g.length),
bb=1<Da.Dc,Dc=G("COLOR","COLOR",1,1,1,!0),Hb=G("DEPTH","DEPTH",1,1,1,!0);if(bb){d(Hb);var Fc=d(Hb);Dc.Pj=!0;Dc.me=!0;Hb.Pj=!0;Hb.me=!0}var ib=c.M[0];if(kb){X.Ct(ib,kb);for(var Ya=0;Ya<kb.ue.length;Ya++)for(var ec=kb.csm_num,ub=0;ub<ec;ub++){var xc=v(ub,Ya,kb,ia);I.B(h,xc);L.push(xc);var Ab=kb.csm_resolution,Ga=xc.j;c.yy.push(Ga);Ga.width=Ab;Ga.height=Ab;xc.Fa=!1;p.push(G("DEPTH","u_shadow_map"+(0<Ya?Ya:ub),Ab,1,1,!1));(sa.UC()||Da.Kv)&&xc.pa.push(G("COLOR","COLOR",Ab,1,1,!1))}}if(ya&&ya.Ax&&!lb)for(ub=
0;ub<ya.Ax;ub++){Ga=X.Ob(X.pc);Ga.width=a.yf;Ga.height=a.yf;X.Zo(Ga,90,.1,100);X.$g(Ga,Ga.Sa);var Bb=O("CUBE_REFLECT",Ga,!1,B,ia,La,jb,null,a.hg);Bb.Ph=ua.iF();for(Ya=0;6>Ya;Ya++)Bb.nl.push(X.wD());I.B(h,Bb);var Gc=G("CUBEMAP","u_cube_reflection",a.yf,1,1,!1);Gc.ua=W.A;Gc.sa=W.A;aa.push(Gc);if(ya.xw){var Rb=O("CUBE_REFLECT_BLEND",Ga,!1,B,ia,La,jb,null,a.hg);Rb.Ph=Bb.Ph;Rb.nl=Bb.nl;I.B(h,Rb);var pd=G("DEPTH","DEPTH",a.yf,1,1,!1),yc=G("COLOR","COLOR",a.yf,1,1,!1);I.m(h,Bb,Rb,pd);I.m(h,Bb,Rb,yc);z.push(Rb);
ya.Gq.push(Rb)}else{var qd=G("DEPTH","DEPTH",a.yf,1,1,!1);Bb.pa.push(qd);z.push(Bb)}ya.xf.push(Bb)}if(ya&&0<ya.ey.length&&!lb)for(Ya=0;Ya<ya.ey.length;Ya++)Ga=e(ib),Ga.Zb=new Float32Array(4),c.M.push(Ga),Bb=O("PLANE_REFLECT",Ga,!1,B,ia,La,jb,null,a.hg),I.B(h,Bb),Gc=G("COLOR","u_plane_reflection",a.wi,1,1,!0),Gc.ua=W.A,Gc.sa=W.A,y.push(Gc),ya.xw?(Rb=O("PLANE_REFLECT_BLEND",Ga,!1,B,ia,La,jb,null,a.hg),I.B(h,Rb),pd=G("DEPTH","DEPTH",a.wi,1,1,!0),yc=G("COLOR","COLOR",a.wi,1,1,!0),yc.ua=W.oe,yc.sa=W.oe,
I.m(h,Bb,Rb,pd),I.m(h,Bb,Rb,yc),ya.Mo.push([Rb]),da.push(Rb)):(qd=G("DEPTH","DEPTH",a.wi,1,1,!0),Bb.pa.push(qd),da.push(Bb)),ya.af.push([Bb]);if(a.fc){var Ib=F();I.B(h,Ib);Ab=ta.Tn;Ib.j.width=Ab;Ib.j.height=Ab;var Ec=G("DEPTH","u_grass_map_depth",Ab,1,1,!1);Ec.ua=W.A;Ec.sa=W.A;var Mc=G("COLOR","u_grass_map_color",Ab,1,1,!1);Mc.ua=W.A;Mc.sa=W.A}else Mc=Ec=Ib=null;if(nc&&kb){var Ob=e(ib);c.M.push(Ob);var Ta=Q(Ob,ia);I.B(h,Ta);Ta.self_shadow_normal_offset=kb.self_shadow_normal_offset;for(ub=0;ub<L.length;ub++)xc=
L[ub],I.m(h,xc,Ta,p[ub]);var Hc=G("COLOR","u_color",1,1,1,!0),cb=G("DEPTH","u_depth",1,1,1,!0);if(Ca){var kd=e(ib);c.M.push(kd);var Zc=a.pJ,bc=P(kd,La,Zc);I.B(h,bc);var fc=G("COLOR","u_ssao_mask",1,1,1,!0);I.m(h,Ta,bc,Hc);I.m(h,Ta,bc,cb);var oc=e(ib);c.M.push(oc);var Ub=S(oc,Zc);I.B(h,Ub);var Qc=G("COLOR","u_shadow_mask",1,1,1,!0);I.m(h,bc,Ub,fc);I.m(h,Ta,Ub,cb)}bb?Ta.pa.push(G("DEPTH","DEPTH",1,1,1,!0)):Ta.pa.push(Hb);Ib&&(I.m(h,Ib,Ta,Ec),I.m(h,Ib,Ta,Mc))}else Ta=null;var Xa=O("OPAQUE",ib,!0,B,ia,
La,jb,null,a.hg);I.B(h,Xa);if(bb){var gb=T();I.B(h,gb);r.push(gb);var Cb=G("COLOR","RESOLVE",1,1,1,!0);Cb.Pj=!0;Cb.me=!0;var gc=G("DEPTH","RESOLVE",1,1,1,!0);gc.Pj=!0;gc.me=!0;I.m(h,Xa,gb,Cb);I.m(h,Xa,gb,gc)}else r.push(Xa);Ta&&(fc?I.m(h,Ub,Xa,Qc):kb?I.m(h,Ta,Xa,G("COLOR","u_shadow_mask",1,1,1,!0)):ua.da("Internal error"));Ib&&(I.m(h,Ib,Xa,Ec),I.m(h,Ib,Xa,Mc));if(da.length)for(var Rc=da.length,Ya=0;Ya<Rc;Ya++)I.m(h,da[Ya],Xa,y[Ya]);if(z.length)for(Ya=0;Ya<z.length;Ya++)I.m(h,z[Ya],Xa,aa[Ya]);q=r;
r=[];if(!lb&&a.hD){Ga=e(ib);c.M.push(Ga);var hc=K(Ga,!1,ia);I.B(h,hc);if(a.pg){Ga=e(ib);c.M.push(Ga);var pb=K(Ga,!0,ia);I.B(h,pb);I.m(h,hc,pb,G("COLOR","COLOR",1,1,1,!0));I.m(h,hc,pb,G("DEPTH","DEPTH",1,1,1,!0))}}else hc=null;if(la.Gc&&!lb)if(bb)yb=gb;else{var yb=fa();I.B(h,yb);I.m(h,q[0],yb,G("COLOR","COPY",1,1,1,!0))}else yb=null;if(nc&&(la.Gc&&jd||E||H)){var Ua=e(ib);c.M.push(Ua);var $a=N(Ua);I.B(h,$a);I.m(h,bb?gb:Xa,$a,G("DEPTH","u_depth",1,1,1,!0));var Ma=G("COLOR","u_scene_depth",1,1,1,!0);
Ma.ua=W.oe;Ma.sa=W.oe}else $a=null;if(a.Sn){var mb=k("BLEND");r.push(mb);q=r;r=[]}if(a.Kf){var Vb=e(ib);c.M.push(Vb);var Db=O("GLOW",Vb,!1,B,ia,La,jb);I.B(h,Db);I.m(h,bb?gb:Xa,Db,bb?Fc:Hb);var db=J("X_GLOW_BLUR");db.hb="GLOW_MASK_SMALL";db.ig=a.Hg.small_glow_mask_width;var Pb=G("COLOR","u_color",1,1,1,!0);Pb.ua=W.A;Pb.sa=W.A;I.B(h,db);I.m(h,Db,db,Pb);var Jb=J("Y_GLOW_BLUR");Jb.hb="GLOW_MASK_SMALL";Jb.ig=a.Hg.small_glow_mask_width;var vb=G("COLOR","u_color",1,.5,.5,!0);vb.ua=W.A;vb.sa=W.A;I.B(h,Jb);
I.m(h,db,Jb,vb);var ic=J("X_GLOW_BLUR");ic.hb="GLOW_MASK_LARGE";ic.ig=a.Hg.large_glow_mask_width;var jc=G("COLOR","u_color",1,.5,.5,!0);jc.ua=W.A;jc.sa=W.A;I.B(h,ic);I.m(h,Jb,ic,jc);var Wb=J("Y_GLOW_BLUR");Wb.hb="GLOW_MASK_LARGE";Wb.ig=a.Hg.large_glow_mask_width;var nb=G("COLOR","u_color",1,.25,.25,!0);nb.ua=W.A;nb.sa=W.A;I.B(h,Wb);I.m(h,ic,Wb,nb);var wb=e(ib);c.M.push(wb);var Pa=D(wb,a);I.B(h,Pa);var Ea=G("COLOR","u_src_color",1,1,1,!0);if(a.Sn)if(bb){var Sb=T();I.B(h,Sb);I.m(h,mb,Sb,Cb);I.m(h,mb,
Sb,gc);I.m(h,Sb,Pa,Ea)}else I.m(h,mb,Pa,Ea);else I.m(h,bb?gb:Xa,Pa,Ea);I.m(h,a.Sn?mb:Xa,Pa,Hb);var xb=G("COLOR","u_glow_mask_small",1,.5,.5,!0);xb.ua=W.A;xb.sa=W.A;I.m(h,Jb,Pa,xb);var Qb=G("COLOR","u_glow_mask_large",1,.25,.25,!0);Qb.ua=W.A;Qb.sa=W.A;I.m(h,Wb,Pa,Qb);q=[Pa];r=[]}a.Sn||(mb=k("BLEND"),r.push(mb),q=r,r=[]);if(Da.wireframe_debug){Ga=e(ib);c.M.push(Ga);var Ja=w(Ga);r.push(Ja);I.B(h,Ja);I.m(h,q[0],Ja,Dc);I.m(h,q[0],Ja,Hb);Ib&&(I.m(h,Ib,Ja,Ec),I.m(h,Ib,Ja,Mc));q=r;r=[]}if(bb){var kc=T();
I.B(h,kc);r.push(kc);I.m(h,q[0],kc,Cb);I.m(h,q[0],kc,gc);q=r;r=[]}var Xb=q.slice(0);if(!lb&&a.HB){Ga=e(ib);c.M.push(Ga);var ab=t(Ga);I.B(h,ab);I.m(h,q[0],ab,bb?Fc:Hb)}if(Ha&&nc&&!lb){var qb=vc.Ij,Yb=vc.Er,hb=vc.uk,Qa=q[0],Eb=B?!0:!1,Tb=G("DEPTH","u_input",1,1,1,!0);Tb.ua=W.A;Tb.sa=W.A;var Na=G("COLOR","u_input",1,.25,.25,!0);Na.ua=W.A;Na.sa=W.A;var ob=qb/hb,Va=e(ib);c.M.push(Va);var rb=ma(Va,Eb,qb,!0,ob,ia,hb);I.B(h,rb);I.m(h,Qa,rb,Tb);var ob=qb/hb*.5,Zb=e(ib);c.M.push(Zb);var zc=ma(Zb,Eb,qb,!1,ob,
ia,hb);I.B(h,zc);I.m(h,rb,zc,Na);var ob=qb/hb*.25,zb=e(ib);c.M.push(zb);var lc=ma(zb,Eb,qb,!1,ob,ia,hb);I.B(h,lc);I.m(h,zc,lc,Na);var $b=ba(Yb,ia);r.push($b);I.B(h,$b);I.m(h,Qa,$b,G("COLOR","u_main",1,1,1,!0));I.m(h,lc,$b,G("COLOR","u_god_rays",1,1,1,!0));q=r;r=[]}if(tb&&!lb){var Qa=q[0],Kb=ha();I.B(h,Kb);I.m(h,Qa,Kb,G("COLOR","u_input",1,1,1,!0));var Lb=Aa();I.B(h,Lb);Lb.j.width=Da.vl?2:1;Lb.j.height=Da.vl?2:1;var Ic=G("COLOR","u_input",1,.25,.25,!0);Ic.ua=W.A;Ic.sa=W.A;var Wa=G("COLOR","u_luminance",
1,.25,.25,!0);Wa.ua=W.A;Wa.sa=W.A;I.m(h,Kb,Lb,Ic);var eb=tb.key,Sc=tb.sE,ac=e(ib);c.M.push(ac);var cc=ca(eb,Sc,ia,ac);I.B(h,cc);I.m(h,Qa,cc,G("COLOR","u_main",1,1,1,!0));I.m(h,Kb,cc,Wa);I.m(h,Lb,cc,G("COLOR","u_average_lum",1,1,1,!1));var dc=G("COLOR","u_color",1,.25,.25,!0);dc.ua=W.A;dc.sa=W.A;db=C("X_BLUR");I.B(h,db);I.m(h,cc,db,dc);Jb=C("Y_BLUR");I.B(h,Jb);I.m(h,db,Jb,dc);var qc=R(tb.blur);I.B(h,qc);var Nc=G("COLOR","u_bloom",1,.25,.25,!0);Nc.ua=W.A;Nc.sa=W.A;I.m(h,Jb,qc,Nc);I.m(h,Qa,qc,G("COLOR",
"u_main",1,1,1,!0));r.push(qc);q=r;r=[]}if(wc&&nc&&!lb){var Qa=q[0],fb=e(ib);c.M.push(fb);dc=G("COLOR","u_color",1,1,1,!0);dc.ua=W.A;dc.sa=W.A;var Ac=J("X_BLUR");I.B(h,Ac);I.m(h,Qa,Ac,dc);var rc=J("Y_BLUR");I.B(h,rc);I.m(h,Ac,rc,dc);var $c=Xb[0],Tc=Y(fb);fb.dof_distance=f.dof_distance;fb.qd=f.qd;fb.dof_front=f.dof_front;fb.dof_rear=f.dof_rear;fb.dof_power=f.dof_power;fb.dof_on=!0;r.push(Tc);I.B(h,Tc);I.m(h,Qa,Tc,G("COLOR","u_sharp",1,1,1,!0));I.m(h,rc,Tc,G("COLOR","u_blurred",1,1,1,!0));I.m(h,$c,
Tc,G("DEPTH","u_depth",1,1,1,!0));q=r;r=[]}if(a.pg){var rd=k("XRAY");r.push(rd);q=r;r=[]}if(Xc&&!lb){var ad=q[0],Jc=ea(Yc.mb_decay_threshold,Yc.mb_factor);r.push(Jc);I.B(h,Jc);I.m(h,ad,Jc,G("COLOR","u_mb_tex_curr",1,1,1,!0));Jc.pa.push(G("COLOR","u_mb_tex_accum",1,1,1,!0));q=r;r=[]}if(!lb&&a.outline){var Qa=q[0],sd=e(ib);c.M.push(sd);var bd=ka(sd,ia);I.B(h,bd);var cd=J("X_EXTEND"),td=G("COLOR","u_color",1,1,1,!0),Mb=G("COLOR","u_outline_mask",1,1,1,!0);cd.Pl=!0;I.B(h,cd);I.m(h,bd,cd,td);var dd=G("COLOR",
"u_color",1,.5,.5,!0);dd.ua=W.A;dd.sa=W.A;var sc=J("Y_EXTEND");sc.Pl=!0;I.B(h,sc);I.m(h,cd,sc,dd);Ac=J("X_BLUR");Ac.Pl=!0;I.B(h,Ac);I.m(h,sc,Ac,dd);var ld=G("COLOR","u_color",1,.25,.25,!0);ld.ua=W.A;ld.sa=W.A;var ed=G("COLOR","u_outline_mask_blurred",1,.25,.25,!0);ed.ua=W.A;ed.sa=W.A;rc=J("Y_BLUR");rc.Pl=!0;I.B(h,rc);I.m(h,Ac,rc,ld);var Oc=ga(qa);I.B(h,Oc);I.m(h,Qa,Oc,G("COLOR","u_outline_src",1,1,1,!0));I.m(h,bd,Oc,Mb);I.m(h,rc,Oc,ed);r.push(Oc);q=r;r=[]}if(pa&&!lb){var Qa=q[0],Kc=U(pc.brightness,
pc.contrast,pc.exposure,pc.saturation);I.B(h,Kc);I.m(h,Qa,Kc,G("COLOR","u_color",1,1,1,!0));r.push(Kc);q=r;r=[]}if(Cc){Qa=q[0];if(Da.smaa){var Uc=G("COLOR","u_color",1,1,1,!0);Uc.ua=W.A;Uc.sa=W.A;var md=M("SMAA_EDGE_DETECTION",a);I.B(h,md);I.m(h,Qa,md,Uc);var Pc=M("SMAA_BLENDING_WEIGHT_CALCULATION",a);I.B(h,Pc);I.m(h,md,Pc,Uc);var nd=G("COLOR","u_search_tex",1,1,1,!1),fd=G("COLOR","u_area_tex",1,1,1,!1);nd.ua=W.A;nd.sa=W.A;fd.ua=W.A;fd.sa=W.A;Pc.pa.push(nd);Pc.pa.push(fd);var Vc=M("SMAA_NEIGHBORHOOD_BLENDING",
a);I.B(h,Vc);I.m(h,Qa,Vc,Uc);var od=G("COLOR","u_blend",1,1,1,!0);od.ua=W.A;od.sa=W.A;I.m(h,Pc,Vc,od);r.push(Vc)}else{var gd=Z(a);I.B(h,gd);var hd=G("COLOR","u_color",1,1,1,!0);hd.ua=W.A;hd.sa=W.A;I.m(h,Qa,gd,hd);r.push(gd)}q=r;r=[]}r.push(q[0]);var ud=I.Ze(h,q[0]);if("MOTION_BLUR"==q[0].type||"RESOLVE"==q[0].type)var vd=!0;else vd=!1,I.De(h,ud,function(a,b,c){if(c.from==c.to)return vd=!0});if(vd){var Ad=J("NONE");I.B(h,Ad);I.m(h,q[0],Ad,G("COLOR","u_color",1,1,1,!0));q=r;r=[];r.push(Ad)}hc&&(pb?
r.push(pb):r.push(hc));ab&&r.push(ab);if(!lb&&a.cp.procedural_skydome){var Cd=x(ia,a.cp);I.B(h,Cd);r.push(Cd)}var Wc=xa();I.B(h,Wc);for(ub=0;ub<r.length;ub++){var wd=r[ub];switch(wd.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":I.m(h,wd,Wc,G("COLOR","NONE",1,1,1,!0));I.m(h,wd,Wc,G("DEPTH","NONE",1,1,1,!0));break;case "SKY":I.m(h,wd,Wc,G("CUBEMAP","u_sky",ta.ol,1,1,!1));break;case "ANCHOR_VISIBILITY":I.m(h,wd,Wc,G("COLOR","NONE",1,1,1,!0));break;default:if(lb){var Dd=g[0].k,xd=G("COLOR","OFFSCREEN",
1,1,1,!0);xd.Aa=Dd;I.m(h,r[ub],Wc,xd);for(Ya=1;Ya<g.length;Ya++){var Ed=g[Ya].k,Bd=J("NONE");I.B(h,Bd);I.m(h,r[ub],Bd,G("COLOR","SCALE",1,1,1,!0));var Fd=Ed.Gi/Dd.Gi,xd=G("COLOR","OFFSCREEN",1,Fd,Fd,!0);xd.Aa=Ed;I.m(h,Bd,Wc,xd)}}else I.m(h,r[ub],Wc,G("SCREEN","NONE",1,1,1,!0))}}gb&&!oa(h,gb).length&&(I.df(h,I.Ze(h,gb)),I.tq(h));b(h,nc);!a.anaglyph_use&&!a.Aw||lb||A(h,a,c);if(ja.enabled){var Gd=n(h);Gd&&u(h,Gd)}m(h);l(h);kb&&I.ea(h,function(a,b){if("SHADOW_RECEIVE"==b.type||"MAIN_BLEND"==b.type||"MAIN_XRAY"==
b.type){for(var c=0,d=V(h,b),f=0,e=0;e<d.length;e++){var g=d[e];"SHADOW_CAST"==g.type&&(f++,b.ui=b.ui||[],b.ui[0<g.ze?g.ze:c]=g.j.nb,c++)}b.xp&&b.wp||(Da.ro?b.Ht=new Float32Array(9*f):(b.xp=new Float32Array(4*f),b.wp=new Float32Array(4*f)))}});return h};a.mH=B;a.VM=E;a.Dd=function(a,b,c){var d=a.ig;a.ut[0]=b*a.tb[0]*d;a.ut[1]=c*a.tb[1]*d};a.yc=function(a,b){a.ig=b};a.GD=function(){var a=I.create(),b=E("PERFORMANCE"),c=X.Ob(X.Tb);c.width=1024;c.height=1024;b.j=c;I.B(a,b);c=xa();I.B(a,c);I.m(a,b,c,
G("COLOR","NONE",1024,1,1,!1));m(a);l(a);return a};a.lM=function(a){var b=null;I.ea(a,function(a,c){return c.j&&null===c.j.Zd?(b=c,!0):!1});return b};a.ab=function(a,b,c){a=V(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.NM=la;a.PM=da;a.JF=V;a.MF=oa;a.Eb=function(a,b){var c=null;I.ea(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.bE=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+
'node [shape=box margin="0.25,0.055"];\n',c=Ca(a);I.ea(a,function(a,d){var f=b+="    ",e="",e=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(e+=" ("+d.No.replace(/_/g," ")+")");if(d.j){for(var e=e+"\\n",g=0;g<c.length;g+=2){var h=d.j.Db;c[g]==h&&(e=W.Cj(h)?e+("CR"+c[g+1]+" "):e+("C"+c[g+1]+" "))}for(g=0;g<c.length;g+=2)h=d.j.od,c[g]==h&&(e=W.Cj(h)?e+("DR"+c[g+1]):e+("D"+c[g+1]))}d.pa.length&&(e+="\\n-----\\n");for(g=0;g<d.pa.length;g++)e+=ya(d.pa[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":
"dashed";b=f+(String(a)+' [label="'+e+'" color="black" style="'+(g+",bold")+'"];\n')});I.Ce(a,function(a,d,f){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ya(f,c)+'" style="'+(f.Bb?"solid":"dotted")+'"];\n'});return b+="}"};a.JD=function(a){a=I.BJ(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function e(){return{name:"",type:0,source:"",dt:"",width:0,height:0,zq:1,$m:!0,Gi:1024,yl:!1,kd:null,Gb:0,Ra:null,Md:null,Rl:!1,mg:-1,la:null,Oj:0,If:0,ba:0,bb:0,pj:0,Ye:!1,bg:1,lc:null,Ps:0,Os:0,Di:-1,Qs:!1,fk:-1,yp:!1,uK:!1,Ki:!1,tp:!1,repeat:!0}}function b(b,d,f,g){var h=b.type,k=new Uint8Array([204,204,204,255]),l=e();switch(h){case "DATA_TEX2D":case "IMAGE":var n=x.createTexture(),m=x.TEXTURE_2D;x.bindTexture(m,n);x.texImage2D(m,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,
k);b.image&&"MOVIE"==b.image.source&&(l.Rl=!0,l.ba=b.frame_start,l.bb=b.frame_offset,l.pj=b.frame_duration,l.uK=b.use_auto_refresh,l.Ki=b.use_cyclic,l.Oj=b.movie_length,l.tp=b.b4w_nla_video,0!=l.bb&&t.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":n=x.createTexture();m=x.TEXTURE_2D;x.bindTexture(m,n);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(f=N.keysearch("name",
b.b4w_source_id,f)))l.Gi=b.b4w_source_size,f.Od=f.Od||[],f.Od.push(b),x.texImage2D(m,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":n=x.createTexture();m=x.TEXTURE_CUBE_MAP;x.bindTexture(m,n);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var q=0;6>q;q++)x.texImage2D(x["TEXTURE_CUBE_MAP_"+f[q]],0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,k);break;case "BLEND":return null;case "NODE_TEX":n=x.createTexture();m=x.TEXTURE_2D;x.bindTexture(m,
n);x.texImage2D(m,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,k);break;default:return t.error('texture "'+b.name+'" has unsupported type "'+h+'"'),null}"NONE"==h&&(!b.b4w_enable_canvas_mipmapping||"CANVAS"!=b.b4w_source_type)||"DATA_TEX2D"==h||"IMAGE"==h&&"MOVIE"==b.image.source||"NODE_TEX"==h?x.texParameteri(m,x.TEXTURE_MIN_FILTER,x.LINEAR):x.texParameteri(m,x.TEXTURE_MIN_FILTER,fa[U.Ak]);x.texParameteri(m,x.TEXTURE_MAG_FILTER,x.LINEAR);k=m;f=b.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=d);"OFF"!==f&&
U.bn&&(d=w.sF())&&(f=parseFloat(f.split("x")[0]),x.texParameterf(k,d.TEXTURE_MAX_ANISOTROPY_EXT,f));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(l.repeat=!1,x.texParameteri(m,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(m,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE)):(x.texParameteri(m,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(m,x.TEXTURE_WRAP_T,x.REPEAT));l.type=a.vh;l.width=1;l.height=1;l.Ra=n;l.Gb=m;"CANVAS"==b.b4w_source_type&&"NONE"==h?(h=b.b4w_source_id,n=b.b4w_source_size,l.yl=b.b4w_enable_canvas_mipmapping,
l.dt=h,l.source="CANVAS",m=document.createElement("canvas"),m.width=n,m.height=n,l.kd=m.getContext("2d"),g in ma||(ma[g]={}),ma[g][h]=l,c(l)):"SCENE"==b.b4w_source_type&&"NONE"==h?(l.dt=b.b4w_source_id,l.source="SCENE"):(l.source=h,x.generateMipmap(m),x.bindTexture(m,null));l.name=b.name;return b.k=l}function c(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Gb;x.bindTexture(b,a.Ra);var c=l(a),d=n(a),f=u(a),e=a.kd.canvas;x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,!0);x.texImage2D(b,0,d,c,f,e);x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,
!1);a.yl&&x.generateMipmap(b);x.bindTexture(b,null);a.width=e.width;a.height=e.height}function m(a){var b=a.Gb;x.bindTexture(b,a.Ra);x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,!0);4!=a.la.length?a.Ye?h(a,a.la,a.width*a.bg,a.height*a.bg,!1):x.texImage2D(b,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,a.la):x.texImage2D(b,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,a.la);x.bindTexture(b,null)}function k(a){var b=a.Gb;x.bindTexture(b,a.Ra);x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,!0);a.Ye?h(a,a.lc[a.Di],a.width*a.bg,a.height*a.bg,
!1):x.texImage2D(b,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,a.lc[a.Di]);x.bindTexture(b,null)}function r(){Y||(Y=document.createElement("canvas"));return Y}function h(a,b,c,d,f){f||(g(x.TEXTURE_2D),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,b));x.bindTexture(x.TEXTURE_2D,null);P.qE(a,c,d,ga,ka)}function q(a,b,c,d){for(var f=0;6>f;f++){var e=d[f],g=r();g.width=c;g.height=c;var h=g.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(h.translate(0,c),h.scale(1,-1)):(h.translate(c,0),h.scale(-1,
1));h.drawImage(a,e[1]*b,e[2]*b,b,b,0,0,c,c);x.texImage2D(x["TEXTURE_CUBE_MAP_"+e[0]],0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,g)}}function g(a){ga||(ga=x.createFramebuffer());x.bindTexture(a,null);ka||(ka=x.createTexture());x.bindTexture(a,ka);x.texParameteri(a,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE);x.texParameteri(a,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE);x.texParameteri(a,x.TEXTURE_MAG_FILTER,x.LINEAR);x.texParameteri(a,x.TEXTURE_MIN_FILTER,x.LINEAR)}function y(a){a.la.pN=function(){m(a)}}function f(a){return N.al(a)?
N.clamp(Math.pow(2,parseInt(a).toString(2).length),2,U.zb):a}function l(b){switch(b.type){case a.vh:b=x.RGBA;break;case a.Xm:b=x.RGB;break;case a.Nk:b=x.RGBA;break;case a.Ok:b=x.RGB;break;case a.Ti:b=x.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function n(b){switch(b.type){case a.vh:b=U.Hc?x.RGBA8:x.RGBA;break;case a.Xm:b=U.Hc?x.RGB8:x.RGB;break;case a.Nk:b=U.Hc?x.RGBA8:x.RGBA;break;case a.Ok:b=U.Hc?x.RGB8:x.RGB;break;case a.Ti:b=U.Hc?x.DEPTH_COMPONENT24:x.DEPTH_COMPONENT;break;
default:throw"Wrong texture type";}return b}function u(b){switch(b.type){case a.vh:b=x.UNSIGNED_BYTE;break;case a.Xm:b=x.UNSIGNED_BYTE;break;case a.Nk:b=x.FLOAT;break;case a.Ok:b=x.FLOAT;break;case a.Ti:b=x.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function A(a){return a&&a.name&&a.Md?!0:!1}function B(a,b){if(b in ba&&a in ba[b]){var c=ba[b][a];c.la?c.la.play():c.lc&&(c.Qs=!0);return!0}return!1}function H(a,b){if(b in ba&&a in ba[b]){var c=ba[b][a];c.la?c.la.pause():c.lc&&(c.Qs=
!1);return!0}return!1}function v(a,b){if(b in ba&&a in ba[b]){var c=ba[b][a];c.la?c.la.currentTime=c.bb/c.If:c.lc&&(c.Di=z(c,c.bb),k(c));return!0}return!1}function E(a){return a.la?!a.la.paused:a.lc?a.Qs:!1}function z(a,b){return Math.round(b*a.Ps/a.Oj)}function G(a,b){if(S.oa(a))return d(a,b);for(var c=a.mx,f=0;f<c.length;f++){var e=d(c[f],b);if(e)return e}return null}function d(a,b){for(var c=null,d=a.u,f=0;f<d.length;f++)for(var e=d[f].P,g=0;g<e.length;g++)for(var h=e[g],k=0;k<h.Y.length;k++)if(h.Y[k].name==
b){c=h.Y[k];break}return c}function F(a,b,c){var d=a.elements;a=a.interpolation;for(var f=0;f<b;f++){var e=f/(b-1),g=J(d,e,!0),h=C(d,e,!0);if(g&&h)if("CONSTANT"==a)c.push.apply(c,g.color);else{var k=c,l=g,n=h;l==n?k.push.apply(k,l.color):(k.push(Z.po(n.color[0],n.position,l.color[0],l.position,e)),k.push(Z.po(n.color[1],n.position,l.color[1],l.position,e)),k.push(Z.po(n.color[2],n.position,l.color[2],l.position,e)),k.push(Z.po(n.color[3],n.position,l.color[3],l.position,e)))}h&&!g&&c.push.apply(c,
h.color);g&&!h&&c.push.apply(c,g.color)}}function J(a,b,c){for(var d=null,f=0;f<a.length;f++){var e=c?b-a[f].position:b-a[f][1][0];0<=e&&(d?e<=(c?b-d.position:b-a[f][1][0])&&(d=a[f]):d=a[f])}return d}function C(a,b,c){for(var d=null,f=0;f<a.length;f++){var e=c?a[f].position-b:a[f][1][0]-b;0<=e&&(d?e<=(c?d.position-b:d[1][0]-b)&&(d=a[f]):d=a[f])}return d}var D=p("__compat"),O=p("__config"),T=p("__dds"),K=p("__debug"),w=p("__extensions"),t=p("__print"),Q=p("__time"),N=p("__util"),P=p("__renderer"),
S=p("__obj_util"),Z=p("__curve"),M=p("__vec3"),U=O.q,ea=O.I,Y=null,ka=null,ga=null;a.oe=0;a.A=0;a.yB=0;a.wB=0;a.xB=0;a.vB=0;a.vh=10;a.Xm=20;a.Nk=30;a.Ok=40;a.Ti=50;a.Vm=60;a.Tm=70;a.Wm=80;a.Um=90;a.Xt=128;a.$z=128;a.ku=128;var ma={},ba={},x=null,fa;a.Ed=function(b){fa=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.oe=b.NEAREST;a.A=b.LINEAR;a.yB=b.NEAREST_MIPMAP_NEAREST;a.wB=b.LINEAR_MIPMAP_NEAREST;a.xB=b.NEAREST_MIPMAP_LINEAR;a.vB=b.LINEAR_MIPMAP_LINEAR;
x=b};a.wF=function(a,b){return b in ma&&a in ma[b]?ma[b][a].kd:null};a.XJ=function(a,b){return b in ma&&a in ma[b]?(c(ma[b][a]),!0):!1};a.ll=function(b,c){var d=e();d.name=b;d.type=c;d.source="NONE";if(c==a.Vm||c==a.Tm||c==a.Wm||c==a.Um)d.Md=x.createRenderbuffer();else{var f=x.TEXTURE_2D,g=x.createTexture();x.bindTexture(f,g);x.texParameteri(f,x.TEXTURE_MAG_FILTER,x.LINEAR);x.texParameteri(f,x.TEXTURE_MIN_FILTER,x.LINEAR);x.texParameteri(f,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE);x.texParameteri(f,x.TEXTURE_WRAP_T,
x.CLAMP_TO_EDGE);x.bindTexture(f,null);d.Gb=f;d.Ra=g}return d};a.tD=function(b){var c=x.createTexture(),d=x.TEXTURE_CUBE_MAP;x.bindTexture(d,c);x.texParameteri(d,x.TEXTURE_MAG_FILTER,x.LINEAR);x.texParameteri(d,x.TEXTURE_MIN_FILTER,x.LINEAR);x.texParameteri(d,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE);x.texParameteri(d,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
g=0;6>g;g++)x.texImage2D(x[f[g]],0,x.RGBA,b,b,0,x.RGBA,x.UNSIGNED_BYTE,null);x.bindTexture(d,null);d=e();d.name="CUBEMAP";d.type=a.vh;d.source="NONE";d.width=3*b;d.height=2*b;d.zq=1;d.Ra=c;d.Gb=x.TEXTURE_CUBE_MAP;return d};a.Rs=function(a,b,c){if(!A(a)){var d=a.Gb;x.bindTexture(d,a.Ra);b&&x.texParameteri(d,x.TEXTURE_MIN_FILTER,b);c&&x.texParameteri(d,x.TEXTURE_MAG_FILTER,c);x.bindTexture(d,null)}};a.AM=function(b){if(A(b))return{min:a.oe,VG:a.oe};var c=b.Gb;x.bindTexture(c,b.Ra);b=x.getTexParameter(c,
x.TEXTURE_MIN_FILTER);var d=x.getTexParameter(c,x.TEXTURE_MAG_FILTER);x.bindTexture(c,null);return{min:b,VG:d}};a.resize=function(b,c,d){c=Math.max(c,U.vl?2:1);d=Math.max(d,U.vl?2:1);if(b.width!=c||b.height!=d){switch(b.type){case a.Vm:x.bindRenderbuffer(x.RENDERBUFFER,b.Md);x.renderbufferStorage(x.RENDERBUFFER,x.RGB565,c,d);x.bindRenderbuffer(x.RENDERBUFFER,null);break;case a.Tm:x.bindRenderbuffer(x.RENDERBUFFER,b.Md);x.renderbufferStorage(x.RENDERBUFFER,x.DEPTH_COMPONENT16,c,d);x.bindRenderbuffer(x.RENDERBUFFER,
null);break;case a.Wm:x.bindRenderbuffer(x.RENDERBUFFER,b.Md);x.renderbufferStorageMultisample(x.RENDERBUFFER,U.Dc,x.RGBA8,c,d);x.bindRenderbuffer(x.RENDERBUFFER,null);break;case a.Um:x.bindRenderbuffer(x.RENDERBUFFER,b.Md);x.renderbufferStorageMultisample(x.RENDERBUFFER,U.Dc,x.DEPTH_COMPONENT24,c,d);x.bindRenderbuffer(x.RENDERBUFFER,null);break;default:var f=b.Gb;x.bindTexture(f,b.Ra);var e=l(b),g=n(b),h=u(b);x.texImage2D(f,0,g,c,d,0,e,h,null);x.bindTexture(f,null)}c>U.zb||d>U.zb?t.error('Slink texture "'+
b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+U.zb+"x"+U.zb+"."):(b.width=c,b.height=d)}};a.SD=b;a.vz=m;a.uz=k;a.xm=function(a,b,c,d,e){var k=a.source,l=a.Ra,n=a.Gb,m=1,C=1;x.bindTexture(n,l);if(4==b.length){var p=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==k)if(p)x.texImage2D(n,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){C=T.mw(b);p=N.al(C.width)||N.al(C.height);if(C.width>U.zb||C.height>U.zb){t.error('Texture "'+d+'" has unsupported size: '+
C.width+"x"+C.height+". Max available: "+U.zb+"x"+U.zb+".");return}m=C.width;C=C.height;p&&(a.Ye=!0,g(n),m=f(m*a.bg),C=f(C*a.bg));T.qK(x,w.hw(),b,!0);a.Ye&&(h(a,null,m,C,!0),x.bindTexture(n,l),x.generateMipmap(n));a.width=m;a.height=C;a.zq=T.zF(b)}else{x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,!0);a.Rl?U.nm?(m=b[0].width,C=b[0].height):(m=b.videoWidth,C=b.videoHeight):(m=b.width,C=b.height);a.width=m;a.height=C;if(m>U.zb||m>U.zb)t.warn('Texture "'+d+'" has unsupported size: '+m+"x"+C+". Max available: "+
U.zb+"x"+U.zb+". Reduced image size will be used."),a.bg=Math.min(U.zb/m,U.zb/C),a.Ye=!0;a.Rl&&(U.nm?(e in ba||(ba[e]={}),ba[e][a.name]=a,a.lc=b,a.Ps=b.length,a.If=a.Os*a.Oj/b.length,b=b[0]):(e in ba||(ba[e]={}),ba[e][a.name]=a,a.la=b,a.la.loop=a.Ki,a.If=b.duration?a.Oj/b.duration:Q.Xb(),ea.Av||(b.playbackRate=Q.Xb()/a.If,ea.cv&&2<b.playbackRate&&(b.playbackRate=2)),y(a)));m=f(a.width*a.bg);C=f(a.height*a.bg);a.Ye?(d=r(),l=d.getContext("2d"),d.width=m,d.height=C,l.drawImage(b,0,0,a.width,a.height,
0,0,m,C),x.texImage2D(n,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,d)):N.al(a.width)||N.al(a.height)?(h(a,b,m,C,!1),a.Ye=!0):x.texImage2D(n,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,b);l=a.Ra;x.bindTexture(n,l);a.Rl||x.generateMipmap(n);x.bindTexture(n,null);a.width=m;a.height=C}else if("ENVIRONMENT_MAP"==k)if(m=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],p){for(d=0;6>d;d++)x.texImage2D(x["TEXTURE_CUBE_MAP_"+m[d][0]],0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,
b);a.width=3;a.height=2}else{x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,!1);if(b.width%3||b.height%2){t.error('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". The width must be multiple of three and the height - multiple of two.");return}C=b.width/3;if(C>U.Ng)t.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+3*U.Ng+"x"+2*U.Ng+". Reduced image size will be used."),d=f(U.Ng/C*C),a.Ye=!0;else if(d=f(C),3*d>U.zb||2*d>U.zb)a.Ye=!0;if(a.Ye||
U.hy)q(b,C,d,m);else{p=b;l=d;g(x.TEXTURE_2D);x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,p);x.bindTexture(x.TEXTURE_2D,null);for(p=0;6>p;p++)x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,x.RGBA,l,l,0,x.RGBA,x.UNSIGNED_BYTE,null);x.bindTexture(a.Gb,null);x.bindFramebuffer(x.FRAMEBUFFER,ga);for(p=0;6>p;p++)P.pE(a,x.TEXTURE_CUBE_MAP_POSITIVE_X+p,l,C,ka,p);x.bindFramebuffer(x.FRAMEBUFFER,null);x.bindTexture(a.Gb,a.Ra);x.texParameteri(a.Gb,x.TEXTURE_MIN_FILTER,fa[U.Ak]);x.texParameteri(a.Gb,
x.TEXTURE_MAG_FILTER,x.LINEAR)}K.WC()&&(t.warn("Firefox detected, setting max cubemap size to 256, use canvas for resizing."),q(b,C,D.gu,m));a.width=3*d;a.height=2*d;x.generateMipmap(n)}else if("DATA_TEX2D"==k||"NODE_TEX"==k)x.texImage2D(n,0,x.RGBA,b.width,b.height,0,x.RGBA,x.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height;x.bindTexture(n,null)};a.hE=function(a){x.deleteTexture(a)};a.Ej=function(a){return a&&a.name&&(a.Ra||a.Md)?!0:!1};a.Cj=A;a.aN=function(b){return b.type==a.Nk||b.type==
a.Ok?!0:!1};a.RF=function(b){var c=0;switch(b.type){case a.vh:case a.Xm:c=4;break;case a.Nk:case a.Ok:c=16;break;case a.Ti:c=3;break;case a.Vm:case a.Tm:c=2;break;case a.Wm:c=4*U.Dc;break;case a.Um:c=3*U.Dc}return c};a.Wv=function(a,c){var d=null;switch(a){case "SSAO_TEXTURE":d={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(d,null,c,0);d.image={filepath:null};break;case "NODE_TEX":d={name:void 0,type:"NODE_TEX",extension:"CLIP",b4w_anisotropic_filtering:"OFF"},
b(d,null,c,0),d.image={filepath:null}}return d};a.cleanup=function(){if(!U.nm)for(var a in ba)for(var b in ba[a])ba[a][b].la.pause(),ba[a][b].la.src="",ba[a][b].la.load();ma={};ba={}};a.pause=function(){for(var a in ba)for(var b in ba[a]){var c=ba[a][b];E(c)&&(H(b,a),c.yp=!0)}};a.reset=function(){for(var a in ba)for(var b in ba[a])v(b,a),ba[a][b].yp=!1};a.play=function(a){for(var b in ba)for(var c in ba[b]){var d=ba[b][c];if(!a||d.yp)B(c,b),d.yp=!1}};a.Kt=function(a,b){return b in ba&&a in ba[b]?
ba[b][a].tp:!1};a.play_video=B;a.pause_video=H;a.reset_video=v;a.uI=function(a,b,c){c in ba&&a in ba[c]&&(a=ba[c][a],a.la?a.la.currentTime=b/a.If:a.lc&&(a.Di=b,k(a)))};a.Kz=E;a.Lz=function(a){return a.la||a.lc?a.la?2<=a.la.readyState:!0:0};a.Hz=function(a){return a.la||a.lc?a.la?Math.round(a.la.currentTime*a.If):a.Di:0};a.Jz=function(a){return a.la||a.lc?a.la?a.bb:z(a,a.bb):0};a.NK=function(a){if(!a.la&&!a.lc)return 0;var b=Math.min(a.pj,a.Oj-a.bb);return a.la?a.bb+b:z(a,a.bb+b)};a.Xo=function(a,
b){return Math.round(b*a.Os*(Q.Xb()/a.If))};a.Iz=function(a){return Math.min(a.pj,a.Oj-a.bb)};a.MK=z;a.xF=function(a,b){var c=G(a,b);return c&&"CANVAS"==c.source?c.kd:null};a.YJ=function(a,b){var d=G(a,b);return d&&"CANVAS"==d.source?(c(d),!0):!1};a.$I=function(a){for(var b={},d=0;d<a.length;d++){for(var f=a[d].Y,g=[],h=0;h<f.length;h++){var k=f[h];if("CANVAS"==k.source)if(k.name in b)k=b[k.name];else{var l=f[h],k=e();k.name=l.name;k.source="CANVAS";k.width=l.width;k.height=l.height;k.yl=l.yl;k.type=
l.type;l=document.createElement("canvas");l.width=k.width;l.height=k.height;k.kd=l.getContext("2d");k.Gb=x.TEXTURE_2D;k.Ra=x.createTexture();x.bindTexture(x.TEXTURE_2D,k.Ra);k.yl?x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,fa[U.Ak]):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR);x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);x.bindTexture(x.TEXTURE_2D,null);l=k;l.kd.drawImage(f[h].kd.canvas,0,0);c(l);b[k.name]=k}g.push(k)}a[d].Y=g}};a.rD=function(a,b){for(var c=[],
d=0;d<a.length;d++)F(a[d].data.value.color_ramp,b,c);return new Uint8Array(c.map(function(a){return N.clamp(255*a,0,255)}))};a.DC=F;a.UD=function(a,b){for(var c=new Float32Array(3),d=new Float32Array(3),f=[],e=0;e<a.length;e++){for(var g=a[e].data.value,h=[],k=g.curve_mapping.curves_data,l=g.curve_mapping.curve_extend,n=g.curve_mapping.curves_handle_types,g=0;g<k.length;g++){for(var m=l[g],q=k[g],r=[],t=n[g],p=0;p<q.length;p++)r.push([new Float32Array(3),new Float32Array(q[p].concat(0)),new Float32Array(3)]);
Z.nq(r[0],null,r[1],t[0],t[0]);for(p=1;p<r.length-1;p++)Z.nq(r[p],r[p-1],r[p+1],t[p],t[p]);Z.nq(r[r.length-1],r[r.length-2],null,t[r.length-1],t[r.length-1]);if(2<r.length){if("AUTO"==t[0]){M.subtract(r[0][2],r[0][1],c);p=M.length(c);M.copy(r[1][0],d);d[0]<r[0][1][0]&&(d[0]=r[0][1][0]);M.subtract(d,r[0][1],d);var x=M.length(d);1E-8<x&&(M.scale(d,p/x,d),M.add(r[0][1],d,r[0][2]),M.subtract(r[0][1],d,r[0][0]))}q=r.length-1;"AUTO"==t[0]&&(M.subtract(r[q][0],r[q][1],c),p=M.length(c),M.copy(r[q-1][2],d),
d[0]>r[q][1][0]&&(d[0]=r[q][1][0]),M.subtract(d,r[q][1],d),x=M.length(d),1E-8<x&&(M.scale(d,p/x,d),M.add(r[q][1],d,r[q][0]),M.subtract(r[q][1],d,r[q][2])))}for(q=0;q<r.length-1;q++)Z.kD(r[q][1],r[q][2],r[q+1][0],r[q+1][1]);q=[];3>=k.length?(p=Math.round(-b/2),t=Math.round(b/2)):(p=0,t=b);for(;p<t;p++){var x=p/(t-1),D=J(r,x,!1),u=C(r,x,!1);D&&u?q.push(Z.Hu(x,D[1],D[2],u[0],u[1],.001)):u&&!D?"EXTRAPOLATED"==m?q.push(Z.bx(x,u[1],u[2])):q.push(u[1][1]):D&&!u&&("EXTRAPOLATED"==m?q.push(Z.bx(x,D[0],D[1])):
q.push(D[1][1]))}h.push(q)}f.push(h)}c=[];for(p=0;p<f.length;p++)for(h=f[p],g=0;g<h[0].length;g++)3>=h.length?(d=N.clamp(127.5*(h[0][g]+1),0,255),e=N.clamp(127.5*(h[1][g]+1),0,255),k=N.clamp(127.5*(h[2][g]+1),0,255),q=255):(d=N.clamp(255*h[0][g],0,255),e=N.clamp(255*h[1][g],0,255),k=N.clamp(255*h[2][g],0,255),q=N.clamp(255*h[3][g],0,255)),c.push(d,e,k,q);return new Uint8Array(c)}};b4w.module.__assets=function(a,p){function e(){return u.iG()?p(u.Ec.on).data:null}function b(){var a={Ym:null,EB:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),f=0;f<c;f++)d[f]=b.charCodeAt(f);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Ym=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=e();b&&a.Ym in b&&(a.status=200,b[a.Ym]&&(a.response=a.EB(b[a.Ym])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function c(b){for(var c=0,d=0;d<b.length;d++){var f=b[d];20===f.state&&c++;if(c>=G.cH)break;if(10===f.state)switch(f.state=20,c++,f.type){case a.AT_ARRAYBUFFER:m(f,"arraybuffer");break;case a.AT_JSON:m(f,"json");break;case a.AT_TEXT:m(f,"text");break;case a.AT_AUDIOBUFFER:k(f);break;case a.AT_IMAGE_ELEMENT:r(f);
break;case a.AT_AUDIO_ELEMENT:h(f);break;case a.Lm:q(f);break;case a.Km:g(f);break;default:v.da("Wrong asset type: "+f.type)}}}function m(c,d){var f=e(),g=f&&c.url in f?new b:new XMLHttpRequest,f=null;if("GET"==c.Cd)g.open("GET",c.url,!0);else if("POST"==c.Cd)switch(g.open("POST",c.url,!0),c.xi){case a.Tt:f="text/plain";break;case a.St:f="application/json"}if(c.Sg)for(var h in c.Sg)"Content-Type"==h?f=c.Sg[h]:g.setRequestHeader(h,c.Sg[h]);f&&g.setRequestHeader("Content-Type",f);"text"==d?(g.overrideMimeType("text/plain"),
g.responseType="text"):"json"==d?(g.overrideMimeType("application/json"),g.responseType="text"):g.responseType=d;g.onreadystatechange=function(){if(40!=c.state&&4==g.readyState){if(200==g.status||0==g.status){var a=g.response;if(a){if("json"==d&&"string"==typeof a)try{a=JSON.parse(a,c.tG)}catch(b){B.error(b+" (parsing JSON "+c.url+")");c.Nb(null,c.id,c.type,c.url,c.lb);return}c.Nb(a,c.id,c.type,c.url,c.lb)}else B.error("empty responce when trying to get "+c.url),c.Nb(null,c.id,c.type,c.url,c.lb)}else B.error(g.status+
" when trying to get "+c.url),c.Nb(null,c.id,c.type,c.url,c.lb);c.state=30}};g.addEventListener("progress",function(a){a.lengthComputable&&c.Xx(a.loaded/a.total)},!1);g.send(c.Vg)}function k(a){"GET"!=a.Cd&&v.da("Unsupported request type for audio buffer");var c=e(),d=c&&a.url in c?new b:new XMLHttpRequest;d.open("GET",a.url,!0);d.responseType="arraybuffer";d.onreadystatechange=function(){if(40!=a.state&&4==d.readyState)if(200==d.status||0==d.status){var b=d.response;b?H.fE(b,function(b){a.Nb(b,a.id,
a.type,a.url,a.lb);a.state=30},function(){a.Nb(null,a.id,a.type,a.url,a.lb);B.error("failed to decode "+a.url);a.state=30}):(a.Nb(null,a.id,a.type,a.url,a.lb),B.error("empty responce when trying to get "+a.url),a.state=30)}else a.Nb(null,a.id,a.type,a.url,a.lb),B.error(d.status+" when trying to get "+a.url),a.state=30};d.send(a.Vg)}function r(a){"GET"!=a.Cd&&v.da("Unsupported request type for image element");var b=document.createElement("img");z.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=
a.state&&(a.Nb(b,a.id,a.type,a.url,a.lb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.Nb(null,a.id,a.type,a.url,a.lb),B.error("could not load image: "+a.url),a.state=30)},!1);var c=e();if(c&&a.url in c)if(c[a.url]){var d=f(a.url);b.src="data:"+d+";base64,"+c[a.url]}else A.Hr()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url}function h(a){"GET"!=a.Cd&&v.da("Unsupported request type for audio element");
var b=document.createElement("audio");z.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.Nb(b,a.id,a.type,a.url,a.lb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.Nb(null,a.id,a.type,a.url,a.lb),B.error("could not load sound: "+a.url),a.state=30)},!1);b.addEventListener("stalled",function(){40!=a.state&&(a.Nb(null,a.id,a.type,a.url,a.lb),B.error("could not load sound: "+a.url),a.state=30)},!1);var c=e();if(c&&a.url in c)if(c[a.url]){var d=
l(a.url);b.src="data:"+d+";base64,"+c[a.url];40!=a.state&&(a.Nb(b,a.id,a.type,a.url,a.lb),a.state=30)}else A.Hr()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url,z.Ve&&b.load();z.as&&(b.autoplay=!0,b.pause());setTimeout(function(){b.eJ=1},5E3)}function q(a){function b(){40!=a.state&&(a.Nb(null,a.id,a.type,a.url),B.error("could not load video: "+a.url,a.lb),a.state=30)}"GET"!=a.Cd&&v.da("Unsupported request type for video element");
var c=document.createElement("video");c.muted=!0;if(z.allow_cors||z.Ve)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.Nb(c,a.id,a.type,a.url,a.lb),a.state=30)},!1);c.addEventListener("error",b,!1);var d=e();if(d&&a.url in d)if(d[a.url]){var f=n(a.url);c.src="data:"+f+";base64,"+d[a.url];40!=a.state&&c.addEventListener("loadeddata",function(){a.Nb(c,a.id,a.type,a.url,a.lb);a.state=30},!1)}else A.Hr()?(d=document.createEvent("CustomEvent"),
d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.url,z.Ve&&c.load();z.as&&(c.autoplay=!0,c.pause());setTimeout(function(){c.eJ=1},1E4)}function g(c){function d(a){c.Nb(a,c.id,c.type,c.url,c.lb);c.state=30}"GET"!=c.Cd&&v.da("Unsupported request type for seq video element");var f=e(),g=f&&c.url in f?new b:new XMLHttpRequest;if(null==c.xi&&null==c.Vg)g.open("GET",c.url,!0);else switch(g.open("POST",c.url,!0),c.xi){case a.Tt:g.setRequestHeader("Content-type",
"text/plain");break;case a.St:g.setRequestHeader("Content-type","application/json")}g.responseType="arraybuffer";g.onreadystatechange=function(){if(40!=c.state&&4==g.readyState)if(200==g.status||0==g.status){var a=g.response;a?y(a,d):(c.Nb(null,c.id,c.type,c.url,c.lb),B.error("empty responce when trying to get "+c.url),c.state=30)}else c.Nb(null,c.id,c.type,c.url,c.lb),B.error(g.status+" when trying to get "+c.url),c.state=30};g.addEventListener("progress",function(a){a.lengthComputable&&c.Xx(a.loaded/
a.total)},!1);g.send(c.Vg)}function y(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),f=c[3],e={images:[],Lu:[],If:c[4]},g=20,h=0;h<f;h++){var k=c[g/4],l=new Blob([d.subarray(g+4,g+4+k)],{type:"image/jpg"}),n=document.createElement("img");n.src=window.URL.createObjectURL(l);e.images.push(n);e.Lu.push(l);g+=k+8-k%4}n.onload=function(){for(var a=0;a<e.images.length;a++)window.URL.revokeObjectURL(e.images[a].src);delete e.Lu;b(e)}}function f(a){var b="image";switch(v.nr(a).toLowerCase()){case "jpeg":case "jpg":b+=
"/jpeg";break;case "png":b+="/png"}return b}function l(a){var b="audio";switch(v.nr(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function n(a){var b="video";switch(v.nr(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var u=p("__config"),A=p("__compat"),B=p("__print"),H=p("__sfx"),v=p("__util"),E=p("__version"),z=u.q,G=u.Qd;a.AT_ARRAYBUFFER=
10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Lm=70;a.Km=80;a.St=a.AT_JSON;a.Tt=a.AT_TEXT;var d=[],F=0,J={};a.rm=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.IM=function(a){if(J[a])return J[a];var b=G.prevent_caching?a+E.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return J[a]=
b;v.da("Error XHR: responce is empty, GET "+a)}else v.da("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<d.length;a++)d[a].state=40;d=[];F=0;J={}};a.enqueue=function(a,b,f,g,h){for(var k=0;k<a.length;k++){var l=a[k],l={id:l.id,type:l.type,url:l.url,Cd:l.Cd?l.Cd:"GET",xi:l.xi?l.xi:null,Sg:l.Sg?l.Sg:null,Vg:l.Vg?l.Vg:null,lb:l.lb?l.lb:null,state:10,Nb:b||function(){},Mx:f||function(){},Xx:g||function(){},tG:h||null,Nx:F};if(G.prevent_caching){var n=e();n&&l.url in n||(l.url+=
E.timestamp())}d.push(l)}c(d);F++};a.update=function(){c(d);for(var a=d,b=0,f=!0,e=0;e<a.length;e++){var g=a[e];g.Nx===a[b].Nx?30!==g.state&&(f=!1):(f&&(a[e-1].Mx(),f=e-b,a.splice(b,f),e-=f),b=e,f=30===a[e].state?!0:!1);e===a.length-1&&f&&(a[e].Mx(),a.splice(b))}}};b4w.module.__loader=function(a,p){function e(c,e,g,d){var h=v,k=A.create(),l;for(l in e){var n=b(e[l]);(d&&n.yb||!c&&n.Lb)&&f(n);A.B(k,n)}for(l in e)for(n=e[l],n.name=l,c=0;c<n.K.length;c++)A.m(k,e[n.K[c]],n,null);e=b({name:"out",mb:a.cA,Cb:function(a,b,c,d,f){b.Ua&&(h.it=!0);u(b)||(b.status=2);b.ex(b.id,!0);f(b,c);B.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},Ab:5});if(g)g=A.Jl(k);else{l=A.clone(k);do{g=A.Jl(l);n=[];for(c=0;c<g.length;c++){d=g[c];var m=A.Ka(l,d);m.vb&&n.push(d)}for(c=
0;c<n.length;c++)A.df(l,n[c]);n.length&&A.tq(l)}while(n.length)}A.B(k,e);for(c=0;c<g.length;c++)d=g[c],m=A.Ka(k,d),e.K.push(m.name),A.m(k,m,e,null);return k}function b(a){a.vb=a.vb||!1;a.mb||0===a.mb||(a.mb=a.Ic);a.K=a.K||[];a.ei=a.ei||!1;a.$s=a.$s||!1;a.Ab=a.Ab||0;a.yb=a.yb||!1;a.Lb=a.Lb||!1;a.status=0;a.jN=0;a.Sr=0;a.Yk=a.Yk||null;return a}function c(a,b){for(var c=[],d=[],f=0;f<b.length;f++){var e=b[f];A.Ka(a.gf,e).ei&&(A.ih(a.gf,e,function(d){var f=!0;A.De(a.gf,d,function(a,b){if(!b.ei)return f=
!1,1});f&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(f))}for(f=d.length-1;0<=f;f--)b.splice(d[f],1);return c}function m(a){function b(c,d){var f=A.Ka(a.gf,c),e=A.Ka(a.gf,d),g=e.mb-f.mb;0==g&&(g=f.vb-e.vb);return g}var f=[],d=a.fg,e=!1;do{var g=c(a,d);f.push.apply(f,d);0<g.length&&(e=!0);d=g}while(0<g.length);e&&f.sort(b);a.fg=f;return a.fg.length}function k(a,b,c){if(b.$s)return b.ei=!0,h(a,b),!1;if(!b.Cb&&!b.Ag&&!b.Xk)return h(a,b),!1;if(0==b.status&&(b.status++,b.Cb))return b.Cb(c,a,
b,b.Yk,h,q),!0;if(1==b.status){if(b.Ag)return b.Ag(c,a,b,b.Yk,h,q),!0;b.status++}return 2==b.status&&(b.status++,b.Xk)?(b.Xk(c,a,b,b.Yk,h,q),!0):!1}function r(a){if(0==a.ep)return 100;var b=0;A.ea(a.gf,function(c,d){a.do_not_load_resources&&d.yb||(b+=d.Sr*d.Ab)});return H.trunc(100*b/a.ep)}function h(a,b){b.ei=!0;b.status=3;g(a,b,1)}function q(a,b,c){1>c?g(a,b,c):b.status++}function g(a,b,c){var d=v;if(b.Cb||b.Ag||b.Xk)if(b.Sr=c,b=r(a),a.rv!=b||1==c)a.ht(b,performance.now()-a.cz),a.rv=b,d.Vr=!0}function y(a,
b){var c=null;A.ea(a.gf,function(a,f){if(f.name==b)return c=f,1});return c}function f(a){a.$s=!0;a.Sr=1}function l(a){a.ht=null;a.yq=null;a.gf=null;a.fg=null}function n(){return 0==v.Zm}function u(a){return a&&(3==a.status||4==a.status)}var A=p("__graph"),B=p("__print"),H=p("__util");a.Ic=0;a.uh=1;a.cA=2;var v=null;a.iw=function(){return v};a.KD=function(){var a={jf:[],Jq:0,Zm:0,it:!1,Vr:!1};return v=a};a.TD=function(a,b,c,d,f,g,h,k){var l=v,n=l.jf.length,m={id:n,Ua:0==n,status:0,Ff:b,Ju:"",ex:c||
function(){},dx:k||!1,UN:g,cz:0,rv:0,ep:0,Fs:!1,ht:d||function(){},yq:f||function(){},gf:null,fg:null,zr:!1,xr:!1,Br:!1};a=e(m.Ua,a,g,h);m.gf=a;b=[];c=A.PF(a);for(d=0;d<c.length;d++)b.push(c[d]);m.fg=b;A.ea(a,function(a,b){!(b.Cb||b.Ag||b.Xk)||m.do_not_load_resources&&b.yb||(m.ep+=b.Ab)});l.jf.push(m);l.Zm++;return m.id};a.kK=function(b){var c=v;if(c&&!n())if(c.Vr)c.Vr=!1;else{var f=performance.now();do{var d=c.jf[c.Jq],e=b[d.id];if(!u(d))if(0==d.status&&(d.status=1,d.cz=performance.now(),d.ht(0,
0)),m(d)){var g=d,h=g.fg.length;do{var q=A.Ka(g.gf,g.fg[0]),r=k(g,q,e);q.mb==a.uh&&(g.Fs=!0);q=g.fg.shift();g.fg.push(q);h--}while(!r&&0!=h)}else g=c,h=d,h.yq(e,h),h.status=3,g.Zm--,l(h);c.it&&(c.Jq=(c.Jq+1)%c.jf.length);if(d.Fs){d.Fs=!1;break}}while(16>performance.now()-f)}};a.ru=function(a){var b=v;a.yq(null,a);a.status=3;b.Zm--;l(a);a.status=4;a.Ua&&(b.it=!0);a.ex(a.id,!1)};a.JN=q;a.bp=function(a,b){var c=y(a,b);null!==c&&f(c)};a.ei=n;a.AJ=u;a.is_primary_loaded=function(a){var b=v;if(!b)return!1;
a|=0;return b.jf[a]&&(3==b.jf[a].status||2==b.jf[a].status)};a.WF=function(){B.error("Debug mode isn't enabled. Can not retrieve the graph.")};a.cleanup=function(){v=null}};b4w.module.__logic_nodes=function(a,p){function e(){return function(a,b,c,d){c=d[0];var f=d[1];d=d[2];if(-2==c.state){for(var e=0;e<c.Wo;e++)if(B.get_sensor_value(a,b,e))for(var g=0;g<c.Vo.length;g++)if(c.Vo[g]==e){f.mi==c.Zy?(u.is_play(f.W)&&(c.state=-1),d.le.td||(c.state=1,c.om=c.qo[g])):(c.state=1,c.om=c.qo[g]);return}c.state=0}}}function b(){return function(a,b,c,d){c=d[0];var f=d[1];d=d[2];for(var e=0;e<c.Wo;e++)if(B.get_sensor_value(a,b,e)&&e==c.py){if(u.is_play(f.W)&&f.mi==c.Zy)c.state=-1;
else if(!d.le.td||c.L.no_wait)c.state=1;return}c.state=0}}function c(a,b,c){return a[0]?b[a[1]]:c[a[1]]}function m(a,b,c,d){a[0]?b[a[1]]=d:c[a[1]]=d}function k(a,b,c){switch(b.state){case 1:n.error("Unknown node type: "+a.type);break;case 2:c.S=a.ja}}function r(a,b,c,d){for(var f=Q[a],e=0;e<Q[a].Bc.length;e++){f.Hq=Q[a].Bc[e];var g=Q[a].Bc[e],h=f,k=b,l=c,n=d,m=g.D;if(m.length){for(var q=0;q<m.length;q++)m[q].Qo=!1;for(q=0;q<m.length;q++){if(0<=g.le.S)var r=m[g.le.S];else break;if(r.Qo)break;if(r.mute)if("ENTRYPOINT"==
r.type)break;else g.le.S=r.ja,r.Qo=!0;else r.Wx(r,h,g.le,k,l,n),r.Qo=!0}}}}function h(a){return f.Jb(f.cc,a.tl||[],0)}function q(a,b){var c=a.b4w_logic_nodes,d=b.Bc;b.state=1;for(var f=0;f<c.length;f++){var e={D:[],le:{Ca:a,S:0,td:!1,vt:f,p:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};d.push(e);for(var g=d[d.length-1],h=c[f],l=0;l<h.length;l++){var n=h[l],n={name:n.name,type:n.type,label:n.label,ja:n.slot_idx_order,om:n.slot_idx_jump,ba:n.frame_range[0],ra:n.frame_range[1],WE:n.frame_range_mask?n.frame_range_mask[0]:
!0,UE:n.frame_range_mask?n.frame_range_mask[1]:!0,state:-1,Wo:-1,py:-1,xH:n.param_name,vH:n.operation,mute:n.mute,tl:n.object,obj:null,Za:{},Pd:n.anim_name,zH:n.parse_json_vars,yH:n.parse_json_paths,kc:n.objects_paths,ls:n.nodes_paths,xb:n.floats,L:n.bools,V:n.variables,gg:n.strings,Wr:n.materials_names,xy:n.shader_nd_type,ld:n.common_usage_names,xE:n.encode_json_vars,wE:n.encode_json_paths,Zy:g,Wx:Y[n.type]?Y[n.type]:k,Qo:!1,jp:0,kp:0,rb:null,Vo:null,KG:n.links,qo:[]};g.D.push(n)}for(h=0;h<g.D.length;h++)n=
g.D[h],n.Wx(n,b,e.le,0,0)}var c=a.timeline_markers,m;for(m in c)b.pm.push(c[m]);b.pm.sort(function(a,b){return a-b});b.state=2;Q.push(b)}function g(a,b){switch(b){case 0:return Boolean(Number(a))?Number(a):0;case 1:return String(a);default:return null}}function y(a){switch(typeof a){case "string":return g(a,1);case "number":return g(a,0);default:return g(a,1)}}var f=p("__objects"),l=p("__scenes"),n=p("__print"),u=p("__nla"),A=p("__config"),B=p("__controls"),H=p("__util"),v=p("__animation"),E=p("__assets"),
z=p("__batch"),G=p("__geometry"),d=p("__time"),F=p("__camera"),J=p("__vec3"),C=p("__physics"),D=p("__transform"),O=p("__sfx"),T=p("__mat3"),K=p("__mat4"),w=p("__tsr"),t=p("__quat"),Q=[],N={},P=new Float32Array(4);new Float32Array(4);var S=new Float32Array(3),Z=new Float32Array(3),M=new Float32Array(2),U=new Float32Array(9),ea=new Float32Array(16);a.AA=0;a.BA=1;a.au=0;a.cu=1;a.bu=2;a.du=3;a.eu=4;a.$t=5;a.yA=0;a.zA=1;var Y={ENTRYPOINT:function(a,b,c){switch(b.state){case 2:c.S=a.ja}},HIDE:function(a,
b,c){switch(b.state){case 1:a.obj=h(a);break;case 2:l.Zk(a.obj,!0),c.S=a.ja}},SHOW:function(a,b,c){switch(b.state){case 1:a.obj=h(a);break;case 2:l.Zk(a.obj,!1),c.S=a.ja}},PAGEPARAM:function(a,b,c){switch(b.state){case 2:var d=a.V.vd;b=b.p;var f=c.p,e;a:{e=a.xH;var h=a.xb.ptp,k=a.L.hsh,l=A.get("url_params");if(l&&e in l)e=Number(l[e]);else{if(k=k?location.hash:location.search)for(k=k.slice(1).split("&"),l=0;l<k.length;l++){var n=k[l].split("=");if(1<n.length&&n[0]==e){e=g(n[1],h);break a}}e=0}}m(d,
b,f,e);c.S=a.ja}},SWITCH_SELECT:function(a,b,c){switch(b.state){case 1:a:{c=b.Bc[c.vt];var d=f.get_selectable_objects();a.Vo=[];a.qo=[];for(var g in a.kc){var h=f.Jb(f.cc,a.kc[g],0),k=d.indexOf(h);if(-1==k){n.error("logic script error: non-selectable object:",a.kc[g][a.kc[g].length-1]);break a}a.Vo.push(k);a.qo.push(a.KG[g])}a.state=-1;a.Wo=d.length;g=[];for(k=0;k<d.length;k++)g.push(B.create_selection_sensor(d[k],!0));B.create_sensor_manifold(h,"LOGIC_NODES_SWITCH_SELECT_"+a.label,B.CT_SHOT,g,B.vv,
e(),[a,b,c])}break;case 2:if(-1==a.state){b=b.Bc[c.vt].D;for(h=0;h<b.length;h++)d=b[h],"SWITCH_SELECT"==d.type&&(d.state=-1);a.state=-2}-1<a.state&&(c.S=a.state?a.om:a.ja,a.state=-1)}},SELECT:function(a,c,d){switch(c.state){case 1:d=c.Bc[d.vt];var e=h(a),g=f.get_selectable_objects(),k=g.indexOf(e);if(-1==k)n.error("logic script error: non-selectable object:",a.tl[a.tl.length-1]);else{a.state=-1;a.Wo=g.length;a.py=k;for(var k=[],l=0;l<g.length;l++)k.push(B.create_selection_sensor(g[l],!0));B.create_sensor_manifold(e,
"LOGIC_NODES_SELECT_"+a.label,B.CT_SHOT,k,B.vv,b(),[a,c,d])}break;case 2:if(-1<a.state){d.S=a.state?a.om:a.ja;a.state=-1;break}a.L.not_wait&&(d.S=a.ja)}},PLAY:function(a,b,c,d){switch(b.state){case 1:u.jt();a.state=-1;a.L.not_wait||(a.L.not_wait=!1);break;case 2:switch(a.state){case -1:if(u.is_play(b.W))if(b.Hq==b.mi&&c.td)break;else{var f=b.mi;if(f){f.le.S=f.D[f.le.S].ja;f.D[f.le.S].state=-1;for(var f=b.mi.D,e=0;e<f.length;e++){var g=f[e];"PLAY"==g.type&&(g.state=-1)}}}c.td=!a.L.not_wait;b.mi=b.Hq;
a.state=0;a.WE&&(u.JI(a.ba),u.sy(d));if(a.UE)u.Ts(a.ra);else{d=u.get_frame(d);var f=-1,h;for(h in b.pm)if(d<b.pm[h]){f=h;break}0<=f?u.Ts(b.pm[f]):u.Ts(u.get_frame_end())}u.Rx(null);a.L.not_wait&&(c.S=a.ja,a.state=-1,c.td=!1);break;case 0:u.is_play()||(c.S=a.ja,a.state=-1,c.td=!1);break;case 1:c.S=a.ja;a.state=-1;b.mi=null;c.td=!1;break;default:H.da("Unknown state of "+a.name),a.state=-1}}},REDIRECT:function(a,b,d){switch(b.state){case 2:window.location.href=a.L.url?g(c(a.V.url,b.p,d.p),1):a.gg.url,
b.state=3}},MATH:function(a,b,d){switch(b.state){case 2:var f=-1==a.V.v1[1]?a.xb.inp1:g(c(a.V.v1,b.p,d.p),0),e=-1==a.V.v2[1]?a.xb.inp2:g(c(a.V.v2,b.p,d.p),0),h=0;switch(a.vH){case "ADD":h=f+e;break;case "MUL":h=f*e;break;case "SUB":h=f-e;break;case "DIV":0==e&&H.da("Division by zero in Logic script");h=f/e;break;case "RAND":h=Math.random()*(e-f)+f}m(a.V.vd,b.p,d.p,h);d.S=a.ja}},CONDJUMP:function(a,b,d){switch(b.state){case 2:var f=a.L.str?1:0,e=a.L.str?a.gg:a.xb,h=-1==a.V.v1[1]?e.inp1:g(c(a.V.v1,
b.p,d.p),f);b=-1==a.V.v2[1]?e.inp2:g(c(a.V.v2,b.p,d.p),f);f=!1;switch(a.ld.condition){case 5:h==b&&(f=!0);break;case 4:h!=b&&(f=!0);break;case 3:h<b&&(f=!0);break;case 2:h>b&&(f=!0);break;case 1:h<=b&&(f=!0);break;case 0:h>=b&&(f=!0)}d.S=f?a.om:a.ja}},REGSTORE:function(a,b,c){switch(b.state){case 2:m([a.L.gl||a.V.vd[0],a.V.vd[1]],b.p,c.p,(1==a.ld.variable_type?a.gg:a.xb).inp1),c.S=a.ja}},PLAY_ANIM:function(a,b,c){var d=v.SLOT_ALL;""==!a.Pd&&(d=v.SLOT_0);switch(b.state){case 1:a.obj=a.L.env?f.get_world_by_name(a.tl[0],
0):h(a);(c=a.ld.param_anim_behavior)||(c="FINISH_STOP");a.kp=v.Pp(c);break;case 2:switch(v.is_play(a.obj,d)||0!=a.state||(a.state=1),a.state){case -1:for(var e in b.Bc){var g=b.Bc[e].le.S;-1!=g&&(g=b.Bc[e].D[g],"PLAY_ANIM"==g.type&&g!=a&&0==g.state&&g.obj==a.obj&&(g.state=1))}if(""==a.Pd)v.apply_def(a.obj),v.set_behavior(a.obj,a.kp,d);else{a:{for(e=b=0;8>e;e++)if((g=a.obj.O[e])&&g.qf&&g.qf==a.Pd)if(0==b)b=1;else{b=!1;break a}b=1==b?!0:!1}b||(v.apply(a.obj,a.Pd,d),v.set_behavior(a.obj,a.kp,d))}a.L.not_wait||
(c.td=!0);v.play(a.obj,null,d);a.state=0;a.L.not_wait&&(c.S=a.ja,a.state=-1);break;case 0:break;case 1:a.L.not_wait||(c.td=!1);c.S=a.ja;a.state=-1;break;default:H.da("Unknown state of "+a.name),a.state=-1}}},SELECT_PLAY:function(a,b,c){switch(b.state){case 2:c.S=a.ja}},SEND_REQ:function(a,b,d){function f(a,c,e,g,h){a=JSON.stringify(a);m(h[0].V.dst,b.p,d.p,a);h[0].state=1}switch(b.state){case 2:switch(a.state){case -1:a.state=0;var e=a.L.url?g(c(a.V.url,b.p,d.p),1):a.gg.url,h={};a.L.ct&&(h["Content-Type"]=
a.gg.ct);"GET"==a.ld.request_type?E.enqueue([{id:e,type:E.AT_JSON,url:e,Sg:h,lb:[a,d.p]}],f,null,null,null):"POST"==a.ld.request_type&&E.enqueue([{id:e,type:E.AT_JSON,url:e,Sg:h,Cd:"POST",xi:E.AT_JSON,Vg:g(c(a.V.dst1,b.p,d.p),1),lb:[a,d.p]}],f,null,null,null);break;case 1:a.state=-1,d.S=a.ja}}},INHERIT_MAT:function(a,b,c){switch(b.state){case 1:for(b=0;2>b;b++)a.Za["id"+b]=f.Jb(f.cc,a.kc["id"+b],0);break;case 2:z.inherit_material(a.Za.id0,a.Wr.id0,a.Za.id1,a.Wr.id1),c.S=a.ja}},SET_SHADER_NODE_PARAM:function(a,
b,d){switch(b.state){case 1:a.kc.id0&&(a.Za.id0=f.Jb(f.cc,a.kc.id0,0),a.ls.id0.unshift(a.Wr.id0));break;case 2:"ShaderNodeRGB"==a.xy&&z.set_nodemat_rgb(a.Za.id0,a.ls.id0,a.L.id0?g(c(a.V.id0,b.p,d.p),0):a.xb.id0,a.L.id1?g(c(a.V.id1,b.p,d.p),0):a.xb.id1,a.L.id2?g(c(a.V.id2,b.p,d.p),0):a.xb.id2),"ShaderNodeValue"==a.xy&&z.set_nodemat_value(a.Za.id0,a.ls.id0,a.L.id0?g(c(a.V.id0,b.p,d.p),0):a.xb.id0),d.S=a.ja}},DELAY:function(a,b,d,f,e){switch(b.state){case 2:-1==a.state?(a.state=0,a.jp=0,d.td=!0):0==
a.state&&(a.jp+=e,(a.L.dl?g(c(a.V.dl,b.p,d.p),0):a.xb.dl)<a.jp&&(a.state=-1,d.S=a.ja,d.td=!1))}},APPLY_SHAPE_KEY:function(a,b,d){switch(b.state){case 1:b=a.Za.id0=f.Jb(f.cc,a.kc.id0,0);d=a.ld.sk;G.check_shape_keys(b)?G.yr(b,d)||(n.error("Wrong key name:",d),a.mute=!0):(n.error("No shape keys in object:",b.name),a.mute=!0);break;case 2:G.Au(a.Za.id0,a.ld.sk,a.L.skv?g(c(a.V.skv,b.p,d.p),0):a.xb.skv),d.S=a.ja}},OUTLINE:function(a,b,d){switch(b.state){case 1:var e=a.Za.id0=f.Jb(f.cc,a.kc.id0,0);e&&e.g&&
e.g.Kb||(n.error("Can't evaluate 'Outline' logic node: wrong object"),a.mute=!0);break;case 2:e=a.Za.id0;switch(a.ld.outline_operation){case "PLAY":b=e.g.Wj;f.apply_outline_anim(e,b.Xj,b.Yj,b.Zj);break;case "STOP":f.clear_outline_anim(e);break;case "INTENSITY":e.g.Yf=a.L["in"]?g(c(a.V["in"],b.p,d.p),0):a.xb["in"]}d.S=a.ja}},MOVE_CAMERA:function(a,b,e){function h(a,b,c,d){switch(F.get_move_style(a)){case F.MS_TARGET_CONTROLS:F.set_trans_pivot(a,b,c);break;case F.MS_EYE_CONTROLS:case F.MS_STATIC:D.set_tsr(a,
d);break;case F.MS_HOVER_CONTROLS:J.sub(c,b,S),J.normalize(S,S),F.set_hover_pivot(a,c),c=b=0,Z[0]=S[0],Z[1]=0,Z[2]=S[2],b=J.dot(Z,S),c=Math.acos(b/(J.length(Z)*J.length(S))),b=S[2]?Math.atan(S[0]/S[2]):0<S[0]?0:Math.PI,0<S[2]&&0<S[0]?M[1]=-(Math.PI+M[1]):0<S[2]&&0>S[0]?M[1]=-(Math.PI+M[1]):0>S[2]&&0>S[0]?(M[0]+=Math.PI,b=-(Math.PI-b)):0>S[2]&&0<S[0]&&(M[0]+=Math.PI,b-=Math.PI),F.rotate_hover_camera(a,b+Math.PI,-c,!0,!0)}D.n(a);C.sync_transform(a)}function k(a,b,c,d){K.lookAt(b,c,H.AXIS_Y,ea);K.invert(ea,
ea);K.rotateX(ea,Math.PI/2,ea);T.fromMat4(ea,U);t.fromMat3(U,P);t.normalize(P,P);a=w.get_scale(a.g.i);w.set_sep(b,a,P,d)}switch(b.state){case 1:a.Za.ca=f.Jb(f.cc,a.kc.id0,0);a.Za.tr=f.Jb(f.cc,a.kc.id1,0);a.Za.ta=f.Jb(f.cc,a.kc.id2,0);a.state=-1;a.rb={kz:new Float32Array(3),jz:new Float32Array(3),Gr:new Float32Array(3),st:new Float32Array(3),Yy:new Float32Array(3),Fr:new Float32Array(3),kh:new Float32Array(8),kf:new Float32Array(8),Nl:new Float32Array(8)};break;case 2:var n=a.Za.ca,m=w.get_trans_view(a.Za.tr.g.i),
q=w.get_trans_view(a.Za.ta.g.i);switch(a.state){case -1:b=a.L.dur?g(c(a.V.dur,b.p,e.p),0):a.xb.dur;if(0==b){k(n,m,q,a.rb.kf);h(n,m,q,a.rb.kf);e.S=a.ja;break}e=w.get_trans_view(n.g.i);J.copy(e,a.rb.kz);var r=F.get_move_style(n);r==F.MS_HOVER_CONTROLS?J.copy(n.g.fb,a.rb.st):r==F.MS_STATIC||r==F.MS_EYE_CONTROLS?(w.copy(n.g.i,a.rb.kh),k(n,m,q,a.rb.kf)):J.copy(n.g.pivot,a.rb.st);J.copy(m,a.rb.jz);J.copy(q,a.rb.Yy);a.state=0;var p=d.animate(0,1,1E3*b,function(b){l.ma()&&(r==F.MS_STATIC||r==F.MS_EYE_CONTROLS?
w.interpolate(a.rb.kh,a.rb.kf,H.smooth_step(b),a.rb.Nl):(a.rb.Fr=J.lerp(a.rb.st,a.rb.Yy,H.smooth_step(b),a.rb.Fr),a.rb.Gr=J.lerp(a.rb.kz,a.rb.jz,H.smooth_step(b),a.rb.Gr)),h(n,a.rb.Gr,a.rb.Fr,a.rb.Nl),1==b&&(a.state=1))});break;case 1:d.clear_animation(p),a.state=-1,e.S=a.ja}}},SET_CAMERA_MOVE_STYLE:function(a,b,c){switch(b.state){case 1:a.kp=F.kH(a.ld.camera_move_style);break;case 2:b=l.Hl(c.Ca),D.n(b),C.sync_transform(b),c.S=a.ja}},MOVE_TO:function(a,b,e){function h(a,b){D.set_tsr(a,b);D.n(a);C.sync_transform(a)}
switch(b.state){case 1:a.Za.ob=f.Jb(f.cc,a.kc.id0,0);a.Za.de=f.Jb(f.cc,a.kc.id1,0);a.state=-1;a.kb={zv:new Float32Array(8),Pq:new Float32Array(8),Bw:new Float32Array(8)};break;case 2:var k=a.Za.ob;w.copy(a.Za.ob.g.i,a.kb.zv);w.copy(a.Za.de.g.i,a.kb.Pq);switch(a.state){case -1:b=a.L.dur?g(c(a.V.dur,b.p,e.p),0):a.xb.dur;if(0==b){h(k,a.kb.Pq);e.S=a.ja;break}a.state=0;var n=d.animate(0,1,1E3*b,function(b){l.ma()&&(a.kb.WM=w.interpolate(a.kb.zv,a.kb.Pq,H.smooth_step(b),a.kb.Bw),h(k,a.kb.Bw),1==b&&(a.state=
1))});break;case 1:d.clear_animation(n),a.state=-1,e.S=a.ja}}},TRANSFORM_OBJECT:function(a,b,e){function h(a,b,c){0==c?D.set_tsr(a,b):D.set_tsr_rel(a,b);D.n(a);C.sync_transform(a)}switch(b.state){case 1:a.Za.ob=f.Jb(f.cc,a.kc.id0,0);a.state=-1;a.kb={dp:0,kh:new Float32Array(8),kf:new Float32Array(8),Nl:new Float32Array(8)};break;case 2:var k=a.Za.ob;switch(a.state){case -1:Z[0]=a.L.trx?g(c(a.V.trx,b.p,e.p),0):a.xb.trx;Z[1]=a.L["try"]?g(c(a.V["try"],b.p,e.p),0):a.xb["try"];Z[2]=a.L.trz?g(c(a.V.trz,
b.p,e.p),0):a.xb.trz;S[0]=a.L.rox?g(c(a.V.rox,b.p,e.p),0):a.xb.rox;S[1]=a.L.roy?g(c(a.V.roy,b.p,e.p),0):a.xb.roy;S[2]=a.L.roz?g(c(a.V.roz,b.p,e.p),0):a.xb.roz;var n=a.L.sc?c(a.V.sc,b.p,e.p):a.xb.sc;if(a.L["try"]||a.L.trz)M[1]=-Z[1],Z[1]=Z[2],Z[2]=M[1];if(a.L.roy||a.L.roz)M[1]=-S[1],S[1]=S[2],S[2]=M[1];H.euler_to_quat(S,P);w.set_sep(Z,n,P,a.kb.kf);a.kb.dp=a.ld.space_type;switch(a.kb.dp){case 0:D.get_tsr(k,a.kb.kh);break;case 1:D.get_tsr_rel(k,a.kb.kh);break;case 2:D.get_tsr_rel(k,a.kb.kh),w.multiply(a.kb.kh,
a.kb.kf,a.kb.kf)}b=a.L.dur?g(c(a.V.dur,b.p,e.p),0):a.xb.dur;if(0==b){h(k,a.kb.kf,a.kb.dp);e.S=a.ja;break}a.state=0;n=d.animate(0,1,1E3*b,function(b){l.ma()&&(w.interpolate(a.kb.kh,a.kb.kf,H.smooth_step(b),a.kb.Nl),h(k,a.kb.Nl,a.kb.dp),1==b&&(a.state=1))});break;case 1:d.clear_animation(n),a.state=-1,e.S=a.ja}}},SPEAKER_PLAY:function(a,b,c){switch(b.state){case 1:a.obj=f.Jb(f.cc,a.kc.id0,0);void 0==a.L.not_wait&&(a.L.not_wait=!0);break;case 2:switch(O.is_playing(a.obj)||0!=a.state||(a.state=1),a.state){case -1:for(var d in b.Bc){var e=
b.Bc[d].le.S;-1!=e&&(e=b.Bc[d].D[e],"SPEAKER_PLAY"==e.type&&e!=a&&0==e.state&&e.obj==a.obj&&(e.state=1))}a.L.not_wait||(c.td=!0);O.play_def(a.obj);a.state=0;break;case 0:a.L.not_wait&&(c.S=a.ja,a.state=-1);break;case 1:a.L.not_wait||(c.td=!1);c.S=a.ja;a.state=-1;break;default:H.da("Unknown state of "+a.name),a.state=-1}}},SPEAKER_STOP:function(a,b,c){switch(b.state){case 1:a.obj=f.Jb(f.cc,a.kc.id0,0);break;case 2:O.stop(a.obj),c.S=a.ja}},STOP_ANIM:function(a,b,c){switch(b.state){case 1:a.obj=a.L.env?
f.get_world_by_name(a.tl[0],0):h(a);break;case 2:v.stop(a.obj,v.SLOT_ALL),a.L.rst&&v.set_first_frame(a.obj,v.SLOT_ALL),c.S=a.ja}},STOP_TIMELINE:function(a,b,c,d){switch(b.state){case 2:a.L.rst&&u.sy(d),u.jt(),c.S=a.ja}},CONSOLE_PRINT:function(a,b,d){switch(b.state){case 2:var f={},e;for(e in a.V)f[a.V[e][1]]=c(a.V[e],b.p,d.p);n.log(a.ld.msg,JSON.stringify(f));d.S=a.ja}},STRING:function(a,b,d){switch(b.state){case 2:var f=a.L.id0?g(c(a.V.id0,b.p,d.p),1):a.gg.id0,e=a.L.id1?g(c(a.V.id1,b.p,d.p),1):a.gg.id1,
h=0;switch(a.xb.sop){case 0:h=f+e;break;case 1:h=f.indexOf(e);break;case 2:h=f.replace(e,a.L.id2?g(c(a.V.id2,b.p,d.p),1):a.gg.id2);break;case 3:h=f.substring(0,f.indexOf(e));m(a.V.dst1,b.p,d.p,f.substring(f.indexOf(e)+1,f.length));""==c(vars.dst,b.p,d.p)&&(h=c(vars.dst1,b.p,d.p),m(vars.dst1,b.p,d.p,""));break;case 4:switch(a.ld.condition){case 5:h=f==e?1:0;break;case 4:h=f!=e?1:0;break;case 3:h=f<e?1:0;break;case 2:h=f>e?1:0;break;case 1:h=f<=e?1:0;break;case 0:h=f>=e?1:0}}m(a.V.dst,b.p,d.p,h);d.S=
a.ja}},GET_TIMELINE:function(a,b,c,f){switch(b.state){case 2:f=a.L.nla?g(u.get_frame(f),0):g(d.get_frame(f),0),m(a.V.vd,b.p,c.p,f),c.S=a.ja}},JSON:function(a,b,d){function f(a,b,c,d){for(var e=0;e<b.length;e++){for(var g=b[e].split("."),h=a,k=c[e],l=0;l<g.length&&(h=h[g[l]],void 0!==h&&null!==h);l++);h=y(h);d[k]=h}}function e(a,b,c,d){d||(d={});for(var f=0;f<b.length;f++){var g=b[f].split("."),h=d,k=c[f];if(!(!k in a)){for(var l=0;l<g.length-1;l++)void 0===h[g[l]]&&(h[g[l]]=isNaN(g[l+1])?{}:[]),h=
h[g[l]];h[g[g.length-1]]=y(a[k])}}}switch(b.state){case 2:switch(a.ld.json_operation){case "PARSE":try{var h=JSON.parse(g(c(a.V.jsn,b.p,d.p),1));f(h,a.yH,a.zH,d.p)}catch(k){n.error("logic script error: non valid JSON string")}break;case "ENCODE":h={},e(d.p,a.wE,a.xE,h),h=g(JSON.stringify(h),1),m(a.V.jsn,b.p,d.p,h)}d.S=a.ja}},JS_CALLBACK:function(a,b,d){switch(b.state){case 2:for(var e=a.L.cb?g(c(a.V.cb,b.p,d.p),1):a.gg.cb,h=[],k=0,l="id"+k,n=a.common_usage_names.js_cb_params;l in n;)l=0==n[l]?f.Jb(f.cc,
a.kc[l],0):c(a.V[l],b.p,d.p),h.push(l),k++,l="id"+k;n=[];k=0;for(l="out"+k;l in a.vars;)l=c(a.V[l],b.p,d.p),n.push(l),k++,l="out"+k;N[e](h,n);for(e=0;e<n.length;e++)l="out"+e,l in a.vars&&m(a.V[l],b.p,d.p,y(n[e]));d.S=a.ja}}};a.dG=function(a,b){var c={Lc:b,oy:a.name,state:0,mi:null,Ca:a,Hq:null,Bc:[],pm:[],p:{}};a.BL=c;q(a,c)};a.update=function(a,b){var c=u.QF();if(!(0>=c))for(var d=0;d<Q.length;d++)r(d,a,b,c)};a.NB=function(a,b){N[a]=b};a.TH=function(a){delete N[a]};a.gI=function(a,b){for(var c=
0;c<Q.length;c++){if(Q[c].oy==a){for(var c=Q[c],d=0;d<c.Bc.length;d++){var f=c.Bc[d].D[0];if(f.name==b){f.L.js&&(f.mute=!1);break}}break}r(c,timeline,elapsed,start_time)}};a.cleanup=function(){Q.length=0;N={}}};b4w.module.__math=function(a,p){function e(a,b){for(var c=a[1],e=1,g=2;g<a.length;g++)4!=g&&8!=g&&Math.abs(a[g])>Math.abs(c)&&(c=a[g],e=g);for(var h=Math.floor(e/3),e=e%3,c=.5*Math.atan(2*c/(a[3*h+h]-a[3*e+e])),g=0;g<b.length;g++)b[g]=0==g||4==g||8==g?1:0;b[e+3*h]=-Math.sin(c);b[h+3*e]=Math.sin(c);b[h+3*h]=Math.cos(c);b[e+3*e]=Math.cos(c);return b}function b(a){return Math.sqrt(a[1]*a[1]+a[2]*a[2]+a[5]*a[5])}var c=p("__vec3"),m=p("__mat3"),k=new Float32Array(3),r=new Float32Array(9),h=new Float32Array(9),
q=new Float32Array(9),g=new Float32Array(9);a.get_pline_directional_vec=function(a,b){b=b||new Float32Array(3);b[0]=a[3];b[1]=a[4];b[2]=a[5];return b};a.get_pline_initial_point=function(a,b){b=b||new Float32Array(3);return c.copy(a,b)};a.set_pline_initial_point=function(a,b){c.copy(b,a)};a.set_pline_directional_vec=function(a,b){c.normalize(b,k);a[3]=k[0];a[4]=k[1];a[5]=k[2]};a.calc_pline_point=function(a,b,c){c=c||new Float32Array(3);c[0]=a[0]+a[3]*b;c[1]=a[1]+a[4]*b;c[2]=a[2]+a[5]*b};a.HC=function(a,
b){for(var e=0;e<a.length;e+=3)b[0]+=a[e],b[1]+=a[e+1],b[2]+=a[e+2];return c.scale(b,3/a.length,b)};a.EC=function(a,b,c){for(var e=0;e<c.length;e++)c[e]=0;for(e=0;e<a.length;e+=3){var g=a[e]-b[0],h=a[e+1]-b[1],k=a[e+2]-b[2];c[0]+=g*g;c[1]+=g*h;c[2]+=g*k;c[4]+=h*h;c[5]+=h*k;c[8]+=k*k}c[3]=c[1];c[6]=c[2];c[7]=c[5];for(e=0;e<c.length;e++)c[e]*=3/a.length;return c};a.KE=function(a,c){var k=m.copy(a,r);if(5E-4>b(k))return m.identity(c);var n=e(k,h),p=m.transpose(n,q);m.multiply(k,p,g);m.multiply(n,g,k);
for(var A=m.copy(n,c),B=1;5E-4<=b(k)&&100>B;)n=e(k,h),p=m.transpose(n,q),m.multiply(k,p,g),m.multiply(n,g,k),m.multiply(n,A,A),B++;return A};a.point_plane_dist=function(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}};b4w.module.__nla=function(a,p){function e(){return{type:"CLIP",ba:0,ra:0,cg:!1,paused:!1,Pd:"",Qk:"",qc:0,ug:0,xh:0,Gv:0,Fv:0,yz:!1,scale:1,repeat:1,tu:0}}function b(a,c){if(a.animation_data){var f=a.animation_data.nla_tracks;if(f)for(var e=0;e<f.length;e++)c.push(f[e])}f=a.nodes;for(e=0;e<f.length;e++){var g=f[e];g.node_group&&(g=g.node_group.node_tree)&&b(g,c)}}function c(a,b){var c=Math.round(a)-b.ba;b.Ki&&(c%=b.pj,0>c&&(c+=b.pj));return b.bb+c}function m(a,b){var c=(b-z)*H.Xb()+a.bb;c>a.ba?(c-=
a.ba,a.cyclic&&(c%=a.ra-a.ba+1),c+=a.ba):c=a.ba;return c}function k(a,b){a=v.clamp(a,b.ba,b.ra);var c=a==b.ra?b.tu:b.ug+(a-b.ba)/b.scale%(b.xh-b.ug);b.yz&&(c=b.xh-c+b.ug);return c}function r(a,b){for(var c=[],f=0;f<a.length;f++){var g=a[f].strips;if(g)for(var h=0;h<g.length;h++){var k=g[h],l=e();l.type=k.type;l.ba=k.frame_start;l.ra=k.frame_end;l.qc=b;l.ug=k.action_frame_start;l.xh=k.action_frame_end;l.yz=k.use_reverse;l.scale=k.scale;l.repeat=k.repeat;k.action&&(l.Pd=k.action.name,l.Qk=k.action.uuid);
c.push(l)}}return c}function h(a){return("SPEAKER"==a.type||"LAMP"==a.type)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function q(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],f=c.node_tree;if(c=c.use_nodes&&f)a:{if(f.animation_data&&(c=f.animation_data.nla_tracks)&&c.length){c=!0;break a}f=f.nodes;for(c=0;c<f.length;c++);c=!1}if(c)return!0}return!1}function g(a,b){var c=u.get_active();if(c.W){var f=m(c.W,
b);c.W.bb-=f-a;c.W.nj=!0}}var y=p("__animation");p("__config");var f=p("__objects"),l=p("__obj_util"),n=p("__print"),u=p("__scenes"),A=p("__sfx"),B=p("__textures"),H=p("__time"),v=p("__util"),E=[],z=-1;a.lh=function(a,c){var f;f=null;for(var g=c.u.length-1;0<=g;g--){var k=c.u[g];if(k.Ca.b4w_use_nla&&(f=k,k.Ca.pu))break}if(f){f.Dx=!0;var n=0;if((g=a.animation_data)&&g.nla_tracks.length){var m=g.nla_tracks;if(l.is_armature(c)||l.is_camera(c)||l.is_mesh(c)||l.is_empty(c)||l.is_lamp(c)||l.is_speaker(c)||
l.is_world(c))m=r(m,n),m.length&&(c.ee=c.ee.concat(m),n++)}h(a)&&(m=a.data.animation_data.nla_tracks,m=r(m,n),m.length&&(c.ee=c.ee.concat(m),n++));if(l.is_mesh(c))for(k=a.data.materials,g=0;g<k.length;g++){var q=k[g];if(q.use_nodes&&q.node_tree&&(m=[],b(q.node_tree,m),m=r(m,n),m.length)){for(var q=n,p=m,u=y.qF(),t=[],A=0,N=0;N<p.length;N++){var P=p[N];""!=P.Qk?P=v.keysearch("uuid",P.Qk,u):(P=P.Pd,P=v.keysearch("name",P,u)||v.keysearch("name",P+"_B4W_BAKED",u));if(P){var P=P.fcurves,B=[],z;for(z in P)B.push(z);
t.push(B)}}for(N=0;N<t.length;N++){u=!1;for(P=0;P<N;P++)if(v.jC(t[N],t[P])){p[N].qc=p[P].qc;u=!0;break}u||(p[N].qc=n+A++)}n=q+A;c.ee=c.ee.concat(m)}}if(!l.is_world(c)){for(g=0;g<a.particle_systems.length;g++)k=a.particle_systems[g],z=k.settings,"EMITTER"==z.type&&z.b4w_allow_nla&&(z=e(),z.type="CLIP",z.ba=f.Ca.frame_start,z.ra=f.Ca.frame_end+1,z.Pd=k.name,z.qc=n,z.ug=z.ba,z.xh=z.ra,c.ee.push(z),n++);k=n+1;for(g=0;g<c.ac.length;g++)m=c.ac[g],m.GB&&(n=k,z=e(),z.type="CLIP",z.ba=f.Ca.frame_start,z.ra=
f.Ca.frame_end+1,z.Pd=m.name,z.qc=n,z.ug=z.ba,z.xh=z.ra,c.ee.push(z))}}};a.jK=function(a,b,c){a.W||(a.W={ba:a.frame_start,ra:a.frame_end,bb:0,Sl:-1,em:a.frame_end,fm:a.frame_start,Fk:null,cyclic:b,Za:[],Y:[],oy:a.name,Lg:!1,nj:!1,Gs:!0},E.push(a.W));b=a.W;for(var g=f.OF(a,c),h=0;h<g.length;h++){var k=g[h];if(k.ee.length){for(var l=0;l<k.u.length;l++){var m=k.u[l];m.Ca==a&&m.Dx&&b.Za.push(k)}for(var l=k.ee,m=b,q=k.name,r=0;r<l.length;r++){var t=l[r];m.ba>t.ra||m.ra<t.ba?(n.warn("NLA: Strip is out of scene range: "+
(q+" ["+t.ba+":"+t.ra+"]")),l.splice(r,1),r--):t.Pd||"CLIP"!=t.type||(n.warn('NLA: no action in strip for object "'+q+'".'),l.splice(r,1),r--)}k=k.ee;l=b;for(m=0;m<k.length;m++){for(var q=k[m],r=l.ba,t=l.ra+1,p=0;p<k.length;p++){var u=k[p];q.qc==u.qc&&(u.ra<=q.ba&&(r=q.ba),u.ba>=q.ra&&(t=Math.min(t,u.ba)))}q.Gv=r;q.Fv=t;q.tu=0===q.repeat%1?q.xh:q.ug+q.repeat%1*(q.xh-q.ug)}}}a=a.k.Hk;for(h=0;h<a.length;h++)g=a[h].k,g.tp&&(g.la||g.lc)&&g.mg==c&&(k=e(),k.type="VIDEO",g.Ki?(k.ba=0,k.ra=b.ra):(k.ba=v.clamp(g.ba,
0,b.ra),k.ra=v.clamp(g.ba+g.pj,0,b.ra)),k.Pd=a[h].name,b.Y.push(g))};a.start=function(){z=0};a.QF=function(){return z};a.GM=function(a){return a.W?a.W.bb:null};a.wN=function(a,b){return a.W?(a.W.bb=b,!0):!1};a.update=function(a,b){if(!(0>z)){0==z&&(z=a);for(var f=0;f<E.length;f++){var e=E[f];e.Lg&&(e.bb-=H.Xb()*b);var h=m(e,a);if((!e.Lg||e.nj)&&h>=e.em)if(e.cyclic){var h=e,l=a;h.Fk&&h.Fk();g(h.fm,l);h.Gs=!0;h=m(h,l)}else{var l=e,n=h;l.Lg=!0;l.bb-=n-l.em;l.Fk&&l.Fk()}if(!e.Lg||e.nj){for(var l=e,n=
h,q=0;q<l.Za.length;q++){for(var r=l.Za[q],p=r.ee,t=0;t<p.length;t++){var u=p[t];"SOUND"==u.type&&n<l.Sl-1E-6&&(u.cg=!1)}for(t=0;t<p.length;t++)switch(u=p[t],u.type){case "CLIP":if(u.Gv<=n&&n<u.Fv&&!u.cg){var N=r,P=u;""!=P.Qk?y.dC(N,P.Qk,P.qc):y.apply(N,P.Pd,P.qc);y.set_behavior(N,y.AB_FINISH_STOP,P.qc);var S=k(P.ba,P);y.set_frame(N,S,P.qc);for(N=0;N<p.length;N++)p[N]!=u&&p[N].qc==u.qc&&(p[N].cg=!1);u.cg=!0}u.cg&&(N=r,P=k(n,u),1E-6<Math.abs(P-y.bw(N,u.qc))&&y.set_frame(N,P,u.qc));break;case "SOUND":(n<
l.Sl-1E-6||l.Sl<u.ba)&&u.ba<=n&&n<u.ra&&!u.cg&&(N=r,S=u,P=(S.ba-n)/H.Xb(),S=(S.ra-S.ba)/H.Xb(),A.play(N,P,S),u.cg=!0),l.Sl<u.ra&&u.ra<=n&&u.cg&&(u.cg=!1)}}l=a;n=e;q=h;for(r=0;r<n.Y.length;r++)if(p=n.Y[r],p.la||p.lc){t=B.Hz(p);u=p;N=v.clamp(c(q,u),u.bb,u.bb+B.Iz(u)-1);u.lc&&(N=B.MK(u,N),N==u.Ps&&N--);u=N;N=B.Jz(p);S=P=!1;if(n.nj||n.Gs)S=!0;if(!n.Lg){var Z;Z=c(q,p);Z=p.bb<=Z&&Z<=p.bb+B.Iz(p);var M=B.Kz(p);p.Ki&&u==N&&(S=!0);M||t==u||(S=!0);Z&&!M?B.play_video(p.name,p.mg):Z&&M?P=!0:!Z&&M&&(p.la&&t<u?
P=!0:B.pause_video(p.name,p.mg))}S?(B.uI(p.name,u,p.mg),p.lc&&(p.fk=B.Xo(p,l))):P&&B.Lz(p)&&(p.la?B.vz(p):(t=B.Xo(p,l),t!=p.fk&&(p.Di=u,B.uz(p)),p.fk=t))}e.Sl=h}e.nj=!1;e.Gs=!1}}};a.cleanup=function(){E.length=0;z=-1};a.Nu=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||h(a)||q(a)?!0:!1};a.set_frame=g;a.get_frame=function(a){var b=u.get_active();return b.W?m(b.W,a):-1};a.jt=function(){var a=u.get_active();a.W&&(a.W.Lg=!0);for(var a=a.W.Y,b=0;b<a.length;b++){var c=a[b];B.pause_video(c.name,
c.mg)}};a.Rx=function(a){var b=u.get_active();b.W&&(b.W.Lg=!1,b.W.Fk=a?a:null)};a.get_frame_start=function(){var a=u.get_active();return a.W?a.W.ba:-1};a.get_frame_end=function(){var a=u.get_active();return a.W?a.W.ra:-1};a.is_play=function(){var a=u.get_active();return a.W?!a.W.Lg:!1};a.check_nla=function(){var a=u.get_active();return a.W?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=u.get_active();return a.W?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=u.get_active();
if(c.W)c.W.fm=a,c.W.em=b;else return!1};a.Ts=function(a){var b=u.get_active();b.W&&(b.W.em=a)};a.JI=function(a){var b=u.get_active();b.W&&(b.W.fm=a)};a.reset_range=function(){var a=u.get_active();if(a.W)a=a.W,a.fm=a.ba,a.em=a.ra;else return!1};a.set_cyclic=function(a){var b=u.get_active();if(b.W)b.W.cyclic=a;else return!1};a.clear_callback=function(){var a=u.get_active();a.W&&(a.W.Fk=null)};a.sy=function(a){var b=u.get_active().W;b&&(b.bb=-(a-z)*H.Xb()+b.fm,b.nj=!0)};a.get_frame_end=function(){var a=
u.get_active().W;return a?a.ra:null}};b4w.module.__camera=function(a,p){function e(a,b,c,d,f){da.set_translation(a,b);c&&B(a,b,c);z(a,d);G(a,f)}function b(a,b,c,d,f,e,g,h){var k=a.g;da.set_translation(a,b);k.pivot.set(c);B(a,b,c);z(a,d);G(a,f);C(a,e);D(a,g);k.use_panning=h}function c(a,b,c,f,e,g,h,k){var l=a.g;da.set_translation(a,b);l.fb.set(c);B(a,b,c);J(a,f);d(a,e);O(a,g);T(a,h);l.zl=k}function m(a,b,c){var d=a.g,f=L.get_trans_view(d.i),e=L.get_quat_view(d.i),d=ja;d.set(V.AXIS_Y);d[3]=0;a=y(a,X)[1];e=V.quat_to_dir(e,V.AXIS_MY,sa);
Aa.set_pline_initial_point(Ha,f);Aa.set_pline_directional_vec(Ha,e);if(!V.line_plane_intersect(d,-b,Ha,c)||Math.abs(a)<ya)R.warn("Active hover camera view vector and the supporting plane are parallel to each other. Hover pivot will be set based on the camera position."),c[0]=f[0],c[1]=0,c[2]=f[2];return c}function k(b){for(var c=b.g,d=0;d<b.u.length;d++){var f=b.u[d].M[0];if(f.type==a.fd)switch(c.Va){case a.MS_TARGET_CONTROLS:var e=L.get_trans_view(c.i);c.zj=oa.dist(e,c.pivot);c.Aj=f.top;break;case a.MS_HOVER_CONTROLS:e=
L.get_trans_view(c.i),c.zj=oa.dist(e,c.fb),c.Aj=f.top}}}function r(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),near:new Float32Array([0,0,0,0]),far:new Float32Array([0,0,0,0])}}function h(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function q(b){var c=
{type:b,name:"",DN:1,width:0,height:0,Zd:null,er:null,Db:null,od:null,Sa:0,Mc:0,near:0,far:0,left:0,right:0,top:0,bottom:0,Oc:Ca.create(),i:new Float32Array(9),Xa:new Float32Array(16),nb:new Float32Array(16),Ge:new Float32Array(16),Mz:new Float32Array(16),NH:new Float32Array(16),ef:new Float32Array(16),He:L.An(),cy:L.An(),Vs:L.An(),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,qd:null,dof_on:!1,fx:new Float32Array(3),qj:r(),vk:0,ke:0,Zb:null,ml:null,Fq:null,ov:new Float32Array(4),Jo:new Float32Array(4)};
c.Oc[0]=c.Oc[2]=45;c.Oc[1]=c.Oc[3]=55;if(b==a.Tb)return c;switch(b){case a.pc:l(c,40,.1,1E3);break;case a.fd:l(c,2.5,.1,1E3);break;case a.nf:break;case a.sg:break;case a.wh:break;case a.Hb:case a.Mb:case a.dd:case a.ed:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function g(b,c,d){if(b.type!=a.Hb&&b.type!=a.Mb&&b.type!=a.dd&&b.type!=a.ed)throw"set_stereo_params(): wrong camera type";if(b.type==a.Hb||b.type==a.Mb)b.vk=c;b.ke=d;Z(b,b.Sa);
if(la.ma()&&(c=la.get_active(),b=c.k.mc))for(c=ca.R(la.Hl(c),c).M,d=0;d<c.length;d++)ka(c[d],b)}function y(a,b){var c=L.get_quat_view(a.g.i);return f(c,b)}function f(a,b){var c=V.quat_to_dir(a,V.AXIS_Y,sa),d=V.quat_to_dir(a,V.AXIS_Z,I),f=-Math.asin(c[1]/oa.length(c)),c=Math.abs(f)>Math.PI/4?oa.scale(d,-V.sign(f),qa):oa.scale(c,-V.sign(d[1]),qa),e=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(f=V.sign(f)*Math.PI-f);d=e;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=f;return b}function l(b,c,d,
f,e){switch(b.type){case a.pc:case a.Hb:case a.Mb:b.Mc=c;b.Sa=1;break;case a.fd:b.top=c;b.Sa=1;break;case a.nf:delete b.Mc;b.Mc=c;b.Sa=e/c;break;case a.sg:b.top=c;b.Sa=e/c;break;case a.dd:case a.ed:break;default:R.error("set_frustum(): Unsupported camera type: "+b.type)}b.near=d;b.far=f}function n(b,c){var d=L.get_trans_view(c.g.i),f=L.get_quat_view(c.g.i),d=ha.fromRotationTranslation(f,d,ia);ha.rotateX(d,-Math.PI/2,d);ha.invert(d,b.Xa);if(la.ma())var e=la.get_active(),e=la.Z(e,"STEREO");if(b.type==
a.Hb||e&&e.enable_hmd_stereo&&b.type==a.dd)b.Xa[12]+=b.ke/2;else if(b.type==a.Mb||e&&e.enable_hmd_stereo&&b.type==a.ed)b.Xa[12]-=b.ke/2;if(b.Zb){L.from_mat4(b.Xa,b.cy);var e=b.Zb[0],d=b.Zb[1],f=b.Zb[2],g=b.Zb[3],h=ia;h[0]=1-2*e*e;h[1]=-2*e*d;h[2]=-2*e*f;h[3]=0;h[4]=-2*e*d;h[5]=1-2*d*d;h[6]=-2*d*f;h[7]=0;h[8]=-2*e*f;h[9]=-2*d*f;h[10]=1-2*f*f;h[11]=0;h[12]=-2*e*g;h[13]=-2*d*g;h[14]=-2*f*g;h[15]=1;ha.multiply(b.Xa,h,b.Xa);Z(b,b.Sa,!0);e=ja;d=ia;ha.invert(b.Xa,d);ha.transpose(d,d);Ca.transformMat4(b.Zb,
d,e);d=Da;d[0]=(V.sign(e[0])+b.nb[8])/b.nb[0];d[1]=(V.sign(e[1])+b.nb[9])/b.nb[5];d[2]=-1;d[3]=(1+b.nb[10])/b.nb[14];Ca.scale(e,2/(e[0]*d[0]+e[1]*d[1]+e[2]*d[2]+e[3]*d[3]),e);b.nb[2]=e[0];b.nb[6]=e[1];b.nb[10]=e[2]+1;b.nb[14]=e[3]}L.from_mat4(b.Xa,b.He);U(b);M(b);L.copy(c.g.i,b.i)}function u(b,c,d,f){ha.lookAt(c,d,f,b.Xa);d=la.get_active();d=la.Z(d,"STEREO");la.ma()&&(d=la.get_active(),d=la.Z(d,"STEREO"));if(b.type==a.Hb||d&&d.enable_hmd_stereo&&b.type==a.dd)b.Xa[12]+=b.ke/2;else if(b.type==a.Mb||
d&&d.enable_hmd_stereo&&b.type==a.ed)b.Xa[12]-=b.ke/2;L.from_mat4(b.Xa,b.He);U(b);M(b);L.set_trans(c,b.i)}function A(a,b,c){c=oa.subtract(c,b,sa);oa.length(c)&&(oa.normalize(c,c),c=V.ly(V.AXIS_MY,c,W),da.set_rotation(a,c));da.set_translation(a,b)}function B(a,b,c){var d=a.g,f=E(a);A(a,b,c);f?(b=oa.copy(d.Fe,sa),oa.negate(b,b),fa.correct_up(a,b,!0)):fa.correct_up(a,d.Fe,!0)}function H(a,b){var c=a.g,d=b.M;if(!d)throw"Wrong object";for(var f=b.yy,e=0;e<f.length;e++){var g=f[e];oa.copy(L.get_trans_view(c.i),
g.fx)}for(e=0;e<d.length;e++)if(g=d[e],n(g,a),V.Ln(g.Ge,g.qj),g.qd&&g.dof_on){var f=L.get_trans_view(c.i),h=da.get_translation(g.qd,sa),f=oa.dist(f,h);g.dof_distance=f}}function v(b){var c=b.g;c.Va==a.MS_TARGET_CONTROLS&&(c.hp=E(b))}function E(a){a=L.get_quat_view(a.g.i);return 0<V.quat_to_dir(a,V.AXIS_Z,sa)[1]}function z(b,c){var d=b.g;if(c){d.La=d.La||{};d.La.left=c.left;d.La.right=c.right;d.La.Gj=c.left;d.La.dk=c.right;d.La.camera_space=Boolean(c.camera_space);var f=b.g;!(d=f.La)||f.Va!=a.MS_EYE_CONTROLS&&
f.Va!=a.MS_TARGET_CONTROLS||(f=y(b,X),d.camera_space?(d.left+=f[0],d.right+=f[0]):(d.Gj-=f[0],d.dk-=f[0]),d.left=V.angle_wrap_0_2pi(d.left),d.right=V.angle_wrap_0_2pi(d.right),d.Gj=V.angle_wrap_0_2pi(d.Gj),d.dk=V.angle_wrap_0_2pi(d.dk))}else d.La=null}function G(a,b){var c=a.g;b?(c.ga=c.ga||{},c.ga.down=b.down,c.ga.up=b.up,c.ga.hj=b.down,c.ga.Dk=b.up,c.ga.camera_space=Boolean(b.camera_space),F(a)):c.ga=null}function d(a,b){var c=a.g;if(!b){var d=y(a,X);b={down:d[1],up:d[1]}}c.ga=c.ga||{};c.ga.down=
b.down;c.ga.up=b.up;F(a);c.Oa&&c.ga&&S(a)}function F(b){var c=b.g,d=c.ga;if(d)switch(c.Va){case a.MS_EYE_CONTROLS:case a.MS_TARGET_CONTROLS:b=y(b,X);d.camera_space?(d.up+=b[1],d.down+=b[1]):(d.Dk-=b[1],d.hj-=b[1]);d.up=V.angle_wrap_periodic(d.up,-Math.PI,Math.PI);d.down=V.angle_wrap_periodic(d.down,-Math.PI,Math.PI);d.Dk=V.angle_wrap_periodic(d.Dk,-Math.PI,Math.PI);d.hj=V.angle_wrap_periodic(d.hj,-Math.PI,Math.PI);break;case a.MS_HOVER_CONTROLS:d.up=V.angle_wrap_periodic(d.up,-Math.PI,Math.PI),d.down=
V.angle_wrap_periodic(d.down,-Math.PI,Math.PI),d.up=V.clamp(d.up,-Math.PI/2,0),d.down=V.clamp(d.down,-Math.PI/2,0)}}function J(a,b){var c=a.g;if(!b){var d=da.Uj(a,c.fb);b={min:d,max:d}}c.Oa=c.Oa||{};c.Oa.min=b.min;c.Oa.max=b.max;c.Oa&&c.ga&&S(a)}function C(a,b){var c=a.g;b?(c.Oa=c.Oa||{},c.Oa.min=b.min,c.Oa.max=b.max):c.Oa=null}function D(a,b){var c=a.g;b?(c.he=c.he||{},c.he.min_y=b.min_y,c.he.max_y=b.max_y):c.he=null}function O(a,b){var c=a.g;b?(c.ic=c.ic||{},c.ic.min=b.min,c.ic.max=b.max):c.ic=
null}function T(a,b){var c=a.g;b?(c.jc=c.jc||{},c.jc.min=b.min,c.jc.max=b.max):c.jc=null}function K(b){var c=b.g;if(ca.is_camera(b))for(var d=b.u,f=0;f<d.length;f++){var e=d[f].M;if(e[0].type===a.fd){switch(c.Va){case a.MS_TARGET_CONTROLS:var g=L.get_trans_view(c.i),g=oa.dist(g,c.pivot),g=g/c.zj*c.Aj;break;case a.MS_HOVER_CONTROLS:g=L.get_trans_view(c.i);g=oa.distance(g,c.fb);g=g/c.zj*c.Aj;break;default:g=e[0].top}for(var h=0;h<e.length;h++){var k=e[h];k.top=g;Z(k,k.Sa)}H(b,d[f])}}}function w(b){var c=
b.g,d=c.Va;if(d===a.MS_TARGET_CONTROLS||d===a.MS_EYE_CONTROLS){if(c.La){var f=c.La.left,e=c.La.right,g=y(b,X);(g=d==a.MS_TARGET_CONTROLS?V.Ih(g[0],f,e):V.Ih(g[0],e,f))&&(d==a.MS_TARGET_CONTROLS?Q(b,g,0):t(b,g,0))}c.ga&&(f=c.ga.down,e=c.ga.up,g=y(b,X),(g=d==a.MS_TARGET_CONTROLS?V.Ih(g[1],e,f):V.Ih(g[1],f,e))&&(d==a.MS_TARGET_CONTROLS?Q(b,0,g):t(b,0,g)));if(d===a.MS_TARGET_CONTROLS&&c.Oa){var g=b.g,f=L.get_trans_view(g.i),e=oa.subtract(f,g.pivot,sa),h=oa.length(e);h>g.Oa.max?(oa.scale(e,g.Oa.max/h,
e),oa.add(g.pivot,e,f)):h<g.Oa.min&&(h=L.get_quat_view(g.i),h=V.quat_to_dir(h,V.AXIS_MY,I),oa.scale(h,100*g.Oa.min,h),oa.add(e,h,e),oa.scale(e,-g.Oa.min/oa.length(e),e),oa.add(g.pivot,e,f))}}d===a.MS_TARGET_CONTROLS&&c.he&&(c=b.g,g=c.pivot[1],f=V.clamp(c.pivot[1],c.he.min_y,c.he.max_y),f!=g&&(g=oa.set(0,f-g,0,sa),oa.add(c.pivot,g,c.pivot),c=L.get_trans_view(c.i),oa.add(c,g,c)));d===a.MS_HOVER_CONTROLS&&(d=b.g,d.ic&&(g=V.clamp(d.fb[0],d.ic.min,d.ic.max)-d.fb[0],d.fb[0]+=g,c=L.get_trans_view(d.i),c[0]+=
g),d.jc&&(g=V.clamp(d.fb[2],d.jc.min,d.jc.max)-d.fb[2],d.fb[2]+=g,c=L.get_trans_view(d.i),c[2]+=g),d=b.g,c=y(b,X)[1],(d=V.Ih(c,d.ga.up,d.ga.down))&&N(b,0,d))}function t(a,b,c,d,f){var e=a.g,g=b,h=c;if(d||f)a=y(a,pa),d&&(g=b-a[0]),f&&(h=c-a[1]);if(g||h)b=xa.identity(W),g&&(g=xa.setAxisAngle(e.Fe,g,ua),xa.multiply(b,g,b)),e=L.get_quat_view(e.i),h&&(g=V.quat_to_dir(e,V.AXIS_X,sa),h=xa.setAxisAngle(g,h,ua),xa.normalize(h,h),xa.multiply(b,h,b)),xa.multiply(b,e,e)}function Q(a,b,c,d,f){var e=a.g,g=b,h=
c;if(d||f){var k=y(a,pa);d&&(g=b-k[0]);f&&(h=c-k[1])}P(a,a.g.pivot,g,h);a=y(a,pa);a=V.angle_wrap_periodic(a[1],-Math.PI,Math.PI);e.hp=Math.abs(a)>Math.PI/2}function N(a,b,c,d,f){var e=a.g,g=b,h=c;if(d||f){var k=y(a,pa);d&&(g=b-k[0]);f&&(h=c-k[1])}e.zl||(g=0);P(a,e.fb,g,h);h&&S(a)}function P(a,b,c,d){var f=a.g;if(c||d){var e=xa.identity(W);c&&(c=xa.setAxisAngle(V.AXIS_Y,c,ua),xa.multiply(e,c,e));Y(a);a=L.get_quat_view(f.i);d&&(c=V.quat_to_dir(a,V.AXIS_X,sa),d=xa.setAxisAngle(c,d,ua),xa.normalize(d,
d),xa.multiply(e,d,e));f=L.get_trans_view(f.i);V.eI(f,b,e,f);xa.multiply(e,a,a)}}function S(a){var b=a.g,c=y(a,X)[1],d=a.g;a=d.ga;d=d.Oa;a.down-a.up?(c=(a.down-c)/(a.down-a.up),c=Math.max(c,0)):c=0;c=c*(d.max-d.min)+d.min;a=L.get_trans_view(b.i);d=L.get_quat_view(b.i);d=V.quat_to_dir(d,V.AXIS_MY,sa);oa.normalize(d,d);oa.scale(d,c,d);oa.subtract(b.fb,d,a)}function Z(b,c,d){switch(b.type){case a.pc:if(!c)throw"No aspect ratio";b.Sa=c;case a.nf:ha.perspective(V.deg_to_rad(b.Mc),b.Sa,b.near,b.far,b.nb);
break;case a.fd:if(!c)throw"No aspect ratio";b.Sa=c;case a.sg:c=b.top*b.Sa;ha.ortho(-c,c,-b.top,b.top,b.near,b.far,b.nb);break;case a.wh:ha.ortho(b.left,b.right,b.bottom,b.top,b.near,b.far,b.nb);break;case a.Hb:case a.Mb:if(!c)throw"No aspect ratio";b.Sa=c;var f=Math.tan(b.Mc*Math.PI/360);c=b.near*f;var e=b.Sa*b.vk*f;b.type==a.Hb?(f=e-b.ke/2,e+=b.ke/2):(f=e+b.ke/2,e-=b.ke/2);f=-(b.near/b.vk*f);e*=b.near/b.vk;ha.frustum(f,e,-c,c,b.near,b.far,b.nb);b.left=f;b.right=e;break;case a.dd:case a.ed:if(la.ma())if(f=
la.get_active(),(f=la.Z(f,"STEREO"))&&f.enable_hmd_stereo){c=Math.tan(V.deg_to_rad(b.Oc[0])/2);var f=Math.tan(V.deg_to_rad(b.Oc[1])/2),e=Math.tan(V.deg_to_rad(b.Oc[2])/2),g=Math.tan(V.deg_to_rad(b.Oc[3])/2);b.top=b.near*c;b.right=b.near*f;b.bottom=-b.near*e;b.left=-b.near*g;ha.frustum(b.left,b.right,b.bottom,b.top,b.near,b.far,b.nb)}else c||(c=b.Sa),ha.perspective(V.deg_to_rad(b.Mc),c,b.near,b.far,b.nb);break;case a.Tb:return;default:throw"Wrong camera type: "+b.type;}d||(U(b),M(b))}function M(a){ha.copy(a.Xa,
a.ef);a.ef[12]=0;a.ef[13]=0;a.ef[14]=0;a.ef[15]=1;ha.multiply(a.nb,a.ef,a.ef);ha.invert(a.ef,a.ef)}function U(a){ha.copy(a.Xa,a.Ge);ha.multiply(a.nb,a.Ge,a.Ge);ha.invert(a.Ge,a.Mz)}function ea(b,c,d,f,e){f||(f=new Float32Array(24));c||(c=b.near);d||(d=b.far);var g,h,k,l,n,m,q,r;switch(b.type){case a.Tb:throw"Extraction from NONE camera is not possible";case a.pc:case a.nf:g=c*Math.tan(b.Mc*Math.PI/360);l=-g;h=g*b.Sa;k=-h;n=d/c*g;r=-n;m=n*b.Sa;q=-m;break;case a.fd:case a.sg:k=b.top*b.Sa;g=n=b.top;
h=m=k;l=r=-b.top;k=q=-k;break;case a.wh:g=n=b.top;h=m=b.right;l=r=b.bottom;k=q=b.left;break;case a.Hb:case a.Mb:n=c/b.near;g=c*Math.tan(b.Mc*Math.PI/360);l=-g;h=b.right*n;k=b.left*n;q=d/c;n=g*q;r=-n;m=h*q;q*=k;break;case a.dd:case a.ed:n=c/b.near;g=b.top*n;l=b.bottom*n;h=b.right*n;k=b.left*n;q=d/c;n=g*q;r=l*q;m=h*q;q*=k;break;default:throw"Wrong camera type: "+b.type;}f[0]=k;f[1]=l;f[2]=-c;f[3]=h;f[4]=l;f[5]=-c;f[6]=h;f[7]=g;f[8]=-c;f[9]=k;f[10]=g;f[11]=-c;f[12]=q;f[13]=r;f[14]=-d;f[15]=q;f[16]=n;
f[17]=-d;f[18]=m;f[19]=n;f[20]=-d;f[21]=m;f[22]=r;f[23]=-d;e&&(c=ia,ha.invert(b.Xa,c),V.bk(f,c,f,0));return f}function Y(b){return ca.is_camera(b)&&b.g&&b.g.Va==a.MS_HOVER_CONTROLS}function ka(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.ml){var d=b.csm_num;a.ml=Array(d);for(var f=0;f<d;f++)a.ml[f]=new Float32Array(3);a.Fq=new Float32Array(d)}for(d=0;d<c;d++){var f=0==d?a.near:ga(b,a,d-1),e=ga(b,a,d),f=ea(a,f,e,ta),f=x.GF(f);a.ml[d].set(f.J);a.Fq[d]=f.Wa;a.ov[d]=oa.length(f.J);a.Jo[d]=ma(b.first_cascade_blur_radius,
b.last_cascade_blur_radius,c,d)}}else a.Jo[0]=b.first_cascade_blur_radius}function ga(a,b,c){var d=a.csm_num,f=V.clamp(a.csm_first_cascade_border,b.near,b.far);a=V.clamp(a.csm_last_cascade_border,b.near,b.far);return V.clamp(ma(f,a,d,c),b.near,b.far)}function ma(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}function ba(a,b){b||(b=new Float32Array(3));var c=L.get_trans_view(a.g.i);oa.copy(c,b);return b}var x=p("__boundings");p("__config");var fa=
p("__constraints"),aa=p("__container"),ha=p("__mat4"),Aa=p("__math"),ca=p("__obj_util"),R=p("__print"),xa=p("__quat"),la=p("__scenes"),da=p("__transform"),L=p("__tsr"),V=p("__util"),oa=p("__vec3"),Ca=p("__vec4");a.Tb=10;a.pc=20;a.fd=30;a.nf=40;a.sg=50;a.wh=60;a.Hb=70;a.Mb=80;a.dd=90;a.ed=100;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var ya=V.deg_to_rad(.5),X=new Float32Array(2),pa=new Float32Array(2),sa=new Float32Array(3),I=new Float32Array(3),qa=new Float32Array(3),
W=new Float32Array(4),ua=new Float32Array(4),ja=new Float32Array(4),Da=new Float32Array(4),ia=new Float32Array(16),ta=new Float32Array(24),Ha=new Float32Array(6);a.JC=function(d,f){var g=f.g,n=d.data;switch(n.type){case "PERSP":var r=q(a.pc);if(n.angle_y)var p=V.rad_to_deg(n.angle_y);l(r,p,n.clip_start,n.clip_end);break;case "ORTHO":r=q(a.fd),l(r,n.ortho_scale/2,n.clip_start,n.clip_end)}r.name=f.name;p=f.u;p[0].M.push(r);for(var t=1;t<p.length;t++){var u=V.za(r);p[t].M.push(u)}g.IJ=!1;g.Va=h(n.b4w_move_style);
g.dof_distance=n.dof_distance;r=n.dof_object;g.qd=r?r.qa:null;g.dof_front=n.b4w_dof_front;g.dof_rear=n.b4w_dof_rear;g.dof_power=n.b4w_dof_power;g.Fm=n.b4w_trans_velocity;g.Em=n.b4w_rot_velocity;g.Gm=n.b4w_zoom_velocity;r=f.g.Va;p=d.data;t=null;r!=a.MS_TARGET_CONTROLS&&r!=a.MS_EYE_CONTROLS||!p.b4w_use_horizontal_clamping||(t={left:p.b4w_rotation_left_limit,right:p.b4w_rotation_right_limit,camera_space:"LOCAL"==p.b4w_horizontal_clamping_type},r==a.MS_EYE_CONTROLS&&(t.left*=-1,t.right*=-1));r=t;p=f.g.Va;
t=d.data;u=null;p!=a.MS_TARGET_CONTROLS&&p!=a.MS_EYE_CONTROLS||!t.b4w_use_vertical_clamping?p==a.MS_HOVER_CONTROLS&&t.b4w_use_zooming&&(t.b4w_hover_angle_min<=t.b4w_hover_angle_max?(u={down:t.b4w_hover_angle_min,up:t.b4w_hover_angle_max},u.down*=-1,u.up*=-1):R.error("Wrong angle limits for the HOVER camera. Disabling angle limits.")):(u={down:t.b4w_rotation_down_limit,up:t.b4w_rotation_up_limit,camera_space:"LOCAL"==t.b4w_vertical_clamping_type},p==a.MS_TARGET_CONTROLS&&(u.down*=-1,u.up*=-1));var p=
u,t=f.g.Va,u=d.data,x=null;t==a.MS_TARGET_CONTROLS&&u.b4w_use_target_distance_limits&&u.b4w_distance_min<=u.b4w_distance_max?x={min:u.b4w_distance_min,max:u.b4w_distance_max}:t===a.MS_HOVER_CONTROLS&&u.b4w_use_zooming&&(u.b4w_distance_min<=u.b4w_distance_max?x={min:u.b4w_distance_min,max:u.b4w_distance_max}:R.error("Wrong distance limits for the HOVER camera. Disabling distance limits."));t=x;u=d.data;x=null;f.g.Va==a.MS_HOVER_CONTROLS&&u.b4w_use_horizontal_clamping&&u.b4w_horizontal_translation_min<=
u.b4w_horizontal_translation_max&&(x={min:u.b4w_horizontal_translation_min,max:u.b4w_horizontal_translation_max});var u=x,ja=d.data,x=null;f.g.Va==a.MS_HOVER_CONTROLS&&ja.b4w_use_vertical_clamping&&ja.b4w_vertical_translation_min<=ja.b4w_vertical_translation_max&&(x={min:ja.b4w_vertical_translation_min,max:ja.b4w_vertical_translation_max},ja=-x.min,x.min=-x.max,x.max=ja);var ja=d.data,da=null;f.g.Va==a.MS_TARGET_CONTROLS&&ja.b4w_use_pivot_limits&&(da={min_y:ja.b4w_pivot_z_min,max_y:ja.b4w_pivot_z_max});
ja=da;switch(g.Va){case a.MS_EYE_CONTROLS:g=L.get_trans_view(f.g.i);e(f,g,null,r,p);break;case a.MS_TARGET_CONTROLS:g=L.get_trans_view(f.g.i);b(f,g,n.b4w_target,r,p,t,ja,n.b4w_use_panning);break;case a.MS_HOVER_CONTROLS:g=L.get_trans_view(f.g.i),r=m(f,d.data.b4w_hover_zero_level,I),c(f,g,r,t,p,u,x,n.b4w_enable_hover_hor_rotation)}w(f);k(f)};a.UI=e;a.WI=b;a.VI=c;a.Ml=k;a.wD=r;a.kH=h;a.Ob=q;a.OL=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.Db);case "DEPTH":return Boolean(a.od);
case "SCREEN":return!Boolean(a.Db)&&!Boolean(a.od);default:throw"Wrong attachment type: "+b;}};a.Yo=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.Db=c;break;case "DEPTH":a.od=c;break;case "SCREEN":a.Db=null;a.od=null;break;default:throw"Wrong attachment type: "+b;}};a.yM=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.Db;case "DEPTH":return a.od;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.so=function(b,c){if(b.type!=a.pc||c!=a.Hb&&c!=a.Mb&&c!=a.dd&&
c!=a.ed)throw"make_stereo(): wrong camera type";b.type=c;g(b,6,.065)};a.KI=g;a.get_camera_angles=y;a.$v=f;a.get_camera_angles_char=function(a,b){y(a,b);b[0]=V.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.Zo=l;a.wI=function(b,c,d,f,e,g,h){switch(b.type){case a.wh:b.left=c;b.right=d;b.bottom=f;b.top=e;b.near=g;b.far=h;break;default:R.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.g.Va};a.QI=n;a.yN=u;a.Us=function(a,b,c){var d=sa;d[0]=
0;d[1]=-1;d[2]=0;oa.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var f=I;f[0]=0;f[1]=0;f[2]=-1;oa.transformQuat(f,c,f);u(a,b,d,f)};a.set_look_at=A;a.EI=B;a.WJ=H;a.VJ=function(b){var c=b.g;w(b);K(b);switch(c.Va){case a.MS_TARGET_CONTROLS:var d=L.get_trans_view(c.i),f=L.get_quat_view(c.i);fa.fI(d,f,c.pivot);for(f=0;f<b.u.length;f++)for(var e=b.u[f].M,h=0;h<e.length;h++){var k=e[h];k.type!=a.Hb&&k.type!=a.Mb||g(k,oa.dist(d,c.pivot),k.ke)}fa.correct_up(b,c.Fe);break;case a.MS_EYE_CONTROLS:b.ib||
fa.correct_up(b,c.Fe)}v(b)};a.Dt=v;a.qy=z;a.uy=G;a.hover_set_vertical_limits=d;a.hover_set_distance_limits=J;a.pI=C;a.HI=D;a.yI=O;a.OI=T;a.gK=K;a.rotate_eye_camera=t;a.rotate_target_camera=Q;a.rotate_hover_camera=N;a.bN=function(b){switch(b.type){case a.pc:case a.fd:case a.Hb:case a.Mb:return!0;default:return!1}};a.Xv=function(b){switch(b.type){case a.pc:case a.nf:case a.Hb:case a.Mb:return V.deg_to_rad(b.Mc);default:return R.error("get_angular_diameter(): Unsupported camera type: "+b.type),0}};a.$g=
Z;a.mq=M;a.Su=U;a.FE=ea;a.lC=function(a){a=a.g;var b=x.cd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.dc=b;var c=x.zn(1,[0,0,0]);a.Sd=c;a.Yp=x.kv(1,b);a.$p=x.mv(1,b);a.Zp=x.lv(1,b)};a.is_static_camera=function(b){return ca.is_camera(b)&&b.g&&b.g.Va==a.MS_STATIC};a.is_target_camera=function(b){return ca.is_camera(b)&&b.g&&b.g.Va==a.MS_TARGET_CONTROLS};a.is_eye_camera=function(b){return ca.is_camera(b)&&b.g&&b.g.Va==a.MS_EYE_CONTROLS};a.is_hover_camera=Y;a.is_ortho_camera=function(b){return ca.is_camera(b)&&
b.g&&b.u[0].M[0].type==a.fd};a.Ct=ka;a.YD=ga;a.project_point=function(b,c,d){b=b.u[0].M[0];switch(b.type){case a.pc:case a.nf:case a.fd:case a.sg:case a.Hb:case a.Mb:case a.dd:case a.ed:var f=ja;f.set(c);f[3]=1;Ca.transformMat4(f,b.Ge,f);c=-f[1]/f[3];d[0]=(f[0]/f[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;aa.OK(d[0],d[1],d,b);2<d.length&&(d[2]=(f[2]/Math.abs(f[3])+1)/2);return d;default:return R.error("Non-compatible camera"),d}};a.EF=function(a){return a.u[0].M[0]};a.uj=function(b,c){switch(b.type){case a.pc:case a.nf:case a.Hb:case a.Mb:var d=
Math.tan(V.deg_to_rad(b.Mc)/2);switch(c){case "LEFT":return-d*b.Sa;case "RIGHT":return d*b.Sa;case "TOP":return d;case "BOTTOM":return-d}break;case a.fd:case a.sg:switch(c){case "LEFT":return-b.top*b.Sa;case "RIGHT":return b.top*b.Sa;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.wh:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;case a.dd:case a.ed:switch(c){case "LEFT":return Math.tan(V.deg_to_rad(b.Oc[3])/
2);case "RIGHT":return Math.tan(V.deg_to_rad(b.Oc[1])/2);case "TOP":return Math.tan(V.deg_to_rad(b.Oc[0])/2);case "BOTTOM":return Math.tan(V.deg_to_rad(b.Oc[2])/2)}break;default:V.da("Unknown camera type")}};a.qG=function(b){switch(b.type){case a.fd:case a.sg:case a.wh:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.pc:case a.nf:case a.Hb:case a.Mb:var d=V.deg_to_rad(b.Mc);return c?d*b.Sa:d;default:return 0}};a.set_trans_pivot=function(a,b,c){a=a.g;L.set_trans(b,a.i);oa.copy(c,
a.pivot)};a.set_hover_pivot=function(a,b){var c=a.g,d=oa.subtract(b,c.fb,sa),f=L.get_trans_view(c.i),d=oa.add(d,f,d);da.set_translation(a,d);oa.copy(b,c.fb)};a.LI=function(a,b){var c=a.g,d=oa.subtract(b,c.pivot,sa),f=L.get_trans_view(c.i),d=oa.add(d,f,d);da.set_translation(a,d);oa.copy(b,c.pivot)};a.get_eye=ba;a.set_move_style=function(b,d){b.g.Va=d;b.g.La=null;b.g.ga=null;b.g.Oa=null;b.g.ic=null;b.g.jc=null;k(b);switch(d){case a.MS_HOVER_CONTROLS:var f=L.get_trans_view(b.g.i),e=m(b,0,I);c(b,f,e,
null,null,null,null,b.g.zl);break;case a.MS_TARGET_CONTROLS:f=ba(b,sa),e=L.get_quat_view(b.g.i),e=V.quat_to_dir(e,V.AXIS_MY,I),e=oa.scaleAndAdd(f,e,10,e),oa.copy(e,b.g.pivot)}};a.Cp=function(a){a=a.g;a.Va=0;oa.set(0,0,0,a.pivot);oa.set(0,0,0,a.fb);a.hp=!1;a.use_panning=!1;a.La=null;a.ga=null;a.Oa=null;a.ic=null;a.jc=null;a.he=null;a.zl=!0};a.set_eye_distance=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];70!=d.type&&80!=d.type&&90!=d.type&&100!=d.type||g(d,d.vk,b)}};a.set_hmd_fov=function(a,
b,c){var d=la.get_active();a=ca.R(a,d).M;for(d=0;d<a.length;d++){var f=a[d];if(90==f.type||100==f.type)90==f.type&&Ca.copy(b,f.Oc),100==f.type&&Ca.copy(c,f.Oc),f.Zb||Z(f),U(f),M(f)}}};b4w.module.__lights=function(a,p){function e(a){m.scale(a.color,a.Ud,a.il)}p("__print");var b=p("__tsr"),c=p("__util"),m=p("__vec3"),k=new Float32Array(3);new Float32Array(3);a.vG=function(a,h){var q=a.data,g=h.Qa={name:"",type:q.type,Sx:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),il:new Float32Array(3),wv:0,Ii:0,sm:0,Vv:!1,tx:!1,Dv:!1,Ek:!0,Mi:!0,Ud:1,distance:25,kM:"INVERSE_SQUARE"};g.name=h.name;g.Ek=q.use_diffuse;g.Mi=q.use_specular;var p=b.get_quat_view(h.g.i),
p=c.quat_to_dir(p,c.AXIS_Y,k);m.normalize(p,p);g.direction.set(p);g.color[0]=q.color[0];g.color[1]=q.color[1];g.color[2]=q.color[2];g.Ud=g.wv=q.energy;e(g);g.distance=q.distance;if("POINT"===g.type||"SPOT"===g.type)g.distance=q.distance;"SPOT"===g.type?(g.sm=q.spot_blend,g.Ii=q.spot_size):"POINT"===g.type&&(g.Ii=Math.PI/2);g.Vv=q.b4w_generate_shadows;g.Dv=q.b4w_dynamic_intensity};a.ry=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];e(a)};a.BI=function(a,b){a.sm=b};a.AI=function(a,b){a.distance=
b};a.CI=function(a,b){a.Ii=b};a.Ss=function(a,b){a.Ud=b;e(a)};a.bK=function(a){if("LAMP"!=a.type)throw"Wrong light object";var e=a.Qa;if(e){a=b.get_quat_view(a.g.i);c.quat_to_dir(a,c.AXIS_Y,e.direction);m.normalize(e.direction,e.direction);if("SUN"==e.type){a=Math.acos(m.dot(e.Sx,c.Kp));var k=Math.acos(m.dot(e.direction,c.Kp));e.tx=Math.floor(a/.025)!=Math.floor(k/.025)?!0:!1}m.copy(e.direction,e.Sx)}}};b4w.module.__scenes=function(a,p){function e(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.Od||!c.Od.length)return c}return null}function b(){if(!jb)throw"No active scene available";return jb}function c(a,b,c){if(!za.Fn||!m(a,b,c))return null;c=a.b4w_shadow_settings;var d={};c.csm_resolution>za.zb?(d.csm_resolution=za.zb,Oa.error("Shadow map texture has unsupported size. Changed to "+za.zb+".")):d.csm_resolution=c.csm_resolution;a=Ba.Rn(b,za.Zc&&a.b4w_enable_ssao);d.self_shadow_polygon_offset=c.self_shadow_polygon_offset;
d.self_shadow_normal_offset=c.self_shadow_normal_offset;d.enable_csm=c.b4w_enable_csm&&1==a.length;d.ue=[];d.Jy=[];d.Bv=[];for(b=0;b<a.length;b++)d.ue.push(a[b].Qa.type),d.Jy.push(a[b].Qa.Ii),d.Bv.push(a[b].Qa.distance),"SPOT"!=d.ue[b]&&"POINT"!=d.ue[b]||!d.enable_csm||(Oa.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),d.enable_csm=!1);d.enable_csm?(d.csm_num=c.csm_num,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,
d.csm_last_cascade_border=c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=c.fade_last_cascade,d.blend_between_cascades=c.blend_between_cascades):(d.csm_num=1,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,d.csm_last_cascade_border=c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=!1,d.blend_between_cascades=!1);return d}function m(a,b,
c){if(0!=b.length&&za.gk)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,f=!1;a=za.Zc&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var e=c[b];e.b4w_shadow_cast&&(d=!0);e.b4w_shadow_receive&&(f=!0);if((a||d)&&f)return!0}return!1}function k(a){for(var b=0;b<a.length;b++)if("SUN"==a[b].Qa.type)return!0;return!1}function r(a){if(!za.shore_smoothing)return!1;a=ha(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}
function h(a){for(var b=0;b<a.length;b++)for(var c=a[b].particle_systems,d=0;d<c.length;d++)if(Ba.$u(a[b],c[d].settings))return!0;return!1}function q(a){for(var b=ha(a),c=[],d=0;d<b.length;d++){var f=b[d];if(f.b4w_water){for(var e={},g=0;g<a.length;g++)for(var h=a[g],k=h.data.materials,l=0;l<k.length;l++)k[l]==f&&(e.rh=h.location[1]);e.zc=f.b4w_water_fog_color.slice(0);e.zc.push(f.b4w_water_fog_density);f.b4w_water_dynamic?(e.ul=!0,e.waves_height=f.b4w_waves_height,e.waves_length=f.b4w_waves_length,
e.dst_noise_scale0=f.b4w_water_dst_noise_scale0,e.dst_noise_scale1=f.b4w_water_dst_noise_scale1,e.dst_noise_freq0=f.b4w_water_dst_noise_freq0,e.dst_noise_freq1=f.b4w_water_dst_noise_freq1,e.dir_min_shore_fac=f.b4w_water_dir_min_shore_fac,e.dir_freq=f.b4w_water_dir_freq,e.dir_noise_scale=f.b4w_water_dir_noise_scale,e.dir_noise_freq=f.b4w_water_dir_noise_freq,e.dir_min_noise_fac=f.b4w_water_dir_min_noise_fac,e.dst_min_fac=f.b4w_water_dst_min_fac,e.waves_hor_fac=f.b4w_water_waves_hor_fac):(e.ul=!1,e.waves_height=
0,e.waves_length=0);e.uf=f.b4w_water_enable_caust;e.LC=f.b4w_water_caust_scale;e.KC=f.b4w_water_caust_brightness;e.MC=new Float32Array([.3,.7]);e.bh=null;f=f.texture_slots;for(g=0;g<f.length;g++)h=f[g].texture,!0===h.b4w_shore_dist_map&&"FILE"==h.image.source&&(e.bh=h.image,e.Ys=h.image.size[0],e.Xr=h.b4w_max_shore_dist,h=h.b4w_shore_boundings,e.ik=[(h[0]+h[1])/2,(h[2]+h[3])/2],e.jk=[h[0]-h[1],h[2]-h[3]]);c.push(e)}}if(0<c.length){e=c[0];if(!e.ul)for(d=0;d<c.length;d++)c[d].ul&&(e=c[d]);return e}return null}
function g(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var f=a[d];"GROUP"==f.type&&f.node_group&&b(f.node_group.node_tree);"GROUP"==f.type&&"B4W_REFRACTION"==f.node_tree_name&&(c.Gc=!0)}}}var c={Gc:!1};a=ha(a);for(var d=0;d<a.length;d++){var f=a[d];f.b4w_refractive&&(c.Gc=!0);f.node_tree&&b(f.node_tree)}return c}function y(a,b,c){if(za.im)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;a=[];for(var d=0,f=!1,e=0;e<b.length;e++){var g=b[e];g.g.Uc&&"CUBE"==g.g.cf&&
d++;if(g.jm.length){for(var h=null,k=0;k<a.length;k++)if(a[k]==g){h=k;break}null==h&&a.push(g)}}for(e=0;e<c.length;e++){a:if(b=c[e],b.b4w_reflexible){b=b.data.materials;for(g=0;g<b.length;g++)if(h=b[g].game_settings.alpha_blend,"OPAQUE"!=h&&"CLIP"!=h){b=!0;break a}b=!1}else b=void 0;b&&(f=!0)}return{ey:a,Ax:d,xf:[],Gq:[],af:[],Mo:[],xw:f}}function f(a,b){var c=a.b4w_sky_settings,d={};d.XH=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;
d.kk=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.Fc=c.reflexible;d.wc=c.reflexible_only;!b&&c.procedural_skydome&&Oa.warn("There is no sun on the scene. Procedural sky won't be rendered");
return d}function l(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.aG=a.hemisphere;b.xC=a.blur_depth;b.Mu=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.iI=a.samples;return b}function n(a){if(!(za.mn&&a.b4w_enable_bloom&&a.k.hg))return null;var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.sE=a.edge_lum;b.key=a.key;return b}function u(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;
return b}function A(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function B(a){var b={};a=a.b4w_god_rays_settings;b.Er=a.intensity;b.Ij=a.max_ray_length;b.uk=a.steps_per_pass;return b}function H(a){var b={};b.Xf=a.b4w_outline_color;b.Wl=a.b4w_outline_factor;return b}function v(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;
b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function E(a,b){var c=a.light_settings,d={};d.Ef=c.environment_energy;d.Gt=c.use_environment_light;d.Uq=c.environment_color;d.be=a.horizon_color.slice(0);d.ne=a.zenith_color.slice(0);d.FK=a.use_sky_paper;d.EK=a.use_sky_blend;d.GK=a.use_sky_real;d.Dy=null;d.at=null;d.Vq=null;if(d.Gt&&"SKY_TEXTURE"==d.Uq&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var c=null,f=0;f<a.texture_slots.length;f++)if(a.texture_slots[f].texture.b4w_use_as_environment_lighting){c=
a.texture_slots[f];break}c?d.Vq=c:(Oa.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),d.Gt=!1)}for(f=0;f<a.texture_slots.length;f++)if(a.texture_slots[f].texture.b4w_use_as_skydome){c=a.texture_slots[f];d.Dy=c;d.at={uC:c.blend_factor,cG:c.horizon_factor,XK:c.zenith_up_factor,WK:c.zenith_down_factor,color:c.color,Ta:c.default_value,invert:c.invert,DK:c.use_rgb_to_intensity,vC:c.blend_type,zK:c.use_map_blend,
AK:c.use_map_horizon,CK:c.use_map_zenith_up,BK:c.use_map_zenith_down};break}return d}function z(a){var b=a.fog_settings,c={};c.vK=b.use_fog;c.Er=b.intensity;c.depth=b.depth;c.start=b.start;c.height=b.height;c.IE=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);a=c.color;c.zc=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.Xd=new Float32Array([c.Er,c.depth,c.start,c.height]);return c}function G(a,b){if(!za.fc)return!1;switch(a.b4w_render_dynamic_grass){case "OFF":return!1;
case "ON":return!0}for(var c=!1,d=!1,f=0;f<b.length;f++){for(var e=b[f],g=e.data.materials,h=0;h<g.length;h++)g[h].b4w_terrain&&(c=!0);e=e.particle_systems;for(h=0;h<e.length;h++)g=e[h].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}function d(a,b){if(Lc.outlining_overview_mode)return!0;if(za.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].qa.g.Yg)return!0;return!1}else return!1}
function F(a,b){if(Lc.outlining_overview_mode)return!0;if(za.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].qa.g.Kb)return!0;return!1}else return!1}function J(a,b){if(za.Kf)switch(a.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,f=0;f<d.length;f++)if(va.Zu(d[f]))return!0;return!1}else return!1}function C(a,b){if(za.Gc)switch(a.b4w_render_refractions){case "OFF":return!1;
case "ON":return!0;case "AUTO":return b.Gc}else return!1}function D(a){for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<c.length;d++){var f=c[d],e=f.game_settings.alpha_blend;if(f.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e)return!0}return!1}function O(a,b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++){var d=b[c].qa;if(d.anchor&&d.anchor.ej)return!0}return!1}}function T(a,b,c){var d=ta.Ze(a,b);ta.De(a,d,function(a,
b,d){if(d.Bb){switch(d.from){case "COLOR":case "CUBEMAP":a=b.j.Db;break;case "DEPTH":a=b.j.od;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.Md)throw"Batch texture can't use renderbuffer";ra.bv(c.$b,d.to)&&I.Yi(c,a,
d.to)}}});for(a=0;a<b.pa.length;a++){var d=b.pa[a],f=b.hf[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":break;default:if(f.Md)throw"Batch texture can't use renderbuffer";ra.bv(c.$b,d.to)&&I.Yi(c,f,d.to)}}}function K(a,b){return{Ib:!0,Sq:[!0,!0,!0,!0,!0,!0],$e:a,H:b}}function w(a,b,c,d,f,e){function g(a,b){return a==b?0:a>b?1:-1}for(var h=b.g,k=Ba.R(b,f).P,l=0;l<k.length;l++){var n=k[l];n.Wc||n.wc||"MAIN"!=n.type&&"NODES_GLOW"!=
n.type&&"PARTICLES"!=n.type&&"LINE"!=n.type||!("OPAQUE"==n.hb&&"OPAQUE"==d||"BLEND"==n.hb&&"BLEND"==d||"XRAY"==n.hb&&"XRAY"==d||"NODES_GLOW"==n.type&&"GLOW"==d)||(e||(t(n,a,b,c,d,f),I.Rb(n),Q(n)),a.v.push(K(h,n)),T(c,a,n),N(n))}a.v.sort(function(a,b){return a.H&&b.H?-g(a.H.Ga,b.H.Ga)||-g(a.H.zh,b.H.zh)||g(a.H.qi,b.H.qi):0})}function t(a,b,c,d,f,e){var g=c.g,h=e.k,k=Ba.R(c,e),l="NO_SHADOWS";c=ca(e,["SHADOW_CAST"]);if(c.length&&a.Xc){switch(f){case "OPAQUE":l="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":l=
"SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":l="NO_SHADOWS";break;case "SHADOW":l="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}for(var n=0;n<c.length;n++)I.Bu(a,e.k.mc)}c=a.Fb;ra.N(c,"SHADOW_USAGE",l);a.fc&&(n=na.Eb(d,"GRASS_MAP"))&&P(a,n,g);if("SHADOW"!=a.type&&"COLOR_ID"!=f||a.Kl){n=b.Bo;ra.N(c,"NUM_LIGHTS",n);ra.N(c,"NUM_LFACTORS",0==n%2?n/2:Math.floor(n/2)+1);ra.N(c,"REFLECTION_PASS",0);ra.N(c,"SSAO_ONLY",0);ra.N(c,"INVERT_FRONTFACING",0);(h=h.Sb)&&
b.Ie?ra.N(c,"WATER_EFFECTS",1):ra.N(c,"WATER_EFFECTS",0);if(h&&b.uf&&g.uf){ra.N(c,"CAUSTICS",1);if(n=e.k.mc){g=n.ue;for(n=f=0;n<g.length;n++)"SUN"==g[n]&&(f=n);ra.N(c,"SUN_NUM",f)}ra.N(c,"CAUST_SCALE",ra.r(b.Uu));ra.N(c,"CAUST_SPEED",ra.r(b.Vu,2));ra.N(c,"CAUST_BRIGHT",ra.r(b.Tu))}else ra.N(c,"CAUSTICS",0);h&&(ra.N(c,"WAVES_HEIGHT",ra.r(h.waves_height)),ra.N(c,"WAVES_LENGTH",ra.r(h.waves_length)),ra.N(c,"WATER_LEVEL",ra.r(h.rh)));b=k.xf;k=k.af;if(-1!==a.nc.indexOf("u_mirrormap"))ra.N(c,"REFLECTION_TYPE",
"REFL_MIRRORMAP");else if(a.Uc&&b)b=b.j.Db,I.Yi(a,b,"u_cube_reflection"),ra.N(c,"REFLECTION_TYPE","REFL_CUBE");else if(a.Uc&&k)for(n=0;n<k.length;n++)b=k[n].j.Db,I.Yi(a,b,"u_plane_reflection"),ra.N(c,"REFLECTION_TYPE","REFL_PLANE");else ra.N(c,"REFLECTION_TYPE","REFL_NONE");(k=na.Eb(d,"SKY"))?a.Vx?(b=k.j.Db,I.Yi(a,b,"u_sky")):za.Po?(a.md=k.md,ra.N(c,"PROCEDURAL_FOG",1)):ra.N(c,"PROCEDURAL_FOG",0):ra.N(c,"PROCEDURAL_FOG",0);b=e.k.Rt;b.Gt&&(ra.N(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==b.Uq?(b=b.Vq?
I.uF(b.Vq,!1):k.j.Db,ra.N(c,"SKY_TEXTURE",1),I.Yi(a,b,"u_sky_texture")):"SKY_COLOR"==b.Uq&&ra.N(c,"SKY_COLOR",1));b=e.k.Uz;b.vK&&(ra.N(c,"USE_FOG",1),ra.N(c,"FOG_TYPE",b.IE));a.km&&a.Ga?(za.Fn&&ra.N(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.Kl||"NODES_GLOW"==a.type?(ra.N(c,"REFRACTIVE",1),e.k.Gc?ra.N(c,"USE_REFRACTION",1):ra.N(c,"USE_REFRACTION",0)):e.k.Gc?ra.N(c,"REFRACTIVE",1):ra.N(c,"REFRACTIVE",0)):(ra.N(c,"REFRACTIVE",0),ra.N(c,"USE_REFRACTION",0),ra.N(c,"USE_REFRACTION_CORRECTION",
0));a.qh&&(za.shore_smoothing&&a.Ap&&na.Eb(d,"DEPTH_PACK")?ra.N(c,"SHORE_SMOOTHING",1):ra.N(c,"SHORE_SMOOTHING",0),a.water_dynamic&&h&&h.waves_height?ra.N(c,"DYNAMIC",1):ra.N(c,"DYNAMIC",0));"PARTICLES"==a.type&&(ra.N(c,"SIZE_RAMP_LENGTH",a.xa.EN),ra.N(c,"COLOR_RAMP_LENGTH",a.xa.gv));if(!a.Ue)for(a=a.Y,d=0;d<a.length;d++)if(b=a[d],"SCENE"==b.source)for(c=0;c<La.length;c++)for(k=La[c],h=La[c].Od,n=0;n<h.length;n++)h[n].k==b&&ta.m(kb,k,e,null)}}function Q(a){var b=a.$b.attributes,c=a.X.sb,d;for(d in b)c[d]||
Sa.da('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=ra.TF(a.$b.Lt),10<b&&("MAIN"==a.type&&Oa.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Cc.join(", ")+'"'),"MAIN"==a.type&&a.Kl||"NODES_GLOW"==a.type))d=c=0,a.Ni&&(c=Sa.Il(a.Ni)),a.bc&&(d=Sa.Il(a.bc)),Oa.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Cc.join(", ")+'"')}function N(a){8<a.Y.length&&Oa.warn(a.type,"too many textures used - "+a.Y.length+
' (max 8), materials "'+a.Cc.join(", ")+'"')}function P(a,b,c){a.Nc=b.Nc;var d=b.Nc[0],f=b.Nc[1],e=b.Nc[2];c=c.dc;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);e=0==e?c:Math.max(e,c);b.Nc[2]=e;b=b.j;W.Zo(b,e/2,-f,-d,e/2);W.$g(b);d=a.sr||0;d=0==d?c:Math.max(d,c);a.sr=d}function S(a,b,c,d,f,e){for(var g=b.g,h=Ba.R(b,f).P,k=0;k<h.length;k++){var l=h[k];if(("MAIN"==l.type||"PARTICLES"==l.type||"LINE"==l.type)&&"REFLECT"==l.hb&&l.Ga==d){if("MAIN_PLANE_REFLECT"==a.type||"MAIN_PLANE_REFLECT_BLEND"==a.type){var n;
a:{var m=f.k.bf.af;for(n=0;n<m.length;n++)for(var q=0;q<m[n].length;q++)if(m[n][q]==a)break a;m=f.k.bf.Mo;for(n=0;n<m.length;n++)for(q=0;q<m[n].length;q++)if(m[n][q]==a)break a;n=null}if(n==g.zd)continue}else if(n=sa(f,a),n==g.Td)continue;e||(t(l,a,b,c,"REFLECT",f),n=l.Fb,ra.N(n,"WATER_EFFECTS",0),ra.N(n,"REFLECTION_PASS",1),ra.N(n,"TEXTURE_NORM",0),"MAIN_PLANE_REFLECT"==a.type&&ra.N(n,"INVERT_FRONTFACING",1),I.Rb(l),Q(l));a.v.push(K(g,l))}}}function Z(a){fa(a);var b=R(a,"MAIN_OPAQUE"),c=!0,d=a.k.mc;
ta.ea(a.k.jb,function(f,e){"SHADOW_CAST"===e.type&&(U(e,a,b.j,e.v,d,c),c=!1)})}function M(a){ta.ea(a.k.jb,function(a,b){"OUTLINE"===b.type&&(b.Tq=1)})}function U(a,b,c,d,f,e){if(0!=d.length){var g=a.j,h=Za.Gg(c.i,vc);Za.set_trans(h,g.i);Za.copy(c.He,g.Vs);if("SUN"===f.ue[a.ze]||"HEMI"===f.ue[a.ze]){h=bb;qa.cd(h);for(var k=0;k<d.length;k++){var l=d[k].$e;0==k?qa.vn(l.wb,h):qa.Ev(h,l.wb)}d=qa.Hv(h,jd);Sa.bk(d,g.Xa,d);if(f.enable_csm){b=Ra.copy(c.ml[a.Eq],vc);f=Ia.invert(c.Xa,nc);Sa.bk(b,f,b);Sa.bk(b,
g.Xa,b);a=c.Fq[a.Eq];if(e)for(Hb=0,Fc=-Infinity,e=2;e<d.length;e+=3)Hb=Math.min(Hb,d[e]),Fc=Math.max(Fc,d[e]);e=bb;e.max_x=b[0]+a;e.max_y=b[1]+a;e.max_z=Fc;e.min_x=b[0]-a;e.min_y=b[1]-a;e.min_z=Hb}else{c=e=bb;f=lb;f.set(d);d=Yc/9;h=Ia.identity(nc);Ia.rotate(h,d,Sa.AXIS_MZ,h);for(var l=k=-1,n=0;10>n;n++){var m=qa.sC(f,Dc),q=(m.max_x-m.min_x)*(m.max_y-m.min_y);if(-1==k||q<k)k=q,l=n,qa.vn(m,c);Sa.bk(f,h,f)}c=l*d;0<c&&(d=Ia.identity(nc),Ia.rotate(d,c,Sa.AXIS_MZ,d),Ia.multiply(d,g.Xa,g.Xa),Za.from_mat4(g.Xa,
g.He));c=e.max_x-e.min_x;d=e.max_y-e.min_y;c&&d&&(f=Math.abs(c-d)/2,2<c/d?(e.max_y+=f,e.min_y-=f):2<d/c&&(e.max_x+=f,e.min_x-=f));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005;ea(a,b.k.jb)}W.wI(g,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);W.$g(g);Sa.Ln(g.Ge,g.qj)}else"SPOT"!==f.ue[a.ze]&&"POINT"!==f.ue[a.ze]||W.$g(g,g.Sa)}}function ea(a,b){for(var c=a.j,d=na.MF(b,a),f=0;f<d.length;f++){var e=d[f];if("MAIN_OPAQUE"==e.type||"SHADOW_RECEIVE"==e.type||"MAIN_BLEND"==
e.type||"MAIN_XRAY"==e.type)if(za.ro)e.Ht.set(c.He,9*a.ze);else{var g=Za.get_trans_view(c.He),h=Za.get_scale(c.He),k=Za.get_quat_view(c.He);Gb.set(g[0],g[1],g[2],h,wc);e.xp.set(wc,4*a.ze);e.wp.set(k,4*a.ze)}}}function Y(a,b,c,d,f){for(var e=b.g,g=Ba.R(b,d).P,h=0;h<g.length;h++){var k=g[h];"COLOR_ID"==k.type&&(f||(t(k,a,b,c,"COLOR_ID",d),I.Rb(k),Q(k)),"COLOR_PICKING"==a.type&&"COLOR_ID"==k.hb||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==k.hb)&&(f||(I.ya(k,"USE_OUTLINE",0),I.Rb(k),Q(k)),a.v.push(K(e,
k)))}}function ka(a,b,c,d,f){d||(f.fc&&(d=na.Eb(c,"GRASS_MAP"))&&P(f,d,b),I.Rb(f),Q(f));a.v.push(K(b,f));T(c,a,f);N(f)}function ga(a,b){ma(a,b);for(var c=0;c<a.Kc.length;c++)a.Kc[c].parent==a&&ga(a.Kc[c],b)}function ma(a,b){a.g.ai=b;if(Ba.is_lamp(a))for(var c=0;c<a.u.length;c++)for(var d=a.u[c],f=ca(d.Ca,Nb),e=0;e<f.length;e++)x(a,d,f[e])}function ba(a,b){for(var c=ca(b,Nb),d=a.Qa,f=a.g,e=Ba.R(a,b),g=e.gi,h=Za.get_trans_view(f.i),f=Za.get_quat_view(f.i),k=0;k<c.length;k++){var l=c[k];l.no.set(h,3*
g);l.Pr.set(d.direction,3*g);l.mo.set(d.il,3*g);switch(d.type){case "SUN":l.Ty.set(f);l.Sy=d.il;"SKY"===l.type?(l.xo=d.tx,Ra.copy(d.direction,l.nt),aa(b,l)):Ra.copy(d.direction,l.nt);break;case "HEMI":case "POINT":case "SPOT":break;default:Oa.error("Unknown light type: "+d.type+'".')}x(a,e,l);for(var n=0;n<l.v.length;n++){var m=l.v[n].H;m.Fj&&I.zI(m,a)}}c=R(b,"MAIN_OPAQUE").j;e=e.Ws;d=b.k.mc;for(k=0;k<e.length;k++)l=e[k],W.Us(l.j,h,f),U(l,b,c,l.v,d,!0),ea(l,b.k.jb)}function x(a,b,c){var d=a.g;a=a.Qa;
b=b.gi;var f=pc;f[0]=a.Ek&&!d.ai?1:0;f[1]=a.Mi&&!d.ai?1:0;c.Qr.set(f,2*b);c.ia=!0}function fa(a){var b=wa.Pa(a,"LAMP",wa.DATA_ID_ALL),b=Ba.Rn(b,za.Zc&&a.b4w_enable_ssao);if(b.length)for(var c=0;c<b.length;c++)for(var d=b[c],f=d.g,e=Za.Gg(f.i,vc),f=Za.qr(f.i,yd),g=0;g<d.u.length;g++){var h=d.u[g],k=h.Ws;if(h.Ca==a)for(h=0;h<k.length;h++)W.Us(k[h].j,e,f)}}function aa(a,b){Fb.Oo(b);sb.ij(b);if(b.xo)for(var c=ca(a,tb),d=0;d<c.length;d++)for(var f=c[d].v,e=0;e<f.length;e++){var g=f[e];g.Ib&&(g=g.H,I.PC(g)&&
sb.QJ(g))}}function ha(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].data,f=0;f<d.materials.length;f++){var e=d.materials[f];-1==b.indexOf(e)&&b.push(e)}return b}function Aa(a,b,c){for(var d=a.k,f=Ba.R(a.tg,a).M,e=0;e<f.length;e++){var g=f[e];W.$g(g,b/c);d.mc&&W.Ct(g,d.mc)}d.mc&&(d.yo=!0,R(a,"SHADOW_RECEIVE").ia=!0,R(a,"MAIN_BLEND").ia=!0);var h=d.jb;na.GJ(h,function(d,f,e){if(d.wm){var g=d.Ei*b,k=d.Fi*c;if(f)for(f=0;f<e.pa.length;f++)e.pa[f]==d&&Ka.resize(d.Aa,g,k);else switch(Ka.Ej(d.Aa)&&Ka.resize(d.Aa,
g,k),d=e.j,d.width=g,d.height=k,e.type){case "DOF":xa(a,{dof_power:e.j.dof_power,dof_on:e.j.dof_on});break;case "GLOW_COMBINE":da(a,{small_glow_mask_width:e.small_glow_mask_width,large_glow_mask_width:e.large_glow_mask_width});break;case "BLOOM":la(a,{bloom_blur:e.bloom_blur});break;case "OUTLINE":e=na.ab(h,e,"POSTPROCESSING");g=na.ab(h,e,"POSTPROCESSING");k=na.ab(h,g,"POSTPROCESSING");d=na.ab(h,k,"POSTPROCESSING");na.Dd(e,1/b,1/c);na.Dd(g,1/b,1/c);na.Dd(k,1/b,1/c);na.Dd(d,1/b,1/c);break;default:na.Dd(e,
1/b,1/c)}}})}function ca(a,b){for(var c=[],d=0;d<b.length;d++){var f=b[d];ta.ea(a.k.jb,function(a,b){b.type==f&&c.push(b)})}return c}function R(a,b){return na.Eb(a.k.jb,b)}function xa(a,b){var c=R(a,"DOF");if(!c)return Oa.error("DOF is not enabled on the scene. Check camera settings"),0;var d=a.k.jb;"boolean"==typeof b.dof_on&&(c.j.dof_on=b.dof_on);"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&
(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;var f=na.ab(d,c,"POSTPROCESSING"),d=na.ab(d,f,"POSTPROCESSING");na.yc(f,c.j.dof_power);na.Dd(f,1/c.j.width,1/c.j.height);na.yc(d,c.j.dof_power);na.Dd(d,1/c.j.width,1/c.j.height)}}function la(a,b){var c=R(a,"LUMINANCE_TRUNCED"),d=R(a,"BLOOM");if(!c||!d)return Oa.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.ia=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=
b.bloom_edge_lum,c.ia=!0);if("number"==typeof b.bloom_blur){var f=a.k.jb,c=na.ab(f,d,"BLOOM_BLUR"),f=na.ab(f,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;na.yc(c,b.bloom_blur);na.Dd(c,1/d.j.width,1/d.j.height);na.yc(f,b.bloom_blur);na.Dd(f,1/d.j.width,1/d.j.height)}}function da(a,b){var c=R(a,"GLOW_COMBINE");if(!c)return Oa.error("Glow is not enabled on the scene"),null;for(var d=a.k.jb,f=na.JF(d,c),e=0;e<f.length;++e){var g=f[e];if("POSTPROCESSING"===g.type&&"GLOW_MASK_LARGE"===g.hb)var h=g;if("POSTPROCESSING"===
g.type&&"GLOW_MASK_SMALL"===g.hb)var k=g}f=na.ab(d,h,"POSTPROCESSING");d=na.ab(d,k,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.ia=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,c.ia=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,na.yc(k,b.small_glow_mask_width),na.Dd(k,1/c.j.width,1/c.j.height),k.ia=!0,na.yc(d,b.small_glow_mask_width),na.Dd(d,
1/c.j.width,1/c.j.height),d.ia=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,na.yc(h,b.large_glow_mask_width),na.Dd(h,1/c.j.width,1/c.j.height),h.ia=!0,na.yc(f,b.large_glow_mask_width),na.Dd(f,1/c.j.width,1/c.j.height),f.ia=!0)}function L(a,b,c){var d=a.k,f=d.Sb;if(!f.ul)return f.rh;var e=f.waves_height,g=f.waves_length,h=f.rh,k=Ra.length(d.ng);a=R(a,"MAIN_OPAQUE").time;k&&(a*=k);var l=pc;l[0]=20/g*(b-.25*a);l[1]=20/g*(c-.25*a);k=Sa.Wu(l);l[0]=17/g*
(c+.1*a);l[1]=17/g*(b+.1*a);var l=Sa.Wu(l),k=k+l-1,n=f.dst_noise_scale0,l=f.dst_noise_scale1,m=f.dst_noise_freq0,q=f.dst_noise_freq1,r=pc;r[0]=n*(b+m*a);r[1]=n*(c+m*a);n=Sa.bt(r);r[0]=l*(c-q*a);r[1]=l*(b-q*a);l=Sa.bt(r);l*=e*n;if(f.bh)if(q=(b-f.ik[0])/f.jk[0],r=(f.ik[1]+c)/f.jk[1],q+=.5,r+=.5,1<q||0>q||1<r||0>r)f=l;else{var d=Sa.Yv(d.Xs,f.Ys,q,r),r=f.dir_freq,wa=f.dir_noise_scale,L=f.dir_noise_freq,n=f.dir_min_noise_fac,q=f.dst_min_fac,m=g/f.Xr/Math.PI;c=[wa/g*(b+L*a),wa/g*(c+L*a)];b=Math.sqrt(d);
f=e*Math.max(d,f.dir_min_shore_fac)*Math.sin(b/m+r*a)*Math.max(Sa.bt(c),n);e=Math.max(b,q);f=f*(1-e)+l*e;k*=d}else f=l;return h+(f+.05*k)}function V(a,b){a.Pl&&"POSTPROCESSING"==a.type&&b.Ib!=a.Ib&&(a.Ib=b.Ib);b.Ib||"OUTLINE"!=a.type||(a.Tq=0)}function oa(a,b,c,d){var f=ta.Ka(a,b);W.Yo(f.j,c,d);f.Wp=!0;ta.ih(a,b,function(b,f,e){e.Bb&&e.from==c&&na.$C(e)&&Ca(a,b,e.to,d)});ta.De(a,b,function(b,f,e){e.Bb&&e.from==c&&e.from==e.to&&oa(a,b,c,d)})}function Ca(a,b,c,d){a=ta.Ka(a,b).v;for(b=0;b<a.length;b++)I.aI(a[b].H,
d,c)}function ya(a){var b=R(a,"GRASS_MAP");if(b){var c=b.j,d=a.tg.g;a=Za.get_trans_view(d.i);var f=vc;f[0]=0;f[1]=-b.Nc[2]/2;f[2]=0;b=Za.get_quat_view(d.i);Ra.transformQuat(f,b,f);f[0]+=a[0];f[1]=0;f[2]+=a[2];b=yd;b[0]=0;b[1]=0;b[2]=0;b[3]=1;W.Us(c,f,b)}}function X(a,b){ta.ea(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.pa[0]||!d.hf[0])throw"Wrong MOTION_BLUR subscene";var f=d.pa[0],e=d.hf[0];d.hf[0]=d.j.Db;ta.ih(a,c,function(b,c,d){d.Bb&&Ca(a,b,d.to,e)});oa(a,c,f.from,e);Ca(a,c,f.to,d.hf[0]);
d.nx=Math.exp(-b/d.mb_factor)}})}function pa(a){return a.k.ng}function sa(a,b){if(!a.k.bf)return null;for(var c=a.k.bf.xf,d=0;d<c.length;d++)if(c[d]==b)return d;c=a.k.bf.Gq;for(d=0;d<c.length;d++)if(c[d]==b)return d;return null}var I=p("__batch"),qa=p("__boundings"),W=p("__camera"),ua=p("__config"),ja=p("__container"),Da=p("__debug"),ia=p("__geometry"),ta=p("__graph"),Ha=p("__hud");p("__lights");var Ia=p("__mat4"),va=p("__nodemat"),wa=p("__objects"),Ba=p("__obj_util"),Fa=p("__physics"),Fb=p("__prerender"),
tc=p("__primitives"),Oa=p("__print"),sb=p("__renderer"),na=p("__scenegraph"),mc=p("__sfx"),ra=p("__shaders"),Ka=p("__textures"),Za=p("__tsr"),Sa=p("__util"),Ra=p("__vec3"),Gb=p("__vec4"),za=ua.q,Lc=ua.Kb,uc=ua.ek,Bc="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND COLOR_PICKING COLOR_PICKING_XRAY SHADOW_RECEIVE OUTLINE_MASK WIREFRAME".split(" ");a.tL=Bc;var Nb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND LUMINANCE_TRUNCED SHADOW_RECEIVE SHADOW_CAST COLOR_PICKING COLOR_PICKING_XRAY OUTLINE_MASK".split(" "),
tb="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND".split(" "),Xc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND COLOR_PICKING COLOR_PICKING_XRAY SHADOW_RECEIVE GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),zd="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND".split(" "),
Cc=null,jb=null,La=[],kb=null,Yc=Math.PI/2,pc=new Float32Array(2),vc=new Float32Array(3),yd=new Float32Array(4),wc=new Float32Array(4),nc=new Float32Array(16),jd=new Float32Array(24),lb=new Float32Array(24),bb=qa.cd(),Dc=qa.cd(),Hb=0,Fc=-Infinity;a.$L=function(){return{}};a.set_active=function(a){jb=a;mc.nI(a)};a.MH=function(a,b){var c=a.k,d=na.JD(c.jb);if(a==b){Aa(a,ja.lw(),ja.kw());for(var f=0;f<d.length;f++)a.k.zi.push(d[f])}else for(f=a.Od[0],Aa(a,f.k.Gi,f.k.Gi),f=0;f<d.length;f++)b.k.zi.push(d[f]);
d=ca(a,Xc);for(f=0;f<d.length;f++)d[f].ng.set(c.ng);for(f=0;f<c.zi.length;f++)"SHADOW_CAST"==c.zi[f].type&&sb.ij(c.zi[f])};a.wj=function(){Cc||(Cc=e(La));return Cc};a.Mn=e;a.get_active=b;a.ma=function(){return jb?!0:!1};a.Hl=function(a){return a.tg};a.tj=function(){return La};a.fw=function(){if(1==La.length)return La;for(var a=0;a<La.length;a++){var b=La[a].k.jb;ta.ea(b,function(b,c){for(var d=0;d<c.v.length;d++){for(var f=c.v[d].H.Y,e=null,g=0;g<f.length;g++)if("SCENE"==f[g].source&&f[g].dt==La[a].name&&
"COPY"!=c.type){Oa.error('Texture-scene loop detected. A scene is rendered to texture "'+f[g].name+'" yet this texture belongs to the same scene.');ta.Ze(kb,La[a]);e=c.v[d].H;break}e&&(e.Y=[],e.nc=[],I.PJ(e,null),I.Rb(e))}})}for(var c=[],a=0;a<La.length;a++)if(b=La[a],!b.Od.length){b=ta.Ze(kb,b);ta.yE(kb,b);b=ta.fp(kb,b,ta.Mm);b=ta.xt(b);ta.ea(b,function(a,b){c.push(b)});break}return c};a.QB=function(a,b,e,m,wa){a.Od=a.Od||[];a.W=null;var L=a.k,p=Ba.R(a.tg,a),t=a.tg.g;L.Hk=[];var V=a.world;L.wG=e.length;
L.hg=k(e);L.cp=f(V,L.hg);L.Rt=E(V,L.cp);L.Uz=z(V);L.HB=O(a,wa);if(wa=!a.Od.length)p.M[0].type!=W.pc&&"HMD"==za.stereo?(Oa.warn("Head-mounted display stereo is disabled for the non-perspective camera"),wa=!1):wa="HMD"==za.stereo;L.Aw=wa;if(wa=!a.Od.length)p.M[0].type!=W.pc&&"ANAGLYPH"==za.stereo?(Oa.warn("Anaglyph stereo is disabled for the non-perspective camera"),wa=!1):wa="ANAGLYPH"==za.stereo;L.anaglyph_use=wa;L.bf=y(a,b,m);L.wC=n(a);L.eH=u(a);L.NC=A(a);L.VF=B(a);L.wH=H(a);L.Hg=v(a);L.gj=za.gj&&
(0<t.dof_distance||t.qd);L.li=za.li&&a.b4w_enable_motion_blur;L.bj=za.bj&&a.b4w_enable_color_correction;L.antialiasing=za.antialiasing&&1==za.Dc&&"NONE"!=a.b4w_antialiasing_quality;L.Zc=za.Zc&&a.b4w_enable_ssao;L.xj=za.xj&&a.b4w_enable_god_rays&&L.hg;L.iE=za.Fn;L.Sn=a.b4w_glow_settings.render_glow_over_blend;L.pJ=l(a);wa=g(m);L.aH=wa;L.Gc=C(a,wa);L.mc=c(a,e,m);L.Sb=q(m);L.pg=D(m);L.cJ=h(m);L.shore_smoothing=r(m);L.fc=G(a,m);L.hD=d(a,m);L.outline=F(a,m);L.Kf=J(a,m);switch(a.b4w_reflection_quality){case "LOW":L.yf=
uc.pv;L.wi=uc.Px;break;case "MEDIUM":L.yf=uc.$D;L.wi=uc.IH;break;case "HIGH":L.yf=uc.ZD;L.wi=uc.HH;break;default:L.yf=uc.pv,L.wi=uc.Px}if(ja.mG())Oa.log("%cENABLE HIDPI MODE","color: #00a"),L.qu="AA_QUALITY_LOW",L.Vc=1,za.Dc=1;else if(1<za.Dc)Oa.log("%cENABLE MSAA RENDERING: "+za.Dc+"x","color: #00a"),L.Vc=1;else{L.qu="AA_QUALITY_"+a.b4w_antialiasing_quality;switch(a.b4w_antialiasing_quality){case "LOW":L.antialiasing&&(L.Vc=1);break;case "MEDIUM":za.quality==ua.P_LOW||za.quality==ua.P_HIGH?L.Vc=
1:za.quality==ua.P_ULTRA&&(L.Vc=1.33);break;case "HIGH":za.quality==ua.P_LOW?L.Vc=1:za.quality==ua.P_HIGH?L.Vc=1.33:za.quality==ua.P_ULTRA&&(L.Vc=2);break;case "NONE":za.quality==ua.P_LOW||za.quality==ua.P_HIGH?L.Vc=1:za.quality==ua.P_ULTRA&&(L.Vc=2)}za.quality==ua.P_CUSTOM&&(L.Vc=1)}e=a.Od.sort(function(a,b){return b.k.Gi-a.k.Gi});L.jb=na.ID(L,p,t,e);L.zi=[];L.yo=!1;L.ds=!1;L.es=!1;L.ng=new Float32Array(3);La.push(a);kb||(kb=ta.create());ta.B(kb,a);for(L=0;L<b.length;L++)Ba.Ls(b[L],!0,a);a=ja.get_container();
ja.resize(a.clientWidth,a.clientHeight,!0)};a.RB=function(a,b,c){for(var d=0;d<b.length;d++)b[d].k&&b[d].k.Rl&&(b[d].k.mg=c,a.k.Hk.push(b[d]))};a.pr=function(a){return a.k.jb};a.Tv=function(a){ta.ea(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=I.Dq(c.No);break;case "SSAO":d=I.PD(c);break;case "SSAO_BLUR":d=I.QD(c);break;case "DEPTH_PACK":d=I.uD();break;case "GOD_RAYS":na.ab(a,c,"RESOLVE")||na.ab(a,c,"WIREFRAME")||na.ab(a,c,"MAIN_BLEND")||na.ab(a,c,"GOD_RAYS");d=I.yD(c.Lx,c.qh,
c.uk);break;case "GOD_RAYS_COMBINE":na.ab(a,c,"RESOLVE")||na.ab(a,c,"WIREFRAME")||na.ab(a,c,"MAIN_BLEND");na.ab(a,c,"GOD_RAYS");d=I.zD();break;case "MOTION_BLUR":d=I.DD();break;case "DOF":var d=I.vD(),f=na.ab(a,c,"POSTPROCESSING"),e=na.ab(a,f,"POSTPROCESSING");na.yc(f,c.j.dof_power);na.yc(e,c.j.dof_power);break;case "OUTLINE":var d=I.ED(),f=na.ab(a,c,"POSTPROCESSING"),e=na.ab(a,f,"POSTPROCESSING"),g=na.ab(a,e,"POSTPROCESSING"),h=na.ab(a,g,"POSTPROCESSING");na.yc(e,c.dq);na.yc(f,c.dq);na.yc(h,c.Zq*
c.Wl);na.yc(g,c.Zq*c.Wl);break;case "GLOW_COMBINE":d=I.xD();break;case "COMPOSITING":d=I.sD();break;case "ANTIALIASING":d=I.mD(c);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=I.ND(c.type);break;case "STEREO":d=I.RD(c.hb);break;case "SKY":d=I.HD();break;case "LUMINANCE":d=I.AD();break;case "AVERAGE_LUMINANCE":d=I.nD();break;case "LUMINANCE_TRUNCED":d=I.BD();break;case "BLOOM_BLUR":d=I.oD();break;case "BLOOM":d=na.ab(a,
c,"BLOOM_BLUR");f=na.ab(a,d,"BLOOM_BLUR");na.yc(d,c.bloom_blur);na.yc(f,c.bloom_blur);d=I.pD();break;case "VELOCITY":d=I.VD();break;case "ANCHOR_VISIBILITY":d=I.lD();break;case "PERFORMANCE":d=I.FD()}d&&(f=K(Ba.Oh("NONE"),d),Q(d),c.v.push(f),T(a,c,d),N(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":case "LINE":var d=a.k.jb,f=b.g;!na.Eb(d,"SHADOW_CAST")&&f.Xc&&(f.Xc=!1);f=ca(a,Bc);c&&b.Li&&Fa.append_object(b,a);for(var e=0;e<f.length;e++){var g=f[e],h=b,k=d,l=a,n=c;switch(g.type){case "MAIN_OPAQUE":w(g,
h,k,"OPAQUE",l,n);break;case "MAIN_BLEND":w(g,h,k,"BLEND",l,n);break;case "MAIN_XRAY":w(g,h,k,"XRAY",l,n);break;case "MAIN_GLOW":w(g,h,k,"GLOW",l,n);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":S(g,h,k,!1,l,n);break;case "MAIN_PLANE_REFLECT_BLEND":case "MAIN_CUBE_REFLECT_BLEND":S(g,h,k,!0,l,n);break;case "SHADOW_RECEIVE":for(var m=Ba.R(h,l).P,q=0;q<m.length;q++){var r=m[q];"SHADOW"==r.type&&"RECEIVE"==r.hb&&(n||(t(r,g,h,k,"SHADOW",l),I.Rb(r),Q(r)),g.v.push(K(h.g,r)),T(k,g,r),N(r))}break;
case "SHADOW_CAST":for(var m=!1,q=h.g,h=Ba.R(h,l).P,r=na.Eb(k,"GRASS_MAP"),L=0;L<h.length;L++){var p=h[L];if("SHADOW"==p.type&&"CAST"==p.hb){m=!0;if(!n){var u=g.Bo;I.ya(p,"NUM_LIGHTS",u);I.ya(p,"NUM_LFACTORS",0==u%2?u/2:Math.floor(u/2)+1);ra.N(p.Fb,"SHADOW_USAGE","SHADOW_CASTING");p.fc&&r&&P(p,r,q);I.ya(p,"SHADOW_TEX_RES",ra.r(l.k.mc.csm_resolution));I.Rb(p);Q(p)}g.v.push(K(q,p))}}m&&(h=l.k.mc,n=na.Eb(k,"MAIN_OPAQUE"),U(g,l,n.j,g.v,h,!0));break;case "COLOR_PICKING":Y(g,h,k,l,n);break;case "COLOR_PICKING_XRAY":Y(g,
h,k,l,n);break;case "OUTLINE_MASK":k=h.g;h=Ba.R(h,l).P;for(l=0;l<h.length;l++)m=h[l],"COLOR_ID"==m.type&&"OUTLINE"==m.hb&&(n||(I.ya(m,"USE_OUTLINE",1),I.Rb(m),Q(m)),g.v.push(K(k,m)));break;case "GRASS_MAP":k=h.g;h=Ba.R(h,l).P;for(l=0;l<h.length;l++)m=h[l],"GRASS_MAP"==m.type&&(n||(I.Rb(m),Q(m)),g.v.push(K(k,m)),m=g.j,p=k.wb,q=g.Nc[0],r=g.Nc[1],L=g.Nc[2],0==q&&0==r?(q=p.min_y,r=p.max_y):(q=Math.min(q,p.min_y),r=Math.max(r,p.max_y)),p=1E-4*(r-q),q-=p,r+=p,g.Nc[0]=q,g.Nc[1]=r,W.Zo(m,L/2,-r,-q,L/2),W.$g(m));
break;case "WIREFRAME":for(m=h.g,h=Ba.R(h,l).P,l=0;l<h.length;l++)q=h[l],"WIREFRAME"==q.type&&ka(g,m,k,n,q)}}break;case "LAMP":ba(b,a),wa.fJ(a)}Ba.Ls(b,!0,a)};a.Ms=function(a){a.k.yo=!0};a.lK=function(a,b){ta.ea(b,function(b,c){if("SHADOW_CAST"===c.type){var d=Za.get_trans_view(a.i);Za.set_trans(d,c.j.i);Za.copy(a.He,c.j.Vs)}})};a.RN=ea;a.AF=function(a,b){for(var c=a.k.mc,d=new Float32Array(c.csm_num),f=0;f<c.csm_num;f++)d[f]=W.YD(c,b,f);return d};a.DL=ka;a.Xu=ga;a.Zk=ma;a.is_hidden=function(a){return a.g.ai};
a.VH=function(a,b,c){b=b.g;a=ca(a,Bc);for(var d=0;d<a.length;d++)for(var f=a[d].v,e=f.length-1;0<=e;e--){var g=f[e];g.$e==b&&(g.H&&c&&ia.dv(g.H.X),f.splice(e,1))}};a.aK=function(a,b){for(var c=a.Qa,d=Ba.R(a,b).gi,f=ca(b,Nb),e=0;e<f.length;e++){var g=f[e];g.mo.set(c.il,3*d);g.ia=!0}};a.rp=ba;a.cleanup=function(){for(var a=0;a<La.length;a++){var b=La[a];ta.ea(b.k.jb,function(a,b){if("SINK"!=b.type){var c=b.j;sb.YH(c.Zd,c.Db,c.od,c.width,c.height);for(var c=b.v,d=0;d<c.length;d++){var f=c[d].H;f&&I.fD(f)}}});
b.k.jb=[];b.k.zi=[]}jb=Cc=null;La.length=0;kb=null};a.gx=function(a,b,c){a=W.FE(a,a.near,a.far,null,!0);var d=tc.gF(a);a=Ba.Oh("DYNAMIC");a.wb=a.dc={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.ec=a.Sd=qa.tC();var f=a.ec.Wa;a.sf=a.Ne=qa.yn([f,0,0],[0,f,0],[0,0,f],a.ec.J,[0,0,0,1]);c=I.MD(d,c);b.v.push(K(a,c))};a.HM=function(a){return[a.frame_start,a.frame_end]};a.vy=function(a,b,c){ja.XI(a,b,c);jb&&Aa(jb,a,b)};a.zN=Aa;a.Ry=ca;a.Z=R;a.get_environment_colors=function(a){a=
R(a,"MAIN_OPAQUE");var b=a.be,c=a.ne,d=[],f=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];f[0]=c[0];f[1]=c[1];f[2]=c[2];return[a.Ef,d,f]};a.set_environment_colors=function(a,b,c,d){a=ca(a,Nb);for(var f=0;f<a.length;f++){var e=a[f];e.be.set(c);e.ne.set(d);e.Ef=b;e.ia=!0}};a.get_sky_params=function(a){if(a=R(a,"SKY")){var b={};b.color=Array(3);Ra.copy(a.kk,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=
a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=R(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&
(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.kk.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==
typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.ia=!0,c.xo=!0,aa(a,c))};a.EM=function(a){return ca(a,tb)[0].Xd[0]};a.CM=function(a){return ca(a,tb)[0].Xd[1]};a.FM=function(a){return ca(a,tb)[0].Xd[2]};a.DM=function(a){return ca(a,
tb)[0].Xd[3]};a.sI=function(a,b){for(var c=ca(a,tb),d=0;d<c.length;d++){var f=c[d];f.Xd[0]=b;f.ia=!0}};a.qI=function(a,b){for(var c=ca(a,tb),d=0;d<c.length;d++){var f=c[d];f.Xd[1]=b;f.ia=!0}};a.tI=function(a,b){for(var c=ca(a,tb),d=0;d<c.length;d++){var f=c[d];f.Xd[2]=b;f.ia=!0}};a.rI=function(a,b){for(var c=ca(a,tb),d=0;d<c.length;d++){var f=c[d];f.Xd[3]=b;f.ia=!0}};a.get_fog_color_density=function(a,b){var c=b||[],d=ca(a,tb)[0].zc;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=
function(a,b){for(var c=ca(a,tb),d=0;d<c.length;d++){var f=c[d];f.zc.set(b);f.ia=!0}};a.get_ssao_params=function(a){var b=R(a,"SSAO");a=R(a,"SSAO_BLUR");if(!b)return null;var c=b.v[0].H,d={};d.ssao_quality=I.hc(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.Mu=a.ssao_blur_discard_value;d.radius_increase=b.pk;d.influence=b.nk;d.dist_factor=b.mk;d.ssao_only=b.ssao_only;d.ssao_white=I.hc(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=
R(a,"SSAO"),d=R(a,"SSAO_BLUR");if(!c)return Oa.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var f=c.v[0].H;I.ya(f,"SSAO_QUALITY",b.ssao_quality);I.Rb(f,!0)}"number"==typeof b.ssao_hemisphere&&(f=c.v[0].H,I.ya(f,"SSAO_HEMISPHERE",b.ssao_hemisphere),I.Rb(f,!0));"number"==typeof b.ssao_blur_depth&&(f=d.v[0].H,I.ya(f,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),I.Rb(f,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==
typeof b.pk&&(c.pk=b.pk);"number"==typeof b.nk&&(c.nk=b.nk);"number"==typeof b.mk&&(c.mk=b.mk);if("number"==typeof b.ssao_only){c=R(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var e=0;e<c.v.length;e++)f=c.v[e].H,I.ya(f,"SSAO_ONLY",b.ssao_only),I.Rb(f,!0)}"number"==typeof b.ssao_white&&(f=c.v[0].H,I.ya(f,"SSAO_WHITE",b.ssao_white),I.Rb(f,!0));c.ia=!0;d.ia=!0};a.get_dof_params=function(a){a=R(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;
b.dof_power=a.j.dof_power;b.qd=a.j.qd;return b};a.set_dof_params=xa;a.get_god_rays_params=function(a){var b=ca(a,["GOD_RAYS"]);a=R(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].Ij;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=I.hc(b[0].v[0].H,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=ca(a,["GOD_RAYS"]),d=R(a,"GOD_RAYS_COMBINE");if(!c||!d)return Oa.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&
(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var f=b.god_rays_max_ray_length,e=0;e<c.length;e++)c[e].Ij=f,c[e].So=f/c[e].uk/(e+1),c[e].ia=!0;if("number"==typeof b.god_rays_steps)for(var g=ra.r(b.god_rays_steps,1),f=c[0].Ij,e=0;e<c.length;e++){c[e].uk=g;c[e].So=f/g/(e+1);c[e].ia=!0;var h=c[e].v[0].H;I.ya(h,"STEPS_PER_PASS",g);I.Rb(h,!0)}d.ia=!0};a.get_bloom_params=function(a){var b=R(a,"LUMINANCE_TRUNCED");a=R(a,"BLOOM");if(!b||!a)return null;var c=
{};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=la;a.get_glow_material_params=function(a){a=R(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=da;a.get_wind_params=function(a){var b=pa(a);a=Ra.length(b);if(0==
a)return null;var b=Sa.rad_to_deg(Math.atan2(b[0],b[2])),c={};c.wind_dir=b;c.wind_strength=a;return c};a.kI=function(a){a.k.ds=!0};a.get_water_surface_level=L;a.get_water_mat_params=function(a,b){var c=a.k.Sb,d=R(a,"MAIN_OPAQUE");d&&c&&(b.waves_height=c.waves_height,b.waves_length=c.waves_length,d.Ie&&(b.water_fog_density=d.Ie[3],c=b.water_fog_color=[],c[0]=d.Ie[0],c[1]=d.Ie[1],c[2]=d.Ie[2]))};a.set_water_params=function(a,b){var c=a.k.Sb;if(!c)return Oa.error("set_water_params() - no water parameters on the scene"),
null;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);
"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.ul=b.water_dynamic);for(var d=ca(a,zd),f=0;f<d.length;f++){var e=d[f];"number"==typeof b.water_fog_density&&c.zc&&(e.Ie[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.zc&&
e.Ie.set(b.water_fog_color);"number"==typeof b.waves_height&&(e.Mt=b.waves_height);"number"==typeof b.waves_length&&(e.Nt=b.waves_length);e.ia=!0}};a.get_shore_dist=function(a,b,c){var d=a.k.Sb;if(!d.bh)return 100;var f=d.Xr;a=d.rh;var e=(b[0]-d.ik[0])/d.jk[0],g=(d.ik[1]+b[2])/d.jk[1],e=e+.5,g=g+.5;if(1<e||0>e||1<g||0>g)b=1;else return d=f*Sa.Yv(jb.k.Xs,d.Ys,e,g),b=(a-b[1])*c,b=Math.sqrt(d*d+b*b)};a.update=function(a,c){for(var d=b().tg.g,f=0;f<La.length;f++){var e=La[f],g=e.k.jb,h=e.k;if(h.Sb)var k=
Za.get_trans_view(d.i),l=k[1]-L(e,k[0],k[2]);for(k=0;k<h.Hk.length;k++){var n=h.Hk[k].k,m=n.la,q=n.lc;if(!(e.b4w_use_nla&&n.tp||!m&&!q)&&Ka.Kz(n)){var r=Ka.Hz(n),wa=Ka.Jz(n);m&&za.Ve&&(wa-=5);var p=Ka.NK(n);r>=p&&n.Ki||r<wa?(Ka.reset_video(n.name,n.mg),q&&(n.fk=Ka.Xo(n,a))):r>=p&&!n.Ki?Ka.pause_video(n.name,n.mg):Ka.Lz(n)&&(m?Ka.vz(n):(m=Ka.Xo(n,a),m!=n.fk&&(Ka.uz(n),n.Di++),n.fk=m))}}ta.ea(g,function(b,c){-1<Xc.indexOf(c.type)&&(c.time=a);h.Sb&&(c.oq=l)})}for(f=0;f<La.length;f++)if(e=La[f],h=e.k,
g=h.jb,d=h.zi,d.length)for(h.yo&&(Z(e),h.yo=!1),h.ds&&(ya(e),h.ds=!1),h.es&&(M(e),h.es=!1),h.li&&X(g,c),e=na.Eb(g,"OUTLINE_MASK"),k=0;k<d.length;k++)g=d[k],Fb.Oo(g),e&&V(g,e),sb.ij(g);za.show_hud_debug_info&&Ha.aJ(La,c)};a.bI=function(a){a.k.es=!0};a.kr=function(a){var b=[];ta.ea(a.k.jb,function(a,c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=R(jb,"MAIN_BLEND"),b=jb;return a||b.k.Sb?a.oq:null};a.get_object_data_id=function(a){return a.g.Lc};a.tz=function(a){ta.ea(a.k.jb,function(a,
b){b.ia=!0})};a.SI=function(a,b){a.Ib=b!=Da.WM_NONE;for(var c=0;c<a.v.length;c++)a.v[c].H.wireframe_mode=b;a.Ga=b==Da.WM_TRANSPARENT_WIREFRAME;a.ia=!0};a.RI=function(a,b){for(var c=0;c<a.v.length;c++)a.v[c].H.wireframe_edge_color=b,a.ia=!0};a.$J=function(a,b){var c=b.kj,d=a.k.ng;if(c&&"WIND"==c.type&&d){var f=Za.get_quat_view(b.g.i);Sa.quat_to_dir(f,Sa.AXIS_Y,d);Ra.normalize(d,d);Ra.scale(d,c.Py,d);c=ca(a,Xc);for(f=0;f<c.length;f++)c[f].ng.set(d)}};a.CH=function(a,b,c){var d=R(a,"COLOR_PICKING");
if(d)return b=ja.Wk(b,c,pc,d.j),Fb.Oo(d),sb.ij(d),(a=R(a,"COLOR_PICKING_XRAY"))?(Fb.Oo(a),sb.ij(a),d=a.j):d=d.j,b[1]=d.height-b[1],sb.Bs(d.Zd,b[0],b[1]);Oa.error("Object Selection is not available on the scene");return null};a.set_outline_color=function(a){var c=b();if(c=R(c,"OUTLINE"))c.Xf.set(a),c.ia=!0};a.LM=pa;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.pz=function(a,b){var c=vc;Ra.negate(b,
c);for(var d=0;6>d;d++){var f=a.Ph[d],e=a.nl[d],g=a.j;Ia.translate(Sa.gA[d],c,f);Ia.multiply(g.nb,f,g.Ge);Sa.Ln(g.Ge,e)}};a.rz=function(a,b,c){Sa.DJ(b,c,Sa.AXIS_Y,a.j.Zb)};a.nC=function(a,b,c){var d=a.k.mc,f=a.k.bf;c=Ba.Rn(c,za.Zc&&a.b4w_enable_ssao);if(f)for(var e=0;e<b.length;e++){var g=b[e],h=Ba.R(g,a);if(null!=g.g.zd){var k=f.af,l=f.Mo,g=g.g.zd;l.length?h.af=l[g]:k.length&&(h.af=k[g])}else null!=g.g.Td&&(k=f.xf,l=f.Gq,g=g.g.Td,l.length?h.xf=l[g]:k.length&&(h.xf=k[g]))}for(e=0;e<c.length;e++)if(h=
Ba.R(c[e],a),d)for(b=ca(a,["SHADOW_CAST"]),f=0;f<b.length;f++)e==b[f].ze&&h.Ws.push(b[f])};a.marker_frame=function(a,b){return a.timeline_markers[b]};a.set_hmd_params=function(a){var c=b();if(c=R(c,"STEREO"))a.distortion_coefs&&(c.Sh[0]=a.distortion_coefs[0],c.Sh[1]=a.distortion_coefs[1],c.ia=!0),a.chromatic_aberration_coefs&&(c.chromatic_aberration_coefs[0]=a.chromatic_aberration_coefs[0],c.chromatic_aberration_coefs[1]=a.chromatic_aberration_coefs[1],c.chromatic_aberration_coefs[2]=a.chromatic_aberration_coefs[2],
c.chromatic_aberration_coefs[3]=a.chromatic_aberration_coefs[3],c.ia=!0),a.base_line_factor&&(c.Sh[2]=a.base_line_factor,c.ia=!0),a.inter_lens_factor&&(c.Sh[3]=a.inter_lens_factor,c.ia=!0),a.enable_hmd_stereo&&(c.enable_hmd_stereo=a.enable_hmd_stereo,c.ia=!0)};a.lH=function(b,c){for(var d=La,f=0;f<d.length;f++)na.mH(a.pr(d[f]),b,c)}};b4w.module.__physics=function(a,p){function e(a,b){for(var c=a.Kc,d=0;d<c.length;d++)c[d].xe.Am&&b.push(c[d]),e(c[d],b)}function b(a,b,c){for(var d=a.ub.v,f=0;f<d.length;f++)for(var e=d[f].o,g=0;g<e.Jc.length;g++){var h=e.Jc[g];"ANY"!=h.Ya&&c!=h.Ya||E(h,a,b)}}function c(a,b,c){if(t.eo(a))switch(b){case t.pA:var f=m(a);f.ub.Tz=!0;t.F(a,t.aB,Date.now()-performance.now(),ka.ve,ka.lq?ga.Nv:0);break;case t.qA:N.Ur("URANIUM:",c.slice(1));break;case t.lA:N.error(c);break;case t.mA:w.fbmsg.apply(this,c.slice(1));
break;case t.vA:var e=k(c.C);if(e){a=c.trans;f=c.quat;b=c.We;var g=c.Je,e=e.o;e.Bn=c.time;M.set_sep(a,1,f,e.Iq);ea.copy(b,e.We);ea.copy(g,e.Je)}break;case t.sA:(a=k(c.qq))&&M.set_sep(c.trans,1,c.quat,a.l.dm[c.xs]);break;case t.nA:if(f=k(c[1]))a=c[4],f=f.Wd.nn[c[2]],Z.set_translation(f,c[3]),Z.set_rotation(f,a),Z.n(f);break;case t.wA:if(e=k(c[1]))e.l.speed=c[2];break;case t.hA:f=m(a);r(f,c.Eh,c.Fh,c.result,null,null,0);break;case t.jA:f=m(a);r(f,c.Eh,c.Fh,c.result,c.Mh,c.coll_norm,c.coll_dist);break;
case t.iA:if(e=k(c[1]))a=e.o,a.Lh&&a.Lh(c[2]);break;case t.Zt:case t.tA:f=m(a);if(a=f.ub.Wg[c.id])if(f=k(c.$i),b==t.Zt)b=a.callback,b(a.id,c.hit_fract,f,c.hit_time);else{b=c.hit_fract;var g=c.hit_time,e=c.hit_pos,h=a.callback;e?h(a.id,b,f,g,e,c.hit_norm):h(a.id,b,f,g)}break;case t.uA:d(id);break;case t.rA:a=x.indexOf(a);console.log("Physics #"+a+" Ping: OUT "+(c[2]-c[1]).toFixed(3)+" ms, IN "+(performance.now()-c[2]).toFixed(3)+" ms, ALL "+(performance.now()-c[1]).toFixed(3)+" ms");break;case t.oA:ba=
c[1];break;case t.kA:a=x.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:N.error("Wrong message: "+b)}}function m(a){for(var b=0;b<x.length;b++)if(x[b]==a)return fa[b]}function k(a){return aa[a]||null}function r(a,b,c,d,f,e,g){a=a.ub.v;for(var l=0;l<a.length;l++)for(var n=a[l].o,m=0;m<n.Jc.length;m++){for(var q=n.Jc[m],r=q.Tg,p=!1,t=0;t<r.length;t++){var u=r[t];if(u[0]===b&&u[1]===c){q.Xl[t]=d;p=!0;break}}p&&(r=h(q),f&&q.fq!=b&&(p=f,t=e,u=g,p[0]+=t[0]*u,p[1]+=t[1]*u,
p[2]+=t[2]*u,t[0]*=-1,t[1]*=-1,t[2]*=-1),q.callback(r,r?q.fq==b?k(c):k(b):null,f,e,g))}}function h(a){a=a.Xl;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function q(){ca.body++;return ca.body}function g(a){var b=Aa.indexOf(a);return-1==b?(Aa.push(a),Aa.length-1):b}function y(a,b){return{C:a,type:b,Xe:0,fo:!1,dh:!0,Pc:!1,is_character:!1,kG:!1,un:null,Ya:"",el:0,UL:{},Jc:[],Lh:null,Bn:0,Iq:new Float32Array([0,0,0,1,0,0,0,1]),We:new Float32Array(3),Je:new Float32Array(3),pn:new Float32Array(3),
Vk:new Float32Array(4)}}function f(a,b){switch(a){case "BOX":var c=b.dc;break;case "CYLINDER":c=b.$p;break;case "CONE":c=b.Zp;break;case "SPHERE":c=b.Sd;break;case "CAPSULE":c=b.Yp}return c}function l(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);
"object"===typeof a.J&&(b.center=a.J);"number"===typeof a.Wa&&(b.radius=a.Wa);"number"===typeof a.height&&(b.height=a.height);return b}function n(a,b,c,d,f){var e=M.get_trans_view(a.g.i),g=M.invert(b.g.i,la),h=new Float32Array(3);M.transform_vec3(e,g,h);switch(b.l.type){case 10:b=b.bd;a=a.g.dc;t.F(f,t.EA,c,h,b.yJ,b.Hs,(a.max_y-a.min_y)/2,d);break;case 20:t.F(f,t.DA,c,h,a.MN)}}function u(a){return a.o&&a.o.un}function A(a,b,c,d,f,e,g,h,k,l){var n;ca.ib++;n=ca.ib.toString(16);var m=b.o.C;t.F(B(m),t.LA,
n,a,h,m,c,d,f.o.C,e,g,k,l);b.o.un=n}function B(a){for(var b=0;b<fa.length;b++)for(var c=fa[b].ub.v,d=0;d<c.length;d++)if(c[d].o.C==a)return x[b];return null}function H(a){var b=a.o;if(b=b?0===b.Xe?!0:!0===b.fo?!0:!1===b.dh?!0:"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type?!0:!1:!1)var b=M.get_trans_view(a.g.i),c=M.get_quat_view(a.g.i),b=b[0]!=a.o.pn[0]||b[1]!=a.o.pn[1]||b[2]!=a.o.pn[2]||c[0]!=a.o.Vk[0]||c[1]!=a.o.Vk[1]||c[2]!=a.o.Vk[2]||c[3]!=a.o.Vk[3];if(b){var b=a.o,d=a.g,c=M.get_trans_view(d.i),d=M.get_quat_view(d.i);
ea.copy(c,b.pn);P.copy(d,b.Vk);var f=t.ew(t.Sm);f.C=b.C;f.trans=c;"DYNAMIC"==b.type?P.identity(f.quat):f.quat=d;t.F(B(b.C),t.Sm)}a=a.Kc;for(b=0;b<a.length;b++)H(a[b])}function v(a,b,c,d,f){f=f||new Float32Array(3);a=M.get_quat_view(a.g.i);f[0]=b;f[1]=c;f[2]=d;ea.transformQuat(f,a,f)}function E(a,b,c){var d=a.Tg,f=a.Xl,e=a.fq,g=[],h=a.Ya;if(!g)throw"At least one destination required";for(var k=0;k<b.ub.v.length;k++){var l=b.ub.v[k];if("ANY"==h||l.o.Ya==h)l=l.o.C,g&&-1==g.indexOf(l)&&g.push(l)}for(b=
0;b<g.length;b++)h=g[b],e<h&&!z(d,e,h)?(d.push([e,h]),f.push(!1)):e>h&&!z(d,h,e)&&(d.push([h,e]),f.push(!1));t.F(c,t.CA,e);t.F(c,t.KA,d,a.Pe)}function z(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function G(a){a.o&&a.o.Lh&&(a=a.o,t.F(B(a.C),t.XA,a.C),a.Lh=null)}function d(a){var b=J(a),c=F(a).ub;c.Wg[a]&&(delete c.Wg[a],c.As.splice(c.As.indexOf,1),t.F(b,t.fB,a))}function F(a){for(var b=0;b<fa.length;b++){var c=fa[b];if(c.ub.Wg[a])return c}return null}function J(a){for(var b=
0;b<fa.length;b++)if(fa[b].ub.Wg[a])return x[b];return null}function C(a,b,c){if(b.tk){a=a.o.C;var d=b.jj*b.Bl,f=b.Tk*b.Uk,e=-b.qk*b.rk*2*Math.PI/b.tm;b.Ol&&(e*=-1);switch(b.type){case 10:t.F(c,t.sB,a,d,f,e);break;case 20:t.F(c,t.rB,a,d,f,e)}}}function D(a){return a.Pc&&"CHASSIS"==a.bd.Rc}function O(a){return a.Pc&&"HULL"==a.bd.Rc}function T(a){return a.fi&&"MAIN_BODY"==a.lj.Rc}var K=p("__config"),w=p("__debug"),t=p("__ipc"),Q=p("__obj_util"),N=p("__print"),P=p("__quat"),S=p("__scenes"),Z=p("__transform"),
M=p("__tsr"),U=p("__util"),ea=p("__vec3"),Y=p("__version"),ka=K.o,ga=K.q,ma=K.Qd,ba=0,x=[],fa=[],aa={},ha=[],Aa=["ANY"],ca={body:0,ib:0,ay:0},R=new Float32Array(3);new Float32Array(4);var xa=new Float32Array(4);new Float32Array(16);var la=M.create(),da=M.create();a.fG=function(a){a.ub={Tz:!1,v:[],Wg:{},As:[]};var b=ka.ym;ma.prevent_caching&&(b+=Y.timestamp());N.log("%cLOAD PHYSICS","color: #0a0",ka.Dm?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+ka.ve);N.log("%cPHYSICS PATH","color: #0a0",
b);var d=t.WD(b,!ka.Dm);t.pC(d,c);x.push(d);fa.push(a);ka.ping&&setInterval(function(){t.F(d,t.cB,performance.now())},1E3)};a.aD=function(a){return a.ub?a.ub.Tz:!0};a.cleanup=function(){for(var a=0;a<x.length;a++)t.terminate(x[a]);x.length=0;fa.length=0;aa={};ha.length=0;Aa.length=0;for(var b in ca)ca[b]=0};a.append_object=function(a,c){if(!a.g)throw"No object render: "+a.name;var d;a:{for(var h=0;h<fa.length;h++)if(fa[h]==c){d=x[h];break a}d=void 0}var k=[];a.xe.Am&&e(a,k);var m=c.ub.v;if(D(a)||
O(a)||a.is_character||T(a)||a.Li){var r,p=a,F=d,w=p.g,v=p.xe,B=v.Ko,ja=q();if("CAMERA"==p.type)var z=v.Ft?v.rn:"BOX",ia=f(z,w),J=w.Dl,K=w.wl,J=.5,K=0;else if("EMPTY"==p.type)z="EMPTY",ia=null,K=J=0;else{var z=v.Ft?v.rn:"BOX",ia=f(z,w),G=M.get_scale(w.i);if(1!=G){var E=ia;switch(z){case "BOX":E.min_x*=G;E.max_x*=G;E.min_y*=G;E.max_y*=G;E.min_z*=G;E.max_z*=G;break;case "CYLINDER":case "CONE":case "CAPSULE":E.height*=G;E.Wa*=G;break;case "SPHERE":E.Wa*=G}}J=w.Dl;K=w.wl}var wa=M.get_trans_view(w.i),Ba=
M.get_quat_view(w.i),Fa=v.Cm,H=v.zz,S=v.Xe,ma=v.Dz,sb=v.Cz,na=v.Kq,ba=v.Js,ra=p.Ya,Z=g(ra),R=v.fl,ca=v.cl,Y=v.hl,ea=w.Sd.Wa,za=l(ia),Aa=p.xn,ka;var ga=z;if(k.length){var Nb=[],tb={};tb.quat=new Float32Array([0,0,0,1]);tb.trans=new Float32Array(3);tb.worker_bounding=za;tb.bounding_type=ga;Nb.push(tb);var Xc=M.invert(w.i,la),zd=M.get_quat_view(w.i);P.invert(zd,xa);for(var Cc=0;Cc<k.length;Cc++){var jb={},La=k[Cc],kb=La.xe.rn,Yc=new Float32Array(4),pc=new Float32Array(3),vc=M.get_trans_view(La.g.i),
yd=M.get_quat_view(La.g.i);M.transform_vec3(vc,Xc,pc);P.multiply(xa,yd,Yc);jb.trans=pc;jb.quat=Yc;jb.bounding_type=kb;jb.worker_bounding=l(f(kb,La.g));Nb.push(jb)}ka=Nb}else ka=[];t.F(F,t.HA,ja,wa,Ba,B,Fa,H,S,ma,sb,na,ba,Z,R,ca,Y,z,za,ea,J,K,ka,Aa);aa[ja]=p;ha.push(p);var wc=y(ja,"BOUNDING");wc.type=B;wc.Xe=S;wc.fo=Fa;wc.Ya=ra;wc.el=Z;r=wc;a.o=r;var nc={H:null,o:r};m.push(nc);b(c,d,r.Ya)}else for(var jd=Q.R(a,c).P,lb=0;lb<jd.length;lb++){var bb=jd[lb],Dc;if(Dc="PHYSICS"==bb.type){var Hb;a:{for(var Fc=
c.ub.v,ib=0;ib<Fc.length;ib++){var Ya=Fc[ib].H;if(Ya&&Ya.id==bb.id){Hb=!0;break a}}Hb=!1}Dc=!Hb}if(Dc)if(bb.Hd.ha)if(bb.qh&&c.k.Sb){var ec=bb,ub=c,xc=d,Ab=ub.k.Sb;t.F(xc,t.QA,Ab.rh);if(ec.SK){var Ga={};Ga.dst_noise_scale0=ec.dst_noise_scale0;Ga.dst_noise_scale1=ec.dst_noise_scale1;Ga.dst_noise_freq0=ec.dst_noise_freq0;Ga.dst_noise_freq1=ec.dst_noise_freq1;Ga.dir_min_shore_fac=ec.dir_min_shore_fac;Ga.dir_freq=ec.dir_freq;Ga.dir_noise_scale=ec.dir_noise_scale;Ga.dir_noise_freq=ec.dir_noise_freq;Ga.dir_min_noise_fac=
ec.dir_min_noise_fac;Ga.dst_min_fac=ec.dst_min_fac;Ga.waves_hor_fac=ec.waves_hor_fac;var Bb=Ab.waves_height,Gc=Ab.waves_length;Ab.bh?t.F(xc,t.hu,Ga,Ab.jk[0],Ab.jk[1],Ab.ik[0],Ab.ik[1],Ab.Xr,Bb,Gc,Ab.Ys,ub.k.Xs):t.F(xc,t.hu,Ga,0,0,0,0,0,Bb,Gc,0,null)}}else{var Rb;if(bb.Cm){var pd=a,yc=bb,qd=d,Ib=q(),Ec=yc.Hd,Mc=Ec.G[0].a_position,Ob=Ec.Ma||null,Ta=yc.Ya,Hc=g(Ta),cb=yc.fl,kd=yc.cl,Zc=yc.hl,bc=M.get_trans_view(pd.g.i);t.F(qd,t.NA,Ib,Mc,Ob,bc,Hc,cb,kd,Zc);var fc=y(Ib,"STATIC_MESH");fc.fo=!0;fc.Ya=Ta;
fc.el=Hc;Rb=fc}else{var oc=a,Ub=bb,Qc=d,Xa=q(),gb=Ub.Hd,Cb=gb.G[0].a_position,gc=gb.Ma||null,Rc=M.get_trans_view(oc.g.i),hc=Ub.Dl,pb=Ub.wl,yb=Ub.Ya,Ua=g(yb);t.F(Qc,t.PA,Xa,Cb,gc,Rc,hc,pb,Ua,Ub.fl,Ub.cl,Ub.hl);var $a=y(Xa,"STATIC_MESH");$a.Ya=yb;$a.el=Ua;Rb=$a}r=Rb;a.o=r;nc={H:bb,o:r};m.push(nc);b(c,d,r.Ya)}else N.error("Object "+a.name+" has collision material with no assigned vertices")}if(D(a)||O(a)){var Ma=a,mb=d,Vb=Ma.o.C;D(Ma)?(Ma.l.type=10,t.F(mb,t.IA,Vb,Ma.l.ot,Ma.l.qt,Ma.l.pt,Ma.l.Qt,Ma.l.Yr)):
O(Ma)&&(Ma.l.type=20,t.F(mb,t.GA,Vb,Ma.l.Xh,Ma.l.Qi,Ma.l.Ri));if(Ma.l.yi){var Db=Ma.l.yi;switch(Ma.l.type){case 10:n(Db[1],Ma,Vb,!0,mb);n(Db[0],Ma,Vb,!0,mb);n(Db[3],Ma,Vb,!1,mb);n(Db[2],Ma,Vb,!1,mb);break;case 20:for(var db=0;db<Db.length;db++)n(Db[db],Ma,Vb,!1,mb)}}C(a,a.l,d)}else if(a.is_character){var Pb=d,Jb=a.g,vb=a.o,ic=Jb.dc.max_y-Jb.dc.min_y,jc=vb.C,Wb=a.Yu,nb=Wb.RK,wb=Wb.hI,Pa=Wb.qJ,Ea=Wb.uG,Sb=Wb.TK,xb=U.mE(a);t.F(Pb,t.JA,jc,xb,ic,nb,wb,Pa,Ea,Sb);vb.is_character=!0}else if(T(a)){var Qb=
a,Ja=d,kc=Qb.o.C;t.F(Ja,t.MA,kc,Qb.Wd.Xh,Qb.Wd.Qi,Qb.Wd.Ri);if(Qb.Wd.nn)for(var Xb=Qb.Wd.nn,ab=0;ab<Xb.length;ab++){var qb=Xb[ab],Yb=M.get_trans_view(qb.g.i),hb=M.invert(Qb.g.i,la),Qa=new Float32Array(3);M.transform_vec3(Yb,hb,Qa);t.F(Ja,t.FA,kc,Qa,qb.yC)}Qb.o.kG=!0}for(lb=0;lb<ha.length;lb++)if(a=ha[lb],a.o){var Eb=a;if(!u(Eb))for(var Tb=0;Tb<Eb.us.length;Tb++){var Na=Eb.us[Tb],ob=Na.target,Va=Na.DH;if(ob.o){var rb=new Float32Array([Na.EH,Na.FH,Na.GH]),Zb,zc=new Float32Array([Na.Ke,Na.Le,Na.Me]);
Zb=U.euler_to_quat(zc,new Float32Array(4));var zb=M.identity(la),zb=M.set_trans(rb,zb),zb=M.set_quat(Zb,zb),lc=M.multiply(Eb.g.i,zb,la),$b=M.invert(ob.g.i,da),Kb=M.multiply($b,lc,$b),Lb=M.get_trans_view(Kb),Ic=M.get_quat_view(Kb),Wa=Na,eb={};eb.use_limit_x=Wa.wK;eb.use_limit_y=Wa.xK;eb.use_limit_z=Wa.yK;eb.use_angular_limit_x=Wa.rK;eb.use_angular_limit_y=Wa.sK;eb.use_angular_limit_z=Wa.tK;eb.limit_max_x=Wa.EG;eb.limit_min_x=Wa.HG;eb.limit_max_y=Wa.FG;eb.limit_min_y=Wa.IG;eb.limit_max_z=Wa.GG;eb.limit_min_z=
Wa.JG;eb.limit_angle_max_x=Wa.yG;eb.limit_angle_min_x=Wa.BG;eb.limit_angle_max_y=Wa.zG;eb.limit_angle_min_y=Wa.CG;eb.limit_angle_max_z=Wa.AG;eb.limit_angle_min_z=Wa.DG;A(Va,Eb,rb,Zb,ob,Lb,Ic,eb,null,null)}}}};a.LE=k;a.update=function(a,b){for(var c=0;c<x.length;c++){var d=x[c],f=a;d&&t.Gw(d)&&t.F(d,t.tB,f,b);for(var e=0;e<ha.length;e++){var g=ha[e],h=g.o;if(h.dh&&h.Bn){var k=t.Gw(d)?f-h.Bn:performance.now()/1E3-h.Bn,k=Math.min(k,10/ka.ve),k=k-1/ka.ve;ga.pH&&(k=0);var l=la;M.gG(h.Iq,k,h.We,h.Je,la);
Z.set_tsr(g,l);Z.n(g);H(g);if(g.l)for(var h=g,k=h.l.yi,l=h.g.i,n=la,m=0;m<k.length;m++){var q=k[m];M.multiply(l,h.l.dm[m],n);Z.set_tsr(q,n);Z.n(q)}g.l&&g.l.tk&&(n=g,k=n.l,h=k.tk)&&(m=n.l.My,M.multiply(n.g.i,n.l.Ny,h.g.i),l=R,M.transform_dir_vec3(m,n.g.i,l),n=xa,P.setAxisAngle(l,-k.qk*k.rk*2*Math.PI,n),k=M.get_quat_view(h.g.i),P.multiply(n,k,k),Z.n(h));g.l&&g.l.gt&&(n=g,k=n.l,h=k.gt)&&(m=n.l.Hy,M.multiply(n.g.i,n.l.Iy,h.g.i),l=R,M.transform_dir_vec3(m,n.g.i,l),n=xa,m=Math.abs(k.speed)*k.qm,m>k.Jj&&
(m=k.Jj),P.setAxisAngle(l,-m,n),k=M.get_quat_view(h.g.i),P.multiply(n,k,k),P.normalize(k,k),Z.n(h));g.l&&g.l.rt&&(l=g,h=l.l,g=h.rt)&&(n=l.l.Vy,M.multiply(l.g.i,l.l.Wy,g.g.i),k=R,M.transform_dir_vec3(n,l.g.i,k),l=xa,P.setAxisAngle(k,-Math.abs(h.jj)*h.ql,l),h=M.get_quat_view(g.g.i),P.multiply(l,h,h),P.normalize(h,h),Z.n(g))}}t.JH(d);d=fa[c];(f=d.k.Sb)&&0<f.waves_height&&(d=S.Z(d,"MAIN_OPAQUE"),f=ea.length(d.ng),t.F(x[c],t.qB,d.time*f))}};a.pF=function(){return fa[0]};a.pause=function(){for(var a=0;a<
x.length;a++)t.F(x[a],t.bB)};a.resume=function(){for(var a=0;a<x.length;a++)t.F(x[a],t.gB)};a.enable_simulation=function(a){a=a.o;if(!a)throw"No object physics";if(!a.dh){var b=a.C,c=B(b);a.dh=!0;t.F(c,t.$A,b)}};a.disable_simulation=function(a){a=a.o;if(!a)throw"No object physics";if(a.dh){var b=a.C,c=B(b);a.dh=!1;t.F(c,t.ZA,b)}};a.Uo=function(a){return Boolean(a.ub)};a.T=function(a){return Boolean(a.o)};a.has_dynamic_physics=function(a){return(a=a.o)&&a.dh&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&
0<a.Xe&&0==a.fo?!0:!1};a.has_simulated_physics=function(a){return(a=a.o)&&a.dh?!0:!1};a.set_gravity=function(a,b){var c=a.o.C;t.F(B(c),t.pB,c,b)};a.ZF=u;a.apply_constraint=A;a.clear_constraint=function(a){a=a.o;t.F(B(body_a),t.eB,a.un);a.un=null};a.pull_to_constraint_pivot=function(b,c,d,f,e,g){c=M.set_sep(c,1,d,la);e=M.set_sep(e,1,g,da);M.invert(c,c);M.multiply(e,c,c);Z.get_tsr(f,e);M.multiply(e,c,c);Z.set_tsr(b,c);Z.n(b);f=M.get_trans_view(b.g.i);e=M.get_quat_view(b.g.i);a.set_transform(b,f,e)};
a.set_transform=function(a,b,c){var d=a.o,f=M.get_trans_view(a.g.i);a=M.get_quat_view(a.g.i);M.set_sep(f,1,a,d.Iq);f=t.ew(t.Sm);f.C=d.C;f.trans=b;f.quat=c;t.F(B(d.C),t.Sm)};a.sync_transform=H;a.apply_velocity=function(a,b,c,d){v(a,b,c,d,R);a=a.o.C;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var f=Math.abs(R[0]),e=Math.abs(R[1]),g=Math.abs(R[2]);R[0]=f?R[0]/f*Math.max(f,b):0;R[1]=e?R[1]/e*Math.max(e,c):0;R[2]=g?R[2]/g*Math.max(g,d):0;t.F(B(a),t.ju,a,R[0],R[1],R[2])};a.apply_velocity_world=function(a,
b,c,d){a=a.o.C;t.F(B(a),t.ju,a,b,c,d)};a.apply_force=function(a,b,c,d,f){f?(R[0]=b,R[1]=c,R[2]=d):v(a,b,c,d,R);a=a.o.C;t.F(B(a),t.RA,a,R[0],R[1],R[2])};a.apply_torque=function(a,b,c,d){v(a,b,c,d,R);a=a.o.C;t.F(B(a),t.TA,a,R[0],R[1],R[2])};a.set_character_move_dir=function(a,b,c){a=a.o.C;t.F(B(a),t.jB,a,b,c)};a.set_character_move_type=function(a,b){var c=a.o.C;t.F(B(c),t.kB,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.o.C;t.F(B(c),t.oB,c,b)};a.set_character_run_velocity=function(a,b){var c=
a.o.C;t.F(B(c),t.mB,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.o.C;t.F(B(c),t.hB,c,b)};a.character_jump=function(a){a=a.o.C;t.F(B(a),t.VA,a)};a.character_rotation_inc=function(a,b,c){a=a.o.C;t.F(B(a),t.WA,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.o.C;t.F(B(a),t.lB,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.o.C;t.F(B(c),t.iB,c,b)};a.set_character_rotation_v=function(a,b){var c=a.o.C;t.F(B(c),t.nB,c,b)};a.append_collision_test=function(a,b,c,d){var f=a.o,e=f.C;
b=b||"ANY";for(var g=0;g<f.Jc.length;g++)if(a=f.Jc[g],a.Ya==b&&a.callback==c)return;a={fq:e,Pe:d||!1,Ya:b,callback:c,Tg:[],Xl:[]};f.Jc.push(a);b=B(e);E(a,m(b),b)};a.remove_collision_test=function(a,b,c){a=a.o;for(var d=B(a.C),f=m(d),e=0;e<a.Jc.length;e++){var g=a.Jc[e];if(g.Ya==b&&g.callback==c){if(h(g)){var k=ea.set(0,0,0,R);g.callback(!1,null,k,k,0)}a.Jc.splice(e,1);e--;for(var k=d,g=g.Tg,l=f.ub.v,n=0;n<l.length;n++)for(var q=l[n].o,r=0;r<q.Jc.length;r++)for(var p=q.Jc[r],u=0;u<p.Tg.length;u++)for(var x=
p.Tg[u],da=0;da<g.length;da++){var F=g[da];x[0]==F[0]&&x[1]==F[1]&&(g.splice(da,1),da--)}g.length&&t.F(k,t.iu,g)}}};a.apply_collision_impulse_test=function(a,b){a.o&&a.o.Lh&&G(a);var c=a.o;t.F(B(c.C),t.SA,c.C);c.Lh=b};a.clear_collision_impulse_test=G;a.append_ray_test=function(a,b,c,d,f,e,h,k,l){var n;ca.ay++;n=ca.ay;d=d||"ANY";a={id:n,C:a?a.o.C:0,from:new Float32Array(b),to:new Float32Array(c),Ya:d,el:g(d),Gu:e,CC:h,Pe:k,Zn:l,callback:f};b=B(a.C)||x[0];c=m(b).ub;n=a.id;c.Wg[n]=a;c.As.push(a);t.F(b,
t.OA,a.id,a.C,a.from,a.to,a.el,a.Gu,a.CC,a.Pe,a.Zn);return n};a.remove_ray_test=d;a.change_ray_test_from_to=function(a,b,c){var d=J(a),f=F(a).ub.Wg[a];f&&!f.Gu&&(f.from.set(b),f.to.set(c),t.F(d,t.UA,a,b,c))};a.Nw=function(a){return F(a).ub.Wg[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.l;c.jj=b;C(a,c,B(a.o.C))};a.vehicle_steer=function(a,b){var c=a.l;c.qk=b;C(a,c,B(a.o.C))};a.vehicle_brake=function(a,b){var c=a.l;c.Tk=b;C(a,c,B(a.o.C))};a.is_vehicle_chassis=D;a.is_vehicle_hull=O;a.jG=function(a){if(!a.Pc)return!1;
a=a.bd.Rc;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.hG=function(a){return a.Pc?"BOB"==a.bd.Rc?!0:!1:!1};a.lG=function(a){return a.fi?"BOB"==a.lj.Rc?!0:!1:!1};a.Pw=function(a){return a.Pc&&"STEERING_WHEEL"==a.bd.Rc?!0:!1};a.Ow=function(a){return a.Pc&&"SPEEDOMETER"==a.bd.Rc?!0:!1};a.Qw=function(a){return a.Pc&&"TACHOMETER"==a.bd.Rc?!0:!1};a.get_vehicle_speed=function(a){return a.l.speed};a.VK=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;
case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.cN=T;a.FF=function(){return ba};a.eE=function(){for(var a=0;a<x.length;a++)t.F(x[a],t.YA)};a.remove_object=function(a){if("BOUNDING"==a.o.type){var b=ha.indexOf(a);-1==b&&N.error("Object "+a.name+" doesn't have bounding physics");delete aa[c];ha.splice(b,1)}for(var c=a.o.C,b=B(c),d=m(b),f=c,e=d.ub.v,g=[],k=0;k<e.length;k++)for(var l=e[k].o,n=0;n<
l.Jc.length;n++)for(var q=l.Jc[n],r=0;r<q.Tg.length;r++){var p=q.Tg[r],u=q.Xl[r];if(p[0]==f||p[1]==f)q.Tg.splice(r,1),q.Xl.splice(r,1),r--,u&&!h(q)&&(u=ea.set(0,0,0,R),q.callback(!1,null,u,u,0)),g.push(p)}g.length&&t.F(b,t.iu,g);a.o&&a.o.Lh&&G(a);a=d.ub.v;for(d=0;d<a.length;d++)a[d].o.C==c&&(a.splice(d,1),d--);t.F(b,t.dB,c)}};b4w.module.__data=function(a,p){function e(a,b){na[b.id]=null;mc[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=xa.mw(a));d=a.width;a=a.height;qa.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(ra)&&c&&qa.warn("image",b,"is not from app root.")}function c(a,b,c,d,f,e){d=b.Ff;if(!d)throw"Nothing requested";ha.enqueue([{id:d,type:ha.AT_JSON,url:d}],function(d,e,g,h){if(d){qa.log("%cLOAD METADATA","color: #616",h);e=wa.Oy(d.b4w_format_version);
switch(wa.Ez(e,Fa.ki)){case -1:e[0]<Fa.ki[0]?wa.da("JSON version is too old relative to B4W engine: "+wa.oh(e)+", required: "+wa.oh(Fa.ki)+". Reexport scene with the latest B4W addon to fix it."):qa.warn("JSON version is a bit old relative to B4W engine: "+ +wa.oh(e)+", required: "+wa.oh(Fa.ki)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:e[0]>Fa.ki[0]?wa.da("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):
qa.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Fa.Tr=e;for(var k in d)a[k]=d[k];b.Ua&&(Ka=ja.Mn(a.scenes));(d=a.binaries[0].binfile)?b.Ju=d:(L.bp(b,"load_binaries"),L.bp(b,"prepare_bindata"));Fa.Ve||L.bp(b,"mobile_media_start");Fa.antialiasing&&Fa.smaa||L.bp(b,"load_smaa_textures");if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)k=a.b4w_export_errors[d],(b.Ua&&"PRIMARY"==k.type||"ALL"==k.type)&&
qa.CE(k.text);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)k=a.b4w_export_warnings[d],(b.Ua&&"PRIMARY"==k.type||"ALL"==k.type)&&qa.DE(k.text);f(b,c)}else L.ru(b)},null,function(a){e(b,c,a)})}function m(a,b,c,d,f,e){d=ma(b.Ff)+b.Ju;if(!d)throw"Binary data is missing";ha.enqueue([{id:d,type:ha.AT_ARRAYBUFFER,url:d}],function(d,e,g,k){d?(qa.log("%cLOAD BINARY","color: #616",k),a.bin_data=d,d=h(d),e=wa.Oy(a.b4w_format_version),d[0]!=e[0]&&wa.da("BIN version does not match to JSON version: "+
wa.oh(d)+", required: "+wa.oh(Fa.ki)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=e[1]&&qa.warn("BIN version does not match to JSON version: "+ +wa.oh(d)+", required: "+wa.oh(Fa.ki)+". Some compatibility issues can occur. Reexport scene to fix it."),f(b,c)):L.ru(b)},null,function(a){e(b,c,a)})}function k(a,b,c,d,f){ia.ZC()&&f(b,c)}function r(a,b,c,d,f){d=a.bin_data;var e=a.binaries[0],g=a.objects,k=a.meshes;a=a.actions;for(var l=wa.VC(),n=h(d),n=5<=n[0]&&4<n[1]?12:0,m=["indices"],
r=["normal","tangent"],p=["color","group"],t=["position","texcoord","texcoord2"],u=0;u<k.length;u++)for(var Ba=k[u].submeshes,x=0;x<Ba.length;x++)for(var ja in Ba[x]){var da=Ba[x][ja][1];if(-1!=m.indexOf(ja)){var F=4*Ba[x][ja][0]+e["int"]+n,y=Ba[x],L=ja,w=d;if(l)var D=new Uint32Array(w,F,da);else for(var D=new Uint32Array(da),w=new DataView(w),v=0;v<da;v++)D[v]=w.getUint32(F+4*v,!0);y[L]=D}else if(-1!=t.indexOf(ja))F=4*Ba[x][ja][0]+e["float"]+n,Ba[x][ja]=q(d,F,da,l);else if(-1!=r.indexOf(ja)){F=2*
Ba[x][ja][0]+e["short"]+n;y=Ba[x];L=ja;w=d;D=new Float32Array(da);w=new DataView(w);for(v=0;v<da;v++)D[v]=w.getInt16(F+2*v,!0)/32767;y[L]=D}else if(-1!=p.indexOf(ja)){F=2*Ba[x][ja][0]+e.ushort+n;y=Ba[x];L=ja;w=d;D=new Float32Array(da);w=new DataView(w);for(v=0;v<da;v++)D[v]=w.getUint16(F+2*v,!0)/65535;y[L]=D}}for(ja=0;ja<g.length;ja++)for(k=g[ja].particle_systems,m=0;m<k.length;m++)r=k[m],r.transforms=q(d,4*r.transforms[0]+e["float"]+n,r.transforms[1],l);for(g=0;g<a.length;g++){ja=a[g];k=ja.fcurves;
m=ja.frame_range;p=m[0];t=m[1];u=aa.tF(p,t);m=null;0>u&&(u=0);var x=Ba=!1,C;for(C in k)Ba|=-1<C.indexOf("rotation_euler"),x|=-1<C.indexOf("rotation_quaternion");r=[];for(C in k)if(Ba&&x&&-1<C.indexOf("rotation_euler"))delete k[C];else{var da=k[C],N;for(N in da)F=da[N],y=q(d,e["float"]+4*F.bin_data_pos[0]+n,F.bin_data_pos[1],l),L=new Float32Array(u),null===m&&(m=new Int8Array(u)),aa.hC(F,y,L,m,p,t),F.hd=L;-1<C.indexOf("rotation_euler")&&(aa.JE(k[C]),r.push(C))}for(p=0;p<r.length;p++)t=r[p],u=t.replace("euler",
"quaternion"),k[u]=k[t],delete k[t];ja.AB=m}f(b,c)}function h(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function q(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var f=0;f<c;f++)d[f]=a.getFloat32(b+4*f,!0)}return d}function g(a,b,c,d,f){var e=a.cameras,g=a.groups,h=a.materials,k=a.meshes,n=a.node_groups,m=a.objects,
q=a.particles,r=a.scenes,p=a.speakers,u=a.lamps,Ba=a.textures,x=a.worlds;n||(qa.warn('"node_groups" datablock undefined. reexport main scene.'),n=a.node_groups=[]);for(var da="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),F={},L=0;L<da.length;L++)for(var w=a[da[L]],D=0;D<w.length;D++){var v=w[D];F[v.uuid]=v}for(var C=0;C<r.length;C++){for(var N=r[C],V=N.objects,ia=0;ia<V.length;ia++)z(V,ia,F);
N.camera&&z(N,"camera",F);N.world&&z(N,"world",F)}for(C=0;C<g.length;C++)for(var P=g[C].objects,ia=0;ia<P.length;ia++)z(P,ia,F);for(C=0;C<m.length;C++){var B=m[C];B.dupli_group&&z(B,"dupli_group",F);B.parent&&z(B,"parent",F);B.dg_parent&&z(B,"dg_parent",F);if(B.animation_data){var A=B.animation_data;A.action&&z(A,"action",F);if(A.nla_tracks)for(ia=0;ia<A.nla_tracks.length;ia++)for(var Fa=A.nla_tracks[ia],J=0;J<Fa.strips.length;J++)Fa.strips[J].action&&z(Fa.strips[J],"action",F)}switch(B.type){case "MESH":if(!B.data)throw"mesh not found for object "+
B.name;z(B,"data",F);for(var K=!1,O=B.modifiers,ia=0;ia<O.length;ia++){var G=O[ia];"ARMATURE"==G.type?(K&&qa.warn('Object "'+B.name+'" has more than one armature modifiers. Only the first one will be used.'),K=!0,z(G,"object",F)):"CURVE"==G.type&&z(G,"object",F)}var H=B.particle_systems;if(H)for(ia=0;ia<H.length;ia++)z(H[ia],"settings",F);break;case "ARMATURE":z(B,"data",F);for(var T=B.pose.bones,Ia=B.data.bones,ia=0;ia<T.length;ia++){var Fb=T[ia];Fb.bone=Ia[Fb.bone];var na=Fb.constraints;if(na)for(J=
0;J<na.length;J++){var S=na[J];S.target&&z(S,"target",F)}for(var Q=Fb.parent_recursive,J=0;J<Q.length;J++)Q[J]=T[Q[J]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":z(B,"data",F)}if(na=B.constraints)for(ia=0;ia<na.length;ia++)S=na[ia],S.target&&z(S,"target",F);var oa=B.lod_levels;if(oa)for(ia=0;ia<oa.length;ia++){var ma=oa[ia];ma.object&&z(ma,"object",F)}}for(C=0;C<k.length;C++)for(var ua=k[C].materials,ia=0;ia<ua.length;ia++)z(ua,ia,F);for(C=0;C<h.length;C++){for(var Ca=h[C],M=Ca.texture_slots,
ia=0;ia<M.length;ia++)z(M[ia],"texture",F);var ra=Ca.node_tree;ra&&E(ra,F)}for(C=0;C<n.length;C++)(ra=n[C].node_tree)&&E(ra,F);for(C=0;C<Ba.length;C++){var sb=Ba[C],va=sb.type;"IMAGE"!=va&&"ENVIRONMENT_MAP"!=va||z(sb,"image",F)}for(C=0;C<e.length;C++){var ba=e[C];ba.dof_object&&z(ba,"dof_object",F)}for(C=0;C<p.length;C++){var Z=p[C];Z.sound&&z(Z,"sound",F);if(Z.animation_data&&(A=Z.animation_data,A.action&&z(A,"action",F),A.nla_tracks))for(ia=0;ia<A.nla_tracks.length;ia++)for(Fa=A.nla_tracks[ia],
J=0;J<Fa.strips.length;J++)Fa.strips[J].action&&z(Fa.strips[J],"action",F)}for(C=0;C<q.length;C++){for(var ya=q[C],M=ya.texture_slots,ia=0;ia<M.length;ia++)z(M[ia],"texture",F);ya.dupli_group&&z(ya,"dupli_group",F);ya.dupli_object&&z(ya,"dupli_object",F)}for(C=0;C<u.length;C++){var Oa=u[C];if(Oa.animation_data&&(A=Oa.animation_data,A.action&&z(A,"action",F),A.nla_tracks))for(ia=0;ia<A.nla_tracks.length;ia++)for(Fa=A.nla_tracks[ia],J=0;J<Fa.strips.length;J++)Fa.strips[J].action&&z(Fa.strips[J],"action",
F)}for(C=0;C<x.length;C++){var fa=x[C];if(M=fa.texture_slots)for(ia=0;ia<M.length;ia++)z(M[ia],"texture",F);if(fa.animation_data&&(A=fa.animation_data,A.action&&z(A,"action",F),A.nla_tracks))for(ia=0;ia<A.nla_tracks.length;ia++)for(Fa=A.nla_tracks[ia],J=0;J<Fa.strips.length;J++)Fa.strips[J].action&&z(Fa.strips[J],"action",F)}W.RC(a);for(var X=a.textures,R=b.Ua?a.scenes[0].b4w_anisotropic_filtering:Ka.b4w_anisotropic_filtering,ha=0;ha<X.length;ha++)b.Ua||"SCENE"!=X[ha].b4w_source_type||(X[ha].b4w_source_id=
""),ta.SD(X[ha],R,a.scenes,b.id);for(var U={},Za=a.objects,la=0;la<Za.length;la++){var ca=Za[la];if("MESH"===ca.type&&!ca.particle_systems.length)for(var Sa=ca.data,Y=Sa.name,xa=Sa.submeshes,sa=Sa.materials,ea=0;ea<xa.length;ea++)0!==xa[ea].base_length||U[Y]||(sa[ea]&&qa.warn('material "'+sa[ea].name+'" is not assigned to any face (object "'+ca.name+'").'),U[Y]=!0)}for(var za=a.meshes,ka=0;ka<za.length;ka++){var Aa=za[ka];Aa.materials.length||Aa.uv_textures.length&&qa.warn('mesh "'+Aa.name+'" has a UV map but has no exported material.')}a.materials.push(W.CD());
for(var ga=a.meshes,Ra=wa.keysearch("name","DEFAULT",a.materials),Gb=0;Gb<ga.length;Gb++){var Lc=ga[Gb];0==Lc.materials.length&&Lc.materials.push(Ra)}for(var Ja=a.actions,Nb=b.id,Bc=0;Bc<Ja.length;Bc++){var ab=Ja[Bc];ab.BB=Nb;aa.JB(ab)}for(var qb=a.scenes,Yb=0;Yb<qb.length;Yb++){for(var hb=qb[Yb],Qa=[],Eb=[],Tb=qb[Yb].objects,Na=0;Na<Tb.length;Na++){var ob=Tb[Na];t(Tb,ob,null,Qa,Eb);var Va=ob.dupli_group;if(Va)for(var rb=Va.objects,Zb=0;Zb<rb.length;Zb++)t(rb,rb[Zb],ob,Qa,Eb)}for(Na=0;Na<Eb.length;Na++)for(var zc=
Eb[Na],zb=[hb],lc=0;lc<zb.length;lc++){for(var $b=zb[lc].objects,Kb=0;Kb<$b.length;Kb++){var Lb=$b[Kb].dupli_group;if(Lb){var Ic=Lb.objects,Wa=Ic.indexOf(zc);-1<Wa&&Ic.splice(Wa,1)}}var Wa=$b.indexOf(zc);-1<Wa&&$b.splice(Wa,1)}for(Na=0;Na<Qa.length;Na++)wa.cC(Qa[Na][0],Qa[Na][1])}!b.Ua&&1<a.scenes.length&&(a.scenes=[ja.Mn(a.scenes)],qa.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var eb=b.Ua?Ka:ja.Mn(a.scenes);Ha.vI(Ka.fps);1<a.scenes.length&&(a.scenes.splice(a.scenes.indexOf(Ka),
1),a.scenes.unshift(Ka));for(var Sc=0;Sc<a.scenes.length;Sc++){var ac=a.scenes[Sc];ac.k={};ac.pu=ac==eb;ac.CB=b.Ua;tc.enabled&&ac.b4w_enable_physics&&(b.Ua||!I.Uo(Ka)&&ac==ja.Mn(a))&&I.fG(ac);b.Ua?ac.b4w_enable_audio&&Da.Du(ac):ac.b4w_enable_audio&&!Ka.Ba&&Da.Du(Ka)}for(var cc=0;cc<a.scenes.length;cc++){for(var dc=a.scenes[cc],qc=y(dc),Nc=0;Nc<qc.length;Nc++){var fb=qc[Nc];pa.SC(fb,dc,a)&&(fb.Ub||(fb.Ub=[]),fb.Ub.push(b.Ua?dc:Ka))}for(var Ac=qc,rc=0;rc<Ac.length;rc++){var $c=Ac[rc];if($c.Ub&&"WORLD"!=
$c.type)for(var Tc=$c.particle_systems,rd=0;rd<Tc.length;rd++){var ad=Tc[rd].settings;if("HAIR"==ad.type)if("OBJECT"==ad.render_type){var Jc=ad.dupli_object;Jc.Ub||(Jc.Ub=$c.Ub.slice())}else if("GROUP"==ad.render_type)for(var sd=ad.dupli_group,bd=0;bd<sd.objects.length;bd++)Jc=sd.objects[bd],Jc.Ub||(Jc.Ub=$c.Ub.slice())}}}for(var cd=a.scenes,td=[],Mb=0;Mb<cd.length;Mb++)l(cd[Mb].objects,0,b.Ua,td);mc[b.id]=[];for(Mb=0;Mb<td.length;Mb++)for(var dd=td[Mb],sc=0;sc<dd.length;sc++)for(var ld=dd[sc],ed=
0;ed<ld.length;ed++)mc[b.id].push(ld[ed]);for(var Oc=a.particles,Mb=0;Mb<Oc.length;Mb++){var Kc=Oc[Mb].dupli_object;Kc&&(Kc.ou=!0,mc[b.id].push(Kc));var Uc=Oc[Mb].dupli_group;if(Uc)for(var md=Uc.objects,sc=0;sc<md.length;sc++)Kc=md[sc],Kc.ou=!0,mc[b.id].push(Kc)}for(var Pc=mc[b.id],Mb=Pc.length-1;0<=Mb;Mb--)Pc[Mb].Ub||Pc.splice(Mb,1);for(var nd=mc[b.id],cc=0;cc<nd.length;cc++)if(fb=nd[cc],!b.Ua&&fb.parent&&-1<uc.indexOf(fb.parent.type)&&(fb.parent=""),"MESH"==fb.type){var fd=W.fC(fb);fd&&(a.meshes.push(fd),
fb.data=fd)}for(var Vc=0;Vc<a.scenes.length;Vc++){var od=a.scenes[Vc],gd=od.world;gd.Ub||(gd.Ub=[]);gd.Ub.push(b.Ua?od:Ka)}for(var hd=0;hd<a.scenes.length;hd++){var ud=a.scenes[hd];if(ud.b4w_use_logic_editor){var vd=y(ud);W.mC(vd,ud)}}f(b,c)}function y(a){var b=[];f(a.objects,"ALL",b);return b}function f(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&f(e.objects,b,c)}}function l(a,b,c,d){d[b]=d[b]||[];for(var f=d[b],e=0;e<a.length;e++){var g=a[e],h=
x(g);f[h]=f[h]||[];(c||-1==uc.indexOf(g.type))&&-1==f[h].indexOf(g)&&f[h].push(g);(g=g.dupli_group)&&l(g.objects,b+1,c,d)}}function n(a,b,c){var d=[];a=mc[a];for(var f=0;f<a.length;f++){var e=a[f];if(e.type==c||"ALL"==c)for(var g=0;g<e.Ub.length;g++)b==e.Ub[g]&&d.push(e)}return d}function u(a,b,c,d,f){var e=mc[b.id],g=a.worlds;d=b.id;for(var h=0;h<e.length;h++){for(var k=e[h],l=sa.dj(k.name,k.type,k.origin_name),n=0;n<k.Ub.length;n++)sa.Xi(l,k.Ub[n]);k.qa=l;pa.lh(k,l);l.g.Lc=d;l.Ql=k.ou||!1}for(d=
0;d<g.length;d++){h=g[d];k="%meta_world%"+h.name;k=sa.dj(k,"WORLD",k);for(l=0;l<h.Ub.length;l++)sa.Xi(k,h.Ub[l]);h.qa=k;pa.pK(h,k)}d=pa.get_all_objects(b.id);for(h=0;h<e.length;h++)k=e[h],l=k.qa,oa.lh(k,l);for(h=0;h<g.length;h++)k=g[h],oa.lh(k,k.qa);if(b.Ua)for(g=b.id,h=0;h<a.scenes.length;h++)for(var k=a.scenes[h],l=0,n=pa.Pa(k,"LAMP",g),m=0;m<n.length;m++)sa.R(n[m],k).gi=l++;for(h=0;h<e.length;h++)k=e[h],l=k.qa,l.Ql||(pa.eK(k,l),Ia.n(l));for(a=0;a<e.length;a++)if(g=e[a],h=g.qa,sa.is_mesh(h)&&(k=
g.lod_levels.length))for(l=h,n=0;n<k;n++)if(m=g.lod_levels[n].object){m=m.qa;m.g.ji=h.g.ji;l.g.Mg=g.lod_levels[n].distance;m.g.Tl=g.lod_levels[n].distance;if(g.lod_levels[n+1])m.g.Mg=g.lod_levels[n+1].distance;else{m.g.lo=!0;m.g.Mg=1E6;break}l.g.lo=!1;l=m}else{l.g.lo=!0;l.g.Mg=g.lod_levels[n].distance;break}for(e=0;e<d.length;e++)if(a=d[e],"MESH"==a.type&&(g=a.en)){var g=g.g,h=a.g.aj,k=[],q;for(q in h)l=h[q],k.push(4*l.Nq,4*l.zg);g.lx.push(k);g.ap.push(a.g)}e=q=-1;a=aa.dw();for(g=0;g<d.length;g++)h=
d[g],k=h.g,sa.is_mesh(h)&&k.Dj&&(h=k.Rf,h>q&&(q=h),a>=h&&h>e&&(e=h));for(g=0;g<d.length;g++)h=d[g],k=h.g,sa.is_mesh(h)&&k.Dj&&(k.Cl=!0,q<a?k.Rf=q:k.Rf<=a?k.Rf=e:(qa.warn('too many bones for "'+h.name+'" / '+k.Rf+" bones (max "+a+" with blending, "+2*a+" without blending). Blending between frames will be disabled."),k.Rf=q,k.Cl=!1),k.Cl=k.Cl&&!Oa.Ov);for(q=0;q<d.length;q++)if(e=d[q],e.Pc)if(a=e.bd,"CHASSIS"==a.Rc){e.l={};e.l.Bl=a.Bl;e.l.Uk=a.Uk;e.l.ot=a.ot;e.l.qt=a.qt;e.l.pt=a.pt;e.l.Qt=a.Qt;e.l.Hs=
a.Hs;e.l.Yr=a.Yr;e.l.jj=0;e.l.Tk=1;e.l.qk=0;e.l.speed=0;e.l.yi=[];e.l.dm=[];e.l.tk=null;h=(g=sa.get_dg_parent(e))?sa.mr(g,d):d;for(g=0;g<h.length;g++)k=h[g],k.Pc&&(l=k.bd,I.jG(k)&&a.name==l.name?(l=I.VK(k.bd.Rc),e.l.yi[l]=k,e.l.dm[l]=new Float32Array(8)):I.Pw(k)&&a.name==l.name?(e.l.tk=k,e.l.rk=l.rk,e.l.tm=l.tm,e.l.Ol=l.Ol,l=va.invert(e.g.i,va.create()),k=va.multiply(l,k.g.i,l),e.l.Ny=k,l=new Float32Array([1,0,0]),va.transform_dir_vec3(l,k,l),e.l.My=l):I.Ow(k)&&a.name==l.name?(e.l.gt=k,e.l.qm=l.qm,
e.l.Jj=l.Jj,l=va.invert(e.g.i,va.create()),k=va.multiply(l,k.g.i,l),e.l.Iy=k,l=new Float32Array([1,0,0]),va.transform_dir_vec3(l,k,l),e.l.Hy=l):I.Qw(k)&&a.name==l.name&&(e.l.rt=k,e.l.ql=l.ql,l=va.invert(e.g.i,va.create()),k=va.multiply(l,k.g.i,l),e.l.Wy=k,l=new Float32Array([1,0,0]),va.transform_dir_vec3(l,k,l),e.l.Vy=l));if(4!=e.l.yi.length)throw"Not enough wheels for chassis "+e.name;}else if("HULL"==a.Rc)for(e.l={},e.l.yi=[],e.l.dm=[],e.l.Bl=a.Bl,e.l.Uk=a.Uk,e.l.Xh=a.Xh,e.l.Qi=a.Qi,e.l.Ri=a.Ri,
e.l.jj=0,e.l.Tk=1,e.l.qk=0,e.l.speed=0,e.l.tk=null,h=(g=sa.get_dg_parent(e))?sa.mr(g,d):d,g=0;g<h.length;g++)k=h[g],k.Pc&&(l=k.bd,I.hG(k)&&a.name==l.name?(e.l.yi.push(k),e.l.dm.push(new Float32Array(8))):I.Pw(k)&&a.name==l.name?(e.l.tk=k,e.l.rk=l.rk,e.l.tm=l.tm,e.l.Ol=l.Ol,l=va.invert(e.g.i,va.create()),k=va.multiply(l,k.g.i,l),e.l.Ny=k,l=new Float32Array([1,0,0]),va.transform_dir_vec3(l,k,l),e.l.My=l):I.Ow(k)&&a.name==l.name?(e.l.gt=k,e.l.qm=l.qm,e.l.Jj=l.Jj,l=va.invert(e.g.i,va.create()),k=va.multiply(l,
k.g.i,l),e.l.Iy=k,l=new Float32Array([1,0,0]),va.transform_dir_vec3(l,k,l),e.l.Hy=l):I.Qw(k)&&a.name==l.name&&(e.l.rt=k,e.l.ql=l.ql,l=va.invert(e.g.i,va.create()),k=va.multiply(l,k.g.i,l),e.l.Wy=k,l=new Float32Array([1,0,0]),va.transform_dir_vec3(l,k,l),e.l.Vy=l));for(q=0;q<d.length;q++)if(e=d[q],e.fi&&(a=e.lj,"MAIN_BODY"==a.Rc))for(e.Wd={},e.Wd.Xh=a.Xh,e.Wd.Qi=a.Qi,e.Wd.Ri=a.Ri,e.Wd.nn=[],g=(g=sa.get_dg_parent(e))?sa.mr(g,d):d,h=0;h<g.length;h++)k=g[h],k.fi&&(l=k.lj,I.lG(k)&&a.name==l.name&&(e.Wd.nn.push(k),
k.yC=k.lj.Uy));f(b,c)}function A(a,b,c,d,f){for(d=0;d<a.scenes.length;d++){var e=a.scenes[d];e.tg=e.camera.qa}for(d=0;d<a.scenes.length;d++){var e=b.Ua?a.scenes[d]:Ka,g=b.Ua?pa.Pa(e,"LAMP",b.id):pa.Pa(e,"LAMP",0),h=pa.Pa(e,"ALL",b.id),k=n(b.id,e,"MESH"),l=n(b.id,e,"EMPTY");b.Ua&&ja.QB(e,h,g,k,l);for(var m=0;m<l.length;m++)pa.qz(l[m].qa);h=[];ja.set_active(e);Aa.lF(e,k,g,h);m=n(b.id,e,"LINE");Aa.kF(e,m);l=ja.pr(e);if(b.Ua){m=e.k.cp;if(m.XH||m.procedural_skydome)m=Aa.nF(e,m),h.push(m);ja.Tv(l)}for(m=
0;m<k.length;m++)Aa.nv(k[m].qa,l,e);for(m=0;m<h.length;m++)Aa.nv(h[m],l,e),pa.tH(h[m]);h=pa.Pa(e,"ALL",b.id);ja.nC(e,h,g);for(m=0;m<h.length;m++)e=h[m],e.g.Ee&&pa.update_boundings(e)}ja.RB(Ka,a.textures,b.id);b.Ua&&Ka.k.Hk.length&&(b.zr=!0);d=a.materials;if(Fb.Lq&&Fa.xz)for(a=0;a<d.length;a++){k=d[a];m=k.texture_slots;for(e=0;e<m.length;e++)if(h=m[e],l=h.texture,"IMAGE"==l.type||"ENVIRONMENT_MAP"==l.type)g=l.image,g.gd||(-1<g.filepath.indexOf(".dds")?g.gd=!0:(g.gd=!l.b4w_disable_compression&&!h.use_map_normal&&
"ENVIRONMENT_MAP"!=l.type&&!l.b4w_shore_dist_map&&"MOVIE"!=g.source,g.gd&&(g.filepath+=".dds")));if(e=k.node_tree)for(k=e.nodes,e=0;e<k.length;e++)g=k[e],"TEXTURE"==g.type&&(m=g.texture)&&(g=m.image)&&!g.gd&&(g.gd=m.k.$m&&!m.b4w_disable_compression&&"MOVIE"!=g.source&&"ENVIRONMENT_MAP"!=m.type,g.gd&&(g.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)e=a[d],e.gd=Boolean("FILE"==e.source&&-1<e.filepath.indexOf(".dds"));f(b,c)}function B(a,b,c,d,f){d=a.groups;for(var e=a.objects,g={},h={},
k={},l={},n=0;n<d.length;n++){var m=d[n];g[m.uuid]=m;k[m.uuid]=m}for(n=0;n<e.length;n++)m=e[n],h[m.uuid]=m,l[m.uuid]=m;a=a.scenes;for(n=0;n<a.length;n++)H(a[n].objects,null,l,k);for(var q in k)q in g||d.push(k[q]);for(q in l)q in h||e.push(l[q]);f(b,c)}function H(a,b,c,d){for(var f=[],e=0;e<a.length;e++){var g=a[e],h=c[g.uuid];if(g=h.proxy){b&&-1==f.indexOf(g.uuid)&&f.push(g.uuid);for(var k=c[g.uuid],l=k.constraints,g=0;g<l.length;g++){var n=wa.Kh(l[g]);n.name+="_CLONE";h.constraints.push(n)}"b4w_proxy_inherit_anim"in
h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=wa.Kh(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=h.b4w_anim_behavior,k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(e=0;e<f.length;e++)h=wa.IF(a,f[e]),-1<h&&a.splice(h,1);f={};if(b)for(e=0;e<a.length;e++)g=a[e],h=c[g.uuid],l=wa.Kh(h),h="origin_name"in h?h.origin_name:h.name,l.name=sa.Sv(b.name,h),l.origin_name=h,l.dg_parent={uuid:b.uuid},
v(l),c[l.uuid]=l,f[g.uuid]=l.uuid,g.uuid=l.uuid;for(e=0;e<a.length;e++)g=a[e],h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],k=wa.Kh(l),k.name=wa.Ck(l.name+"_CLONE"),k.uuid=V.zw("Group"+k.name),d[k.uuid]=k,g.uuid=k.uuid,H(k.objects,h,c,d));if(b)for(e=0;e<a.length;e++){g=a[e];h=c[g.uuid];h.parent&&h.parent.uuid in f?h.parent.uuid=f[h.parent.uuid]:h.parent&&(qa.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(g=0;g<l.length;g++)b=
l[g],b.target&&b.target.uuid in f&&(b.target.uuid=f[b.target.uuid]);if(b=h.pose)for(d=b.bones,g=0;g<d.length;g++)if(l=d[g].constraints)for(k=0;k<l.length;k++)b=l[k],b.target&&b.target.uuid in f&&(b.target.uuid=f[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in f&&(d.object.uuid=f[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in f&&(b.object.uuid=f[b.object.uuid])}for(var m in f)Za[m]=f[m]}function v(a){a.uuid=
V.zw("Object"+a.name)}function E(a,b){for(var c=a.nodes,f=0;f<c.length;f++){var e=c[f];"TEXTURE"==e.type&&e.texture&&z(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in Za&&(e.lamp.uuid=Za[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&z(e,"node_group",b)}e=a.links;for(f=0;f<e.length;f++){var g=e[f];G(g,"from_node",c);G(g,"to_node",c);d(g,"from_socket",g.from_node.outputs);d(g,"to_socket",g.to_node.inputs)}if(c=a.animation_data)if(c.action&&z(c,"action",b),c.nla_tracks)for(f=
0;f<c.nla_tracks.length;f++)for(e=c.nla_tracks[f],g=0;g<e.strips.length;g++)e.strips[g].action&&z(e.strips[g],"action",b)}function z(a,b,c){(c=c[a[b].uuid])||qa.error("Dangling link found:",b,a);a[b]=c}function G(a,b,c){c=wa.keysearch("name",a[b].name,c);a[b]=c}function d(a,b,c){c=wa.keysearch("identifier",a[b].identifier,c);a[b]=c}function F(a,c,d,f,e,g){f=ma(c.Ff);for(var h=a.images,k={},l=[],n=0;n<h.length;n++){var m=h[n],q=m.uuid;if("FILE"===m.source||"MOVIE"===m.source){var r=C(m,a.textures);
if(!r.length)qa.warn("image ",m.name," has no users.");else if(!r[0].b4w_shore_dist_map){r=wa.Ul(f+m.filepath);if("FILE"===m.source){var p=m.gd?ha.AT_ARRAYBUFFER:ha.AT_IMAGE_ELEMENT;Fb.Zr&&Fa.sp&&(r=ha.rm(r),"dds"==r[1]?(r=ha.rm(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===m.source&&(Fa.nm?(r=ha.rm(r),r=r[0]+".altconv.seq",p=ha.Km):(r=ha.rm(r),p=Da.detect_video_container(r[1]),r=p!=r[1]?r[0]+".altconv."+p:r[0]+"."+p,p=ha.Lm));l.push({id:q,type:p,url:r});k[q]=m}}}if(l.length){var t=
0;ha.enqueue(l,function(f,e,h,n){if(f){if(h==ha.Lm||h==ha.Km){if(h==ha.Lm)var m=f.videoWidth,q=f.videoHeight;else m=f.images[0].width,q=f.images[0].height;qa.log("%cLOAD VIDEO "+m+"x"+q,"color: #"+(2048<m||2048<q?"a00":1024<m||1024<q?"aa0":"0a0"),n);-1==n.indexOf(ra)&&qa.warn("video",n,"is not from app root.")}else b(f,n,!0);e=k[e];n=C(e,a.textures);for(m=0;m<n.length;m++){var q=n[m],r=q.image.filepath;h==ha.Km?(q.k.Os=f.If,ta.xm(q.k,f.images,e.gd,r,c.id)):ta.xm(q.k,f,e.gd,r,c.id)}}f=++t/l.length;
g(c,d,f)},function(){qa.log("%cLOADED ALL IMAGES","color: #0a0");e(c,d)})}else e(c,d)}function J(a,b,c,d,f){a=ja.fw();for(d=0;d<a.length;d++){var e=a[d];if(e.b4w_use_nla){var g=e.b4w_nla_cyclic;e.b4w_use_logic_editor&&(g=!1);oa.jK(e,g,b.id)}}f(b,c)}function C(a,b){for(var c=[],d=0;d<b.length;d++){var f=b[d];f.image===a&&c.push(f)}return c}function D(a,b,c,d,f,e){a=ma(b.Ff);var g=[],h={};d=pa.get_all_objects(b.id);for(var k=0;k<d.length;k++){var l=d[k];if(O(l)){var n=l.I.mh;"BACKGROUND_MUSIC"==Da.rr(l)?
(n=wa.hr(),b.xr=!0):"NONE"!=Da.rr(l)&&Fa.Cr&&(b.Br=!0);if(!(n in h)){h[n]=[];var m=wa.Ul(a+l.I.Ff);switch(Da.Gy(l)){case Da.Ep:var q=ha.AT_AUDIOBUFFER;break;case Da.Ut:q=ha.AT_AUDIO_ELEMENT}var m=ha.rm(m),r=Da.detect_audio_container(m[1]),m=r!=m[1]?m[0]+".altconv."+r:m[0]+"."+r;g.push({id:n,type:q,url:m})}h[n].push(l)}}if(g.length){var p=0;ha.enqueue(g,function(a,d,f,k){if(a)for(qa.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(ra)&&qa.warn("sound",k,"is not from app root."),d=h[d],f=0;f<d.length;f++)Da.nK(d[f],
a);a=++p/g.length;e(b,c,a)},function(){qa.log("%cLOADED ALL SOUNDS","color: #0aa");f(b,c)})}else f(b,c)}function O(a){return sa.is_speaker(a)&&Da.Gy(a)!=Da.Vt}function T(a,b,c){a=pa.Pa(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];sa.is_speaker(d)&&(Da.is_cyclic(d)||c)&&Da.play_def(d)}}function K(a,b){for(var c=a.k.Hk,d=0;d<c.length;d++){var f=c[d].k;a.b4w_use_nla&&c[d].b4w_nla_video||!c[d].use_auto_refresh||b!=f.mg||(ta.reset_video(f.name,b),ta.play_video(f.name,b))}}function w(a,b,c,d,f){oa.start();
qa.log("%cSTART NLA","color: #0a0");f(b,c)}function t(a,b,c,d,f){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,g=0;g<e;g++){var h=b.lod_levels[g],k=h.object;if(k){var l=wa.bl(k);l.name=b.name+"_LOD_"+String(g+1);v(l);l.lod_levels=[];c&&(l.dg_parent=c);d.push([a,l]);f.push(k);h.object=l}}}function Q(a,b,c,d,f){d=!0;for(var e=0;e<a.scenes.length;e++)if(!I.aD(a.scenes[e])){d=!1;break}d&&(f(b,c),qa.log("%cPHYSICS READY","color: #0a0"))}function N(a,b,c,d,f){for(d=0;d<a.scenes.length;d++){var e=
a.scenes[d];if(b.Ua)var g=I.Uo(e);else g=I.Uo(Ka)||I.Uo(e),e=Ka;if(tc.enabled&&g)for(g=0;g<Bc.length;g++)for(var h=pa.Pa(e,Bc[g],b.id),k=0;k<h.length;k++){var l=h[k];l.g.Lc==b.id&&(I.append_object(l,e),b.dx&&I.T(l)&&I.disable_simulation(l))}}f(b,c)}function P(a,c,d,f,e){var g={};f=[];for(var h=a.scenes,k=0;k<a.scenes.length;k++){var l=h[k];if(l.k.Sb&&(l=l.k.Sb.bh)&&"FILE"===l.source){var n=l.uuid,m=wa.Ul(ma(c.Ff)+l.filepath);f.push({id:n,type:l.gd?ha.AT_ARRAYBUFFER:ha.AT_IMAGE_ELEMENT,url:m});g[n]=
l}}f.length?ha.enqueue(f,function(d,f,e,k){if(d){b(d,k,!0);f=g[f];k=C(f,a.textures);for(e=0;e<k.length;e++){var l=k[e];ta.xm(l.k,d,f.gd,l.image.filepath,c.id)}for(e=0;e<h.length;e++)if(k=h[e],k.k.Sb&&(l=k.k.Sb.bh,l===f)){var n=d,m=document.createElement("canvas"),l=f.size[0],q=f.size[1];m.width=l;m.height=q;m=m.getContext("2d");m.drawImage(n,0,0);n=m.getImageData(0,0,l,q).data;m=new Float32Array(4);m[0]=1/16581375;m[1]=1/65025;m[2]=1/255;m[3]=1;for(var l=l*q,q=new Float32Array(l),r=0;r<l;r++)q[r]=
m[1]*n[4*r+2]+m[2]*n[4*r+3];k.k.Xs=q}}else for(f=g[f],e=0;e<h.length;e++)k=h[e],l=k.k.Sb.bh,l===f&&(k.k.Sb.bh=null,qa.warn("image",l.filepath," was not found. Disabling water shore effects."))},function(){e(c,d)}):e(c,d)}function S(a,c,d,f,e){f=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var k=ja.Z(f,g[h]);k&&a.push(k)}if(a.length){f=[];h=ha.AT_IMAGE_ELEMENT;f.push({id:"SEARCH_TEXTURE",type:h,
Ff:ca.Ec.smaa_search_texture_path});f.push({id:"AREA_TEXTURE",type:h,url:ca.Ec.smaa_area_texture_path});for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.pa;for(h=0;h<a.length;h++)if(g=a[h],"u_search_tex"==g.to)var l=g.Aa;else if("u_area_tex"==g.to)var n=g.Aa;break}f.length?ha.enqueue(f,function(a,d,f,e){a&&(b(a,e,!1),d="SEARCH_TEXTURE"==d?l:n,d.source="IMAGE",d.JL=!0,ta.xm(d,a,-1!=e.indexOf(".dds")?1:0,e,c.id),ta.Rs(d,ta.A,ta.A))},function(){e(c,d)}):e(c,d)}else e(c,
d)}function Z(a,b,c,d){for(c=0;c<a.scenes.length;c++){var f=a.scenes[c];b.Ua||(f=Ka);for(var e=pa.Pa(f,"LAMP",b.id),g=0;g<e.length;g++){var h=e[g];h.g.Lc==b.id&&d.Np.push({Ca:f,obj:h})}e=pa.Pa(f,"ALL",b.id);for(g=0;g<e.length;g++)h=e[g],"LAMP"!=h.type&&h.g.Lc==b.id&&(b.dx&&sa.is_mesh(h)&&ja.Zk(h,!0),d.Np.push({Ca:f,obj:h}))}}function M(a,b,c,d,f,e){var g=d.Np;f=d.Bx;if(g.length){a=g[f].obj;var h=g[f].Ca;f=sa.R(a,h);ja.append_object(h,a,!1);a.anchor&&fa.append(a);d=++d.Bx/g.length;g=f.xf;if(null!=
a.g.Td&&g){var k=Ba.copy(a.g.ec.J,Sa);ja.pz(g,k)}g=a.jm;if(g.length&&h.k.bf)for(h=va.get_trans_view(a.g.i),a=va.get_quat_view(a.g.i),f=f.af,k=0;k<f.length;k++)ja.rz(f[k],h,a),sa.sz(g,f[k].j.Zb)}else d=1;e(b,c,d)}function U(a,b,c,d,f){if(b.Ua){d=ja.wj();var e=ja.fw();for(a=0;a<e.length;a++){var g=e[a];ja.MH(g,d);g.b4w_use_logic_editor&&Ca.dG(g,b.id)}ja.set_active(d)}else ja.tz(Ka);d=pa.get_all_objects(b.id);pa.fK(d);for(e=0;e<d.length;e++)for(g=d[e],a=0;a<g.u.length;a++)for(var h=g.u[a].P,k=0;k<h.length;k++)null==
h[k].$b&&h.splice(k--,1);f(b,c)}function ea(a,b,c,d,f){if(b.Ua)for(d=0;d<a.scenes.length;d++)K(a.scenes[d],b.id),T(a.scenes[d],b.id);else K(Ka,b.id),T(Ka,b.id);f(b,c)}function Y(a,b,c,d,f){for(d=0;d<a.scenes.length;d++)a.scenes[d].camera=null;Fa.media_auto_activation&&(b.zr||b.xr||b.Br)?Ra||ka(a,f,b,c):f(b,c)}function ka(a,b,c,d){function f(){if(!h){h=!0;c.zr&&(ta.play(),ta.pause(),ta.reset());if(c.xr){if(c.Ua)for(var e=0;e<a.scenes.length;e++)T(a.scenes[e],c.id,!0);else T(Ka,c.id,!0);Da.pause()}c.Br&&
Da.Qx();ga();b(c,d)}}var e=Nb.parentElement;za=e.style.zIndex;e.style.zIndex="999";Ra=document.createElement("div");Ra.style.position="relative";Ra.style.height="88px";Ra.style.width="88px";var g=Math.round(Nb.offsetWidth/2-44);Ra.style.top=Math.round(Nb.offsetHeight/2-44).toString()+"px";Ra.style.left=g.toString()+"px";Ra.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
Ra.style.backgroundSize="88px";Gb=document.createElement("div");Gb.style.position="relative";Gb.style.height=Nb.offsetHeight.toString()+"px";Gb.style.width=Nb.offsetWidth.toString()+"px";Gb.style.background="rgba(0, 0, 0, 0.5)";Gb.style.zIndex="999";e.appendChild(Gb);Gb.appendChild(Ra);Ra.addEventListener("touchstart",f,!1);Ra.addEventListener("click",f,!1);var h=!1}function ga(){if(Ra){var a=Nb.parentElement;a.style.zIndex=za;Gb.removeChild(Ra);a.removeChild(Gb);Ra=Gb=null;za=0}}function ma(a){(a=
a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function ba(a,b,c){aa.is_animated(b)&&aa.remove(b);ya.UH(b);pa.clear_outline_anim(b);R.check_sensor_manifold(b)&&R.remove_sensor_manifold(b);I.T(b)&&I.remove_object(b);ja.VH(a,b,c);sa.is_speaker(b)&&Da.hJ(b);fa.is_anchor(b)&&fa.remove(b)}function x(a){var b=aa.Zv(a);return(a=b&&b.parent==a?null:a.parent||b)?1+x(a):0}var fa=p("__anchors"),aa=p("__animation"),ha=p("__assets"),Aa=p("__batch"),ca=p("__config"),R=p("__controls"),xa=p("__dds"),la=p("__extensions"),
da=p("__input"),L=p("__loader"),V=p("__md5"),oa=p("__nla"),Ca=p("__logic_nodes"),ya=p("__particles"),X=p("__nodemat"),pa=p("__objects"),sa=p("__obj_util"),I=p("__physics"),qa=p("__print"),W=p("__reformer"),ua=p("__renderer"),ja=p("__scenes"),Da=p("__sfx"),ia=p("__shaders"),ta=p("__textures"),Ha=p("__time"),Ia=p("__transform"),va=p("__tsr"),wa=p("__util"),Ba=p("__vec3"),Fa=ca.q,Fb=ca.Qd,tc=ca.o,Oa=ca.Ch,sb=ca.I,na=null,mc=null,ra="",Ka=null,Za={},Sa=new Float32Array(3),Ra=null,Gb=null,za=0,Lc=!1,uc=
["LAMP","CAMERA"],Bc=["MESH","CAMERA","EMPTY"],Nb=null;a.is_primary_loaded=function(a){return L.is_primary_loaded(a)};a.update=function(){L.kK(na)};a.TI=function(a){Nb=a};a.cK=function(a,b){if(Ra){Gb.style.height=b.toString()+"px";Gb.style.width=a.toString()+"px";var c=Math.round(a/2-44);Ra.style.top=Math.round(b/2-44).toString()+"px";Ra.style.left=c.toString()+"px"}};a.load=function(a,b,d,f,h){var l={load_main:{mb:L.uh,vb:!1,K:[],yb:!1,Ab:500,Lb:!1,Cb:c},duplicate_objects:{mb:L.Ic,vb:!1,K:["load_main"],
yb:!1,Ab:50,Lb:!1,Cb:B},load_binaries:{mb:L.uh,vb:!1,K:["load_main"],yb:!1,Ab:500,Lb:!1,Cb:m},wait_for_shaders:{mb:L.Ic,vb:!1,K:[],yb:!1,Ab:50,Lb:!0,Ag:k},prepare_bindata:{mb:L.Ic,vb:!1,K:["duplicate_objects","load_binaries"],yb:!1,Ab:100,Lb:!1,Cb:r},prepare_bpy_data:{mb:L.Ic,vb:!1,K:["duplicate_objects","prepare_bindata"],yb:!1,Ab:100,Lb:!1,Cb:g},process_objects:{mb:L.Ic,vb:!1,K:["prepare_bpy_data"],yb:!1,Ab:150,Lb:!1,Cb:u},process_scenes:{mb:L.Ic,vb:!1,K:["process_objects","wait_for_shaders"],yb:!1,
Ab:300,Lb:!1,Cb:A},load_smaa_textures:{mb:L.uh,vb:!1,K:["process_scenes"],yb:!1,Ab:30,Lb:!0,Cb:S},load_shoremap:{mb:L.uh,vb:!1,K:["process_scenes"],yb:!1,Ab:30,Lb:!0,Cb:P},load_textures:{mb:L.uh,vb:!0,K:["process_scenes"],yb:!0,Ab:500,Lb:!1,Cb:F},update_scenes_nla:{mb:L.Ic,vb:!1,K:["process_scenes","load_textures"],yb:!1,Ab:50,Lb:!1,Cb:J},wait_physics_workers:{mb:L.Ic,vb:!1,K:["load_shoremap"],yb:!1,Ab:20,Lb:!1,Ag:Q},add_physics_objects:{mb:L.Ic,vb:!1,K:["wait_physics_workers"],yb:!1,Ab:50,Lb:!1,
Cb:N},add_objects:{mb:L.Ic,vb:!1,K:["add_physics_objects"],yb:!1,Ab:600,Lb:!1,Cb:Z,Ag:M,Xk:U,Yk:{Np:[],Bx:0}},load_speakers:{mb:L.uh,vb:!0,K:["add_objects"],yb:!0,Ab:100,Lb:!1,Cb:D},mobile_media_start:{mb:L.Ic,vb:!1,K:["load_textures","update_scenes_nla","load_speakers"],yb:!0,Ab:5,Lb:!1,Cb:Y,Ag:Y},synchronize_media:{mb:L.Ic,vb:!0,K:["mobile_media_start"],yb:!0,Ab:50,Lb:!1,Cb:ea},start_nla:{mb:L.Ic,vb:!0,K:["mobile_media_start"],yb:!1,Ab:5,Lb:!0,Cb:w}},n=L.iw();n||(n=L.KD(),na={},mc={},Za={});na[n.jf.length]=
{};return L.TD(l,a,b,d,e,f||sb.Eu,Fa.do_not_load_resources,h)};a.unload=function(a){var b=L.iw();if(!b||!b.jf.length||a&&!L.AJ(b.jf[a]))qa.error("Unable to unload data!");else{if(0==a)qa.log("%cUNLOAD ALL","color: #00a"),fa.cleanup(),aa.cleanup(),Da.cleanup(),oa.cleanup(),ja.cleanup(),L.cleanup(),R.cleanup(),I.cleanup(),pa.cleanup(),wa.cleanup(),ua.cleanup(),X.cleanup(),ia.cleanup(),la.cleanup(),ha.cleanup(),ta.cleanup(),Ca.cleanup(),ya.cleanup(),da.cleanup(),mc=null,Za={},na=Ka=null,Lc=!1;else{qa.log("%cUNLOAD DATA "+
a,"color: #00a");aa.SH(a);for(var b=ja.tj(),c=0;c<b.length;c++)for(var d=b[c],f=pa.Pa(d,"ALL",a),e=f.length-1;0<=e;e--){var g=f[e];ba(d,g,!0);pa.remove_object(g)}}ga()}};a.LH=ba;a.set_debug_resources_root=function(a){ra=a};a.activate_media=function(){Lc||Fa.media_auto_activation||(ta.play(),ta.pause(),ta.reset(),T(Ka,pa.DATA_ID_ALL,!0),Da.pause(),Fa.Cr&&Da.Qx(),Lc=!0)}};b4w.module.__batch=function(a,p){function e(a){a={type:a,hb:"",id:0,WH:0,Vj:"",Y:[],nc:[],Cc:[],jl:[],Ni:null,bc:{},$b:null,Fb:{Gk:null,oj:null,Eg:[],ni:[]},fn:[],rN:null,X:null,Ee:!1,Qh:!1,sv:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,Sw:0,Tw:0,nw:0,sr:0,Nc:new Float32Array(3),md:new Float32Array(16),zh:!1,Ga:!1,gD:!1,wa:!1,pg:!1,pb:!1,Ld:!1,Re:!1,Fd:!1,Wc:!1,Xc:!1,Fc:!1,wc:!1,Uc:!1,fc:!1,Vx:!1,Cf:ca.Mk,rg:ca.of,pq:!1,Ue:!1,PH:"",BN:"",qw:!1,uw:0,rw:0,vw:0,ww:0,tw:new Float32Array(3),sw:new Float32Array(3),
wr:!1,pf:0,Df:0,Dg:1,reflect_factor:0,Hi:0,et:1,parallax_scale:0,Cg:0,vg:1,yx:0,$r:0,qi:0,fy:0,pd:Array(2),Yc:new Float32Array(3),hh:new Float32Array(3),ff:new Float32Array(3),vc:new Float32Array(4),se:new Float32Array(4),Fj:null,Lr:null,Jr:null,Ir:null,Kr:null,Kl:!1,qh:!1,water_dynamic:!1,Ap:!1,Oz:!1,Pz:0,Qz:0,Nz:0,Ik:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Mv:new Float32Array(2),Lv:new Float32Array(2),br:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
pi:null,km:!1,xa:null,oo:0,Go:!1,rs:null,oi:null,Sj:null,ux:null,xd:null,Rj:null,vx:null};a.vc[3]=1;a.gD=!0;a.wa=!0;a.oo=1;return a}function b(a){switch(a.type){case "MAIN":case "PARTICLES":case "LINE":a.hb=a.Ga?a.pg?"XRAY":"BLEND":"OPAQUE";break;case "SHADOW":a.hb=a.Wc?"CAST":"RECEIVE";break;case "COLOR_ID":a.hb=a.pg?"COLOR_ID_XRAY":"COLOR_ID"}}function c(a){var b=a.X;a.X=null;var c=la.cj(a);a.X=b;c.X=b;return c}function m(a,b){for(var c=[],d=0;d<a.length;d++){var f=a[d],e=f.qa.g,g=fa.cd();fa.vn(e.Zi,
g);var k=f.data.b4w_bounding_cylinder_radius,l=f.data.b4w_bounding_sphere_radius,n=f.data.b4w_bounding_sphere_center,m=f.data.b4w_bounding_ellipsoid_axes,q=f.data.b4w_bounding_ellipsoid_center;if(e.pe){var k=Math.max(Math.abs(g.max_x),Math.abs(g.min_x)),l=Math.max(Math.abs(g.max_y),Math.abs(g.min_y)),p=Math.max(Math.abs(g.max_z),Math.abs(g.min_z)),p=Math.sqrt(k*k+l*l+p*p),k=Math.sqrt(k*k+l*l);g.max_x=g.max_y=g.max_z=p;g.min_x=g.min_y=g.min_z=-p;l=p;n[0]=n[1]=n[2]=0;m[0]=m[1]=m[2]=p;q[0]=q[1]=q[2]=
0}e.dc=g;p=fa.hq(g,e.i);e.wb=p;h(e,k,k,g);g=fa.zn(l,n);e.Sd=g;g=fa.jq(g,e.i);e.ec=g;m=fa.yn([m[0],0,0],[0,m[1],0],[0,0,m[2]],q,[0,0,0,1]);e.Ne=m;m=fa.iq(m,e.i);e.sf=m;c=c.concat(r(f,e,b))}return c}function k(a,b,c){for(var d=[],f=[],e={},g=0;g<a.length;g++){var h=a[g],k=h.qa.g,l=fa.cd();fa.vn(k.Zi,l);var n=fa.hq(l,k.i),m=fa.zn(h.data.b4w_bounding_sphere_radius,h.data.b4w_bounding_sphere_center),q=fa.jq(m,k.i),p=h.data.b4w_bounding_ellipsoid_axes,p=fa.yn([p[0],0,0],[0,p[1],0],[0,0,p[2]],h.data.b4w_bounding_ellipsoid_center,
[0,0,0,1]),t=fa.iq(p,k.i);k.dc=l;k.wb=n;k.Sd=m;k.ec=q;k.Ne=p;k.sf=t;l={};l.Fd=k.Fd;l.Wc=k.Wc;l.Xc=k.Xc;l.Yg=k.Yg;l.Eo=k.Eo;l.Kb=k.Kb;l.Do=k.Do;l.Wj=k.Wj;l.Fc=k.Fc;l.wc=k.wc;l.Uc=k.Uc;l.Td=k.Td;l.zd=k.zd;l.cf=k.cf;l.uf=k.uf;l.Nd=k.Nd;l.Qf=k.Qf;l.uc=k.uc;l.pe=k.pe;l.Sk=k.Sk;l.Rk=k.Rk;l.fc=k.fc;l.Th=k.Th;l.Gn=k.Gn;l.Re=k.Re;n=k.ec.J;l.XF=0==c?[0,0]:[Math.floor(n[0]/c),Math.floor(n[2]/c)];l.Mg=k.Mg;l.Tl=k.Tl;l.ji=k.ji;l.fj=k.fj;k=JSON.stringify(l);e[k]=e[k]||[];e[k].push(h)}for(var u in e){l=JSON.parse(u);
c=e[u];var h=la.Oh("STATIC"),x;for(x in l)h[x]=l[x];h.Lc=a[0].qa.g.Lc;h.mf=0;h.og=0;h.Bf=0;h.Af=0;h.tf=0;h.ai=!1;for(g=0;g<c.length;g++)k=c[g].qa,0==g?(h.wb=I.za(k.g.wb),h.ec=I.za(k.g.ec)):(fa.Ev(h.wb,k.g.wb),fa.BE(h.ec,k.g.ec));h.sf=fa.Dp();h.Ne=fa.Dp();h.dc=I.za(h.wb);h.Sd=I.za(h.ec);f.push({g:h,BC:c})}for(a=0;a<f.length;a++)for(e=f[a].g,g=f[a].BC,u=0;u<g.length;u++){x=g[u];c=x.qa.g;h=r(x,e,b);k=sa.create();c.pe&&!c.cq?(l=sa.get_trans_view(c.i),sa.set_trans(l,k)):sa.copy(c.i,k);l={};if(e.Nd||e.pe)l.au_center_pos=
[k[0],k[1],k[2]];e.Nd&&(l.au_wind_bending_amp=[c.mf],l.au_wind_bending_freq=[x.b4w_wind_bending_freq],l.au_detail_bending_amp=[x.b4w_detail_bending_amp],l.au_detail_bending_freq=[x.b4w_detail_bending_freq],l.au_branch_bending_amp=[x.b4w_branch_bending_amp]);for(n=0;n<h.length;n++)p=h[n].g,m=h[n].Hd,q=h[n].H,p.ho?p.pe?ca.sJ(m,k):ca.lt(m,k):("COLOR_ID"==q.type&&(h[n].g=c,q.Vj=x.uuid,O(q,c),p=Z(c),S(q,p)),m=ca.lt(m,k),ca.rJ(m,l));d=d.concat(h)}return d}function r(a,b,c){var d=[],f=q(c,b,!b.fj,!1),h=
Z(b),k=a.data,l=k.materials,n=Array(l.length),m=ya.Eb(c,"MAIN_OPAQUE"),r=!1;m&&(r=m.no.length?!0:!1);for(var p=0;p<f.length;p++)for(var u=f[p],x=0;x<l.length;x++){var F=l[x];if(("LENS_FLARES"!=F.name||r)&&!ca.yw(k,x)){var C=e(u);"COLOR_ID"==u&&(C.pq=!(a.b4w_do_not_render||F.b4w_do_not_render));"MAIN"==u&&(n[x]=C);if(P(C,F)){"SHADOW"==u&&n[x]&&(C.Ld=n[x].Ld);C.Cf=b.Ee||b.Re?ca.Qm:ca.Mk;O(C,b);for(var L=C,y=a.particle_systems,w=0;w<y.length;w++){var D=y[w].settings.b4w_vcol_from_name,v=y[w].settings.b4w_vcol_to_name;
""!==D&&""!==v&&(L.bc[D]={$h:!1,src:[{name:D,ce:7}]})}"DYNAMIC"==b.type&&(C.Vj=a.uuid);S(C,h);var V=ca.Iv(k,x,C.jl,b.aj,C.bc,C.Ni);"LENS_FLARES"==F.name&&(V=da.KH(V));d.push({H:C,Hd:V,Qc:[F.name],g:b,Bd:[a]})}}}var ia=a.particle_systems;if(0<ia.length&&d.length){for(var A=!1,B=!1,p=0;p<ia.length;p++){var z=ia[p],J=z.settings;J.use_render_emitter&&(A=!0);"HAIR"!=J.type||"OBJECT"!=J.render_type&&"GROUP"!=J.render_type&&z.transforms.length||(B=!0);if(A&&B)break}var Da=d[0].H.bc,K;if(B){var G;if(1<l.length){for(var ta=
{},E=0;E<ia.length;E++){var H=ia[E].settings;if("HAIR"==H.type&&("OBJECT"==H.render_type||"GROUP"==H.render_type)){var T=H.b4w_vcol_from_name,Ia=H.b4w_vcol_to_name;""!==T&&""!==Ia&&(ta[T]=I.za(Da[T]))}}"a_bending_col_main"in Da&&(ta.a_bending_col_main=I.za(Da.a_bending_col_main));"a_bending_col_detail"in Da&&(ta.a_bending_col_detail=I.za(Da.a_bending_col_detail));G=ca.Jv(k,[],ta)}else G=d[0].Hd;K=G}else K=null;for(var Q,ma=K,Ha=a.qa,ua=[],M=a.particle_systems,Ca=a.data,va=0;va<M.length;va++){var ba=
M[va],fa=ba.settings;if(fa.count)if("EMITTER"==fa.type){if("DYNAMIC"==b.type){var aa=e("PARTICLES"),R,U=Ca.materials,pa=ba.settings.material-1;pa>=U.length&&(ha.warn('Wrong material used for rendering particle system "'+ba.name+'"'),pa=0);R=U[pa];"HALO"===ba.settings.render_type&&"HALO"===R.type&&(aa.wr=!0);g(aa,R);var Y=aa,xa=a,ea=ba.settings;switch(ea.b4w_billboard_align){case "VIEW":t(Y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":t(Y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;
case "YZ":t(Y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":t(Y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}t(Y,"BILLBOARD",0);var ka=ea.b4w_enable_soft_particles&&la.$u(xa,ea);t(Y,"SOFT_PARTICLES",0<ea.b4w_particles_softness&&ka&&ja.Fn?1:0);t(Y,"SOFT_STRENGTH",X.r(ea.b4w_particles_softness));X.N(Y.Fb,"WORLD_SPACE","WORLD"==ea.b4w_coordinate_system?1:0);aa.Re=!0;aa.Vj=Ha.name+"_"+fa.uuid;aa.PH=ba.name;S(aa,h);da.eG(aa,ba,R);var Aa=da.fF(aa,Ca,
ba,Ha.g.i);da.iK(Aa,aa,fa.count);da.hK(Ha);O(aa,Ha.g);ua.push({H:aa,Hd:Aa,Qc:[R.name],g:b,Bd:[a]})}}else if("HAIR"==fa.type){var ga=I.bo(ba.seed);fa.b4w_dynamic_grass&&(b.Th=!0);var qa=oa.av(ja.Tr)&&!fa.b4w_initial_rand_rotation&&!fa.b4w_hair_billboard,Ob=4;qa&&(Ob=8);if(ba.transforms.length)var Ta=ba.transforms;else for(var Hc=ca.jr(ma,fa.count,!1,ga),Ta=new Float32Array(Hc.length*Ob),cb=0;cb<Hc.length;cb++){var kd=.75+.5*I.ie(ga);Ta[cb*Ob]=Hc[cb][0];Ta[cb*Ob+1]=Hc[cb][1];Ta[cb*Ob+2]=Hc[cb][2];Ta[cb*
Ob+3]=kd;qa&&(Ta[cb*Ob+4]=1,Ta[cb*Ob+5]=0,Ta[cb*Ob+6]=0,Ta[cb*Ob+7]=0)}var Zc=ya.Eb(c,"GRASS_MAP")?!0:!1;if("OBJECT"==fa.render_type)var bc=[q(c,fa.dupli_object.qa.g,!b.fj,!0)],fc=N(a,b,Da,ma,[fa.dupli_object],bc,[Ta],fa,ba,Zc,ga,!1),ua=ua.concat(fc);else if("GROUP"==fa.render_type){for(var oc=fa.dupli_group.objects,bc=[],cb=0;cb<oc.length;cb++){var Ub=q(c,oc[cb].qa.g,!b.fj,!0);bc.push(Ub)}for(var Qc=!1,Xa=[],cb=0;cb<oc.length;cb++)Xa.push(oc[cb].qa);if(fa.use_whole_group){for(var gb,Cb=Ta,gc=Xa,
Rc=qa,hc=Ob,pb={},yb=new Float32Array([0,0,0,1]),Ua=0;Ua<Cb.length;Ua+=hc)for(var $a=0;$a<gc.length;$a++){var Ma=W.create(),mb=sa.get_scale(gc[$a].g.i),Vb=sa.get_trans_view(gc[$a].g.i);W.scale(Vb,mb,Ma);var Db=W.clone([Cb[Ua],Cb[Ua+1],Cb[Ua+2]]);pb[$a]||(pb[$a]=new Float32Array(Cb.length));Rc&&(pb[$a][Ua+4]=yb[0]=Cb[Ua+4],pb[$a][Ua+5]=yb[1]=Cb[Ua+5],pb[$a][Ua+6]=yb[2]=Cb[Ua+6],pb[$a][Ua+7]=yb[3]=Cb[Ua+7],I.ys(yb,yb),I.EJ(Ma,yb,Ma));W.add(Db,Ma,Db);pb[$a][Ua]=Db[0];pb[$a][Ua+1]=Db[1];pb[$a][Ua+2]=
Db[2];pb[$a][Ua+3]=Cb[Ua+3]}gb=pb;Qc=!0}else{var db;if(fa.use_group_count){for(var Pb=Ta,Jb=Xa,vb=fa.dupli_weights,ic=ga,jc=qa,Wb=Ob,nb={},wb=[],Pa=0;Pa<Jb.length;Pa++)for(var Ea=Jb[Pa],Sb=Ea.ri||Ea.name,xb=0;xb<vb.length;xb++){var Qb=vb[xb];Sb==Qb.name&&wb.push(Qb)}vb.length!=wb.length&&ha.error("dupli weights match failed");for(Pa=0;Pa<Pb.length;Pa+=Wb){for(var Ja,kc=wb,Xb=[0],ab=0;ab<kc.length;ab++)Xb[ab+1]=Xb[ab]+kc[ab].count;for(var qb=Xb[Xb.length-1]*I.ie(ic),Yb=0,ab=0;ab<Xb.length;ab++)if(qb>=
Xb[ab]&&qb<Xb[ab+1]){Yb=ab;break}Ja=Yb;nb[Ja]=nb[Ja]||[];nb[Ja].push(Pb[Pa],Pb[Pa+1],Pb[Pa+2],Pb[Pa+3]);jc&&nb[Ja].push(Pb[Pa+4],Pb[Pa+5],Pb[Pa+6],Pb[Pa+7])}for(Ja in nb)nb[Ja]=new Float32Array(nb[Ja]);db=nb}else{for(var hb=Ta,Qa=ga,Eb=qa,Tb=Ob,Na=Xa.length,ob={},Va=0;Va<hb.length;Va+=Tb){var rb=Math.floor(Na*I.ie(Qa));ob[rb]=ob[rb]||[];ob[rb].push(hb[Va],hb[Va+1],hb[Va+2],hb[Va+3]);Eb&&ob[rb].push(hb[Va+4],hb[Va+5],hb[Va+6],hb[Va+7])}for(rb in ob)ob[rb]=new Float32Array(ob[rb]);db=ob}gb=db}fc=N(a,
b,Da,ma,oc,bc,gb,fa,ba,Zc,ga,Qc);ua=ua.concat(fc)}"INSTANCE"==fa.b4w_wind_bend_inheritance&&Ha.g.Nd&&ha.warn('Emitter object "'+Ha.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}Q=ua;d=A?d.concat(Q):Q}return d}function h(a,b,c,d){a.$p=fa.mv(b,d);a.Yp=fa.kv(c,d);a.Zp=fa.lv(b,d)}function q(a,b,c,d){var f=[];d||(b.Yg&&ya.Eb(a,"COLOR_PICKING")||
b.Kb&&ya.Eb(a,"OUTLINE_MASK"))&&f.push("COLOR_ID");c&&(f.push("MAIN"),f.push("NODES_GLOW"),ya.Eb(a,"WIREFRAME")&&f.push("WIREFRAME"),ya.Eb(a,"SHADOW_RECEIVE")&&f.push("SHADOW"),ya.Eb(a,"GRASS_MAP")&&f.push("GRASS_MAP"));f.push("PHYSICS");if(b.Wc||b.wc)for(a=null,b.Wc&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.wc&&(b=["COLOR_ID","PHYSICS","SHADOW","WIREFRAME"],a=null!==a?I.iC(a,b):b),b=a,a=0;a<b.length;a++)c=f.indexOf(b[a]),-1!==c&&f.splice(c,1);return f}function g(a,b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render)c=
!1;else{if(b.use_nodes&&"HALO"!=b.type)v(a,b,"MAIN");else{l(a,b);c=b.game_settings.alpha_blend;a.pg=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.qi=b.offset_z;a.hh.set([1,1,1]);var d=b.texture_slots;ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.vc);switch(b.name){case "LENS_FLARES":U(a,"special_lens_flares.glslv","special_lens_flares.glslf");w(a,"a_position");w(a,"a_texcoord");var e=n(d[0],null);ea(a,e);break;default:U(a,"main.glslv","main_stack.glslf");b.use_shadeless||
(c=xa.Cq(b.uuid,b.name,{Ld:b.use_shadeless,rl:b.diffuse_shader,lk:b.specular_shader}),a.Fb.ni=xa.tn(c));var g=u("use_map_color_diffuse",d),h=u("use_map_color_spec",d),k=u("use_map_normal",d),m=u("use_map_mirror",d),q=u("use_stencil",d);c=g[0];h=h[0];k=k[0];m=m[0];g=g[1];d=q[0]&&u("use_rgb_to_intensity",d)[0];if(c){switch(c.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}e=n(c,null);ea(a,e,"u_colormap0");
a.Cg=c.diffuse_color_factor;a.vg=c.use_map_alpha?c.alpha_factor:0;a.hh.set(c.scale)}q=c&&c==h;h&&(q||(e=n(h,null),ea(a,e,"u_specmap0")),a.Hi=h.specular_color_factor);if(k&&(w(a,"a_normal"),w(a,"a_tangent"),a.Go=!0,e=n(k,null),ea(a,e,"u_normalmap0"),a.yx=k.normal_factor,e=k.texture,e.b4w_use_map_parallax&&ja.Zl)){var r=X.r(e.b4w_parallax_steps),p=X.r(e.b4w_parallax_lod_dist);t(a,"PARALLAX",1);t(a,"PARALLAX_STEPS",r);t(a,"PARALLAX_LOD_DIST",p);a.parallax_scale=e.b4w_parallax_scale}m&&(e=n(m,null),ea(a,
e,"u_mirrormap"),a.$r=m.mirror_factor);if(m=c&&g&&d?1:0)e=n(g,null),ea(a,e,"u_colormap1"),e=n(d,null),ea(a,e,"u_stencil0");(e=c||h||k)&&a.hh.set(e.scale);t(a,"TEXTURE_SPEC",void 0==h?0:1);t(a,"ALPHA_AS_SPEC",q?1:0);t(a,"TEXTURE_STENCIL_ALPHA_MASK",m);w(a,"a_position");w(a,"a_normal");(c||h||k)&&w(a,"a_texcoord");if(b.b4w_water){a.qh=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.Ga?(ha.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.Ap=!1):a.Ap=b.b4w_water_shore_smoothing;
U(a,"special_water.glslv","special_water.glslf");m=xa.Cq(b.uuid,b.name,{Ld:!1,rl:b.diffuse_shader,lk:b.specular_shader});a.Fb.ni=xa.tn(m);w(a,"a_position");ja.Rz?(w(a,"a_polyindex"),a.wa=!0,a.wireframe_edge_color=[0,0,0],Aa.jw()?t(a,"DEBUG_WIREFRAME",1):t(a,"DEBUG_WIREFRAME",2)):t(a,"DEBUG_WIREFRAME",0);q=b.texture_slots;m=u("use_map_normal",q);e=u("use_map_mirror",q)[0];m.length&&(r=n(m[0]),ea(a,r,"u_normalmap0"),a.Ik=b.b4w_water_norm_uv_velocity);t(a,"NUM_NORMALMAPS",m.length);a.pi=Array(m.length);
for(r=0;r<m.length;r++)a.pi[r]=new Float32Array(2),a.pi[r].set([m[r].scale[0],m[r].scale[1]]);e&&(r=n(e),ea(a,r,"u_mirrormap"),a.$r=e.mirror_factor);e=null;if(ja.mj)for(r=0;r<q.length;r++){var x=q[r];if(!0===x.texture.b4w_water_foam){e=x;break}}e?(t(a,"FOAM",1),r=n(e),ea(a,r,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Mv.set(e.texture.b4w_foam_uv_freq),a.Lv.set(e.texture.b4w_foam_uv_magnitude),a.br[0]=e.scale[0],a.br[1]=e.scale[1]):t(a,"FOAM",0);for(r=0;r<q.length;r++)if(x=q[r],!0===x.texture.b4w_shore_dist_map){var F=
x;break}F&&ja.an?(F=n(F),ea(a,F,"u_shore_dist_map"),t(a,"SHORE_PARAMS",1),F=x.texture.b4w_shore_boundings,t(a,"MAX_SHORE_DIST",X.r(x.texture.b4w_max_shore_dist)),t(a,"SHORE_MAP_SIZE_X",X.r(F[0]-F[1])),t(a,"SHORE_MAP_SIZE_Y",X.r(F[2]-F[3])),t(a,"SHORE_MAP_CENTER_X",X.r((F[0]+F[1])/2)),t(a,"SHORE_MAP_CENTER_Y",X.r((F[2]+F[3])/2))):t(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh)t(a,"GENERATED_MESH",1),a.Oz=!0,a.Pz=b.b4w_water_num_cascads,a.Qz=b.b4w_water_subdivs,a.Nz=b.b4w_water_detailed_dist;else{w(a,
"a_normal");if(e||m.length)w(a,"a_texcoord"),w(a,"a_tangent"),a.Go=!0;t(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){var x=X.r(b.b4w_water_dst_noise_scale0),F=X.r(b.b4w_water_dst_noise_scale1),m=X.r(b.b4w_water_dst_noise_freq0),q=X.r(b.b4w_water_dst_noise_freq1),e=X.r(b.b4w_water_dir_min_shore_fac),r=X.r(b.b4w_water_dir_freq),p=X.r(b.b4w_water_dir_noise_scale),da=X.r(b.b4w_water_dir_noise_freq),C=X.r(b.b4w_water_dir_min_noise_fac),L=X.r(b.b4w_water_dst_min_fac),D=X.r(b.b4w_water_waves_hor_fac);t(a,
"DST_NOISE_SCALE_0",x);t(a,"DST_NOISE_SCALE_1",F);t(a,"DST_NOISE_FREQ_0",m);t(a,"DST_NOISE_FREQ_1",q);t(a,"DIR_MIN_SHR_FAC",e);t(a,"DIR_FREQ",r);t(a,"DIR_NOISE_SCALE",p);t(a,"DIR_NOISE_FREQ",da);t(a,"DIR_MIN_NOISE_FAC",C);t(a,"DST_MIN_FAC",L);t(a,"WAVES_HOR_FAC",D)}B(a,b);H(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;t(a,"ABSORB",X.r(b.b4w_water_absorb_factor));
t(a,"SSS_STRENGTH",X.r(b.b4w_water_sss_strength));t(a,"SSS_WIDTH",X.r(b.b4w_water_sss_width))}"HALO"===b.type&&(U(a,"halo.glslv","halo.glslf"),y(a,b),a.jl=["a_position"]);t(a,"TEXCOORD",0);t(a,"NORMAL_TEXCOORD",0);c&&f(a,c,"TEXTURE_COLOR0_CO");g&&f(a,g,"TEXTURE_COLOR1_CO");d&&f(a,d,"TEXTURE_STENCIL_ALPHA_MASK_CO");h&&f(a,h,"TEXTURE_SPEC_CO");k&&f(a,k,"TEXTURE_NORM_CO");t(a,"SHADELESS",b.use_shadeless?1:0);a.Ld=b.use_shadeless}c=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===c?0:1);t(a,"ALPHA_CLIP",
"CLIP"===c?1:0);t(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(t(a,"VERTEX_COLOR",1),w(a,"a_color")):t(a,"VERTEX_COLOR",0);a.pf=b.ambient;a.Dg=b.diffuse_intensity;a.Df=b.emit;a.ff.set(b.specular_color);a.et=b.specular_alpha;B(a,b);H(a,b);b.b4w_wettable?t(a,"WETTABLE",1):t(a,"WETTABLE",0);A(a,b);b.b4w_refractive&&!a.Ga?(ha.warn('Material "'+b.name+'" is not blend. Disabling refractions.'),a.km=!1):a.km=b.b4w_refractive;a.fy=b.b4w_refr_bump}c=!0}break;case "NODES_GLOW":c=
v(a,b,"GLOW");break;case "SHADOW":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(l(a,b),a.Ga)c=!1;else{h=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==h?v(a,b,"SHADOW"):(U(a,"shadow.glslv","shadow.glslf"),ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.vc));w(a,"a_position");w(a,"a_normal");t(a,"ALPHA","OPAQUE"===h?0:1);a.hh.set([1,1,1]);if((c=u("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){switch(c.blend_type){case "MIX":t(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.hh.set(c.scale);t(a,"TEXTURE_COLOR",1);w(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source||"CANVAS"==c.texture.k.source)h=n(c),ea(a,h,"u_colormap0");"NONE"==c.texture.k.source&&(h=n(c),ea(a,h,"u_colormap0"))}else t(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.Cm=b.b4w_use_ghost,a.Ya=b.b4w_collision_id,a.fl=b.b4w_collision_margin,
a.cl=b.b4w_collision_group,a.hl=b.b4w_collision_mask,a.Dl=b.physics.friction,a.wl=b.physics.elasticity,c=!0):b.b4w_water?(a.qh=!0,a.SK=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,
a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||"HALO"===b.type)c=!1;else{l(a,b);a.rg=ca.of;a.wa=!0;a.Ga=!1;h=b.game_settings.alpha_blend;a.pg=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;b.use_nodes&&"CLIP"==h?v(a,b,"COLOR_ID"):(U(a,"color_id.glslv","color_id.glslf"),ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.vc));w(a,"a_position");
t(a,"ALPHA","OPAQUE"===h?0:1);a.hh.set([1,1,1]);if((c=u("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){switch(c.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.hh.set(c.scale);t(a,"TEXTURE_COLOR",1);w(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)h=n(c),ea(a,h,"u_colormap0");"NONE"==c.texture.k.source&&(h=n(c),ea(a,h,"u_colormap0"))}else t(a,
"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(l(a,b),a.Ga=!1,a.rg=ca.of,a.wa=!0,U(a,"grass_map.glslv","grass_map.glslf"),w(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,h=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.bc.a_grass_size={$h:!0,src:[]},c?(a.bc.a_grass_size.src.push({name:c,ce:4}),t(a,"DYNAMIC_GRASS_SIZE",1)):t(a,"DYNAMIC_GRASS_SIZE",0),a.bc.a_grass_color={$h:!0,src:[]},h?(a.bc.a_grass_color.src.push({name:h,
ce:7}),t(a,"DYNAMIC_GRASS_COLOR",1)):t(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?c=!1:(U(a,"wireframe.glslv","wireframe.glslf"),w(a,"a_position"),w(a,"a_normal"),w(a,"a_polyindex"),a.wa=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":a:if(b.b4w_do_not_render)c=!1;else{c=b.texture_slots;if(a.wr)U(a,"particle_system.glslv","particle_system_stack.glslf"),t(a,"HALO_PARTICLES",1),y(a,
b);else{h={Ld:!1,rl:b.diffuse_shader,lk:b.specular_shader};if(b.use_nodes){U(a,"particle_system.glslv","particle_system.glslf");v(a,b,"PARTICLES");c=!0;break a}U(a,"particle_system.glslv","particle_system_stack.glslf");h=xa.Cq(b.uuid,b.name,h);a.Fb.ni=xa.tn(h);if(c=u("use_map_color_diffuse",c)[0]){t(a,"TEXTURE_COLOR",1);switch(c.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Cg=c.diffuse_color_factor;
a.vg=c.use_map_alpha?c.alpha_factor:0;c=n(c);ea(a,c)}}ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.vc);a.pf=b.ambient;a.Dg=b.diffuse_intensity;a.Df=b.emit;a.ff.set(b.specular_color);a.et=b.specular_alpha;w(a,"a_position");w(a,"a_normal");c=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===c?0:1);t(a,"ALPHA_CLIP","CLIP"===c?1:0);t(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);B(a,b);H(a,b);l(a,b);c=b.game_settings.alpha_blend;a.pg=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=
c;a.qi=b.offset_z;c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function y(a,b){var c=b.halo;t(a,"NUM_RINGS",c.ring_count);t(a,"NUM_LINES",c.line_count);t(a,"NUM_STARS",c.star_tip_count);t(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0);a.uw=c.size;a.rw=c.hardness/20;a.tw.set(c.b4w_halo_rings_color);a.sw.set(c.b4w_halo_lines_color);a.vw=1/b.b4w_halo_stars_blend_height;a.ww=b.b4w_halo_stars_min_height;a.qw=!0}function f(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":t(a,c,"TEXTURE_COORDS_UV_ORCO");
t(a,"TEXCOORD",1);break;case "NORMAL":t(a,c,"TEXTURE_COORDS_NORMAL");t(a,"NORMAL_TEXCOORD",1);break;default:t(a,c,0)}}function l(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Ga=!0;a.rg=ca.nu;a.wa=!0;a.zh=!1;break;case "ALPHA":a.Ga=!0;a.rg=ca.of;a.wa=!0;a.zh=!1;break;case "CLIP":a.Ga=!1;a.rg=ca.of;a.wa=!0;a.zh=!0;break;case "ADD":a.Ga=!0;a.rg=ca.of;a.wa=!1;a.zh=!1;break;case "OPAQUE":a.Ga=!1;a.rg=ca.of;a.wa=!0;a.zh=!1;break;default:throw Error("Unknown alpha blend mode: "+
d);}a.pb=c.use_backface_culling}function n(a,b){var c=a.texture,d=c.k,c=c.image;d&&b&&c&&pa.xm(d,b,c.gd,c.filepath);return d}function u(a,b){for(var c=[],d=b.length,f=0;f<d;f++){var e=b[f];1==e[a]&&e.texture&&e.texture.k&&c.push(e)}return c}function A(a,b){var c=b.raytrace_transparency;a.se[0]=c.fresnel;a.se[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.se[2]=c.fresnel;a.se[3]=1-c.fresnel_factor/5}function B(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=
b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:ha.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.Yc[0]=b.specular_intensity;a.Yc[1]=c;a.Yc[2]=d}function H(a,b){switch(b.diffuse_shader){case "LAMBERT":a.pd[0]=0;a.pd[1]=0;break;case "OREN_NAYAR":a.pd[0]=b.roughness;a.pd[1]=0;break;case "FRESNEL":a.pd[0]=
b.diffuse_fresnel;a.pd[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.pd[0]=b.darkness;a.pd[1]=0;break;case "TOON":a.pd[0]=b.diffuse_toon_size;a.pd[1]=b.diffuse_toon_smooth;break;default:ha.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.pd[0]=0,a.pd[1]=0}}function v(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":U(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":U(a,"main.glslv","main.glslf");d=!0;break;case "SHADOW":U(a,
"shadow.glslv","shadow.glslf");d=!1;break;case "COLOR_ID":U(a,"color_id.glslv","color_id.glslf"),d=!1}var f=b.node_tree;c=xa.iD(f,b.uuid,!1,b.name,c);if(!c)return ha.error('Failed to create node graph for material "'+b.name+'", disable nodes'),D(a,b),!0;a.Kl=!0;t(a,"NODES",1);t(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);w(a,"a_position");b.use_orco_tex_coord&&w(a,"a_orco_tex_coord");l(a,b);a.qi=b.offset_z;var e=b.game_settings.alpha_blend;d?(t(a,"ALPHA",1),t(a,"ALPHA_CLIP",0)):(t(a,
"ALPHA","OPAQUE"===e?0:1),t(a,"ALPHA_CLIP","CLIP"===e?1:0));a.pg=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.vc);a.Df=b.emit;a.pf=b.ambient;A(a,b);b.b4w_wettable?t(a,"WETTABLE",1):t(a,"WETTABLE",0);var g=[],h=[],k=!1;R.ea(c,function(c,d){switch(d.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var f=d.data.name,e=d.data.value;a.Ni||(a.Ni={});a.Ni[e]=f;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":f=
d.data.name;a.bc[f]={$h:!0,src:[{name:d.data.value}]};e=0;if("GEOMETRY_VC"==d.type)e=7;else for(var l=0;l<d.Da.length;l++){var n="RGB".indexOf(d.Da[l].identifier);-1<n&&(e|=1<<2-n)}a.bc[f].src[0].ce=e;break;case "TEX_COORD_NO":case "GEOMETRY_NO":w(a,"a_normal");break;case "MATERIAL_BEGIN":w(a,"a_normal");k=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":f=d.data.name;e=d.data.value;if(!e.k){ha.warn('Wrong texture "'+d.data.value.name+'" in material "'+b.name+'".');D(a,b);break}!1!==e.k.$m&&
(e.k.$m="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);ea(a,e.k,f);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":t(a,"CALC_TBN_SPACE",1);w(a,"a_normal");w(a,"a_tangent");a.Go=!0;f=d.data.name;e=d.data.value;e.k.$m=!1;ea(a,e.k,f);break;case "LAMP":d.data&&(a.Fj=d.data);break;case "B4W_REFRACTION":a.Ga?a.km=!0:(a.km=!0,ha.warn('Material "'+b.name+'" is not blend. Disabling refractions.'));break;case "VALTORGB":g.push(d);break;case "CURVE_VEC":case "CURVE_RGB":h.push(d);break;case "PARTICLE_INFO":"PARTICLES"==
a.type&&d.data&&(a.rs=d.data)}});var n=0,m=e=null,q=g.length+h.length;if(g.length)for(e=pa.rD(g,pa.$z),d=0;d<g.length;d++)g[d].Na=[["NODE_TEX_ROW",X.r((n+.5)/q)]],n++;if(h.length)for(m=pa.UD(h,pa.Xt),d=0;d<h.length;d++){h[d].Na=[["NODE_TEX_ROW",X.r((n+.5)/q)]];n++;var r=h[d].data.value;"CURVE_RGB"==r.type?(J(r,0,0)&&h[d].Na.push(["READ_R",1]),J(r,1,0)&&h[d].Na.push(["READ_G",1]),J(r,2,0)&&h[d].Na.push(["READ_B",1]),J(r,3,0)&&h[d].Na.push(["READ_A",1])):"CURVE_VEC"==r.type&&(J(r,0,-1)&&h[d].Na.push(["READ_R",
1]),J(r,1,-1)&&h[d].Na.push(["READ_G",1]),J(r,2,-1)&&h[d].Na.push(["READ_B",1]))}d=null;e&&m?(d=new Uint8Array(e.length+m.length),d.set(e),d.set(m,e.length)):d=e?e:m;d&&C(a,d,"u_nodes_texture",pa.Xt);k||(a.Ld=!0);c=a.Fb.ni=xa.tn(c);E(f,a,b.name);f=a.Sj;e=a.Rj;for(d=0;d<c.length;d++)switch(m=c[d],m.id){case "VALUE":if(n=m.Fo[0])for(q=0;q<f.length;q+=2)if(f[q]==n){m.Na.push(["VALUE_IND",f[q+1]]);break}break;case "RGB":if(n=m.Fo[0])for(q=0;q<e.length;q+=2)if(e[q]==n){m.Na.push(["RGB_IND",e[q+1]]);break}}t(a,
"NUM_VALUES",a.oi.length);t(a,"NUM_RGBS",a.xd.length);return!0}function E(a,b,c){var d=[],f=[],e=[],g=[],h=[],k=[];z(a,c,a.animation_data,d,f,e,g,h,k);b.oi=d;b.Sj=f;b.ux=e;b.xd=g;b.Rj=h;b.vx=k}function z(a,b,c,f,e,g,h,k,l){for(var n=0;n<a.nodes.length;n++){var m=a.nodes[n];if("VALUE"==m.type){var q=d(b,m.name);f.push(m.outputs[0].default_value);e.push(q,e.length/2)}else"RGB"==m.type?(q=d(b,m.name),m=m.outputs[0].default_value.slice(0,3),h.push(m[0],m[1],m[2]),k.push(q,k.length/2)):"GROUP"==m.type&&
(q=m.node_group.node_tree,z(q,d(b,m.name),q.animation_data,f,e,g,h,k,l))}if(c)for((a=c.action)&&a.k.type==qa.Wt&&G(a,b,g,e,l,k),c=c.nla_tracks,f=0;f<c.length;f++)for(h=c[f].strips,n=0;n<c[f].strips.length;n++)(a=h[n].action)&&a.k.type==qa.Wt&&G(a,b,g,e,l,k)}function G(a,b,c,f,e,g){var h=a.k.s,k;for(k in h){var l=d(b,k.match(/"(.*?)"/)[1]),h=F(f,l);null!=h?(l=d(a.name,k),c.push(l,h)):(h=F(g,l),null!=h&&(l=d(a.name,k),e.push(l,h)))}}function d(a,b){return a+"%join%"+b}function F(a,b){for(var c=0;c<
a.length;c+=2)if(a[c]==b)return a[c+1];return null}function J(a,b,c){a=a.curve_mapping.curves_data[b];return 2==a.length&&a[0][0]<c+.01&&a[0][1]<c+.01&&.99<a[1][0]&&.99<a[1][1]?!1:!0}function C(a,b,c,d){var f={texture:pa.Wv("NODE_TEX",null)};b=n(f,{width:d,height:b.length/(4*d),data:b});ea(a,b,c)}function D(a,b){switch(a.type){case "SHADOW":U(a,"shadow.glslv","shadow.glslf");break;case "COLOR_ID":U(a,"color_id.glslv","color_id.glslf");break;default:U(a,"main.glslv","main_stack.glslf")}t(a,"SHADELESS",
1);w(a,"a_position");w(a,"a_normal");ua.set(1,0,1,1,a.vc);if(b){var c=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===c?0:1);t(a,"ALPHA_CLIP","CLIP"===c?1:0);t(a,"VERTEX_COLOR",0);a.qi=b.offset_z;l(a,b)}return!0}function O(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.ho?t(a,"AU_QUALIFIER","attribute"):t(a,"AU_QUALIFIER","uniform"),t(a,"STATIC_BATCH",0)):(t(a,"AU_QUALIFIER","attribute"),t(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(Aa.jw()?t(a,"WIREFRAME_QUALITY",1):t(a,"WIREFRAME_QUALITY",0),
a.Qh?(t(a,"DEBUG_SPHERE",1),a.sv?t(a,"DEBUG_SPHERE_DYNAMIC",1):t(a,"DEBUG_SPHERE_DYNAMIC",0)):t(a,"DEBUG_SPHERE",0),t(a,"ALPHA",1));b.Ee&&(a.Ee=b.Ee);b.Nd?(""!==b.Qf?(a.bc.a_bending_col_main={$h:!0,src:[{name:b.Qf,ce:4}]},w(a,"a_bending_col_main"),""!==b.uc.Zw&&""!==b.uc.Yw&&""!==b.uc.Jx?(a.bc.a_bending_col_detail={$h:!0,src:[{name:b.uc.Zw,ce:4},{name:b.uc.Yw,ce:2},{name:b.uc.Jx,ce:1}]},w(a,"a_bending_col_detail"),w(a,"a_normal"),t(a,"DETAIL_BEND",1)):t(a,"DETAIL_BEND",0),t(a,"MAIN_BEND_COL",1)):
t(a,"MAIN_BEND_COL",0),t(a,"WIND_BEND",1)):t(a,"WIND_BEND",0);b.kn?t(a,"BEND_CENTER_ONLY",1):t(a,"BEND_CENTER_ONLY",0);t(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.cq|0);b.pe?t(a,"BILLBOARD",1):t(a,"BILLBOARD",0);b.pe&&b.ho?t(a,"HAIR_BILLBOARD",1):t(a,"HAIR_BILLBOARD",0);b.Rk?t(a,"BILLBOARD_SPHERICAL",1):t(a,"BILLBOARD_SPHERICAL",0);switch(b.Sk){case "RANDOM":t(a,"BILLBOARD_RANDOM",1);t(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":t(a,"BILLBOARD_RANDOM",0);t(a,"BILLBOARD_JITTERED",1);break;default:t(a,
"BILLBOARD_RANDOM",0),t(a,"BILLBOARD_JITTERED",0)}b.fc&&ja.an?t(a,"DYNAMIC_GRASS",1):t(a,"DYNAMIC_GRASS",0);a.fc=b.fc;"PARTICLES"!=a.type&&(a.Re=b.Re);a.Fd=b.Fd;a.Wc=b.Wc;a.Xc=b.Xc&&!a.Ld&&!(a.Ga&&ja.Qq);a.Fc=b.Fc;a.wc=b.wc;a.Uc=b.Uc;b.Dj?(w(a,"a_influence"),t(a,"SKINNED",1),ja.Op?(t(a,"DISABLE_TANGENT_SKINNING",1),t(a,"FRAMES_BLENDING",0)):(t(a,"DISABLE_TANGENT_SKINNING",0),b.Cl?t(a,"FRAMES_BLENDING",1):t(a,"FRAMES_BLENDING",0)),t(a,"MAX_BONES",b.Rf)):(t(a,"SKINNED",0),t(a,"FRAMES_BLENDING",0),t(a,
"DISABLE_TANGENT_SKINNING",0));b.ac?(t(a,"VERTEX_ANIM",1),ja.Fz?t(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):t(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):t(a,"VERTEX_ANIM",0);if(b.Dj&&b.ac)throw"Skinning and vertex animation are mutually exlusive";b.Gn?t(a,"DISABLE_FOG",1):t(a,"DISABLE_FOG",0)}}function T(a,b,c){if(b.length){for(var d=la.Rn(b,ja.Zc&&c.b4w_enable_ssao),f=a.Fb,e=0,g=0;g<a.Fb.ni.length;g++){var h=a.Fb.ni[g];if("LIGHTING_LAMP"==h.id){var k=b[e++%b.length],l=k.Qa;"AREA"==l.type&&
(k=b[e++%b.length],l=k.Qa);var n=la.R(k,c);if("SPOT"==l.type||"POINT"==l.type)var m=Math.cos(l.Ii/2);if("SPOT"==l.type)var q=l.sm*(1-m);n=n.gi;k=d.indexOf(k);h.Na=[["LAMP_TYPE",l.type],["LAMP_IND",n],["LAMP_LIGHT_FACT_IND",Math.floor(n/2)],["LAMP_FAC_CHANNELS",0==n%2?"rg":"ba"],["LAMP_SPOT_SIZE",X.r(m||.01)],["LAMP_SPOT_BLEND",X.r(q||.01)],["LAMP_LIGHT_DIST",X.r(l.distance)],["LAMP_SHADOW_MAP_IND",k]]}}if(a.Fj){c=0;for(var r in a.Fj)c++;a.Lr=new Float32Array(3*c);a.Jr=new Float32Array(3*c);a.Ir=new Float32Array(3*
c);a.Kr=new Float32Array(4*c);X.N(f,"NUM_LAMP_LIGHTS",c);for(g=0;g<b.length;g++)K(a,b[g])}}}function K(a,b){if(b.mh in a.Fj){var c=a.Fj[b.mh],d=sa.get_trans_view(b.g.i);a.Lr.set(d,3*c);a.Jr.set(b.Qa.direction,3*c);a.Ir.set(b.Qa.il,3*c);var d=ta,f=b.Qa;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=f.Mi?1:0;switch(f.type){case "POINT":d[2]=f.distance;break;case "SPOT":d[2]=f.distance;var e=d[0]=Math.cos(f.Ii/2);d[1]=f.sm*(1-e)}a.Kr.set(d,4*c)}}function w(a,b){var c=a.jl;-1==c.indexOf(b)&&c.push(b)}function t(a,b,c){X.N(a.Fb,
b,c)}function Q(a,b){if("PHYSICS"==a.type)0<b.va.length&&ca.tJ(b,b.G[0]),a.Hd=b;else{var c=a.rg,d=a.Cf;a.qw&&"PARTICLES"!=a.type&&(b=ca.GE(b));a.Oz&&(b=L.mF(a.Pz,a.Qz,a.Nz));c=ca.vJ(b,c,d,a.bc);a.X=c;a.Re||c.ao||a.Ee||(c.Ig=null,c.oc=null);c=b.G.length;a.num_vertices=b.ha*c;a:switch(a.Cf){case ca.Mk:case ca.Rm:case ca.Qm:d=!0;break a;default:d=!1}d?ca.nG(b)?a.num_triangles=b.Ma.length/3*c:a.num_triangles=b.ha/3*c:a.num_triangles=0}}function N(a,b,c,d,f,g,h,k,l,n,m,q){var r=a.qa,p=[],t=k.b4w_dynamic_grass;
if(!n&&t)return p;for(var u="INSTANCE"==k.b4w_wind_bend_inheritance,x="INSTANCE"==k.b4w_shadow_inheritance,F="INSTANCE"==k.b4w_reflection_inheritance,da=[],C=[],L=0;L<f.length;L++){var y=f[L].qa.g,w=I.bl(b);w.pe=k.b4w_hair_billboard;w.Sk=k.b4w_hair_billboard_type;w.Rk="SPHERICAL"==k.b4w_hair_billboard_geometry;w.fc=t;w.ho=!0;u?(w.Nd=y.Nd,w.Jm=y.Jm,w.og=y.og,w.Bf=y.Bf,w.Qf=y.Qf,w.Af=y.Af,w.tf=y.tf,w.mf=y.mf,w.uc=y.uc,w.kn=!1):(w.Nd=r.g.Nd,w.Jm=r.g.Jm,w.og=r.g.og,w.Bf=r.g.Bf,w.Qf=r.g.Qf,w.Af=r.g.Af,
w.tf=r.g.tf,w.mf=r.g.mf,w.uc=r.g.uc,w.kn=!0);x?(w.Fd=y.Fd,w.Wc=y.Wc,w.Xc=y.Xc):(w.Fd=r.g.Fd,w.Wc=r.g.Wc,w.Xc=r.g.Xc);F?(w.Fc=y.Fc,w.wc=y.wc,w.Uc=y.Uc,w.Td=y.Td,w.zd=y.zd,w.cf=y.cf):(w.Fc=r.g.Fc,w.wc=r.g.wc,w.Uc=r.g.Uc,w.Td=r.g.Td,w.zd=r.g.zd,w.cf=r.g.cf);da.push(w);var D=h[L];D||(D=new Float32Array);q&&I.bo(l.seed,m);var v=new Float32Array(3),N=new Float32Array([0,0,0,1]),A=[],B=oa.av(ja.Tr)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,z=4;B&&(z=8);for(var J=0;J<D.length;J+=z){v[0]=D[J];v[1]=
D[J+1];v[2]=D[J+2];var Da=D[J+3]*sa.get_scale(y.i);if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var K=new Float32Array([I.ie(m),I.ie(m),I.ie(m)]);W.normalize(K,K);break;case "Z":K=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}V.setAxisAngle(K,k.b4w_rand_rotation_strength*(2*Math.PI*I.ie(m)-Math.PI),N)}else if(B&&(N.set(D.subarray(J+4,J+8)),I.ys(N,N),!k.use_whole_group))if(k.use_rotation_dupli){var G=sa.get_quat_view(y.i);
V.multiply(N,G,N)}else V.multiply(N,ia,N);var ta=sa.set_sep(v,Da,N,sa.create());A.push(ta)}C.push(A)}for(var E={},L=0;L<f.length;L++){var H=f[L],T=g[L],w=da[L],Ia={};w.Nd&&(Ia.au_wind_bending_amp=[w.mf],Ia.au_wind_bending_freq=[w.og],Ia.au_detail_bending_freq=[w.Bf],Ia.au_detail_bending_amp=[w.Af],Ia.au_branch_bending_amp=[w.tf],w.mf=0,w.og=0,w.Bf=0,w.Af=0,w.tf=0);var Q=Z(w),A=C[L];if(A.length)for(var Ha=H.data,ma=Ha.materials,ua=Array(ma.length),J=0;J<ma.length;J++)if(!ca.yw(Ha,J))for(var M=0;M<
T.length;M++){var Ca=T[M],va=e(Ca),ba=ma[J];"COLOR_ID"==Ca&&(va.pq=!(H.b4w_do_not_render||ba.b4w_do_not_render));"MAIN"==Ca&&(ua[J]=va);if(P(va,ba)){"SHADOW"==Ca&&ua[J]&&(va.Ld=ua[J].Ld);va.Cf=ca.Mk;O(va,w);va.Vj=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(va.Sw=k.b4w_hair_billboard_jitter_amp,va.Tw=k.b4w_hair_billboard_jitter_freq);t&&(va.nw=k.b4w_dynamic_grass_scale_threshold);u||(delete va.bc.a_bending_col_main,delete va.bc.a_bending_col_detail);S(va,Q);var ya=ca.Iv(Ha,J,va.jl,b.aj,va.bc,va.Ni),
fa=ca.WG(ya,Ia,A),X=fa,aa=A;X.U.au_center_pos=new Float32Array(3*X.ha);for(var R=aa.length,U=X.ha/R,pa=0;pa<R;pa++)for(var la=aa[pa],Y=3*U*pa,ea=0;ea<U;ea++)X.U.au_center_pos[Y+3*ea]=la[0],X.U.au_center_pos[Y+3*ea+1]=la[1],X.U.au_center_pos[Y+3*ea+2]=la[2];fa=X;if(w.Nd&&w.kn){var xa=fa,Aa=r.g.i;xa.U.a_emitter_center=new Float32Array(3*xa.ha);var ka=W.fromValues(0,0,0);sa.transform_vec3(ka,Aa,ka);for(var ga=0;ga<xa.ha;ga++)xa.U.a_emitter_center[3*ga]=ka[0],xa.U.a_emitter_center[3*ga+1]=ka[1],xa.U.a_emitter_center[3*
ga+2]=ka[2];fa=xa}var qa=k.b4w_vcol_from_name,bc=k.b4w_vcol_to_name,fc=va,oc=c,Ub=!u,Qc=Ha,Xa=[];if(""!==qa&&""!==bc){var gb,Cb=bc,gc=fc.bc,Rc=[],hc=void 0;for(hc in gc)for(var pb=gc[hc].src,yb=0,Ua=0;Ua<pb.length;Ua++){var $a=pb[Ua].ce;Cb==pb[Ua].name&&Rc.push(hc,$a,yb);yb+=I.Bi($a)}gb=Rc;if(0<gb.length)for(var Ma=0;Ma<gb.length;Ma+=3)Xa.push({xl:qa,Kn:7,Ho:gb[Ma],Io:gb[Ma+1],Hn:gb[Ma+2]});else ca.YF(fc.jl,"a_color")&&bc==Qc.active_vcol_name&&Xa.push({xl:qa,Kn:7,Ho:"a_color",Io:7,Hn:0})}Ub&&("a_bending_col_main"in
oc&&Xa.push({xl:"a_bending_col_main",Kn:4,Ho:"a_bending_col_main",Io:4,Hn:0}),"a_bending_col_detail"in oc&&Xa.push({xl:"a_bending_col_detail",Kn:7,Ho:"a_bending_col_detail",Io:7,Hn:0}));for(var mb=fa,Vb=A,Db=d,db=Xa,Pb=va.bc,Jb=!1,vb=0;vb<db.length;vb++){var ic=db[vb].xl,jc=Db.U[ic];if(jc&&0<jc.length){Jb=!0;break}}if(Jb){var Wb,nb=r.g.dc,wb=Db.G[0].a_position,Pa=Vb,Ea=E,Sb=new Float32Array(3),xb=new Float32Array(3),Qb=new Uint32Array(Pa.length);if(!("verts_indices"in Ea)){Ea.vf=new Float32Array(3);
Ea.rf=new Float32Array(3);Ea.Jt=new Uint32Array(wb.length/3);Ea.Vl=new Uint32Array(wb.length/3);Ea.vf[0]=(nb.max_x-nb.min_x)/20;Ea.vf[1]=(nb.max_y-nb.min_y)/20;Ea.vf[2]=(nb.max_z-nb.min_z)/20;Ea.rf[0]=nb.min_x;Ea.rf[1]=nb.min_y;Ea.rf[2]=nb.min_z;for(var Ja=0;Ja<wb.length/3;Ja++){var kc=I.trunc((wb[3*Ja]-Ea.rf[0])/Ea.vf[0]),Xb=I.trunc((wb[3*Ja+1]-Ea.rf[1])/Ea.vf[1]),ab=I.trunc((wb[3*Ja+2]-Ea.rf[2])/Ea.vf[2]),kc=I.clamp(kc,0,19),Xb=I.clamp(Xb,0,19),ab=I.clamp(ab,0,19);Ea.Jt[Ja]=Ja;Ea.Vl[Ja]=ab*Math.pow(20,
2)+20*Xb+kc}ca.Fy(Ea.Vl,Ea.Jt,ca.Jp,!0);Ea.Oi=new Uint32Array(Math.pow(20,3));for(Ja=0;Ja<Ea.Vl.length;Ja++)Ea.Oi[Ea.Vl[Ja]]++;delete Ea.Vl;for(Ja=1;Ja<Ea.Oi.length;Ja++)Ea.Oi[Ja]+=Ea.Oi[Ja-1]}for(var qb=0;qb<Pa.length;qb++){Sb[0]=Pa[qb][0];Sb[1]=Pa[qb][1];Sb[2]=Pa[qb][2];for(var Yb=1E10,hb=-1,Qa=I.trunc((Sb[0]-Ea.rf[0])/Ea.vf[0]),Eb=I.trunc((Sb[1]-Ea.rf[1])/Ea.vf[1]),Tb=I.trunc((Sb[2]-Ea.rf[2])/Ea.vf[2]),Qa=I.clamp(Qa,0,19),Eb=I.clamp(Eb,0,19),Tb=I.clamp(Tb,0,19),Na=Tb*Math.pow(20,2)+20*Eb+Qa,ob=
Ea.Oi[Na],Va=0==Na?0:Ea.Oi[Na-1];Va<ob;Va++){var rb=Ea.Jt[Va];xb[0]=wb[3*rb];xb[1]=wb[3*rb+1];xb[2]=wb[3*rb+2];W.sub(xb,Sb,xb);var Zb=W.sqrLen(xb);Zb<=Yb&&(Yb=Zb,hb=rb)}if(-1==hb)for(Va=0;Va<wb.length/3;Va++)xb[0]=wb[3*Va],xb[1]=wb[3*Va+1],xb[2]=wb[3*Va+2],W.sub(xb,Sb,xb),Zb=W.sqrLen(xb),Zb<=Yb&&(Yb=Zb,hb=Va);Qb[qb]=hb}Wb=Qb;for(var zc=mb.ha/Vb.length,vb=0;vb<db.length;vb++){var zb=db[vb].Ho,lc=db[vb].Io,ic=db[vb].xl,$b=db[vb].Kn,jc=Db.U[ic];switch(zb){case "a_bending_col_main":var Kb=1;break;case "a_bending_col_detail":Kb=
3;break;case "a_color":Kb=3;break;default:for(var Lb=Kb=0;Lb<Pb[zb].src.length;Lb++)Kb+=I.Bi(Pb[zb].src[Lb].ce)}if(jc&&0<jc.length){var Ic=I.Bi($b),Wa=I.Bi(lc),eb=$b&lc,Sc=I.jy(eb);eb!=lc&&ha.error("Wrong color extraction from "+ic+" to "+zb+".");if("a_bending_col_main"==zb||"a_bending_col_detail"==zb)mb.U[zb]=new Float32Array(mb.ha*Wa);for(Lb=0;Lb<Vb.length;Lb++){var ac=Wb[Lb],cc=ac*Ic,dc=Lb*zc*Kb;if(-1!=ac)for(var qc=0;qc<zc;qc++)for(var Nc=qc*Kb,fb=0;fb<Sc.length;fb++)Sc[fb]&&(mb.U[zb][dc+Nc+(db[vb].Hn+
I.lm(lc,fb))]=jc[cc+I.lm($b,fb)])}}else mb.U[zb]=new Float32Array(0)}}fa=mb;p.push({H:va,Hd:fa,Qc:[ba.name],g:w,Bd:[a]})}}}return p}function P(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=xa.Zu(b));return c=c&&g(a,b)}function S(a,b){for(var c=null,d=null,f=0;f<a.Y.length;f++){var e=a.Y[f].kd;e&&(c||(c={}),c[f]=e,a.Y[f].kd=null);if(e=a.Y[f].la)d||(d={}),d[f]=e,a.Y[f].la=null}a.id=0;a.WH=b;a.id=I.Ru(a,b);if(c)for(var g in c)a.Y[g].kd=c[g];if(d)for(g in d)a.Y[g].la=d[g]}function Z(a){var b=a.Rd;a.Rd=null;
var c=I.Ru(a,0);a.Rd=b;return c}function M(a,b,c,d,f){var g=e("WIREFRAME");U(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.Qh=!0;g.wa=!0;g.Vj=c;f&&(g.sv=!0);O(g,b);b=Z(b);S(g,b);d?(d=f?a.J:[0,0,0],b=L.ir(1,d),c=[W.length(a.Ke),W.length(a.Le),W.length(a.Me)],ca.ny(b,c,d),f||(sa.set_trans(a.J,Ha),sa.set_quat(a.quat,Ha),sa.set_scale(1,Ha),ca.lt(b,Ha))):b=L.ir(a.Wa,a.J);ca.gp(b,1,!0);b.U.a_polyindex=ca.$q(b);Q(g,b);return g}function U(a,b,c){a.Fb.Gk=b;a.Fb.oj=c;X.oI(a.Fb)}function ea(a,
b,c){1==a.Y.length&&0==a.nc.length&&a.nc.push("default0");c=c||"default"+String(a.Y.length);-1==a.nc.indexOf(c)&&(a.Y.push(b),a.nc.push(c));a.$b&&Ca.Cu(a)}function Y(a){if(!a.Fb)throw"No shaders info for batch "+a.name;a.$b=X.yF(a.Fb);Ca.oC(a.$b);Ca.Vp(a);Ca.Cu(a)}function ka(a,b,c){a=a.u[0].P;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].Ue&&-1!=a[d].Cc.indexOf(b))return a[d];return null}function ga(a,b,c){a=a.u[0].P;for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].Ue&&-1!=a[d].Cc.indexOf(b))return a[d];
return null}function ma(a,b){a.vc.set(b.vc);a.Dg=b.Dg;a.ff.set(b.ff);a.Hi=b.Hi;a.Yc.set(b.Yc);a.Df=b.Df;a.pf=b.pf;a.Cg=b.Cg;a.vg=b.vg;a.reflect_factor=b.reflect_factor;a.se.set(b.se);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Ik=b.Ik}function ba(a,b){for(var c=a.Sj,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+
1];return null}function x(a,b){for(var c=a.Rj,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}var fa=p("__boundings"),aa=p("__config"),ha=p("__print"),Aa=p("__extensions"),ca=p("__geometry"),R=p("__graph"),xa=p("__nodemat"),la=p("__obj_util"),da=p("__particles"),L=p("__primitives"),V=p("__quat"),oa=p("__reformer"),Ca=p("__renderer"),ya=p("__scenegraph"),X=p("__shaders"),pa=p("__textures"),sa=p("__tsr"),I=p("__util"),qa=p("__animation"),W=p("__vec3"),ua=p("__vec4"),ja=aa.q,Da=["MAIN"],ia=
new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);new Float32Array(3);var ta=new Float32Array(4),Ha=sa.create(),Ia=new Float32Array(24);a.$K=va;var va="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" ");a.UM=e;a.lF=function(a,c,d,f){for(var e=[],g=[],h=0;h<c.length;h++){var l=c[h],n=l.qa;n.Ql||(la.oa(n)?e.push(l):g.push(l))}for(var h=[],h=h.concat(m(e,a.k.jb)),n=h=h.concat(k(g,a.k.jb,a.b4w_batch_grid_size)),e=[],g=[],q={},h=0;h<n.length;h++){var r=n[h].H,p=n[h].g,
t=null;if(r.id in q){for(var u=q[r.id],x=g[u].H,F=g[u].g,w=null,da=null,l=0;l<r.Y.length;l++){var y=r.Y[l].kd;y&&(w||(w={}),w[l]=y,r.Y[l].kd=null);if(y=r.Y[l].la)da||(da={}),da[l]=y,r.Y[l].la=null}I.Qy(r,x)&&I.Qy(p,F)&&(t=g[u]);if(w)for(l in w)r.Y[l].kd=w[l];if(da)for(l in da)r.Y[l].la=da[l];if(!t){do r.id++;while(q[r.id])}}t||(t={H:r,g:n[h].g,Bd:[],mt:[],Qc:[]},q[r.id]=g.length,g.push(t));t.Bd=t.Bd.concat(n[h].Bd);n[h].Hd&&n[h].Hd.ha&&t.mt.push(n[h].Hd);if(t.Qc.length)for(l=0;l<n[h].Qc.length;l++)r=
n[h].Qc[l],-1==t.Qc.indexOf(r)&&t.Qc.push(r);else t.Qc=n[h].Qc;ca.Fy(t.Qc,t.mt,ca.uB,!1)}for(h=0;h<g.length;h++){n=g[h].mt;if(0==n.length)l=I.Vb(I.Ck("%empty"));else if(1==n.length)l=n[0];else{q=[];for(l=0;l<n.length;l++)ca.oG(n[l])||q.push(l);if(q.length<n.length)for(l=0;l<q.length;l++)ca.gp(n[q[l]]);l=ca.uJ(n)}e.push({H:g[h].H,g:g[h].g,Hd:l,Qc:g[h].Qc,Bd:g[h].Bd})}for(g=0;g<e.length;g++)if(n=e[g].H,n.Cc=e[g].Qc,Q(n,e[g].Hd),T(n,d,a),"STATIC"==e[g].g.type&&"COLOR_ID"!=n.type){h=I.Ck("%meta%"+n.type+
"%"+n.Cc.join("%")+"%");q=la.dj(h,"MESH");q.g=I.za(e[g].g);la.Xi(q,a);la.dn(q,a,n);f.push(q);t=[];for(l=0;l<e[g].Bd.length;l++){h=e[g].Bd[l];h=h.qa;fa.Hv(h.g.wb,Ia);for(r=0;r<Ia.length;r++)t.push(Ia[r]);"MAIN"==n.type&&h.mx.push(q)}q.g.sf=fa.qD(t);fa.RJ(q.g)}else for(q=[],l=0;l<e[g].Bd.length;l++)h=e[g].Bd[l],h=h.qa,-1==q.indexOf(h.name)&&(la.dn(h,a,n),q.push(h.name));if(ja.wireframe_debug){for(g=0;g<e.length;g++)if(d=e[g].g,"DYNAMIC"==d.type&&(h=e[g].Bd[0].qa,-1<Da.indexOf(e[g].H.type))){l=la.R(h,
a);n=l.P;q=!1;for(l=0;l<n.length;l++)n[l].Qh&&(q=!0);q||(d=M(d.Ne,d,h.name,!0,!0),la.dn(h,a,d))}for(g=0;g<f.length;g++)h=f[g],d=h.g,l=la.R(h,a),n=l.P,-1<Da.indexOf(n[0].type)&&(d=M(d.Ne,d,h.name,!0,!1),la.dn(h,a,d))}for(g=0;g<c.length;g++)for(l=la.R(c[g].qa,a),n=l.P,l=0;l<n.length;l++)b(n[l]);for(g=0;g<f.length;g++)for(l=la.R(f[g],a),n=l.P,l=0;l<n.length;l++)b(n[l])};a.nF=function(a,c){var d=a.k.Rt,f=e("MAIN");U(f,"special_skydome.glslv","special_skydome.glslf");if(c.procedural_skydome)t(f,"PROCEDURAL_SKYDOME",
1),f.Vx=!0;else{var g=d.at;if(g){t(f,"WO_SKYTEX",1);var h=n(d.Dy,null);ea(f,h,"u_sky");g.invert&&t(f,"MTEX_NEGATIVE",1);g.DK&&t(f,"MTEX_RGBTOINT",1);t(f,"BLENDTYPE",g.vC);g.zK&&t(f,"WOMAP_BLEND",1);g.AK&&t(f,"WOMAP_HORIZ",1);g.CK&&t(f,"WOMAP_ZENUP",1);g.BK&&t(f,"WOMAP_ZENDOWN",1)}d.EK&&t(f,"WO_SKYBLEND",1);d.FK&&t(f,"WO_SKYPAPER",1);d.GK&&t(f,"WO_SKYREAL",1)}c.Fc&&(f.Fc=!0,c.wc&&(f.wc=!0));f.qi=99999;w(f,"a_position");d=L.hF();Q(f,d);b(f);d=I.Ck("%meta_sky%");d=la.dj(d,"MESH");la.Xi(d,a);g=la.R(d,
a);d.g=la.Oh("STATIC");d.g.Th=!0;d.g.dc=fa.cd();d.g.Sd=fa.Si();d.g.wb=fa.cd();d.g.ec=fa.Si();g.P.push(f);return d};a.nv=function(a,b,d){d=la.R(a,d).P;var f=[];ya.Eb(b,"SHADOW_CAST");var e=ya.Eb(b,"MAIN_PLANE_REFLECT"),g=ya.Eb(b,"MAIN_CUBE_REFLECT"),h=ya.Eb(b,"OUTLINE_MASK");b=ya.Eb(b,"COLOR_PICKING");for(var k=0;k<d.length;k++){var l=d[k],n=null;"SHADOW"==l.type&&"RECEIVE"==l.hb&&l.Fd&&(n=c(l),n.hb="CAST");"MAIN"!=l.type&&"PARTICLES"!=l.type||!e&&!g||!l.Fc||(n=c(l),n.hb="REFLECT",n.xa=l.xa);"COLOR_ID"==
l.type&&l.pq&&h&&a.g.Kb&&(b&&a.g.Yg?(n=c(l),n.hb="OUTLINE"):l.hb="OUTLINE");n&&(n.Ue=!0,S(n,a.g.id),f.push(n))}d.push.apply(d,f)};a.DI=h;a.UK=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";if(0==b)return 0;a=b*Math.tan(I.deg_to_rad(a));return.5*(Math.sqrt(2*Math.sqrt(4*a+1)+2)/2-1)/b};a.rC=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.uF=n;a.$B=C;a.PJ=D;a.OJ=T;a.zI=K;a.Bu=function(a,b){t(a,"CSM_SECTION0",
0);t(a,"CSM_SECTION1",0);t(a,"CSM_SECTION2",0);t(a,"CSM_SECTION3",0);t(a,"NUM_CAST_LAMPS",0);if(b){t(a,"NUM_CAST_LAMPS",b.ue.length);ja.ro&&t(a,"MAC_OS_SHADOW_HACK",1);for(var c=0;c<b.csm_num;c++)t(a,"CSM_SECTION"+String(c),1);t(a,"SHADOW_TEX_RES",X.r(b.csm_resolution));t(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);t(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else t(a,"SHADOW_TEX_RES",0),t(a,"CSM_FADE_LAST_CASCADE",0),t(a,"CSM_BLEND_BETWEEN_CASCADES",0)};a.ya=t;a.hc=function(a,
b){return X.CF(a.Fb,b)};a.MJ=Q;a.NJ=S;a.GC=Z;a.YL=M;a.Yi=ea;a.aI=function(a,b,c){c=a.nc.indexOf(c);-1<c&&(a.Y[c]=b)};a.MD=function(a,b){var c=e("MAIN");c.Ga=!0;ua.set(b[0],b[1],b[2],.5,c.vc);c.Cf=ca.Rm;Q(c,a);U(c,"main.glslv","main_stack.glslf");t(c,"SHADELESS",1);Y(c);return c};a.Rb=Y;a.kF=function(a,c){for(var d=0;d<c.length;d++){var f=c[d].qa,g=e("LINE");U(g,"line.glslv","line.glslf");g.Ga=!0;var h=L.jF();Q(g,h);b(g);la.Xi(f,a);la.R(f,a).P.push(g);Y(g)}};a.PC=function(a){return a.$b.bm.length?
a.$b.ts.u_cube_fog?!0:!1:!1};a.uD=function(){var a=e("DEPTH_PACK");a.pb=!0;a.wa=!1;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");Y(a);return a};a.Dq=function(a){var b=e("POSTPROCESSING");U(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":t(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":t(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":t(b,"POST_EFFECT","POST_EFFECT_X_BLUR");
break;case "Y_BLUR":t(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":t(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":t(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":t(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":t(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;case "FLIP_CUBEMAP_COORDS":t(b,"POST_EFFECT","FLIP_CUBEMAP_COORDS");break;default:throw"Wrong postprocessing effect: "+a;}b.pb=!0;b.wa=!1;a=L.Pb();Q(b,a);Y(b);return b};
a.PD=function(a){var b=e("SSAO");b.wa=!1;b.pb=!0;var c=L.Pb();Q(b,c);U(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");t(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Ly);t(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:pa.Wv("SSAO_TEXTURE",a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,
0])};a=n(a,c);ea(b,a,"u_ssao_special_tex");Y(b);return b};a.QD=function(a){var b=e("SSAO_BLUR");b.wa=!1;b.pb=!0;var c=L.Pb();Q(b,c);U(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");t(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);Y(b);return b};a.vD=function(){var a=e("DOF");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");t(a,"DEPTH_RGBA",1);Y(a);return a};a.ED=function(){var a=e("OUTLINE");a.wa=!1;a.pb=!0;var b=L.Pb();
Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");Y(a);return a};a.xD=function(){var a=e("GLOW_COMBINE");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");Y(a);return a};a.yD=function(a,b,c){var d=e("GOD_RAYS");d.wa=!1;d.pb=!0;var f=L.cF();Q(d,f);U(d,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");t(d,"DEPTH_RGBA",a?1:0);t(d,"WATER_EFFECTS",b?1:0);t(d,"STEPS_PER_PASS",X.r(c,1));Y(d);return d};
a.zD=function(){var a=e("GOD_RAYS_COM");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");t(a,"SAFARI_CANVAS_ALPHA_HACK",ja.my?1:0);Y(a);return a};a.HD=function(){var a=e("SKY");a.wa=!1;a.pb=!0;var b=L.dF();Q(a,b);U(a,"procedural_skydome.glslv","procedural_skydome.glslf");t(a,"WATER_EFFECTS",1);Y(a);return a};a.mD=function(a){var b=e("ANTIALIASING");b.wa=!1;b.pb=!0;var c=L.Pb();Q(b,c);U(b,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");
ja.Yx?(t(b,"AA_METHOD","AA_METHOD_FXAA_QUALITY"),t(b,"AA_QUALITY",a.bF)):t(b,"AA_METHOD","AA_METHOD_FXAA_LIGHT");Y(b);return b};a.ND=function(a){var b=e("SMAA"),c=L.Pb();Q(b,c);U(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");t(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");t(b,"SMAA_PASS",a);t(b,"SMAA_PREDICATION",0);t(b,"SMAA_REPROJECTION",0);Y(b);b.wa=!1;b.pb=!0;return b};a.sD=function(){var a=e("COMPOSITING");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");
Y(a);return a};a.DD=function(){var a=e("MOTION_BLUR");a.pb=!0;a.wa=!1;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");Y(a);return a};a.RD=function(a){var b=e("STEREO");b.pb=!0;b.wa=!1;var c=L.Pb();Q(b,c);U(b,"postprocessing/postprocessing.glslv","postprocessing/stereo.glslf");t(b,"ANAGLYPH","ANAGLYPH"===a?1:0);t(b,"DISABLE_DISTORTION_CORRECTION",0);Y(b);return b};a.AD=function(){var a=e("LUMINANCE");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance.glslf");Y(a);return a};a.nD=function(){var a=e("LUMINANCE");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");Y(a);return a};a.BD=function(){var a=e("LUMINANCE_X_BLUR");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");Y(a);return a};a.oD=function(){var a=e("POSTPROCESSING");a.pb=!0;a.wa=!1;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv",
"postprocessing/bloom_blur.glslf");Y(a);return a};a.pD=function(){var a=e("BLOOM");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");Y(a);return a};a.VD=function(){var a=e("VELOCITY");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");Y(a);return a};a.lD=function(){var a=e("ANCHOR_VISIBILITY");a.wa=!0;a.pb=!0;a.Cf=ca.Yt;U(a,"anchors.glslv","anchors.glslf");var b=L.Uv(1);Q(a,
b);t(a,"ANCHOR_NUM",1);Y(a);a.ak=new Float32Array([0,0,0]);return a};a.FD=function(){var a=e("PERFORMANCE");a.wa=!1;a.pb=!0;var b=L.Pb();Q(a,b);U(a,"postprocessing/postprocessing.glslv","postprocessing/performance.glslf");t(a,"POST_EFFECT","POST_EFFECT_X_BLUR");Y(a);return a};a.LJ=function(a,b){var c=b.length/3;if(c!=a.ak.length/3){var d=L.Uv(c);Q(a,d);t(a,"ANCHOR_NUM",c);Y(a)}a.ak=b};a.or=function(a){if(!a.u.length)return null;a=a.u[0];return a.P.length?a.P[0]:null};a.Ja=ka;a.sd=ga;a.xN=ma;a.PL=
function(a,b){for(var c=a.u[0].P,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.fD=function(a){for(var b=a.Y,c=0;c<b.length;c++)pa.hE(b[c].Ra);ca.dv(a.X)};a.inherit_material=function(a,b,c,d){for(var f=["MAIN","SHADOW","COLOR_ID"],e=!1,g=0;g<f.length;g++){var h=f[g],k=ka(a,b,h),l=ka(c,d,h);if(k&&l){var e=!0,n=ga(c,d,h);"MAIN"==h&&(ma(l,k),n&&ma(n,k));for(h=0;h<l.nc.length;h++){var m=l.nc[h];if(-1!==va.indexOf(m)){var q=k.nc.indexOf(m);-1!==q&&(l.Y[h]=k.Y[q],n&&(m=n.nc.indexOf(m),-1!==m&&
(n.Y[m]=k.Y[q])))}}}}e||ha.error("Wrong objects for inheriting material!")};a.set_nodemat_value=function(a,b,c){var d=b[0],f=ka(a,d,"MAIN");if(null===f)ha.error('Material "'+d+'" was not found in the object "'+a.name+'".');else if(b=b.join("%join%"),f=ba(f,b),null!==f)for(b=0;b<a.u.length;b++)for(var e=a.u[b].P,g=0;g<e.length;g++){var h=e[g];-1!=h.Cc.indexOf(d)&&h.oi&&(h.oi[f]=c)}else ha.error('Value node "'+b+'" was not found in the object "'+a.name+'".')};a.set_nodemat_rgb=function(a,b,c,d,f){var e=
b[0],g=b.join("%join%");b=x(ka(a,e,"MAIN"),g);if(null!=b)for(g=0;g<a.u.length;g++)for(var h=a.u[g].P,k=0;k<h.length;k++){var l=h[k];-1!=l.Cc.indexOf(e)&&l.xd&&(l.xd[3*b]=c,l.xd[3*b+1]=d,l.xd[3*b+2]=f)}else ha.error('RGB node "'+g+'" was not found in the object "'+a.name+'".')};a.get_nodemat_value=function(a,b){var c=b.join("%join%"),d=ka(a,b[0],"MAIN"),f=ba(d,c);if(null!=f)return d.oi[f];ha.error('Value node "'+c+'" was not found in the object "'+a.name+'".');return null};a.get_nodemat_rgb=function(a,
b,c){var d=b.join("%join%");b=ka(a,b[0],"MAIN");var f=x(b,d);if(null!=f)return c[0]=b.xd[3*f],c[1]=b.xd[3*f+1],c[2]=b.xd[3*f+2],c;ha.error('RGB node "'+d+'" was not found in the object "'+a.name+'".');return null}};b4w.module.__nodemat=function(a,p){function e(a,c,g,m,p){var t=oa.get_active(),t=k(c,p,t.uuid);if(t in pa)return pa[t];if("SHADOW"!=p&&"COLOR_ID"!=p){c=R.create();for(var u=a.nodes,x=0;x<u.length;x++)if(null==C(c,u[x],0,m,p))return pa[t]=null;if(g&&-1==F(a,c,"GROUP_OUTPUT","group"))return null;x=ma(c);u=g?a.links:a.links.slice();if(!ba(c,u,x))return null;if(g)return c;for(x=0;x<u.length;x++){g=u[x];for(var w=l(g.from_node,c),da=l(g.to_node,c),L=0;L<w.length;L++)for(var D=0;D<da.length;D++){var v=
w[L],N=da[D],V=R.Ka(c,v),B=R.Ka(c,N);if(!ka(c,v,N,V,B,g))return pa[t]=null}}f(c);a="GLOW"==p?F(a,c,"B4W_GLOW_OUTPUT","material",!0):F(a,c,"OUTPUT","material",!1,!0);-1==a&&(c=h(),a=0);n(c);a=R.fp(c,a,R.Mm);b(a,m);q(a);A(a);d(a);y(a,m,p)}else m=e(a,c,g,m,"MAIN"),m=R.clone(m,function(a){var b=Ca.bl(a);b.K=Ca.za(a.K);b.Da=Ca.za(a.Da);return b}),a=F(a,m,"OUTPUT","material",!1,!0),r(m,a),a=R.fp(m,a,R.Mm),q(a);return pa[t]=a}function b(a,b){var d=[];R.ea(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=
b.type||d.push({sH:a,node:b})});for(var f=0;f<d.length;++f){var e=d[f].sH,g=d[f].node,h=R.Gl(a);R.Wi(a,h,g.data.ZG);var k=R.Gl(a);R.Wi(a,k,g.data.$G);R.rc(a,h,k,[4,2]);for(var l={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},n=R.$n(a,e),m=[],q=[],r=[],p={},t=0;t<n;t++){var u=R.vj(a,e,t);u in p||(p[u]=0);var x=R.Jf(a,u,e,p[u]++);m.push([u,e,x]);var F=l[x[1]];if(F)switch(F[0]){case "MATERIAL_END":q.push([u,k,[x[0],F[1]]]);break;case "LIGHTING_APPLY":r.push([u,
[x[0],F[1]]])}else q.push([u,h,x])}c(a,g.data.value,h,k,r,b);for(t=0;t<m.length;t++)R.To(a,m[t][0],m[t][1],m[t][2]);for(t=0;t<q.length;t++)R.rc(a,q[t][0],q[t][1],q[t][2]);g=R.Rg(a,e);h=[];l=[];n={};for(t=0;t<g;t++)m=R.Fg(a,e,t),m in n||(n[m]=0),x=R.Jf(a,e,m,n[m]++),h.push([e,m,x]),l.push([k,m,x]);for(t=0;t<h.length;t++)R.To(a,h[t][0],h[t][1],h[t][2]);for(t=0;t<l.length;t++)R.rc(a,l[t][0],l[t][1],l[t][2]);R.df(a,e)}}function c(a,b,c,d,f,e){var g={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},h=
C(a,g,0,e,null),k=h;m(a,c,h,"E");m(a,c,h,"A");m(a,c,h,"D");h=oa.get_active();h=da.Pa(h,"LAMP",da.DATA_ID_ALL);if(!b.Ld)for(var l,n,q=0;q<h.length;q++){var r=h[q].Qa,g={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};l=C(a,g,0,e,null);g={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};n=C(a,g,0,e,null);m(a,k,n,"color");m(a,k,n,"specular");m(a,l,n,"ldir");m(a,c,n,"normal");m(a,c,n,"D");m(a,c,n,"S");m(a,l,n,"lcolorint");m(a,c,l,"shadow_factor");k="COOKTORR"==b.lk?"SPECULAR_PHONG":"SPECULAR_"+b.lk;g={name:k,
type:k};g=C(a,g,0,e,null);m(a,l,g,"ldir");m(a,l,g,"lfac");m(a,c,g,"normal");m(a,g,n,"sfactor");"SPECULAR_PHONG"!=k&&"SPECULAR_BLINN"!=k||m(a,l,g,"norm_fac");m(a,c,g,"sp_params");k="HEMI"==r.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.rl;g={name:k,type:k};g=C(a,g,0,e,null);m(a,l,g,"ldir");m(a,l,g,"lfac");m(a,c,g,"normal");m(a,l,g,"norm_fac");m(a,g,n,"lfactor");"DIFFUSE_LAMBERT"!=k&&m(a,c,g,"dif_params");for(l=0;l<f.length;l++)R.rc(a,f[l][0],n,f[l][1]);k=n}m(a,k,d,"color");m(a,k,d,"specular")}function m(a,
b,c,d){for(var f=R.Ka(a,b),e=R.Ka(a,c),g,h=0;h<e.K.length;h++)if(d==e.K[h].identifier){g=h;break}for(var k,h=0;h<f.Da.length;h++)if(d==f.Da[h].identifier){k=h;break}void 0!=g&&void 0!=k&&R.rc(a,b,c,[k,g])}function k(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "SHADOW":return a+c+"00";default:return a+c+"10"}}function r(a,b){R.Ce(a,function(c,d,f){var e=R.Ka(a,d);d==b&&"Color"==e.K[f[1]].identifier&&R.To(a,c,d,f)})}function h(){var a=R.create(),b={data:null,Na:[],s:[],K:[{Ta:new Float32Array([0,
0,0]),identifier:"Color",Yb:!1,name:"Color"},{Ta:1,identifier:"Alpha",Yb:!1,name:"Alpha"}],Da:[],type:"OUTPUT",ph:[]};R.Wi(a,0,b);return a}function q(a){R.ea(a,function(b,c){for(var d=c.K,f=c.Da,e=0;e<d.length;e++)g(a,d[e],b,e,1);for(e=0;e<f.length;e++)g(a,f[e],b,e,0)})}function g(a,b,c,d,f){if(b.Yb){var e=!0;R.Ce(a,function(a,b,g){if(!f&&a==c&&g[0]==d||f&&b==c&&g[1]==d)e=!1});e&&(b.Yb=!1)}}function y(a,b,c){var d=[];R.Ce(a,function(f,e,g){var h=R.Ka(a,f),k=R.Ka(a,e),h=Ca.is_vector(h.Da[g[0]].Ta),
k=Ca.is_vector(k.K[g[1]].Ta);if(h!=k){var l,n={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},m={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};h&&!k?l=J("vector_to_scalar","B4W_VECTOSCAL",[n],[m]):!h&&k&&(l=J("scalar_to_vector","B4W_SCALTOVEC",[m],[n]));C(a,l,0,b,c);d.push([f,e,a.D[a.D.length-2],g])}});for(var f=0;f<d.length;++f)R.To(a,d[f][0],d[f][1],d[f][3]),R.rc(a,d[f][0],d[f][2],[d[f][3][0],0]),R.rc(a,d[f][2],d[f][1],[0,d[f][3][1]])}function f(a){var b=[];
R.ea(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":R.Ce(a,function(a,f,e){a==c&&"Translucency"==d.Da[e[0]].name&&b.push(a,f,[e[0]+1,e[1]+1])})}});for(var c=0;c<b.length;c+=3)R.rc(a,b[c],b[c+1],b[c+2])}function l(a,b){var c=[];R.ea(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function n(a){var b=[];R.ea(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],f=b[c+1];if("B4W_PARALLAX"==f.type){var e=
u(a,d);if(-1!=e){var g=R.vj(a,e,0);R.Ai(a,e,d,-1);-1!=g&&R.Ai(a,g,e,-1);d=R.Ka(a,e);f.data=d.data;f.s[0]=d.s[0];R.df(a,e)}f.K.splice(1,1)}else if("REROUTE"==f.type){for(var f=R.vj(a,d,0),h=R.Rg(a,d),e=[],g=[],k=[],l=0;l<h;l++){var n=R.Fg(a,d,l),m=g.indexOf(n);-1!=m?k[m]+=1:(g.push(n),k.push(1),e.push(d,n))}if(-1!=f)for(h=R.Jf(a,f,d,0)[0],l=0;l<g.length;l++)for(n=0;n<k[l];n++)m=R.Jf(a,d,g[l],n)[1],R.rc(a,f,g[l],[h,m]);for(l=0;l<e.length;l+=2)R.Ai(a,e[l],e[l+1],-1)}}}function u(a,b){for(var c=a.ka,
d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function A(a){H(a);E(a);B(a)}function B(a){var b=[],c="",d="",f={};R.ea(a,function(a,e){if("GEOMETRY_UV"==e.type||"UVMAP"==e.type||"TEX_COORD_UV"==e.type){b.push(a,e);var g=e.data.value;c?c==g||d||(d=g,f[d]=0):(c=g,f[c]=0);f[g]++}});for(var e in f)if(2>f[e]){for(var g=0;g<b.length;g+=2)b[g+1].data.value==e&&b.splice(g,2);delete f[e];c==e&&(c=d,d="");d==e&&(d="")}if(!(3>b.length)){var g={default_value:[0,0,0],identifier:"UV_geom",
is_linked:!1,name:"UV_geom"},h={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"};e=J("merged_uv","UV_MERGED",[],[g,h]);e.uv_layer=c;C(a,e,0,"",void 0);var k=a.D[a.D.length-2];e=a.D[a.D.length-1];if(d){h=J("merged_uv","UV_MERGED",[],[g,h]);h.uv_layer=d;C(a,h,0,"",void 0);var l=a.D[a.D.length-2],h=a.D[a.D.length-1]}else h=null;for(var n=-1,m=null,g=0;g<b.length;g+=2){var q=b[g],r=b[g+1];G(r,b[1])?(n=k,m=e):h&&(n=l,m=h);for(var p=[],t=R.Rg(a,q),u={},x=0;x<t;x++){var F=R.Fg(a,
q,x);F in u||(u[F]=0);var w=R.Jf(a,q,F,u[F]++);p.push(q,F,w);w=w.splice(0,w.length);switch(r.type){case "GEOMETRY_UV":w[0]=0;m.Da[0].Yb=!0;break;case "UVMAP":case "TEX_COORD_UV":w[0]=1,m.Da[1].Yb=!0}R.rc(a,n,F,w)}for(var x=0;x<p.length;x+=3)R.Ai(a,p[x],p[x+1],0);R.df(a,q)}}}function H(a){var b=[];R.ea(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=
[],d=0;d<b.length;d+=2){for(var f=b[d],e=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(z(e,k.jd)){g=[];h=R.Rg(a,f);for(m=0;m<h;m++){var l=R.Fg(a,f,m),n=R.Jf(a,f,l,0);g.push(f,l,n);R.rc(a,k.id,l,n)}for(var m=0;m<g.length;m+=3)R.Ai(a,g[m],g[m+1],0);R.df(a,f);g=!1;break}}g&&(k={id:f,jd:e},c.push(k))}}function v(a){for(var b={},c=0;c<a.D.length;c+=2)b[a.D[c]]=[];for(c=0;c<a.ka.length;c+=3){for(var d=a.ka[c],f=a.ka[c+1],e=b[f],g=d,h=0;h<=e.length;h++){if(h>=e.length||e[h]>g)e.splice(h,0,g);else if(e[h]!=
g)continue;break}for(var f=b[f],d=b[d],g=e=0,h=f.length+d.length,k=[],l=0;l<h;l++)e>f.length||f[e]>d[g]?k.push(d[g++]):k.push(f[e++])}return b}function E(a){var b=[];R.ea(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=v(a),d=[],f=0;f<b.length;f+=2){for(var e=b[f],g=b[f+1],h=!0,k=0;k<d.length;k++){var l=d[k];if(!(3<=l.Kj.length||!z(g,l.jd)||-1<c[e].indexOf(l.id)||-1<c[l.id].indexOf(e))){for(var n=!1,m=0;m<l.Kj.length;m++){var q=l.Kj[m].id;if(-1<
c[e].indexOf(q)||-1<c[q].indexOf(e)){n=!0;break}}if(!n){for(var k=[],q=R.$n(a,e),r={},m=0;m<q;m++)n=R.vj(a,e,m),n in r||(r[n]=0),h=R.Jf(a,n,e,r[n]++),k.push(n,e,h);for(var q=[],r=R.Rg(a,e),p={},m=0;m<r;m++)n=R.Fg(a,e,m),n in p||(p[n]=0),h=R.Jf(a,e,n,p[n]++),q.push(e,n,h);h=k.concat(q);for(m=0;m<h.length;m+=3)R.Ai(a,h[m],h[m+1],0);R.df(a,e);m={id:e,jd:g,tE:k,uE:q};l.Kj.push(m);h=!1;break}}}h&&(l={id:e,jd:g,Kj:[]},d.push(l))}for(f=0;f<d.length;f++){l=d[f];c=l.Kj.length;for(k=0;k<c;k++){g=l.Kj[k];m=
g.jd;e=g.tE;g=g.uE;l.jd.K[k+1].Yb=m.K[0].Yb;l.jd.K[k+1].Ta=m.K[0].Ta;l.jd.Da[2*(k+1)].Yb=m.Da[0].Yb;l.jd.Da[2*(k+1)].Ta=m.Da[0].Ta;l.jd.Da[2*(k+1)+1].Yb=m.Da[1].Yb;l.jd.Da[2*(k+1)+1].Ta=m.Da[1].Ta;for(m=0;m<e.length;m+=3)n=e[m],h=e[m+2],h[1]+=k+1,R.rc(a,n,l.id,h);for(m=0;m<g.length;m+=3)n=g[m+1],h=g[m+2],h[0]+=2*(k+1),R.rc(a,l.id,n,h);l.jd.Na.push(["USE_uv"+(k+2),1])}R.df(a,l.id);R.Wi(a,l.id,l.jd)}}}function z(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==
b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value.uuid==b.data.value.uuid;default:return!1}}function G(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function d(a){var b=[];R.ea(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=
b[c],f=b[c+1],e=!1,g=[],h=[],k=[[],[],[]],l=R.Rg(a,d),n=0;n<l;n++){var m=R.Fg(a,d,n);if("SEPRGB"!=R.Ka(a,m).type){e=!1;break}g.push(d,m);for(var q={},r=R.Rg(a,m),e=0;e<r;e++){var p=R.Fg(a,m,e);p in q||(q[p]=0);var t=R.Jf(a,m,p,q[p]++);g.push(m,p);k[t[0]].push(d,p,t)}h.push(m);e=!0}if(e){for(n=d=l=0;n<k.length;n++)k[n].length&&(l++,d|=1<<2-n);if(l){f.type+=l;f.Da=[];for(n=0;n<k.length;n++)if(k[n].length)for(f.Da.push({Ta:0,identifier:"RGB"[n],Yb:!0,name:"RGB"[n]}),e=0;e<k[n].length;e+=3)k[n][e+2][0]=
Ca.lm(d,n);for(n=0;n<g.length;n+=2)R.Ai(a,g[n],g[n+1],0);for(n=0;n<h.length;n++)R.df(a,h[n]);for(n=0;n<k.length;n++)for(e=0;e<k[n].length;e+=3)R.rc(a,k[n][e],k[n][e+1],k[n][e+2])}}}}function F(a,b,c,d,f,e){a=a.nodes;for(var g=null,h=0;h<a.length;h++){var k=a[h];f?"GROUP"==k.type&&k.node_tree_name==c&&(g=k):k.type==c&&(g=k)}return g?l(g,b)[0]:(e||L.error('No "'+c+'" node in node '+d),-1)}function J(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function C(a,b,c,d,f){var e=b.name,g=b.type,h=[],k=
[],l=[],n=[],m=null,q=[];switch(g){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":k=
U(b);l=ea(b);L.warn(g+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":k=U(b);l=ea(b);break;case "UVMAP":var r=b.uv_layer;r||(g="EMPTY_UV");if("EMPTY_UV"!=g){var m=K("param_"+g+"_a"),p=K("param_"+g+"_v");h.push(Y(m));h.push(Y(p));n.push(Y(p));m={name:m,value:r}}l=ea(b);break;case "UV_MERGED":m=K("param_UV_MERGED_a");p=K("param_UV_MERGED_v");h.push(Y(m));h.push(Y(p));l.push(S(b,"UV_geom"));l.push(S(b,"UV_cycles"));n.push(Y(p));m={name:m,value:b.uv_layer};
break;case "CAMERA":k=[];l=ea(b);break;case "COMBRGB":case "COMBHSV":k=U(b);l=ea(b);break;case "CURVE_RGB":case "CURVE_VEC":k=U(b);l=ea(b);m={value:b};break;case "PARTICLE_INFO":k=U(b);l=ea(b);for(p=0;p<b.outputs.length;p++){var u=b.outputs[p],x=u.identifier,F=Y("v_param_PART_INFO_"+x.replace(" ",""));if(u.is_linked)switch(x){case "Size":q.push(["PART_INFO_SIZE",V.r(1)]);break;case "Age":q.push(["PART_INFO_AGE",V.r(1)]);break;case "Lifetime":q.push(["PART_INFO_LT",V.r(1)]);break;case "Location":q.push(["PART_INFO_LOC",
V.r(1)]);break;case "Index":m=r=Y("a_param_PART_INFO_"+u.identifier.replace(" ",""));q.push(["PART_INFO_IND",V.r(1)]);break;case "Velocity":q.push(["PART_INFO_VEL",V.r(1)]);break;case "Angular Velocity":q.push(["PART_INFO_A_VEL",V.r(1)])}"Age"!=x&&"Lifetime"!=x&&"Size"!=x&&(h.push(F),n.push(F))}r&&h.push(r);break;case "GEOMETRY":if(!w(b))return!0;g=t(b,c);if(!g)return L.error("Geometry output is not supported"),null;switch(g){case "GEOMETRY_UV":(r=b.uv_layer)||(g="EMPTY_UV");"EMPTY_UV"!=g&&(m=K("param_GEOMETRY_UV_a"),
p=K("param_GEOMETRY_UV_v"),h.push(Y(m)),h.push(Y(p)),n.push(Y(p)),m={name:m,value:r});l.push(S(b,"UV"));break;case "GEOMETRY_VC":(r=b.color_layer)||(g="EMPTY_VC");"EMPTY_VC"!=g&&(m=K("param_GEOMETRY_VC_a"),p=K("param_GEOMETRY_VC_v"),h.push(Y(m)),h.push(Y(p)),n.push(Y(p)),m={name:m,value:r});l.push(S(b,"Vertex Color"));break;case "GEOMETRY_NO":l.push(S(b,"Normal"));break;case "GEOMETRY_FB":l.push(S(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(S(b,"View"));break;case "GEOMETRY_GL":l.push(S(b,"Global"));
break;case "GEOMETRY_LO":l.push(S(b,"Local"));break;case "GEOMETRY_OR":r=K("param_GEOMETRY_OR_v"),h.push(Y(r)),l.push(S(b,"Orco")),n.push(Y(r))}break;case "TEX_COORD":if(!w(b))return!0;g=Q(b,c);if(!g)return L.error("Texture coordinate output is not supported"),null;switch(g){case "TEX_COORD_UV":(r=b.uv_layer)||(g="EMPTY_UV");"EMPTY_UV"!=g&&(m=K("param_TEX_COORD_UV_a"),p=K("param_TEX_COORD_UV_v"),h.push(Y(m)),h.push(Y(p)),n.push(Y(p)),m={name:m,value:b.uv_layer});l.push(S(b,"UV"));break;case "TEX_COORD_NO":l.push(S(b,
"Normal"));break;case "TEX_COORD_GE":r=K("param_TEX_COORD_GE_v");h.push(Y(r));l.push(S(b,"Generated"));n.push(Y(r));break;case "TEX_COORD_OB":l.push(S(b,"Object"));L.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":l.push(S(b,"Camera"));break;case "TEX_COORD_WI":l.push(S(b,"Window"));L.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":l.push(S(b,"Reflection")),L.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":r=b.node_tree_name;switch(r){case "B4W_LINEAR_TO_SRGB":if(!D(b,[1],[1])){m=O(b,d,f);break}g="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!D(b,[1],[1])){m=O(b,d,f);break}g="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!D(b,[1],[1])){m=O(b,d,f);break}g="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!D(b,[1,1],[1])){m=O(b,d,f);break}g="B4W_REFLECT";break;case "B4W_REFRACTION":if(!D(b,[1,0],[1])){m=O(b,d,f);break}g="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!D(b,
[1,1,0,0,0],[1])){m=O(b,d,f);break}g="B4W_PARALLAX";p=K("temp_texture");n.push(Y(p));break;case "B4W_CLAMP":if(!D(b,[1],[1])){m=O(b,d,f);break}g="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!D(b,[0,0,0,0,0],[0])){m=O(b,d,f);break}g="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!D(b,[],[0])){m=O(b,d,f);break}g="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!D(b,[0,0,0],[0])){m=O(b,d,f);break}g="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":g="B4W_GLOW_OUTPUT";break;default:m=O(b,d,f)}k=U(b);l=ea(b);"B4W_TRANSLUCENCY"==
r&&(r=M("TranslucencyParams","TranslucencyParams",[0,0,0,0]),r.Yb=l[0].Yb,l.push(r));break;case "LAMP":m=b.lamp;if(!m)return L.error("There is no lamp in node: "+b.name),null;l.push(S(b,"Color"));l.push(S(b,"Light Vector"));l.push(S(b,"Distance"));l.push(S(b,"Visibility Factor"));m.uuid in I?q.push(["LAMP_INDEX",String(I[m.uuid])]):(I[m.uuid]=qa,q.push(["LAMP_INDEX",String(qa++)]));m=I;break;case "LIGHTING_AMBIENT":k=[M("E","E",[0,0,0],!0),M("A","A",[0,0,0],!0),M("D","D",[0,0,0],!0)];l=[M("color",
"color",[0,0,0],!0),M("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":l=[M("E","E",[0,0,0],!0),M("A","A",[0,0,0],!0),M("D","D",[0,0,0],!0),M("S","S",[0,0,0],!0),M("normal","normal",[0,0,0],!0),M("dif_params","dif_params",[0,0],!0),M("sp_params","sp_params",[0,0],!0),M("shadow_factor","shadow_factor",0,!0),M("translucency_color","translucency_color",0,!0),M("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":k=[M("color","color",[0,0,0],!0),M("specular",
"specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":k=[M("shadow_factor","shadow_factor",0,!0)];l=[M("ldir","ldir",[0,0,0],!0),M("lfac","lfac",[0,0],!0),M("lcolorint","lcolorint",[0,0,0],!0),M("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":k=[M("ldir","ldir",[0,0,0],!0),M("lfac","lfac",[0,0],!0),M("normal","normal",[0,0,0],!0),M("norm_fac","norm_fac",0,!0)];l=[M("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":k=
[M("ldir","ldir",[0,0,0],!0),M("lfac","lfac",[0,0],!0),M("normal","normal",[0,0,0],!0),M("norm_fac","norm_fac",0,!0),M("dif_params","dif_params",[0,0],!0)];l=[M("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":k=[M("ldir","ldir",[0,0,0],!0),M("lfac","lfac",[0,0],!0),M("normal","normal",[0,0,0],!0),M("norm_fac","norm_fac",0,!0),M("sp_params","sp_params",[0,0],!0)];l=[M("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":k=[M("ldir","ldir",[0,0,
0],!0),M("lfac","lfac",[0,0],!0),M("normal","normal",[0,0,0],!0),M("sp_params","sp_params",[0,0],!0)];l=[M("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":k=[M("color","color",[0,0,0,0],!0),M("specular","specular",[0,0,0],!0),M("lfactor","lfactor",0,!0),M("sfactor","sfactor",0,!0),M("ldir","ldir",[0,0,0],!0),M("normal","normal",[0,0,0],!0),M("translucency_params","translucency_params",[0,0,0,0],!0),M("D","D",[0,0,0],!0),M("S","S",[0,0,0],!0),M("lcolorint","lcolorint",[0,0,0],!0),M("translucency_color",
"translucency_color",0,!0)];l=[M("color","color",[0,0,0,0],!0),M("specular","specular",[0,0,0],!0)];break;case "NORMAL":k=U(b);l=ea(b);r=S(b,"Normal");n.push(Y(K("param_NORMAL_Normal"),r.Ta,3));break;case "MAPPING":r=b.vector_type;g="MAPPING";k.push(P(b,"Vector"));l.push(S(b,"Vector"));var p=b.rotation,u=b.scale,x=b.translation,F=xa.create(),da=Ca.AE(p);"TEXTURE"==r&&(u[0]=u[0]||1,u[1]=u[1]||1,u[2]=u[2]||1);var y=new Float32Array([u[0],0,0,0,u[1],0,0,0,u[2]]);xa.multiply(da,y,F);F=Ca.YG(F,la.create());
switch(r){case "POINT":F[12]=x[0];F[13]=x[1];F[14]=x[2];break;case "TEXTURE":F[12]=x[0];F[13]=x[1];F[14]=x[2];F=la.invert(F,F);break;case "NORMAL":la.invert(F,F),la.transpose(F,F)}switch(r){case "NORMAL":q.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":q.push(["MAPPING_TRS_MATRIX",V.r(F,16)]);break;case "POINT":0!==ya.length(p)?q.push(["MAPPING_TRS_MATRIX",V.r(F,16)]):(0!==ya.length(u)&&q.push(["MAPPING_SCALE",V.r(u,3)]),0!==ya.length(x)&&q.push(["MAPPING_TRANSLATION",V.r(x,3)]));break;case "VECTOR":0!==
ya.length(p)?q.push(["MAPPING_TRS_MATRIX",V.r(F,16)]):0!==ya.length(u)&&q.push(["MAPPING_SCALE",V.r(u,3)])}b.use_min&&q.push(["MAPPING_MIN_CLIP",V.r(b.min,3)]);b.use_max&&q.push(["MAPPING_MAX_CLIP",V.r(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":m=[];r=[];p=[];u=[M("E","E",[0,0,0],!0),M("A","A",[0,0,0],!0),M("D","D",[0,0,0],!0),M("S","S",[0,0,0],!0),M("normal","normal",[0,0,0],!0),M("dif_params","dif_params",[0,0],!0),M("sp_params","sp_params",[0,0],!0),M("shadow_factor","shadow_factor",
0,!0)];x=[M("color","color",[0,0,0],!0),M("specular","specular",[0,0,0],!0),M("normal","normal",[0,0,0],!0)];F=[S(b,"Color"),S(b,"Alpha"),S(b,"Normal")];da=[];y=P(b,"Color");y.Ta.splice(3);p.push(y);k.push(y);y=P(b,"Spec");y.Ta.splice(3);p.push(y);k.push(y);p.push(M("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));k.push(y);var v=P(b,"Normal");v.Ta.splice(3);p.push(v);k.push(v);"MATERIAL_EXT"==g?((y=P(b,"Emit"))||(y=M("Emit","Emit",0)),p.push(y),k.push(y),(y=P(b,"Translucency"))?(y.Ta=
0,y.name="Translucency",y.identifier="Translucency"):y=M("Translucency","Translucency",0),k.push(y),(y=P(b,"Translucency"))?(y.Ta=[0,0,0,0],y.name="TranslucencyParams",y.identifier="TranslucencyParams"):y=M("TranslucencyParams","TranslucencyParams",[0,0,0,0]),k.push(y),l=P(b,"Reflectivity"),y=P(b,"Ray Mirror"),l?(y=l,l="Reflectivity"):y?l="Ray Mirror":(y=l,l="Reflectivity"),y||(y=M(l,l,0)),k.push(y),x.push(y),(y=P(b,"SpecTra"))||(y=M("SpecTra","SpecTra",0)),k.push(y),x.push(y),(y=P(b,"Alpha"))||(y=
M("Alpha","Alpha",b.alpha)),k.push(y),x.push(y),F.push(S(b,"Diffuse")),F.push(S(b,"Spec")),m.push(["MATERIAL_EXT",1]),r.push(["MATERIAL_EXT",1])):(p.push(M("emit_intensity","emit_intensity",0)),x.push(M("reflect_factor","reflect_factor",0)),x.push(M("specular_alpha","specular_alpha",0)),x.push(M("alpha_in","alpha_in",0)),F.push(M("diffuse_out","diffuse_out",0)),F.push(M("spec_out","spec_out",0)),m.push(["MATERIAL_EXT",0]),r.push(["MATERIAL_EXT",0]));da.push(Y(K("param_MATERIAL_alpha"),b.alpha));da.push(Y(K("param_MATERIAL_spec_alpha"),
b.specular_alpha));l=F;v.Yb&&m.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(m.push(["USE_MATERIAL_DIFFUSE",1]),r.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);var y=[],A=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":v=b.specular_hardness;break;case "WARDISO":v=b.specular_slope;break;case "TOON":v=b.specular_toon_size;A=b.specular_toon_smooth;break;case "BLINN":v=b.specular_ior;A=b.specular_hardness;break;default:L.error("unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),v=b.specular_hardness}var B,z;switch(b.diffuse_shader){case "LAMBERT":z=B=0;break;case "OREN_NAYAR":B=b.roughness;z=0;break;case "FRESNEL":B=b.diffuse_fresnel;z=b.diffuse_fresnel_factor;break;case "MINNAERT":B=b.darkness;z=0;break;case "TOON":B=b.diffuse_toon_size;z=b.diffuse_toon_smooth;break;default:L.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),z=B=0}y.push(Y(K("param_MATERIAL_diffuse"),[B,z],2));
y.push(Y(K("param_MATERIAL_spec"),[b.specular_intensity,v,A],3));m.push(["SHADELESS_MAT",b.use_shadeless?1:0]);v={name:b.name,value:{lk:b.specular_shader,rl:b.diffuse_shader,Ld:b.use_shadeless}};m={name:b.name,value:{lk:b.specular_shader,rl:b.diffuse_shader,Ld:b.use_shadeless},ZG:{name:"material_begin",type:"MATERIAL_BEGIN",K:p,Da:u,s:y,data:v,Na:m,ph:[]},$G:{name:"material_end",type:"MATERIAL_END",K:x,Da:F,s:da,data:v,Na:r,ph:[]}};break;case "MATH":switch(b.operation){case "ADD":g="MATH_ADD";break;
case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g="MATH_ARCSINE";break;case "ARCCOSINE":g="MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g="MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g=
"MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";break;default:return L.error("Unsupported MATH operation: "+b.operation),null}q.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=U(b);l=ea(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g="MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";
break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g="MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";break;case "DODGE":g="MIX_RGB_DODGE";break;case "BURN":g="MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";
break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return L.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}q.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);k=U(b);l=ea(b);break;case "OUTPUT":k=U(b);l=[];break;case "RGB":r=d+"%join%"+b.name;r={name:"-1",value:r};n.push(r);l.push(S(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=U(b);l=ea(b);break;case "TEXTURE":g=N(b);if("TEXTURE_EMPTY"==g)l.push(S(b,"Color")),l.push(S(b,"Normal")),l.push(S(b,"Value"));else if("TEXTURE_ENVIRONMENT"==
g)k.push(P(b,"Vector")),l.push(S(b,"Color")),l.push(S(b,"Value"));else{if("TEXTURE_NORMAL"==g&&"ENVIRONMENT_MAP"==b.texture.type)return L.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),null;for(m=0;4>m;++m)m?(y=M("Vector"+m,"Vector"+m,[0,0,0]),"TEXTURE_COLOR"==g&&(p=M("Color"+m,"Color"+m,[0,0,0]),u=M("Value"+m,"Value"+m,0)),"TEXTURE_NORMAL"==g&&(p=M("Normal"+m,"Normal"+m,[0,0,0]),u=M("Value"+m,"Value"+m,0))):(y=P(b,"Vector"),"TEXTURE_COLOR"==g&&(p=S(b,"Color"),u=S(b,"Value")),"TEXTURE_NORMAL"==
g&&(p=S(b,"Normal"),u=S(b,"Value"))),k.push(y),l.push(p),l.push(u)}p=K("param_TEXTURE_texture");n.push(Y(p));m={name:p,value:b.texture};break;case "VALTORGB":k=U(b);l=ea(b);m={value:b};r=b.color_ramp.interpolation;"CONSTANT"!=r&&"LINEAR"!=r&&L.warn("Color Ramp node is not fully supported.");break;case "VALUE":g="VALUE";r=d+"%join%"+b.name;r={name:"-1",value:r};n.push(r);l.push(S(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":g="VECT_MATH_ADD";break;case "SUBTRACT":g="VECT_MATH_SUBTRACT";
break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g="VECT_MATH_NORMALIZE";break;default:return L.error("Unsupported VECT_MATH operation: "+b.operation),null}k=U(b);l=ea(b);break;default:k=U(b),l=ea(b)}g={name:e,type:g,ph:h,K:k,Da:l,s:n,data:m,Na:q};e=R.Gl(a);R.Wi(a,R.Gl(a),g);if(!(g="GEOMETRY"!=b.type&&"TEX_COORD"!=b.type)){a:{g=b.outputs;for(k=h=0;k<g.length;k++)if(g[k].is_linked&&
h++>c){g=!0;break a}g=!1}g=!g}return g||null!=C(a,b,++c,d,f)?e:null}function D(a,b,c){for(var d=a.inputs,f=a.outputs,e=a.node_tree_name,g=0;g<b.length;g++){var h=d[g],k=b[g];if(!h||h.default_value instanceof Array!=k)return L.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=f[g],d=c[g],!b||b.default_value instanceof Array!=d)return L.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),
!1;return!0}function O(a,b,c){var d=a.node_group.node_tree,f={},g;for(g in d)if("links"==g||"nodes"==g){f[g]=[];for(var h=0;h<d[g].length;h++){f[g][h]={};for(var k in d[g][h])if("links"==g){f[g][h][k]={};for(var l in d[g][h][k])f[g][h][k][l]=T(d[g][h][k][l])}else f[g][h][k]=T(d[g][h][k])}}else f[g]=T(d[g]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d)g=J("Group input","GROUP_INPUT",[],a.inputs),h=J("Group output","GROUP_OUTPUT",a.outputs,[]),k=null,k="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==
d&&(W.quality==ca.P_LOW||W.cr)?{from_node:g,from_socket:g.outputs[1],to_node:h,to_socket:h.inputs[0]}:{from_node:g,from_socket:g.outputs[0],to_node:h,to_socket:h.inputs[0]},f.nodes=[g,h],f.links=[k];d=a.name;g=f.nodes;h=f.links;for(k=0;k<g.length;k++)g[k].name=ga(g[k].type,d,g[k].name);for(k=0;k<h.length;k++)h[k].from_node.name=ga(h[k].from_node.type,d,h[k].from_node.name),h[k].to_node.name=ga(h[k].to_node.type,d,h[k].to_node.name);return{qH:e(f,a.node_group.uuid,!0,b,c),rH:f.links}}function T(a){var b=
typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?Ca.bl(a):a}function K(a){X[a]||(X[a]=0);var b=a+"_"+X[a],b=b.replace(/ /g,"_").replace(/\//g,"_");X[a]++;return b}function w(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function t(a,b){for(var c=a.outputs,d=0,f=0;f<c.length;f++){var e=c[f];if(e.is_linked&&!(d++<b))switch(e.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";
case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function Q(a,b){for(var c=a.outputs,d=0,f=0;f<c.length;f++){var e=c[f];if(e.is_linked&&!(d++<b))switch(e.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";
default:return null}}}function N(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,f=!1,e=0;e<b.length;e++){var g=b[e];if(g.is_linked)switch(g.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":f=!0;break;default:throw"Unknown texture output";}}if(c)return d&&L.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(f)return"ENVIRONMENT_MAP"==
a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function P(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var f=c[d];if(f.identifier==b)return Z(f)}return null}function S(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var f=c[d];if(f.identifier==b)return Z(f)}return null}function Z(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=Ca.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,Yb:d,Ta:a}}function M(a,b,c,d){return{name:a,identifier:b,Yb:d||!1,Ta:c}}function U(a){for(var b=
[],c=0;c<a.inputs.length;c++){var d=Z(a.inputs[c]);d.Ta.length&&d.Ta.splice(3);b.push(d)}return b}function ea(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=Z(a.outputs[c]);b.push(d)}return b}function Y(a,b,c){b=null===b||void 0===b?null:V.r(b,c);return{name:a,value:b}}function ka(a,b,c,d,f,e){var g=[],h=e.from_socket.identifier;e=e.to_socket.identifier;var k=d.Da;for(d=0;d<k.length;d++)if(k[d].identifier==h){g.push(d);break}f=f.K;for(d=0;d<f.length;d++)if(f[d].identifier==e){g.push(d);break}2==
g.length&&R.rc(a,b,c,g);return!0}function ga(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function ma(a){var b=[];R.ea(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function ba(a,b,c){for(var d=0;d<c.length;d++){var f=c[d].data.qH,e=c[d].data.rH;if(!f)return!1;R.ea(f,function(b,c){R.Wi(a,R.Gl(a),c)});for(f=0;f<e.length;f++)b.push(e[f]);Aa(c[d],b,a)}return!0}function x(a,b,c,d,f,e){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||f.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||e.push(c)}}function fa(a,b,c){for(var d=[],f=0;f<c.length;f++){for(var e=c[f],g=null,h=0;h<b.length;h++)if(e.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(e.from_node=g.from_node,e.from_socket=g.from_socket):d.push(e)}for(f=0;f<b.length;f++)a.splice(a.indexOf(b[f]),1);return d}function aa(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function ha(a,b,
c,d){for(var f=0;f<d.length;f++){for(var e=d[f],g,h=0;h<c.K.length;h++)if(e.from_socket.identifier==c.K[h].identifier){g=c.K[h].Ta;break}for(var h=e,k=b,n=g,m=l(h.to_node,k),q=0;q<m.length;q++)for(var r=R.Ka(k,m[q]),p=0;p<r.K.length;p++){var t=r.K[p];if(t.identifier==h.to_socket.identifier){r=t.Ta instanceof Object?0:1;if((n instanceof Object?0:1)==r)t.Ta=n;else switch(r){case 0:t=t.Ta;t[0]=t[1]=t[2]=n;break;case 1:t.Ta=(n[0]+n[1]+n[2])/3}break}}e=a.indexOf(e);-1!=e&&a.splice(e,1)}}function Aa(a,
b,c){for(var d=a.name,f=[],e=[],g=[],h=[],k=0;k<b.length;k++){var l=b[k];x(l.from_node,d,l,f,g,h);x(l.to_node,d,l,e,g,h)}e=fa(b,e,g);f=fa(b,h,f);aa(b,e);ha(b,c,a,e);if(f.length){var n;R.ea(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(n=b)});ha(b,c,n,f)}}var ca=p("__config"),R=p("__graph"),xa=p("__mat3"),la=p("__mat4"),da=p("__objects"),L=p("__print"),V=p("__shaders"),oa=p("__scenes"),Ca=p("__util"),ya=p("__vec3"),X={},pa={},sa={},I={},qa=0;new Float32Array(4);var W=ca.q;a.iD=
e;a.Cq=function(a,b,d){var f=oa.get_active();a=k(a,"MAIN",f.uuid);if(a in sa)return sa[a];var f=R.create(),e={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},g=C(f,e,0,b,null),e={name:"LIGHTING_END",type:"LIGHTING_END"},e=C(f,e,0,b,null);c(f,d,g,e,[[g,[8,10]],[g,[9,6]]],b);q(f);return sa[a]=f};a.tn=function(a){var b=[],c={};X={};var d=R.xt(a);R.ea(d,function(a,d){var f;f=[];for(var e=[],g=[],h=[],k=[],l=[],n=0;n<d.K.length;n++){var m=d.K[n];if(m.Yb)f.push(null),e.push(null);else{f.push(K("in_"+d.type+
"_"+m.identifier));var q=V.r(m.Ta,0);W.wy&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==m.identifier||"Color2"==m.identifier||"Fac"==m.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==m.identifier||"Value_001"==m.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==m.identifier||0<=d.type.indexOf("LIGHTING_APPLY")||0<=d.type.indexOf("MATERIAL_END")||0<=d.type.indexOf("MATERIAL_BEGIN"))&&(m=q,m=m.replace(/(,)/g,"$1 "),m=m.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),m=
m.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=m=m.replace(/\s+/g,""));e.push(q)}}for(n=0;n<d.Da.length;n++)m=d.Da[n],m.Yb?g.push(null):g.push(K("out_"+d.type+"_"+m.identifier));for(n=0;n<d.s.length;n++)m=d.s[n],h.push(m.name),k.push(m.value);for(n=0;n<d.ph.length;n++)l.push(d.ph[n].name);f={id:d.type,K:f,Dr:e,Da:g,s:h,Fo:k,ph:l,Na:JSON.parse(JSON.stringify(d.Na))};b.push(f);c[a]=f});R.Ce(d,function(a,b,f){var e=R.Ka(d,a);R.Ka(d,b);var g=e.Da[f[0]];a=c[a].Da;b=c[b].K;e=a[f[0]]||
K("out_"+e.type+"_"+g.identifier);a[f[0]]=e;b[f[1]]=e});return b};a.Zu=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in pa)delete pa[a];for(a in sa)delete sa[a];for(var b in I)delete I[b];qa=0}};b4w.module.__animation=function(a,p){function e(a,b){var c=a.O[b];c&&c.ar&&c.Al&&(c.Al=!1,c.ar(a,b))}function b(a,b,c){c=a.O[c];c.type=30;var d=b.ba,f=b.ra-d+1;c.start=d;c.length=f;c.nd=d;c.qf=b.name;for(f=d=0;f<a.ac.length;f++){var e=a.ac[f];if(e==b)break;else d+=e.ra-e.ba+1}c.Bz=d}function c(a,b){a.type=50;a.qf=b.name;a.start=b.ba;a.length=b.ra-a.start;b.cyclic||(a.length+=b.Or)}function m(a){return a.replace(/_B4W_BAKED$/,"")}function k(a,b){if(a.animation_data){var c=a.animation_data.action;c&&
c.k.type==L&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var f=c[d];f.node_group&&(f=f.node_group.node_tree)&&k(f,b)}}function r(a){return P.is_mesh(a)&&a.g.ac?!0:!1}function h(a,b,c){var d=a.O;if(-1==c)for(c=0;8>c;c++){var f=d[c];f&&(f.nd=b,g(a,0,c,!0))}else if(f=d[c])f.nd=b,g(a,0,c,!0)}function q(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function g(a,b,c,d){B(a,b,c,d);e(a,c);a.g.Bh&&(E(a,b),v(a,b))}function y(a,b,c){var d=b.frame_range;if(d[0]>d[1])return M.warn('Incompatible action "'+
b.name+'" has been applied to object "'+a.name+'"'),!1;var e=b.k,g=a.O[c];g.qf=b.name;g.Mp=d;g.uu=e.Ox;g.su=e.Iu;g.Jh.set(e.Jh);g.start=d[0];g.length=d[1]-d[0];g.nd=d[0];switch(e.type){case xa:if(P.is_armature(a)){g.type=10;var h=f(a,b);if(!h){for(var h=a.g.Rd,d=[],k=[],m=b.k.ns,q=0;q<m;q++){for(var r in h){var p=h[r],t=p.mp,x=b.k.gq[r];x?ma.copy(x.subarray(8*q,8*q+8),t):ma.identity(t);p.np=!1}p=z(h);d.push(p.trans);k.push(p.Ea)}h={trans:d,Ea:k};a.Vi.push(b,h)}g.trans=h.trans;g.Ea=h.Ea;g=h;h=a.g;
r=h.ap;k=a.O[c];d=k.Zs;a:{m=h.zy;for(q=0;q<m.length;q+=2)if(b==m[q]){m=m[q+1];break a}m=null}if(m)k.Zs=m;else{for(k=0;k<r.length;k++){for(var m=r[k].aj,q=[],p=[],t=g.trans,x=g.Ea,F=0;F<t.length;F++){var y=G(t[F],x[F],m);q.push(y.trans);p.push(y.Ea)}d.push({trans:q,Ea:p})}h.zy.push(b,d)}h.Bh&&(b=h.pp,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),l(a))}break;case la:P.is_speaker(a)&&(g.volume=e.s.volume||null,g.pitch=e.s.pitch||null,g.type=40);break;case V:P.is_lamp(a)&&(g.color=e.s.color||
null,g.Ud=e.s.energy||null,g.type=70);break;case L:if("MESH"==a.type){g.type=60;r=f(a,b);if(!r){r=[];d=[];k=[];m=[];q=[];p=b.k;for(h in p.s)for(t=b.name+"%join%"+h,x=0;x<a.u.length;x++)for(F=a.u[x].P,y=0;y<F.length;y++){var w=F[y],C=w.ux,D=w.vx;C&&(C=u(h,t,p,d,r,C),D=u(h,t,p,m,k,D),(C||D)&&q.push(w))}r={HK:r,values:d,cI:k,dI:m,Ao:q};a.Vi.push(b,r)}g.Sj=r.HK;g.xx=r.values;g.Rj=r.cI;g.wx=r.dI;g.Ao=r.Ao}break;case da:if(h=e.s.tsr){g.type=20;r=f(a,b);if(!r){r=b.k.ns;d=[];k=[];for(m=0;m<r;m++)d.push(h.subarray(8*
m,8*m+4)),k.push(h.subarray(8*m+4,8*m+8));r={trans:d,Ea:k};a.Vi.push(b,r)}g.trans=r.trans;g.Ea=r.Ea;S.Tj(a)&&S.oK(a,g.trans[0],g.Ea[0])}else return M.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;break;case oa:P.is_world(a)&&(g.Ud=e.s["light_settings.environment_energy"]||null,g.Fw=Boolean(e.s["light_settings.environment_energy"]),g.be=e.s.horizon_color||null,g.Mw=Boolean(e.s.horizon_color),g.ne=e.s.zenith_color||null,g.Rw=Boolean(e.s.zenith_color),g.RE=e.s["mist_settings.intensity"]||
null,g.Kw=Boolean(e.s["mist_settings.intensity"]),g.PE=e.s["mist_settings.depth"]||null,g.Iw=Boolean(e.s["mist_settings.depth"]),g.SE=e.s["mist_settings.start"]||null,g.Lw=Boolean(e.s["mist_settings.start"]),g.QE=e.s["mist_settings.height"]||null,g.Jw=Boolean(e.s["mist_settings.height"]),g.OE=e.s.b4w_fog_color||null,g.Hw=Boolean(e.s.b4w_fog_color),g.type=80)}P.is_armature(a)&&e.type!=xa&&n(a,c);return!0}function f(a,b){for(var c=a.Vi,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function l(a){var b=
a.g.pp;if(-1!=b[0]&&-1!=b[1]){var c=a.O;a=c[b[1]].nd;var d=Math.floor(a),f=a-d,b=c[b[0]];a=b.nd;d=Math.floor(a);b.nd=d+f}}function n(a,b){var c=a.g.pp,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var f=a.O;0<=d;d--){var e=f[d];if(e&&10==e.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function u(a,b,c,d,f,e){for(var g=!1,h=0;h<e.length;h+=2)b==e[h]&&(f.push(e[h+1]),d.push(new Float32Array(c.s[a])),g=!0);return g}function A(a){a=a.k;for(var b in a.s)if(-1!=b.indexOf("nodes"))return!0;return!1}function B(a,
b,c,d){if((c=a.O[c])&&null!=c.type&&(c.play||d)){var f=a.g,e=c.nd,g=c.start,h=c.length,e=e+c.speed*b*ka.Xb(),k=c.type,l=c.speed;if(0<=l&&e>=g+h||0>l&&e<g)switch(d||(c.Al=!0),c.behavior){case 10:e=0<=l?(e-g)%h+g:g+h-1E-6;break;case 20:e=0<=l?g:g+h-1E-6;c.play=!1;break;case 30:e=0<=l?g+h-1E-6:g,c.play=!1}c.nd=e;switch(k){case 10:if(!f.Bh){d=H(c);b=d[0];e=d[1];d=d[2];f.Tc=c.Ea[b];f.Ad=c.Ea[e];f.ad=c.trans[b];f.Kd=c.trans[e];f.Yd=d;d=f.ap;c=c.Zs;for(g=0;g<d.length;g++)h=d[g],k=c[g],h.Tc=k.Ea[b],h.Ad=
k.Ea[e],h.ad=k.trans[b],h.Kd=k.trans[e],h.Yd=f.Yd;ga.n(a)}break;case 20:d=H(c);var f=ya,e=d[0],g=d[1],h=d[2],k=c.trans,l=k[e][1],n=k[e][2],m=k[g][1],q=k[g][2];f[0]=(1-h)*k[e][0]+h*k[g][0];f[1]=(1-h)*l+h*m;f[2]=(1-h)*n+h*q;e=pa;n=d[0];g=d[1];h=d[2];k=c.Ea;l=sa;l[0]=k[n][0];l[1]=k[n][1];l[2]=k[n][2];l[3]=k[n][3];n=I;n[0]=k[g][0];n[1]=k[g][1];n[2]=k[g][2];n[3]=k[g][3];U.slerp(l,n,h,e);g=d[2];h=c.trans;d=(1-g)*h[d[0]][3]+g*h[d[1]][3];a.parent&&a.Lo&&(g=qa,ma.set_sep(f,d,e,g),ma.multiply(a.Lo,g,g),ma.Gg(g,
f),ma.qr(g,e),d=ma.get_scale(g));c.zt&&(g=X,ga.get_translation(a,g),ba.smooth_v(f,g,b,c.zt,f));c.zs&&(g=sa,ga.get_rotation(a,g),ba.Ey(e,g,b,c.zs,e));h=c.Jh;h[0]&&ga.set_translation_rel(a,f);h[1]&&ga.set_rotation_rel(a,e);h[2]&&ga.set_scale_rel(a,d);ga.n(a);Z.sync_transform(a);break;case 30:d=c.nd-c.start;0>d&&(d=0);d>=c.length&&(d=c.length);a=Math.floor(d);b=a+1;d-=a;10!=c.behavior&&b==c.length&&(b=--a,d=1);c=c.Bz;Ca[0]=a+c;Ca[1]=b+c;Ca[2]=d;d=Ca;f.It=d[0];f.Az=d[2];break;case 40:d=H(c);b=d[0];f=
d[1];d=d[2];c.volume&&Y.set_volume(a,(1-d)*c.volume[b]+d*c.volume[f]);c.pitch&&Y.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[f]);break;case 50:b=10==c.behavior?(e-g)/ka.Xb():e/ka.Xb();S.MI(a,c.qf,b);break;case 60:d=H(c);b=d[0];f=d[1];d=d[2];k=c.xx;l=c.Sj;a=c.wx;g=c.Rj;c=c.Ao;for(e=0;e<l.length;e++)for(n=k[e],h=l[e],m=(1-d)*n[b]+d*n[f],n=0;n<c.length;n++)c[n].oi[h]=m;for(e=0;e<g.length;e++)for(k=a[e],h=g[e],k=x.lerp(k.subarray(3*b,3*b+3),k.subarray(3*f,3*f+3),d,ya),n=0;n<c.length;n++)c[n].xd[3*h]=k[0],c[n].xd[3*
h+1]=k[1],c[n].xd[3*h+2]=k[2];break;case 70:d=H(c);b=d[0];f=d[1];d=d[2];h=c.Jh;(g=c.Ud)&&h[0]&&aa.Ss(a.Qa,(1-d)*g[b]+d*g[f]);(c=c.color)&&h[1]&&(ya[0]=(1-d)*c[3*b]+d*c[3*f],ya[1]=(1-d)*c[3*b+1]+d*c[3*f+1],ya[2]=(1-d)*c[3*b+2]+d*c[3*f+2],aa.ry(a.Qa,ya));h=a.u;for(e=0;e<h.length;e++)ha.aK(a,h[e].Ca);break;case 80:d=H(c);b=d[0];f=d[1];d=d[2];h=a.u;e=ha.Z(h[0].Ca,"MAIN_OPAQUE");g=c.Ud;g=c.Fw?(1-d)*g[b]+d*g[f]:e.Ud;k=c.be;c.Mw?(ya[0]=(1-d)*k[3*b]+d*k[3*f],ya[1]=(1-d)*k[3*b+1]+d*k[3*f+1],ya[2]=(1-d)*k[3*
b+2]+d*k[3*f+2],k=ya):k=e.be;l=c.ne;c.Rw?(X[0]=(1-d)*l[3*b]+d*l[3*f],X[1]=(1-d)*l[3*b+1]+d*l[3*f+1],X[2]=(1-d)*l[3*b+2]+d*l[3*f+2],l=X):l=e.ne;n=c.RE;c.Kw&&(n=(1-d)*n[b]+d*n[f]);m=c.PE;c.Iw&&(m=(1-d)*m[b]+d*m[f]);q=c.SE;c.Lw&&(q=(1-d)*q[b]+d*q[f]);var r=c.QE;c.Jw&&(r=(1-d)*r[b]+d*r[f]);var p=c.OE;c.Hw&&(pa[0]=(1-d)*p[3*b]+d*p[3*f],pa[1]=(1-d)*p[3*b+1]+d*p[3*f+1],pa[2]=(1-d)*p[3*b+2]+d*p[3*f+2],p=pa);for(e=0;e<h.length;e++)b=a.u[e].Ca,(c.Fw||c.Mw||c.Rw)&&ha.set_environment_colors(b,g,k,l),c.Kw&&ha.sI(b,
n),c.Iw&&ha.qI(b,m),c.Lw&&ha.tI(b,q),c.Jw&&ha.rI(b,r),c.Hw&&ha.set_fog_color_density(b,p);break;default:ba.da("Unknown animation type:"+k)}}}function H(a){var b=a.Mp[0],c=a.Mp[1]-b,b=a.nd-b;0>b&&(b=0);b>=c&&(b=c);b/=a.uu;c=Math.floor(b);a=a.su[c]?b-c:0;b=Math.ceil(c+a);Ca[0]=c;Ca[1]=b;Ca[2]=a;return Ca}function v(a,b){var c=a.g,d=c.wg,f=c.pp,e=f[0],f=f[1];if(-1!=f){if(-1!=e){var g=a.O[e];if(g.play||0==b){var h=H(g),k=h[0],l=h[1];c.Yd=h[2];var h=g.Ea[k],n=g.Ea[l],k=g.trans[k],l=g.trans[l]}else d=1}else d=
1;f=a.O[f];if(f.play||0==b){var e=H(f),m=e[0],q=e[1];c.Yd=e[2]}else if(-1!=e&&g.play)d=0;else return;e=f.Ea[m];g=f.Ea[q];m=f.trans[m];q=f.trans[q];if(1==d)c.Tc.set(e),c.Ad.set(g),c.ad.set(m),c.Kd.set(q);else if(0==d)c.Tc.set(h),c.Ad.set(n),c.ad.set(k),c.Kd.set(l);else{for(f=0;f<h.length;f+=4){for(var r=pa,p=sa,t=0;4>t;t++)r[t]=h[f+t],p[t]=e[f+t];U.slerp(r,p,d,r);for(t=0;4>t;t++)c.Tc[f+t]=r[t];for(t=0;4>t;t++)r[t]=n[f+t],p[t]=g[f+t];U.slerp(r,p,d,r);for(t=0;4>t;t++)c.Ad[f+t]=r[t]}ba.Ku(k,m,d,c.ad);
ba.Ku(l,q,d,c.Kd)}ga.n(a);fa.mK(a)}}function E(a,b){var c=a.g,d=c.wg,f=c.Rp;if(0!=f){var d=c.Qp-d,e=f*b;ba.sign(d)==ba.sign(f)&&Math.abs(e)<Math.abs(d)?c.wg+=e:(c.wg=c.Qp,c.Rp=0)}}function z(a){var b=[],c=[],d=new Float32Array(4),f=new Float32Array(4),e;for(e in a){var g=a[e],h=d,k=f,l=g.qn,n=l[l.length-1],m=n.Bt;n.np||ma.identity(m);for(n=l.length-1;0<=n;n--){var q=l[n],r=q.Bt;if(q.np)m=r;else{var p=q.jh,t=q.mp;ma.invert(p,qa);ma.multiply(t,qa,qa);ma.multiply(p,qa,qa);ma.multiply(m,qa,r);m=r;q.np=
!0}}l=q.Bt;h[0]=l[0];h[1]=l[1];h[2]=l[2];h[3]=l[3];k[0]=l[4];k[1]=l[5];k[2]=l[6];k[3]=l[7];U.normalize(k,k);g=g.zg;for(h=0;4>h;h++)k=4*g+h,b[k]=d[h],c[k]=f[h]}return{trans:b,Ea:c}}function G(a,b,c){var d=[],f=[];new Float32Array(4);new Float32Array(4);for(var e in c)for(var g=c[e],h=g.zg,g=g.Nq,k=0;4>k;k++){var l=4*g+k,n=4*h+k;d[l]=a[n];f[l]=b[n]}d=new Float32Array(d);f=new Float32Array(f);return{trans:d,Ea:f}}function d(a){var b=a.k,c;if(b.gq)c=xa;else if(b.s)if("volume"in b.s||"pitch"in b.s)c=la;
else if(A(a))c=L;else{a:{if(a.k.s){a=a.fcurves;for(c in a)if("color"==c&&!a[c][3]){c=!0;break a}if("energy"==c){c=!0;break a}}c=!1}c=c?V:"light_settings.environment_energy"in b.s||"horizon_color"in b.s||"zenith_color"in b.s||"mist_settings.intensity"in b.s||"mist_settings.depth"in b.s||"mist_settings.start"in b.s||"mist_settings.height"in b.s||"b4w_fog_color"in b.s?oa:da}else c=R;b.type=c}function A(a){if(a=a.k.s)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;return!1}function F(a,b){b[0]=b[1]=
b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1)}function J(a,b){b[0]=b[1]=0;for(var c in a)"energy"==c?b[0]=1:"color"==c&&(b[1]=1)}function C(a,b,c,d,f,e,g){var h=a+(b-a)/2,k=D(h,d,f,e,g)-c;return.02>Math.abs(k)?h:0<k?C(a,h,c,d,f,e,g):C(h,b,c,d,f,e,g)}function D(a,b,c,d,f){var e=1-a;return b*e*e*e+3*c*e*e*a+3*d*e*a*a+f*a*a*a}function O(a,b){var c={type:null,qf:null,Mp:null,uu:0,su:null,Jh:new Int8Array(3),Ea:null,trans:null,Zs:[],play:!1,behavior:20,
nd:0,start:0,length:0,zt:0,zs:0,Al:!1,Bz:null,speed:1,volume:null,pitch:null,color:null,Ud:null,xx:[],Sj:[],wx:[],Rj:[],Ao:null};if(!a.O.length)for(var d=0;8>d;d++)a.O.push(null);a.O[b]=c;-1==W.indexOf(a)&&W.push(a)}function T(a,b){ga.n(a);Z.sync_transform(a);g(a,0,b,!0)}function K(a,d,f){f=f||0;if(P.is_mesh(a)){var e=w(a,d);if(e)return O(a,f),b(a,e,f),T(a,f),!0;if((e=t(a,d))&&"EMITTER"==e.ps){O(a,f);d=e.name;for(var e=f,g=a.u,h=0;h<g.length;h++)for(var k=g[h].P,l=0;l<k.length;l++){var n=k[l].xa;
n&&n.name==d&&c(a.O[e],n)}T(a,f);return!0}}if(e=ba.keysearch("name",d,ua)||ba.keysearch("name",d+"_B4W_BAKED",ua)){O(a,f);if(y(a,e,f))return T(a,f),!0;a.O[f]=null}M.error('Unsupported object: "'+a.name+'" or animation name: "'+d+'"');return!1}function w(a,b){for(var c=0;c<a.ac.length;c++){var d=a.ac[c];if(d.name===b)return d}return null}function t(a,b){for(var c=a.u,d=0;d<c.length;d++)for(var f=c[d].P,e=0;e<f.length;e++){var g=f[e].xa;if(g&&g.name===b)return g}return null}function Q(a){a=a.modifiers;
for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var N=p("__config"),P=p("__obj_util"),S=p("__particles"),Z=p("__physics"),M=p("__print"),U=p("__quat"),ea=p("__reformer"),Y=p("__sfx"),ka=p("__time"),ga=p("__transform"),ma=p("__tsr"),ba=p("__util"),x=p("__vec3"),fa=p("__armature"),aa=p("__lights"),ha=p("__scenes"),Aa=N.Ch,ca=N.q;a.xA=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=
40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.vL=70;a.uL=80;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var R=a.YK=0,xa=a.Wz=1,la=a.ZK=2,da=a.Zz=3,L=a.Wt=4,V=a.Yz=5,oa=a.Xz=6,Ca=Array(3),ya=new Float32Array(3),X=new Float32Array(3),pa=new Float32Array(4),sa=new Float32Array(4),I=new Float32Array(4),qa=ma.create();new Float32Array(16);var W=[],ua=[];a.dw=function(){return ba.trunc((ca.kx-
50)/4)};a.frame_to_sec=function(a){return a/ka.Xb()};a.update=function(a){for(var b=0;b<W.length;b++){for(var c=W[b],d=0;8>d;d++)B(c,a,d);c.g.Bh&&(E(c,a),v(c,a))}for(b=0;b<W.length;b++)for(c=W[b],d=0;8>d&&c.O.length;d++)e(c,d)};a.qF=function(){return ua};a.get_anim_names=function(a){var b=[];if(r(a))for(var c=0;c<a.ac.length;c++)b.push(a.ac[c].name);for(var d=[],c=0;c<ua.length;c++){var f=ua[c],e=f.k;e.type==da?d.push(f):e.type==xa&&"ARMATURE"==a.type?d.push(f):e.type==la&&"SPEAKER"==a.type?d.push(f):
e.type==oa&&"WORLD"==a.type&&d.push(f)}if("MESH"==a.type)for(c=0;c<a.actions.length;c++)f=a.actions[c],f.k.type==L&&d.push(f);for(c=0;c<d.length;c++)b.push(m(d[c].name));if(S.Tj(a)&&S.Cx(a))for(a=a.u,c=0;c<a.length;c++)for(d=a[c].P,f=0;f<d.length;f++)(e=d[f].xa)&&b.push(e.name);return b};a.LN=m;a.get_anim_type=function(a,b){var c=a.O[b];return c?c.type:0};a.apply_def=function(a){for(var d=0,f=a.u,e=0;e<f.length;e++)for(var g=f[e].P,h=0;h<g.length;h++){var k=g[h].xa;k&&"EMITTER"==k.ps&&!g[h].Ue&&(O(a,
d),c(a.O[d],k),T(a,d),a.O[d].behavior=k.cyclic?10:a.Ah,d++)}f=a.actions.slice();for(e=0;e<f.length;e++)g=f[e],O(a,d),y(a,g,d)?(T(a,d),a.O[d].behavior=a.Ah,d++):a.O[d]=null;r(a)&&(O(a,d),b(a,a.ac[0],d),T(a,d),a.O[d].behavior=a.Ah)};a.Pp=function(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ba.da("Wrong animation behavior")}};a.vF=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&k(d,b)}return b};a.play=
function(a,b,c){q(a.O,c,function(a){a.play=!0;a.ar=b?b:null;a.Al=!1});a.g.Bh&&l(a)};a.stop=function(a,b){q(a.O,b,function(a){a.play=!1;a.ar=null;a.Al=!1})};a.is_play=function(a,b){var c=a.O;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=c[b])return c.play;return!1};a.set_frame=h;a.set_first_frame=function(a,b){b=b||0;q(a.O,b,function(c){h(a,c.start,b)})};a.bw=function(a,b){var c=a.O[b];return c&&c.nd?c.nd:0};a.is_cyclic=function(a,b){var c=a.O[b];return c&&10==c.behavior};a.set_behavior=
function(a,b,c){q(a.O,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.O[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){q(a.O,d,function(a){a.zt=b||0;a.zs=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.O[c]=null;else a.O[b]=null;a.g.Bh&&n(a,b)};a.dK=g;a.Ex=function(a){if("ARMATURE"==a.type||a.en||"WORLD"==a.type)return!0;for(var b=0;b<a.actions.length;b++){var c=a.actions[b].k.type;if(c==da||c==xa||c==la&&"SPEAKER"==a.type||c==V&&"LAMP"==
a.type||c==L&&"MESH"==a.type)return!0}return S.Tj(a)&&S.Cx(a)||"MESH"==a.type&&a.ac.length?!0:!1};a.Ou=function(a,b){if("ARMATURE"==b.type||Q(a))return!0;for(var c=0;c<b.actions.length;c++){var d=b.actions[c].k.type;if(d==da||d==xa||d==la&&"SPEAKER"==b.type||d==L&&"MESH"==b.type)return!0}return S.AC(a)&&S.zC(a)||"MESH"==b.type&&a.data.b4w_vertex_anim.length||"WORLD"==b.type?!0:!1};a.is_animated=function(a){return Boolean(a.O.length)};a.FC=z;a.HE=G;a.JB=function(a){function b(a,c){for(var d=0;d<c;d++){var f=
a.subarray(8*d+4,8*d+8);U.normalize(f,f)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,f=b;else-1<a.indexOf("rotation_quaternion")?(d=4,f=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,f=0):(d=0,f=b);return d+f}function f(a,b,c,d,h){if(-1<c.search(e)){a=b;c=c.split('"')[1];var k=g}else 8==h?(c="tsr",k=g):k=1<h?new Float32Array(h):0;if(!a[c]){h=a;b=c;if("object"==typeof k&&k.length)for(var l=k.length,n=new Float32Array(d*l),m=0;m<d;m++)for(var q=0;q<l;q++)n[m*l+q]=k[q];else if("number"==typeof k)for(n=
new Float32Array(d),m=0;m<d;m++)n[m]=k;else ba.da("Wrong storage default value");h[b]=n}return a[c]}var e=new RegExp(/pose.bones\[\".+\"\]/g),g=ma.create(),h=a.k={type:R,ns:0,Ox:0,s:null,gq:null,Iu:null,Jh:new Int8Array(3)};h.Ox=1/Aa.Yh;var k=a.fcurves,l={},n={},m=0,q;for(q in k){var r=k[q],p;for(p in r){var t=r[p],u=t.hd;ea.OC(t,a);t=t.num_channels;m||(m=u.length);for(var t=f(l,n,q,m,t),x=t.length/m,y=c(q,p|0),w=0;w<m;w++)t[w*x+y]=u[w]}}if(ba.Il(l)){for(var da in l)"tsr"==da&&b(l[da],m);h.s=l}if(ba.Il(n)){for(var C in n)b(n[C],
m);h.gq=n}h.ns=m;h.Iu=a.AB;"tsr"in l&&F(k,h.Jh);("color"in l||"energy"in l)&&J(k,h.Jh);d(a);ua.push(a)};a.tF=function(a,b){return(b-a)*Aa.Yh+1};a.hC=function(a,b,c,d,f,e){var g=new Float32Array(2),h=new Float32Array(2),k=new Float32Array(2),l=new Float32Array(2),n=b[1],m=b[2],q=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var r=0,p=0,t=null;f<=e;f++)if(f<n)for(var u=0;u<Aa.Yh;u++)c[r++]=m;else if(f>q)for(u=0;u<Aa.Yh;u++)c[r++]=a;else{var x=b[p],F=3;0===x&&(F+=2);0===t&&(F+=2);var y=2===
x?0:1;if(b[p+1]==b[p+F+1])t=x,p+=F;else{u=0;f==b[p+1]&&(y&&(d[r]=1),c[r]=b[p+2],r++,u++);if(f==q)for(;u<Aa.Yh;u++)c[r++]=a;else for(g[0]=b[p+1],g[1]=b[p+2],0!==x?(h[0]=0,h[1]=0):0===t?(h[0]=b[p+5],h[1]=b[p+6]):(h[0]=b[p+3],h[1]=b[p+4]),0!==x?(k[0]=0,k[1]=0):(k[0]=b[p+F+3],k[1]=b[p+F+4]),l[0]=b[p+F+1],l[1]=b[p+F+2];u<Aa.Yh;u++){var w=f+u/Aa.Yh;switch(x){case 0:var da=g,L=h,v=k,N=l,V=[],A=[],B=void 0,P=void 0,z=void 0,B=void 0;V[0]=da[0]-L[0];V[1]=da[1]-L[1];A[0]=N[0]-v[0];A[1]=N[1]-v[1];z=N[0]-da[0];
B=Math.abs(V[0]);P=Math.abs(A[0]);0!=B+P&&B+P>z&&(B=z/(B+P),L[0]=da[0]-B*V[0],L[1]=da[1]-B*V[1],v[0]=N[0]-B*A[0],v[1]=N[1]-B*A[1]);y&&(d[r]=1);c[r]=D(C(0,1,w,g[0],h[0],k[0],l[0]),g[1],h[1],k[1],l[1]);r++;break;case 1:y&&(d[r]=1);da=g[0];L=g[1];v=(l[1]-L)/(l[0]-da);c[r]=v*w+(L-v*da);r++;break;case 2:y&&(d[r]=1);c[r]=b[p+2];r++;break;default:ba.da("Unknown keyframe interpolation mode: "+x)}}f+1==b[p+F+1]&&(t=x,p+=F)}}};a.apply=K;a.dC=function(a,b,c){c=c||0;var d=ba.keysearch("uuid",b,ua);if(d){O(a,
c);if(y(a,d,c)){T(a,c);return}a.O[c]=null}M.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.IK=function(a,b){var c=ba.keysearch("name",b,ua)||ba.keysearch("name",b+"_B4W_BAKED",ua);if(c){if(c.k.type==R)return!1}else if(!(t(a,b)||P.is_mesh(a)&&w(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.O,d=0;d<c.length;d++){var f=c[d];if(f&&m(f.qf)==m(b))return d}return-1};a.rF=function(a,b){var c=a.O[b];return c&&c.qf?m(c.qf):null};a.remove=function(a){a.O.length=
0;a=W.indexOf(a);-1!=a&&W.splice(a,1)};a.SH=function(a){for(var b=ua.length-1;0<=b;b--)ua[b].BB==a&&ua.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.O.length)return K(a,b,0)?0:-1;for(var c=0;c<a.O.length;c++)if(!a.O[c])return K(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.g.Rp=(b-a.g.wg)/c;a.g.Qp=b};a.set_speed=function(a,b,c){q(a.O,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.O[b].speed};a.get_anim_start_frame=function(a,b){return a.O[b].start};a.get_anim_length=
function(a,b){return a.O[b].length};a.cleanup=function(){W.length=0;ua.length=0};a.JE=function(a){var b=(a[0]||a[1]||a[2]).hd.length,c=pa,d=ya,f=Boolean(a[0]);f||(a[0]={hd:new Float32Array(b),num_channels:8});var e=Boolean(a[1]);e||(a[1]={hd:new Float32Array(b),num_channels:8});var g=Boolean(a[2]);g||(a[2]={hd:new Float32Array(b),num_channels:8});a[3]={hd:new Float32Array(b),num_channels:8};for(var h=0;h<b;h++)d[0]=f?a[0].hd[h]:0,d[1]=e?a[1].hd[h]:0,d[2]=g?a[2].hd[h]:0,ba.euler_to_quat(d,c),a[0].hd[h]=
c[3],a[1].hd[h]=c[0],a[2].hd[h]=c[1],a[3].hd[h]=c[2]};a.Zv=Q};b4w.module.__time=function(a,p){function e(){return-1!==b.Ch.On?b.Ch.On:g}var b=p("__config");p("__print");var c=0,m=0,k=[],r=0,h=0,q=[],g=-1;a.ty=function(a){c=a;m=performance.now();for(a=0;a<k.length;a++){var b=k[a];c>b.Wq&&(k.splice(a,1),a--,b.callback())}for(a=0;a<q.length;a++){var b=q[a],e=1-(b.Wq-c)/b.duration,e=Math.min(e,1);b.callback(b.from+e*(b.to-b.from));1==e&&(q.splice(a,1),a--)}};a.get_timeline=function(){return c};a.set_timeout=function(a,b){var e;r++;e=r;k.push({id:e,callback:a,Wq:c+
(performance.now()-m+b)/1E3});return e};a.clear_timeout=function(a){for(var b=0;b<k.length;b++)if(k[b].id==a){k.splice(b,1);break}};a.clear_animation=function(a){for(var b=q.length;b--;)if(q[b].id==a){q.splice(b,1);break}};a.animate=function(a,b,e,g){e/=1E3;var k;h++;k=h;q.push({id:k,callback:g,from:a,to:b,Wq:c+e,duration:e});g(a);return k};a.reset=function(){m=c=0;k.length=0;h=r=q.length=0};a.Xb=e;a.vI=function(a){g=a};a.get_frame=function(a){return a*e()}};b4w.module.__transform=function(a,p){function e(a,b){g.ae(a)?u.set_trans(b,g.$d(a)):u.set_trans(b,a.g.i)}function b(a,b){var c=a.g;if(g.ae(a)){u.set_quat(b,c.i);var f=g.Pn(a),f=u.invert(f,d);u.multiply(f,c.i,g.$d(a))}else u.set_quat(b,c.i)}function c(a,b){g.ae(a)?u.set_quat(b,g.$d(a)):u.set_quat(b,a.g.i)}function m(a,b){g.ae(a)?u.copy(b,g.$d(a)):u.copy(b,a.g.i)}function k(a,b){g.ae(a)?u.copy(g.$d(a),b):u.copy(a.g.i,b);return b}function r(a){var b=a.g,c=a.u,e=a.type;"CAMERA"==e&&q.Dt(a);g.ZJ(a,J);
"CAMERA"==e&&q.VJ(a);var k=u.Gg(b.i,z),m=u.qr(b.i,G);b.dc&&b.wb&&(h.hq(b.dc,b.i,b.wb),h.jq(b.Sd,b.i,b.ec),h.iq(b.Ne,b.i,b.sf));switch(e){case "SPEAKER":n.jJ(a,J);break;case "CAMERA":for(var p=0;p<c.length;p++)q.WJ(a,c[p]);break;case "MESH":var F=a.en;F&&(u.invert(F.g.i,d),u.multiply(d,b.i,d),E.set(d[0],d[1],d[2],d[3],b.Up),f.set(d[4],d[5],d[6],d[7],b.Tp));break;case "LAMP":y.bK(a)}for(p=0;p<c.length;p++){var v=c[p];if(v.eo){var F=v.Ca,P=F.k;switch(e){case "LAMP":l.rp(a,F);break;case "CAMERA":l.kI(F);
if(P.mc){P.mc.enable_csm&&l.Ms(F);var S=B.R(a,F).M[0];l.lK(S,P.jb)}l.get_active()==F&&n.LG(F,k,m,J);break;case "MESH":b.dc&&b.wb&&(b.Fd&&l.Ms(F),P=v.xf,null!=b.Td&&P&&l.pz(P,k));break;case "EMPTY":A.qz(a)}v=v.af;P=a.jm;if(P.length)for(S=0;S<v.length;S++){var Z=v[S].j;l.rz(v[S],k,m);B.sz(P,Z.Zb);q.QI(Z,l.Hl(F));H.Ln(Z.Ge,Z.qj)}}}c=a.Kc;for(p=0;p<c.length;p++)r(c[p]);a=a.Aq;for(p=0;p<a.length;p++)c=a[p],F=c[0],g.SJ(F,c[1]);b.dr=!0}var h=p("__boundings"),q=p("__camera"),g=p("__constraints"),y=p("__lights"),
f=p("__quat"),l=p("__scenes"),n=p("__sfx"),u=p("__tsr"),A=p("__objects"),B=p("__obj_util"),H=p("__util"),v=p("__vec3"),E=p("__vec4"),z=new Float32Array(3),G=new Float32Array(4);new Float32Array(9);var d=u.create(),F=u.create(),J=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){J=a};a.set_translation=function(a,b){var c=a.g;if(g.ae(a)){u.set_trans(b,c.i);var f=g.Pn(a),f=u.invert(f,d);u.multiply(f,c.i,g.$d(a))}else u.set_trans(b,c.i)};a.set_translation_rel=e;a.get_translation=function(a,b){var c=
u.get_trans_view(a.g.i);v.copy(c,b);return b};a.get_translation_rel=function(a,b){if(g.ae(a))v.copy(u.get_trans_view(g.$d(a)),b);else{var c=u.get_trans_view(a.g.i);v.copy(c,b)}return b};a.set_rotation=b;a.set_rotation_rel=c;a.get_rotation=function(a,b){var c=u.get_quat_view(a.g.i);f.copy(c,b);return b};a.get_rotation_rel=function(a,b){if(g.ae(a))f.copy(u.get_quat_view(g.$d(a)),b);else{var c=u.get_quat_view(a.g.i);f.copy(c,b)}return b};a.set_rotation_euler=function(a,c){var d=H.euler_to_quat(c,G);
b(a,d)};a.set_rotation_euler_rel=function(a,b){var d=H.euler_to_quat(b,G);c(a,d)};a.set_scale=function(a,b){var c=a.g;if(g.ae(a)){var c=g.$d(a),d=u.get_scale(g.Pn(a));u.set_scale(b/d,c)}else u.set_scale(b,c.i)};a.set_scale_rel=function(a,b){var c=a.g;g.ae(a)?u.set_scale(b,g.$d(a)):u.set_scale(b,c.i)};a.get_scale=function(a){return u.get_scale(a.g.i)};a.get_scale_rel=function(a){return g.ae(a)?u.get_scale(g.$d(a)):u.get_scale(a.g.i)};a.set_tsr=function(a,b){u.copy(b,a.g.i);if(g.ae(a)){var c=g.Pn(a),
c=u.invert(c,d);u.multiply(c,a.g.i,g.$d(a))}};a.set_tsr_rel=m;a.get_tsr=function(a,b){return u.copy(a.g.i,b)};a.get_tsr_rel=k;a.get_object_size=function(a){var b=a.g;a=b.Zi;var c=u.get_scale(b.i),b=c*(a.max_x-a.min_x),d=c*(a.max_y-a.min_y);a=c*(a.max_z-a.min_z);return.5*Math.sqrt(b*b+d*d+a*a)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(a=a.g,v.copy(a.ec.J,c)):(a=a.g,b=a.Zi,c[0]=(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,u.transform_vec3(c,a.i,c));
return c};a.move_local=function(a,b,c,f){var g=k(a,d),h=z;h[0]=b;h[1]=c;h[2]=f;u.transform_vec3(h,g,h);e(a,h)};a.Is=function(a,b){var c=k(a,d),f=u.set_quat(b,u.identity(F));u.multiply(c,f,f);m(a,f)};a.n=r;a.distance=function(a,b){var c=u.get_trans_view(a.g.i),d=u.get_trans_view(b.g.i);return v.dist(c,d)};a.Uj=function(a,b){var c=u.get_trans_view(a.g.i);return v.dist(c,b)};a.get_object_bounding_box=function(a){return{max_x:a.g.wb.max_x,min_x:a.g.wb.min_x,max_y:a.g.wb.max_y,min_y:a.g.wb.min_y,max_z:a.g.wb.max_z,
min_z:a.g.wb.min_z}}};b4w.module.__tsr=function(a,p){function e(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a}function b(){var a=new Float32Array(9);a[3]=1;a[7]=1;return a}function c(a,b,c,f){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=b;f[4]=c[0];f[5]=c[1];f[6]=c[2];f[7]=c[3];return f}function m(a,b,c){var f=b[0],e=b[1],g=b[2],h=b[3],k=b[4],m=b[5],q=b[6];b=b[7];var d=a[0]*h,r=a[1]*h,p=a[2]*h;a=b*d+m*p-q*r;var h=b*r+q*d-k*p,y=b*p+k*r-m*d,d=-k*d-m*r-q*p;c[0]=a*b+d*-k+h*-q-y*-m;c[1]=h*b+d*-m+y*-k-a*-q;c[2]=y*b+d*-q+a*-m-h*-k;
c[0]+=f;c[1]+=e;c[2]+=g;return c}var k=p("__mat4"),r=p("__quat"),h=p("__util"),q=p("__vec3"),g=new Float32Array(3),y=new Float32Array(4),f=new Float32Array(16);a.create=e;a.from_values=function(a,b,c,f,g,h,k,m){var q=e();q[0]=a;q[1]=b;q[2]=c;q[3]=f;q[4]=g;q[5]=h;q[6]=k;q[7]=m;return q};a.An=b;a.tM=function(a,c,f,e,g,h,k,m){var q=b();q[0]=a;q[1]=c;q[2]=f;q[3]=e;q[4]=g;q[5]=h;q[6]=k;q[7]=m;return q};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];
return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.set_sep=c;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.Gg=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.get_scale=function(a){return a[3]};
a.get_quat_view=function(a){return a.subarray(4,8)};a.qr=function(a,b){b[0]=a[4];b[1]=a[5];b[2]=a[6];b[3]=a[7];return b};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var f=a[0],e=a[1],g=a[2];y[0]=a[4];y[1]=a[5];y[2]=a[6];y[3]=a[7];r.invert(y,y);var h=y[0],k=y[1],m=y[2],q=y[3],f=f*c,e=e*c,d=g*c,g=q*f+k*d-m*e,p=q*e+m*f-h*d,J=q*d+h*e-k*f,f=-h*f-k*e-m*d;b[0]=-(g*q+f*-h+p*-m-J*-k);b[1]=-(p*q+f*-k+J*-h-g*-m);b[2]=-(J*q+f*-m+g*-k-p*-h);b[3]=c;b[4]=h;b[5]=k;b[6]=m;b[7]=q;return b};a.to_mat4=function(a,
b){var c=a[3];k.fromRotationTranslation(a.subarray(4,8),a.subarray(0,3),b);for(var f=0;12>f;f++)b[f]*=c;return b};a.from_mat4=function(a,b){var f=h.ix(a,g),e=h.hx(a),k=h.matrix_to_quat(a,y);c(f,e,k,b);return b};a.multiply=function(a,b,c){m(b,a,c);c[3]=a[3]*b[3];var f=a[4],e=a[5],g=a[6];a=a[7];var h=b[4],k=b[5],q=b[6];b=b[7];c[4]=f*b+a*h+e*q-g*k;c[5]=e*b+a*k+g*h-f*q;c[6]=g*b+a*q+f*k-e*h;c[7]=a*b-f*h-e*k-g*q;return c};a.FJ=function(a,b,c){var e=b[3];b=k.fromRotationTranslation(b.subarray(4,8),b.subarray(0,
3),f);for(var g=0;12>g;g++)b[g]*=e;k.multiply(b,a,c);return c};a.transform_vec3=m;a.transform_vec3_inv=function(a,b,c){var f=b[3],e=a[0]-b[0],g=a[1]-b[1],h=a[2]-b[2];a=b[4];var k=b[5],m=b[6];b=b[7];var q=a*a+k*k+m*m+b*b,q=q?1/q:0;a=-a*q;k=-k*q;m=-m*q;b*=q;var q=b*e+k*h-m*g,d=b*g+m*e-a*h,r=b*h+a*g-k*e,e=-a*e-k*g-m*h;c[0]=q*b+e*-a+d*-m-r*-k;c[1]=d*b+e*-k+r*-a-q*-m;c[2]=r*b+e*-m+q*-k-d*-a;c[0]/=f;c[1]/=f;c[2]/=f;return c};a.transform_vectors=function(a,b,c,f){f||(f=0);var e=a.length,g=b[0],h=b[1],k=
b[2],m=b[3],q=b[4],d=b[5],r=b[6];b=b[7];for(var p=0;p<e;p+=3){var y=a[p]*m,D=a[p+1]*m,O=a[p+2]*m,T=b*y+d*O-r*D,K=b*D+r*y-q*O,w=b*O+q*D-d*y,y=-q*y-d*D-r*O;c[f+p]=T*b+y*-q+K*-r-w*-d;c[f+p+1]=K*b+y*-d+w*-q-T*-r;c[f+p+2]=w*b+y*-r+T*-d-K*-q;c[f+p]+=g;c[f+p+1]+=h;c[f+p+2]+=k}return c};a.transform_dir_vectors=function(a,b,c,f){f||(f=0);var e=a.length,g=b[3],h=b[4],k=b[5],m=b[6];b=b[7];for(var q=0;q<e;q+=3){var d=a[q]*g,r=a[q+1]*g,p=a[q+2]*g,y=b*d+k*p-m*r,D=b*r+m*d-h*p,O=b*p+h*r-k*d,d=-h*d-k*r-m*p;c[f+q]=
y*b+d*-h+D*-m-O*-k;c[f+q+1]=D*b+d*-k+O*-h-y*-m;c[f+q+2]=O*b+d*-m+y*-k-D*-h}return c};a.transform_dir_vec3=function(a,b,c){var f=b[3],e=b[4],g=b[5],h=b[6];b=b[7];var k=a[0]*f,m=a[1]*f,q=a[2]*f;a=b*k+g*q-h*m;var f=b*m+h*k-e*q,d=b*q+e*m-g*k,k=-e*k-g*m-h*q;c[0]=a*b+k*-e+f*-h-d*-g;c[1]=f*b+k*-g+d*-e-a*-h;c[2]=d*b+k*-h+a*-g-f*-e;return c};a.transform_tangents=function(a,b,c,f){f||(f=0);var e=a.length,g=b[3],h=b[4],k=b[5],m=b[6];b=b[7];for(var q=0;q<e;q+=4){var d=a[q]*g,r=a[q+1]*g,p=a[q+2]*g,y=b*d+k*p-m*
r,D=b*r+m*d-h*p,O=b*p+h*r-k*d,d=-h*d-k*r-m*p;c[f+q]=y*b+d*-h+D*-m-O*-k;c[f+q+1]=D*b+d*-k+O*-h-y*-m;c[f+q+2]=O*b+d*-m+y*-k-D*-h;c[f+q+3]=a[q+3]}return c};a.translate=function(a,b,c){var f=a[3],e=a[4],g=a[5],h=a[6],k=a[7],m=b[0]*f,q=b[1]*f,d=b[2]*f;b=k*m+g*d-h*q;var f=k*q+h*m-e*d,r=k*d+e*q-g*m,m=-e*m-g*q-h*d;c[0]=a[0]+b*k+m*-e+f*-h-r*-g;c[1]=a[1]+f*k+m*-g+r*-e-b*-h;c[2]=a[2]+r*k+m*-h+b*-g-f*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,f){q.lerp(a.subarray(0,
3),b.subarray(0,3),c,f.subarray(0,3));var e=a[3];f[3]=e+c*(b[3]-e);r.slerp(a.subarray(4,8),b.subarray(4,8),c,f.subarray(4,8));return f};a.jM=function(a,b,c,f){var e=a.subarray(0,3),g=b.subarray(0,3),h=f.subarray(0,3);h[0]=g[0]*(c+1)-e[0]*c;h[1]=g[1]*(c+1)-e[1]*c;h[2]=g[2]*(c+1)-e[2]*c;f[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4,8);b=b.subarray(4,8);e=f.subarray(4,8);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;r.normalize(e,e);return f};a.gG=function(a,b,c,
f,e){e[0]=a[0]+b*c[0];e[1]=a[1]+b*c[1];e[2]=a[2]+b*c[2];e[3]=a[3];c=f[0];var g=f[1];f=f[2];var h=a[4],k=a[5],m=a[6],q=a[7];e[4]=.5*(c*q+g*m-f*k);e[5]=.5*(g*q+f*h-c*m);e[6]=.5*(f*q+c*k-g*h);e[7]=.5*(-c*h-g*k-f*m);e[4]=a[4]+e[4]*b;e[5]=a[5]+e[5]*b;e[6]=a[6]+e[6]*b;e[7]=a[7]+e[7]*b;a=e[4];b=e[5];c=e[6];g=e[7];a=a*a+b*b+c*c+g*g;0<a&&(a=1/Math.sqrt(a),e[4]*=a,e[5]*=a,e[6]*=a,e[7]*=a)}};b4w.module.__util=function(a,p){function e(a){return 0<a?1:0>a?-1:0}function b(a){var b=a[0],c=a[1],d=a[2],f=a[3],e=Math.sqrt(b*b+c*c+d*d),e=1/e;a[0]=b*e;a[1]=c*e;a[2]=d*e;a[3]=f*e}function c(a,b){var d=b;switch(typeof a){case "number":return m(a,d);case "string":return k(a,d);case "boolean":return m(a|0,d);case "function":case "undefined":return m(0,d);case "object":if(a){switch(a.constructor){case WebGLUniformLocation:case WebGLProgram:case WebGLShader:case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:return m(0,
d)}if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(var f=0;f<a.length;f++)d=m(a[f],d);else if(a instanceof Array)for(f=0;f<a.length;f++)d=c(a[f],d);else for(f in a)d=c(a[f],d)}else d=m(0,d)}return d}function m(a,b){var c=b;P[0]=a;c=(c<<5)-c+S[0];c&=c;c=(c<<5)-c+S[1];return c&c}function k(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),c&=c;return c}function r(a){return(34*a+1)*a%289}function h(a){return a-Math.floor(a)}function q(a){return g((34*a+5)*a)}function g(a){return a-
289*Math.floor(a/289)}function y(a){return a-7*Math.floor(a/7)}function f(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function l(a){return f(a,0,2*Math.PI)}function n(a,b){if(a&&b){var c=a instanceof Array;if(c!=b instanceof Array)return!1;var d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength;if(d!=(b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength))return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!u(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;
for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{switch(a.constructor){case WebGLUniformLocation:case WebGLProgram:case WebGLShader:case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:return a==b}for(var f in a)if(!u(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function u(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return n(a,b);default:return!0}}function A(a){if(""==a)return".";var b=
0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var f=a[d];""!=f&&"."!=f&&(".."!=f||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(f):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var B=p("__mat3"),H=p("__mat4"),v=p("__math"),E=p("__print"),z=p("__tsr"),G=p("__quat"),d=p("__vec3"),F=p("__vec4"),J=0,C={},D=[fa,aa,ha,Aa,ca],O=new Float32Array(3),T=new Float32Array(3),K=new Float32Array(4),w=new Float32Array(4),
t=new Float32Array(9),Q=new Float32Array(16),N=new Float32Array(16),P=new Float64Array(1),S=new Uint32Array(P.buffer),Z=new Float32Array([0,0,0]),M=new Float32Array([0,0,0,1]),U=new Float32Array([0,0,0,1,0,0,0,1]),ea=new Float32Array([1,1,1]),Y=new Float32Array([1,0,0]),ka=new Float32Array([0,1,0]),ga=new Float32Array([0,0,1]),ma=new Float32Array([-1,0,0]),ba=new Float32Array([0,-1,0]),x=new Float32Array([0,0,-1]),fa=0,aa=1,ha=2,Aa=4,ca=5,R=Math.floor(44488.07041494893),xa=[new Float32Array([0,0,
-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])];a.mu=Z;a.lu=M;a.yL=U;a.Kp=ea;a.AXIS_X=Y;a.AXIS_Y=ka;a.AXIS_Z=ga;a.AXIS_MX=ma;a.AXIS_MY=ba;a.AXIS_MZ=x;a.XYX=fa;a.YZY=aa;a.ZXZ=ha;a.XZX=3;a.YXY=Aa;a.ZYZ=ca;a.XYZ=6;a.YZX=7;a.ZXY=8;a.XZY=9;a.YXZ=10;a.ZYX=
11;a.gA=xa;a.ud=function(a){return"undefined"!=typeof a};a.keyfind=function(a,b,c){for(var d=[],f=c.length,e=0;e<f;e++){var g=c[e];g[a]==b&&d.push(g)}return d};a.NE=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.HJ=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.VC=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.iC=function(a,b){var c=[],d={},f=b.length,e,g;for(e=
0;e<f;e++)d[b[e]]=!0;f=a.length;for(e=0;e<f;e++)g=a[e],g in d&&c.push(g);return c};a.sign=e;a.fN=function(a,b,c){for(var d=c.length,f=0;f<d;f++)if(c[f][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var f=c[d];if(f[a]===b)return f}return null};a.dN=function(a,b,c,d,f){for(var e=0;e<f.length;e++){var g=f[e];if(g[a]==b&&g[c]==d)return g}return null};a.IF=function(a,b){for(var c=0;c<a.length;c++)if(a[c].uuid==b)return c;return-1};a.cC=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==
b)return;a.push(b)};a.SL=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.CJ=function(a,b,c,d){d||(d=new Float32Array(16));H.identity(d);d[12]=a;d[13]=b;d[14]=c};var la=1;a.QH=function(){la=(69069*la+5)%Math.pow(2,32);return Math.round(la/65536)%32768/32767};a.oJ=function(a){la=a};a.ie=function(a){var b=a[0]%R*48271-3399*Math.floor(a[0]/R);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.bo=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);
return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),f=Math.cos(a[0]/2),e=Math.sin(a[1]/2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=c*d*h+e*g*f;b[1]=e*d*f+c*g*h;b[2]=c*g*f-e*d*h;b[3]=c*d*f-e*g*h;return b};a.ordered_angles_to_quat=function(a,b,c){var d=a[0],f=a[1];a=a[2];var e=Math.cos(d/2),g=Math.cos(f/2),h=Math.cos(a/2),k=Math.sin(d/2),f=Math.sin(f/2),l=Math.sin(a/2);if(-1<D.indexOf(b))var m=Math.cos((d+a)/2),n=Math.sin((d+a)/2),q=Math.cos((d-
a)/2),r=Math.sin((d-a)/2),p=Math.cos((a-d)/2),t=Math.sin((a-d)/2);switch(b){case fa:c[0]=g*n;c[1]=f*q;c[2]=f*r;c[3]=g*m;break;case aa:c[0]=f*r;c[1]=g*n;c[2]=f*q;c[3]=g*m;break;case ha:c[0]=f*q;c[1]=f*r;c[2]=g*n;c[3]=g*m;break;case 3:c[0]=g*n;c[1]=f*t;c[2]=f*p;c[3]=g*m;break;case Aa:c[0]=f*p;c[1]=g*n;c[2]=f*t;c[3]=g*m;break;case ca:c[0]=f*t;c[1]=f*p;c[2]=g*n;c[3]=g*m;break;case 6:c[0]=k*g*h+e*f*l;c[1]=e*f*h-k*g*l;c[2]=e*g*l+k*f*h;c[3]=e*g*h-k*f*l;break;case 7:c[0]=e*g*l+k*f*h;c[1]=k*g*h+e*f*l;c[2]=
e*f*h-k*g*l;c[3]=e*g*h-k*f*l;break;case 8:c[0]=e*f*h-k*g*l;c[1]=e*g*l+k*f*h;c[2]=k*g*h+e*f*l;c[3]=e*g*h-k*f*l;break;case 9:c[0]=k*g*h-e*f*l;c[1]=e*g*l-k*f*h;c[2]=e*f*h+k*g*l;c[3]=e*g*h+k*f*l;break;case 10:c[0]=e*f*h+k*g*l;c[1]=k*g*h-e*f*l;c[2]=e*g*l-k*f*h;c[3]=e*g*h+k*f*l;break;case 11:c[0]=e*g*l-k*f*h,c[1]=e*f*h+k*g*l,c[2]=k*g*h-e*f*l,c[3]=e*g*h+k*f*l}return c};a.quat_to_ordered_angles=function(a,b,c){var d=a[0],f=a[1],e=a[2];a=a[3];switch(b){case fa:c[0]=Math.atan2(d*f+e*a,f*a-d*e);c[1]=Math.acos(1-
2*(f*f+e*e));c[2]=Math.atan2(d*f-e*a,d*e+f*a);break;case aa:c[0]=Math.atan2(d*a+f*e,e*a-d*f);c[1]=Math.acos(1-2*(d*d+e*e));c[2]=Math.atan2(f*e-d*a,d*f+e*a);break;case ha:c[0]=Math.atan2(d*e+f*a,d*a-f*e);c[1]=Math.acos(1-2*(d*d+f*f));c[2]=Math.atan2(d*e-f*a,d*a+f*e);break;case 3:c[0]=Math.atan2(d*e-f*a,d*f+e*a);c[1]=Math.acos(1-2*(f*f+e*e));c[2]=Math.atan2(d*e+f*a,e*a-d*f);break;case Aa:c[0]=Math.atan2(d*f-e*a,d*a+f*e);c[1]=Math.acos(1-2*(d*d+e*e));c[2]=Math.atan2(d*f+e*a,d*a-f*e);break;case ca:c[0]=
Math.atan2(f*e-d*a,d*e+f*a);c[1]=Math.acos(1-2*(d*d+f*f));c[2]=Math.atan2(d*a+f*e,f*a-d*e);break;case 6:c[0]=Math.atan2(2*(d*a-f*e),1-2*(d*d+f*f));c[1]=Math.asin(2*(d*e+f*a));c[2]=Math.atan2(2*(e*a-d*f),1-2*(f*f+e*e));break;case 7:c[0]=Math.atan2(2*(f*a-d*e),1-2*(f*f+e*e));c[1]=Math.asin(2*(d*f+e*a));c[2]=Math.atan2(2*(d*a-f*e),1-2*(d*d+e*e));break;case 8:c[0]=Math.atan2(2*(e*a-d*f),1-2*(d*d+e*e));c[1]=Math.asin(2*(d*a+f*e));c[2]=Math.atan2(2*(f*a-d*e),1-2*(d*d+f*f));break;case 9:c[0]=Math.atan2(2*
(d*a+f*e),1-2*(d*d+e*e));c[1]=Math.asin(2*(e*a-d*f));c[2]=Math.atan2(2*(d*e+f*a),1-2*(f*f+e*e));break;case 10:c[0]=Math.atan2(2*(d*e+f*a),1-2*(d*d+f*f));c[1]=Math.asin(2*(d*a-f*e));c[2]=Math.atan2(2*(d*f+e*a),1-2*(d*d+e*e));break;case 11:c[0]=Math.atan2(2*(d*f+e*a),1-2*(f*f+e*e)),c[1]=Math.asin(2*(f*a-d*e)),c[2]=Math.atan2(2*(d*a+f*e),1-2*(d*d+f*f))}return c};a.AE=function(a){var b=B.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),f=Math.cos(a[2]),e=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=
c*f,k=c*a,l=e*f,m=e*a;b[0]=d*f;b[1]=d*a;b[2]=-g;b[3]=g*l-k;b[4]=g*m+h;b[5]=d*e;b[6]=g*h+m;b[7]=g*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],f=a[2],e=a[3],g=f*f,h=c*d+f*e;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,e),b[2]=Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,e),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*e-2*d*f,1-2*c*c-2*g),b[1]=Math.atan2(2*d*e-2*c*f,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*f*e));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));d.transformQuat(b,
a,c);return c};a.dir_to_quat=function(a,b,c){c||(c=new Float32Array(4));a=d.normalize(a,O);var f=d.dot(b,a);a=d.cross(b,a,T);f=Math.acos(f);c[0]=a[0]*Math.sin(f/2);c[1]=a[1]*Math.sin(f/2);c[2]=a[2]*Math.sin(f/2);c[3]=Math.cos(f/2);return c};a.DJ=function(a,b,c,f){f||(f=new Float32Array(4));d.transformQuat(c,b,f);f[3]=-d.dot(a,f)};a.mE=function(a){var b=z.get_quat_view(a.g.i);switch(a.type){case "CAMERA":O[0]=0;O[1]=-1;O[2]=0;d.transformQuat(O,b,O);T[0]=0;T[1]=0;T[2]=-1;break;case "MESH":O[0]=0;O[1]=
0;O[2]=1;d.transformQuat(O,b,O);T[0]=0;T[1]=0;T[2]=1;break;case "EMPTY":O[0]=0,O[1]=1,O[2]=0,d.transformQuat(O,b,O),T[0]=0,T[1]=1,T[2]=0}O[1]=0;d.normalize(O,O);a=d.dot(O,T);return Math.acos(a)*(0<-O[0]*T[2]?-1:1)};a.Ku=function(a,b,c,d){if(0!=c){d=d||[];for(var f=0;f<a.length;f++)d[f]=(1-c)*a[f]+c*b[f]}};a.QN=function(){J++;return J.toString(16)};a.Ck=function(a){C[a]||(C[a]=0);var b=a+C[a];C[a]++;return b};a.qe=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};
a.Vb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,ha:0,Ma:null,G:[],U:b,va:[]}};a.Kh=function(a){return JSON.parse(JSON.stringify(a))};a.za=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.za(b[d]);break;default:for(d in c=new c,b)c[d]=a.za(b[d])}return c};a.bl=
function(a){var b=a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));B.fromMat4(a,t);var c=t[0],d=t[3],f=t[6],e=t[1],g=t[4],h=t[7],k=t[2],l=t[5],m=t[8],c=Math.sqrt(c*c+d*d+f*f)||1,e=Math.sqrt(e*e+g*g+h*h)||1,k=Math.sqrt(k*k+l*l+m*m)||1;t[0]/=
c;t[3]/=c;t[6]/=c;t[1]/=e;t[4]/=e;t[7]/=e;t[2]/=k;t[5]/=k;t[8]/=k;G.fromMat3(t,b);G.normalize(b,b);return b};a.ix=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.hx=function(a){K[0]=.577350269189626;K[1]=.577350269189626;K[2]=.577350269189626;K[3]=0;F.transformMat4(K,a,K);return F.length(K)};a.Ln=function(a,c){var d=c.left,f=c.right,e=c.top,g=c.bottom,h=c.near,k=c.far;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];f[0]=a[3]-a[0];f[1]=a[7]-a[4];
f[2]=a[11]-a[8];f[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];b(d);b(f);b(e);b(g);b(h);b(k)};a.GN=function(a,b,c){return c<-v.point_plane_dist(a,b.left)||c<-v.point_plane_dist(a,b.right)||c<-v.point_plane_dist(a,b.top)||c<-v.point_plane_dist(a,b.bottom)||c<-v.point_plane_dist(a,
b.near)||c<-v.point_plane_dist(a,b.far)?!0:!1};a.vE=function(a,b,c,f,e){g=d.dot(c,b.far);h=d.dot(f,b.far);k=d.dot(e,b.far);g=Math.sqrt(g*g+h*h+k*k);if(g<-v.point_plane_dist(a,b.near)||g<-v.point_plane_dist(a,b.far))return!0;var g=d.dot(c,b.left),h=d.dot(f,b.left),k=d.dot(e,b.left);if(Math.sqrt(g*g+h*h+k*k)<-v.point_plane_dist(a,b.left))return!0;g=d.dot(c,b.right);h=d.dot(f,b.right);k=d.dot(e,b.right);if(Math.sqrt(g*g+h*h+k*k)<-v.point_plane_dist(a,b.right))return!0;g=d.dot(c,b.top);h=d.dot(f,b.top);
k=d.dot(e,b.top);if(Math.sqrt(g*g+h*h+k*k)<-v.point_plane_dist(a,b.top))return!0;g=d.dot(c,b.bottom);h=d.dot(f,b.bottom);k=d.dot(e,b.bottom);return Math.sqrt(g*g+h*h+k*k)<-v.point_plane_dist(a,b.bottom)?!0:!1};a.bk=function(a,b,c,d){d||(d=0);for(var f=a.length,e=0;e<f;e+=3){var g=a[e],h=a[e+1],k=a[e+2];c[d+e]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+e+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+e+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.LK=function(a,b,c){for(var d=0,d=0,f=a.length,e=0;e<f;e+=3){var g=a[e],h=a[e+1],k=a[e+
2];c[d+e]=b[0]*g+b[4]*h+b[8]*k;c[d+e+1]=b[1]*g+b[5]*h+b[9]*k;c[d+e+2]=b[2]*g+b[6]*h+b[10]*k}};a.zJ=function(a,b,c){for(var d=0,d=0,f=a.length,e=0;e<f;e+=4){var g=a[e],h=a[e+1],k=a[e+2];c[d+e]=b[0]*g+b[4]*h+b[8]*k;c[d+e+1]=b[1]*g+b[5]*h+b[9]*k;c[d+e+2]=b[2]*g+b[6]*h+b[10]*k;c[d+e+3]=a[e+3]}};a.JK=function(a,b,c){c||(c=new Float32Array(3));K[0]=a[0];K[1]=a[1];K[2]=a[2];K[3]=0;F.transformMat4(K,b,K);c[0]=K[0];c[1]=K[1];c[2]=K[2]};a.mM=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";
var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var f=0;f<c;f++)for(var e=0;e<d;e++)b[f*d+e]=a[f][e];return b};a.KK=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.ln=function(b,c,d,f){if(f<d)return d;var e=d+Math.floor((f-d)/2);return b[e]>c?a.ln(b,c,d,e-1):b[e]<c?a.ln(b,c,e+1,f):e};a.Bg=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.TL=function(a,b,c){for(var d=
0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.vN=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.FJ=function(a,b,c,d,f){f||(f=new Float32Array(16));b=H.fromRotationTranslation(c,d,Q);H.multiply(b,a,f);return f};a.transform_vec3=function(a,b,c,f,e){e||(e=new Float32Array(3));c=H.fromRotationTranslation(c,f,Q);1!==b&&(f=H.identity(N),b=d.set(b,b,b,O),H.scale(f,b,f),H.multiply(c,f,c));d.transformMat4(a,
c,e);return e};a.ON=function(a,b,c,d,f){f||(f=new Float32Array(4));b=H.fromRotationTranslation(c,d,Q);F.transformMat4(a,b,f);return f};a.XM=function(a,b,c,f,e){e||(e=new Float32Array(3));b=H.fromRotationTranslation(c,f,Q);H.invert(b,b);d.transformMat4(a,b,e);return e};a.NN=function(a,b,c){c||(c=new Float32Array(16));H.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.mN=function(b,c,d){a.ix(b,c);c[3]=a.hx(b);a.matrix_to_quat(b,d)};a.EL=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);
return JSON.stringify(b)};a.eI=function(a,b,c,f){f||(f=new Float32Array(3));d.subtract(b,a,O);d.transformQuat(O,c,O);d.subtract(b,O,f)};a.eF=function(){O[0]=0;O[1]=0;O[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),f=new Float32Array(16),e=new Float32Array(16);H.lookAt(O,[-1,0,0],[0,-1,0],a);H.scale(a,[-1,1,1],a);H.scale(a,[-1,1,-1],b);H.lookAt(O,[0,-1,0],[0,0,-1],c);H.scale(c,[1,1,-1],c);H.scale(c,[1,-1,-1],d);H.lookAt(O,[0,0,-1],[0,-1,0],f);
H.scale(f,[-1,1,1],f);H.scale(f,[-1,1,-1],e);return[a,b,c,d,f,e]};a.iF=function(){O[0]=0;O[1]=0;O[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),f=new Float32Array(16),e=new Float32Array(16);H.lookAt(O,[1,0,0],[0,-1,0],a);H.scale(a,[-1,1,-1],b);H.lookAt(O,[0,1,0],[0,0,1],c);H.scale(c,[1,-1,-1],d);H.lookAt(O,[0,0,1],[0,-1,0],f);H.scale(f,[-1,1,-1],e);return[a,b,c,d,f,e]};a.Ru=function(a,b){return c(a,b)};a.hash_code=c;a.QM=k;a.YG=function(a,b){b[15]=
1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.deg_to_rad=function(a){return a*Math.PI/180};a.rad_to_deg=function(a){return 180*
a/Math.PI};a.bt=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),f=.211324865405187*c+.211324865405187*d,b=a[0]-c+f;a=a[1]-d+f;var e=b>a?1:0,g=1-e,f=b+.211324865405187-e,k=a+.211324865405187-g,l=b+-.577350269189626,m=a+-.577350269189626,c=c%289,d=d%289,n=r(r(d)+c),g=r(r(d+g)+c+e),q=r(r(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(f*f+k*k),0),e=Math.max(.5-(l*l+m*m),0),p=2*h(.024390243902439*n)-1,t=2*h(.024390243902439*g)-1,x=2*h(.024390243902439*
q)-1,n=Math.abs(p)-.5,g=Math.abs(t)-.5,q=Math.abs(x)-.5,p=p-Math.floor(p+.5),t=t-Math.floor(t+.5),x=x-Math.floor(x+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(p*p+n*n)),d=d*d*d*d*(1.79284291400159-.85373472095314*(t*t+g*g)),e=e*e*e*e*(1.79284291400159-.85373472095314*(x*x+q*q));return 130*(c*(p*b+n*a)+d*(t*f+g*k)+e*(x*l+q*m))};a.Wu=function(a){var b=1/7,c=b/2,d=g(Math.floor(a[0])),f=g(Math.floor(a[1])),e=h(a[0]);a=h(a[1]);var k=e-.5,l=e-1.5,e=a-.5;a-=1.5;var m=q(d),n=q(d+1),r=m,d=n,m=q(m+f),
n=q(n+f),r=q(r+f+1),d=q(d+f+1),f=k+.7*(y(m)*b+c),p=l+.7*(y(n)*b+c),k=k+.7*(y(r)*b+c),l=l+.7*(y(d)*b+c),m=e+.7*(y(Math.floor(m*b))*b+c),e=e+.7*(y(Math.floor(n*b))*b+c),r=a+.7*(y(Math.floor(r*b))*b+c),b=a+.7*(y(Math.floor(d*b))*b+c);return Math.min(f*f+m*m,p*p+e*e,k*k+r*r,l*l+b*b)};a.quat_project=function(a,b,c,f,e){e||(e=new Float32Array(4));a=d.transformQuat(b,a,O);b=c[0];var g=c[1];c=c[2];t[0]=g*g+c*c;t[1]=-g*b;t[2]=-c*b;t[3]=-b*g;t[4]=b*b+c*c;t[5]=-c*g;t[6]=-b*c;t[7]=-g*c;t[8]=b*b+g*g;d.transformMat3(a,
t,a);d.normalize(a,a);G.rotationTo(f,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=K,d=w,c=G.setAxisAngle([0,1,0],Math.PI,G.create()),d=G.setAxisAngle([1,0,0],Math.PI/2,G.create());G.multiply(c,d,c);G.multiply(a,c,b);return b};a.cleanup=function(){J=0;C={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,f){f||(f=new Float32Array(a.length));c=Math.exp(-c/d);
for(d=0;d<f.length;d++)f[d]=(1-c)*a[d]+c*b[d];return f};a.Ey=function(a,b,c,d,f){f||(f=new Float32Array(a.length));G.slerp(a,b,Math.exp(-c/d),f)};a.YM=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=B.fromQuat(a,t);T[0]=0;T[1]=1;T[2]=0;O[0]=c[3];O[1]=c[4];O[2]=c[5];var f=d.cross(T,O,O);
d.normalize(f,f);var e=c[7];!b&&0<e&&(f[0]*=-1,f[1]*=-1,f[2]*=-1);T[0]=c[0];T[1]=c[1];T[2]=c[2];d.normalize(T,T);G.rotationTo(T,f,w);G.multiply(w,a,a)};a.Yv=function(a,b,c,d){c=c*b-.5;var f=d*b-.5;d=c-Math.floor(c);var e=f-Math.floor(f);c=Math.floor(c);var f=Math.floor(f),g=b-1,h=a[f*b+c],k=a[f*b+Math.min(c+1,g)],l=a[Math.min(f+1,g)*b+c];a=a[Math.min(f+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-e)+(l*(1-d)+a*d)*e};a.Bi=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.jy=function(a){for(var b=
[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.lm=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.hr=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Il=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,
c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];d.normalize(c,c)};a.EJ=function(a,b,c){var d=a[0],f=a[1];a=a[2];var e=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*f,l=h*d-e*a,m=e*f-g*d,n=g*m-h*l,h=h*k-e*m,e=e*l-g*k;c[0]=d+2*k*b+2*n;c[1]=f+2*l*b+2*h;c[2]=a+2*m*b+2*e};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.da=function(a){a&&E.error.apply(E,arguments);throw"engine panic:\nThe engine tried to perform an invalid operation and halted.\nPlease copy the console contents above and submit it to the Blend4Web forum at\nhttps://www.blend4web.com/en/forums/forum/17/";
};a.angle_wrap_periodic=f;a.angle_wrap_0_2pi=l;a.nr=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Qy=function(a,b){for(var c in a){var d=!0,f=a[c],e=b[c];switch(typeof f){case "number":case "string":case "boolean":d=f==e;break;case "object":d=n(f,e)}if(!d)return!1}return!0};a.ys=function(a,b){var c=a[0],d=a[2],f=a[3];b[0]=a[1];b[1]=d;b[2]=f;b[3]=c};a.Rv=function(a){a+=1;132651<a&&E.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/
51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,f){K.set(a);K[3]=b;O[0]=c[3];O[1]=c[4];O[2]=c[5];w.set(O);w[3]=0;a=F.dot(K,w);if(0==a)return null;d.copy(c,O);w.set(O);w[3]=1;a=-F.dot(K,w)/a;f[0]=c[0]+a*c[3];f[1]=c[1]+a*c[4];f[2]=c[2]+a*c[5];return f};a.NF=function(a,b,c,d){var f=b[0]-a[0],e=c[0]-a[0],g=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=g*a-b*h;d[1]=e*b-f*a;d[2]=f*h-g*e;return d};a.VL=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.ly=function(a,b,c){var f=
d.dot(a,b);-.9999999>f?(d.cross(Y,a,O),1E-6>d.length(O)&&d.cross(ka,a,O),d.normalize(O,O),G.setAxisAngle(O,Math.PI,c)):(d.cross(a,b,O),c.set(O),c[3]=1+f,G.normalize(c,c));return c};a.Ih=function(a,b,c){if(b==c)return c-a;a=l(a);b=l(b);c=l(c);b=2*Math.PI-b;c=l(c+b);a=l(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.jC=function(a,b){for(var c=0;c<a.length;c++)for(var d=
0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.aM=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.Ez=function(a,b){for(var c=Math.max(a.length,b.length),d=0;d<c;d++){var f=e((d>=a.length?0:a[d])-(d>=b.length?0:b[d]));if(f)return f}return 0};a.oh=function(a){return a.join(".")};a.Oy=function(a){return a.split(".").map(function(a){return a|0})};a.Ky=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2)};a.Rr=function(a,b){b[0]=Math.pow(a[0],1/2.2);
b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.Ul=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=A(b[1]),b.join("://")):A(a)};a.al=function(a){return 0!=parseInt(a.toString(2).substr(1),2)}};b4w.module.__sfx=function(a,p){function e(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;B.warn("deprecated WebAudio implementation");return null}B.warn("WebAudio is not supported");return null}function b(a,b,d){var f=a.I;if("NONE"!=f.behavior){var e=f.loop,g=f.pitch;if(f.src&&(e||0<=d)){f.Xp=Math.floor(5E4*Math.random());var l=T.currentTime+b,l=Math.max(0,l);f.Gd=l;f.state=20;c(a);"POSITIONAL"==f.behavior||"BACKGROUND_SOUND"==f.behavior?(b=T.createBufferSource(),
b.buffer=f.src,b.playbackRate.value=g,E.ud(b.onended)&&(b.onended=function(){f.state=50}),e?(f.Qb&&f.Qb.disconnect(),b.loop=!0,b.start(l),f.duration=0):(e=b.buffer?b.buffer.duration:0,d>e?(e=l+d+f.rd,b.loop=!0,b.start(l),b.stop(e),f.duration=d):(b.loop=!1,b.start(l),f.duration=e)),b.connect(f.Sc),f.Qb=b,k(f),r(f)):"BACKGROUND_MUSIC"==f.behavior&&(H.clear_timeout(f.aq),H.clear_timeout(f.bq),d=function(){var b=a.I,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.Qb=b.Qb||T.createMediaElementSource(c),b.Qb.connect(b.Sc),
20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==b?d():f.aq=H.set_timeout(d,1E3*b),f.duration=e?0:u(a));h(f,l)}}}function c(a){var b=a.I;if(!b.Sc){var c=v.get_trans_view(a.g.i);a=v.get_quat_view(a.g.i);if(d.vo){var f=T.createBiquadFilter();f.type="peaking"}else f=null;var e=T.createGain();switch(b.behavior){case "POSITIONAL":var g=T.createPanner();"string"!=typeof g.panningModel?(g.panningModel=g.EQUALPOWER,g.distanceModel=g.INVERSE_DISTANCE):(g.panningModel="equalpower",g.distanceModel=
"inverse");g.setPosition(c[0],c[1],c[2]);z.copy(c,b.Mr);c=F;E.quat_to_dir(a,E.AXIS_MY,c);g.setOrientation(c[0],c[1],c[2]);z.copy(c,b.direction);g.refDistance=b.dist_ref;g.maxDistance=b.dist_max;g.rolloffFactor=b.attenuation;g.coneInnerAngle=b.hv;g.coneOuterAngle=b.iv;g.coneOuterGain=b.jv;var h=T.createGain();h.gain.value=n(b);f?(g.connect(f),f.connect(h)):g.connect(h);h.connect(e);b.Sc=g;if(b.Pi){var k=T.createGain();e.connect(k);k.connect(T?K.Ba.Sc:null)}else k=null,e.connect(T?K.Ba.Sc:null);break;
case "BACKGROUND_SOUND":g=null;h=T.createGain();h.gain.value=n(b);f?(b.Sc=f,f.connect(h)):b.Sc=h;h.connect(e);b.Pi?(k=T.createGain(),e.connect(k),k.connect(T?K.Ba.Sc:null)):(k=null,e.connect(T?K.Ba.Sc:null));break;case "BACKGROUND_MUSIC":k=g=null,h=T.createGain(),h.gain.value=n(b),f?(b.Sc=f,f.connect(h)):b.Sc=h,h.connect(e),e.connect(T?K.Ba.Sc:null)}b.Yl=g;b.Te=f;b.rj=h;b.Vh=e;b.$x=k}}function m(a){var c=a.I,d=c.duration,c=c.delay+c.xv*Math.random();b(a,c,d)}function k(a){a.Pi&&a.$x.gain.cancelScheduledValues(a.Gd);
a.$j&&a.Qb.playbackRate.cancelScheduledValues(a.Gd);a.Im=a.Gd}function r(a){if(a.Pi||a.$j){var b=a.$x,c=a.Qb,d=c.buffer?c.buffer.duration:0;if(d){var f=a.Gd;t[0]=a.Xp;for(var e=0;5>e;){var g=a.pitch+a.$j*E.ie(t);if(f>=a.Im){if(a.Pi){var h=1-E.clamp(a.Pi,0,1)*Math.random();b.gain.setValueAtTime(h,f)}a.$j&&c.playbackRate.setValueAtTime(g,f);e++}f+=d/g}a.Im=f-.001}}}function h(a,b){if(a.Wh||a.rd){var c=a.Vh;c.gain.cancelScheduledValues(b);a.Wh?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,
b+a.Wh)):c.gain.setValueAtTime(1,b);a.rd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.rd))}}function q(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.I;if(50==b.state)b.state=30;else if(20==b.state||40==b.state){var c=b.Vh,d=T.currentTime;b.rd&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.rd));"BACKGROUND_MUSIC"==b.behavior?b.src&&(H.clear_timeout(b.aq),H.clear_timeout(b.bq),b.bq=H.set_timeout(function(){var b=
a.I.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.rd)):(c=b.Qb,b.duration<c.buffer.duration?b.rd&&20==b.state?c.stop(d+b.rd):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.Gd=0,b.ss=0,b.kq=0);b.state=30}}function g(a){a=a.I;if(20==a.state){var b=T.currentTime;a.ss=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Gd){t[0]=a.Xp;for(var d=a.Qb.buffer.duration,f=a.Gd;f<b;)c=a.pitch+a.$j*E.ie(t),f+=d/c;c*=d/c-(f-b)}else c=0;a.kq=c;a.Qb.stop(0);a.Qb.disconnect();
k(a)}a.state=40}}function y(a){var b=a.I;if(40==b.state){var c=T.currentTime;b.Gd+=c-b.ss;"BACKGROUND_MUSIC"==b.behavior?b.src.play():(f(a),b.Im=c,a=b.Qb,E.ud(a.onended)&&(a.onended=function(){b.state=50}),a.start(b.Gd,b.kq),r(b));h(b,b.Gd);b.state=20}}function f(a){a=a.I;var b=T.createBufferSource();b.loop=a.Qb.loop;b.buffer=a.Qb.buffer;b.playbackRate.value=a.Qb.playbackRate.value;a.Yl?b.connect(a.Yl):b.connect(a.rj);a.Qb=b}function l(a){a=a.I;return!a||20!=a.state&&40!=a.state&&30!=a.state&&50!=
a.state?!1:!0}function n(a){return a.muted?0:a.volume}function u(a){a=a.I;return(a=a.src)?a.duration:0}var A=p("__config"),B=p("__print"),H=p("__time"),v=p("__tsr"),E=p("__util"),z=p("__vec3"),G=A.q,d=A.I;a.Vt=10;a.Ep=20;a.Ut=30;var F=new Float32Array(3),J=new Float32Array(3),C=new Float32Array(3),D=[],O=[],T=null,K=null,w=[],t=[1],Q=null;a.LD=function(){return{mh:-1,Ff:"",behavior:"NONE",Rh:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,hv:360,iv:360,jv:1,cyclic:!1,loop:!1,delay:0,
xv:0,Pi:0,$j:0,Wh:0,rd:0,Gd:0,ss:0,kq:0,duration:0,Im:0,Xp:1,src:null,state:10,Mr:new Float32Array(3),direction:new Float32Array(3),ft:new Float32Array(3),aq:-1,bq:-1,Uh:0}};a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(D.push("ogg"),D.push("ogv")),""!=a.canPlayType("audio/mpeg")&&D.push("mp3"),""!=a.canPlayType("audio/mp4")&&(D.push("mp4"),D.push("m4v")),""!=a.canPlayType("audio/webm")&&D.push("webm"));b.canPlayType&&
(""!=b.canPlayType("video/ogg")&&O.push("ogv"),""!=b.canPlayType("video/mp4")&&O.push("m4v"),""!=b.canPlayType("video/webm")&&O.push("webm"));(T=d.Ot?e():null)&&B.log("%cINIT WEBAUDIO: "+T.sampleRate+"Hz","color: #00a")};a.Du=function(a){var b={hi:new Float32Array(3),cx:new Float32Array(3),Hj:new Float32Array(3)};a.Ba=b;if(T){var c=T.createGain(),d=T.createGain();b.rj=c;b.Vh=d;c.connect(d);d.connect(T.destination);if(a.b4w_enable_dynamic_compressor){var d=T.createDynamicsCompressor(),f=a.b4w_dynamic_compressor_settings;
d.threshold.value=f.threshold;d.knee.value=f.knee;d.ratio.value=f.ratio;d.attack.value=f.attack;d.release.value=f.release;d.connect(c);b.kl=d;b.Sc=d}else b.kl=null,b.Sc=c;c=T.listener;b.Rh=G.Rq;b.Rh||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.Uh=0}};a.nI=function(a){K=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<D.indexOf(a)?a:"ogg"==a&&-1<D.indexOf("mp4")?"mp4":"mp3"==a&&-1<D.indexOf("ogg")?"ogg":"mp4"==a&&-1<D.indexOf("ogg")?
"ogg":"ogv"==a&&-1<D.indexOf("m4v")?"m4v":"webm"==a&&-1<D.indexOf("m4v")?"m4v":"m4v"==a&&-1<D.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<O.indexOf(a)?a:"ogv"==a&&-1<O.indexOf("m4v")?"m4v":"webm"==a&&-1<O.indexOf("m4v")?"m4v":"m4v"==a&&-1<O.indexOf("webm")?"webm":""};a.lh=function(a,b){var c=a.data,d=b.I;d.mh=a.data.sound.uuid;d.Ff=a.data.sound.filepath;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=T?c.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var f;T?(window.MediaElementAudioSourceNode?f=!0:(B.warn("MediaElementAudioSourceNode not found"),f=!1),f=f?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):f="NONE";d.behavior=f;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.Rh=c.b4w_disable_doppler||G.Rq;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.hv=c.cone_angle_inner;d.iv=c.cone_angle_outer;d.jv=c.cone_volume_outer;
d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.xv=c.b4w_delay_random;d.Pi=c.b4w_volume_random;d.$j=c.b4w_pitch_random;d.Wh=c.b4w_fade_in;d.rd=c.b4w_fade_out;w.push(b)};a.Gy=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.I.behavior){case "POSITIONAL":return a.Ep;case "BACKGROUND_SOUND":return a.Ep;case "BACKGROUND_MUSIC":return a.Ut;case "NONE":return a.Vt;default:throw"Wrong speaker behavior";}};a.nK=function(a,b){var c=a.I;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=
b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Qx=function(){var a=T.createBufferSource();a.buffer=T.createBuffer(1,22050,22050);a.connect(T.destination);a.start(0)};a.fE=function(a,b,c){T?T.decodeAudioData(a,b,c):c()};a.hJ=function(a){q(a);a.I=null;w.splice(w.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<w.length;a++){var b=w[a].I;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Qb&&b.Qb.disconnect()}K&&K.Ba&&(a=K.Ba,a.hi[0]=0,a.hi[1]=0,a.hi[2]=0,a.Hj[0]=0,a.Hj[1]=
0,a.Hj[2]=0);K=null;w.splice(0);Q=null};a.update=function(a){if(T&&0!=w.length){for(var b=0;b<w.length;b++){var c=w[b],d=c.I,f=d.Qb,e=T.currentTime;!d.loop&&20==d.state&&d.duration&&d.Gd+d.duration<e&&("BACKGROUND_MUSIC"==d.behavior||f&&!E.ud(f.onended))&&(d.state=50);d.cyclic&&50==d.state&&m(c);20==d.state&&3>d.Im-e&&r(d)}Q&&Q.eg.length&&(-1==Q.Bb||a>Q.vu+Q.Cv[Q.Bb])&&(b=Q,-1<b.Bb&&q(b.eg[b.Bb]),-1==b.Bb&&b.random?c=Math.round(Math.random()*(b.eg.length-1)):b.random?(c=1+Math.round(Math.random()*
(b.eg.length-2)),c=(b.Bb+c)%b.eg.length):c=(b.Bb+1)%b.eg.length,m(b.eg[c]),b.Bb=c,b.vu=a)}};a.play=b;a.play_def=m;a.stop=q;a.is_playing=function(a){return 20==a.I.state};a.gJ=g;a.iJ=y;a.playrate=function(a,b){var c=a.I;c.pitch=b;!l(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.Qb.playbackRate.value=b,k(c),r(c))};a.get_playrate=function(a){return a.I.pitch};a.cyclic=function(a,b){a.I.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.I.cyclic};a.LG=function(a,b,c,d){if(T&&a.Ba){var f=
F;f[0]=0;f[1]=-1;f[2]=0;z.transformQuat(f,c,f);J[0]=0;J[1]=0;J[2]=-1;z.transformQuat(J,c,J);c=T.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(f[0],f[1],f[2],J[0],J[1],J[2]);z.copy(f,a.Ba.cx);!a.Ba.Rh&&d&&(C[0]=(b[0]-a.Ba.hi[0])/d,C[1]=(b[1]-a.Ba.hi[1])/d,C[2]=(b[2]-a.Ba.hi[2])/d,E.smooth_v(C,a.Ba.Hj,d,.3,C),c.setVelocity(C[0],C[1],C[2]),z.copy(C,a.Ba.Hj));z.copy(b,a.Ba.hi)}};a.listener_reset_speed=function(a,b){if(T&&K.Ba&&!K.Ba.Rh){var c=F;b?z.copy(b,c):z.copy(K.Ba.cx,c);z.scale(c,a,c);
T.listener.setVelocity(c[0],c[1],c[2]);z.copy(c,K.Ba.Hj)}};a.jJ=function(a,b){var c=a.I;if(l(a)&&"POSITIONAL"==c.behavior){var d=v.get_trans_view(a.g.i),f=v.get_quat_view(a.g.i),e=c.Yl;e.setPosition(d[0],d[1],d[2]);var g=F;E.quat_to_dir(f,E.AXIS_MY,g);e.setOrientation(g[0],g[1],g[2]);f=c.Mr;!c.Rh&&b&&(J[0]=(d[0]-f[0])/b,J[1]=(d[1]-f[1])/b,J[2]=(d[2]-f[2])/b,E.smooth_v(J,c.ft,b,.3,J),e.setVelocity(J[0],J[1],J[2]),z.copy(J,c.ft));z.copy(d,f)}};a.speaker_reset_speed=function(a,b,c){var d=a.I;if(l(a)&&
"POSITIONAL"==d.behavior&&!d.Rh){var f=F;c?z.copy(c,f):z.copy(d.direction,f);z.scale(f,b,f);d.Yl.setVelocity(f[0],f[1],f[2]);z.copy(f,d.ft);a=v.get_trans_view(a.g.i);z.copy(a,d.Mr)}};a.rr=function(a){return a.I.behavior};a.check_active_speakers=function(){for(var a=0;a<w.length;a++)if(l(w[a]))return!0;return!1};a.FI=function(a){var b=K.Ba;b&&(b.volume=a,T&&(b.rj.gain.value=n(b)))};a.KF=function(){var a=K.Ba;return a?a.volume:0};a.set_volume=function(a,b){var c=a.I;c.volume=b;l(a)&&(c.rj.gain.value=
n(c))};a.get_volume=function(a){return a.I.volume};a.mute=function(a,b){a.I.muted=Boolean(b);l(a)&&(a.I.rj.gain.value=n(a.I))};a.is_muted=function(a){return a.I.muted};a.nH=function(a){var b=K.Ba;b&&(b.muted=Boolean(a),T&&(b.rj.gain.value=n(b)))};a.pG=function(){var a=K.Ba;return a?a.muted:!1};a.get_speaker_objects=function(){return w};a.pause=function(){for(var a=0;a<w.length;a++)g(w[a])};a.resume=function(){for(var a=0;a<w.length;a++)y(w[a])};a.set_compressor_params=function(a,b){if(a.Ba&&a.Ba.kl){var c=
a.Ba.kl;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.Ba||!a.Ba.kl)return null;a=a.Ba.kl;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(l(a)){a=a.I;var d=a.Vh,f=T.currentTime;d.gain.setValueAtTime(d.gain.value,f);d.gain.linearRampToValueAtTime(b,f+c);a.Uh=c}};a.unduck=function(a){if(l(a)){a=
a.I;var b=a.Vh,c=T.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Uh);a.Uh=0}};a.rE=function(a,b){if(T){var c=K.Ba,d=c.Vh,f=T.currentTime;d.gain.setValueAtTime(d.gain.value,f);d.gain.linearRampToValueAtTime(a,f+b);c.Uh=b}};a.JJ=function(){if(T){var a=K.Ba,b=a.Vh,c=T.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Uh);a.Uh=0}};a.apply_playlist=function(a,b,c){Q={Bb:-1,vu:0,random:c,eg:[],Cv:[]};for(c=0;c<a.length;c++){var d=
a[c],f=u(d);0==f?B.warn("Ignoring speaker with zero duration: "+d.name):(q(d),d.I.cyclic=!1,Q.eg.push(d),Q.Cv.push(f+b))}};a.get_duration=u;a.clear_playlist=function(){if(Q)for(var a=Q.eg,b=0;b<a.length;b++)q(a[b]);Q=null};a.get_positional_params=function(a){return(a=a.I)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.I;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=
b.attenuation;var d=c.Yl;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.I;c&&c.Te&&(c.Te.frequency.value=b.freq,c.Te.Q.value=b.Q,c.Te.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.I)&&a.Te?{freq:a.Te.frequency.value,Q:a.Te.Q.value,gain:a.Te.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.I;if(!a||!a.Te)return null;a.Te.getFrequencyResponse(b,c,d)}};b4w.module.__input=function(a,p){function e(a){return(20!=a||navigator.getVRDevices||N.Ve)&&(10!=a||N.Ve&&window.DeviceOrientationEvent&&N.gyro_use)?!0:!1}function b(a,b){if(!e(a))return null;var c={type:a,$f:!1,ge:[],we:[],Sf:[],Tf:[],Uf:[],Vf:[],Nf:[],Of:[],lg:[],kg:[],jg:[],element:b,Zf:!0,gb:[],wo:new Float32Array(2),jH:0,Hm:"",distortion_coefs:new Float32Array(2),chromatic_aberration_coefs:new Float32Array(4),Jk:null,lf:null,Gf:new Float32Array(4),Hf:new Float32Array(4),Jg:0,xg:0,dg:0,kE:"",
th:0,Lf:0,yg:0,Zh:[],sj:[0,0,0,0],Wb:{}};c.Gf[0]=c.Gf[1]=c.Gf[2]=c.Gf[3]=45;c.Hf[0]=c.Hf[1]=c.Hf[2]=c.Hf[3]=45;30==a||40==a||50==a?(c.$f=Boolean(b),50==a?document.addEventListener("touchstart",function(){}):40==a&&(c.Zf=!1)):10==a&&(c.$f=!0);return c}function c(c,d){10==c||20==c?d=window:d||(d=D.get_container());for(var f=0;f<ga.length;f++)if(ga[f].type==c&&ga[f].element==d)return ga[f];f=b(c,d);if(60==c||70==c||80==c||90==c)f.Wb[a.DPAD_UP_GAMEPAD_BTN]=a.DPAD_UP_GAMEPAD_BTN,f.Wb[a.DPAD_DOWN_GAMEPAD_BTN]=
a.DPAD_DOWN_GAMEPAD_BTN,f.Wb[a.DPAD_RIGHT_GAMEPAD_BTN]=a.DPAD_RIGHT_GAMEPAD_BTN,f.Wb[a.DPAD_LEFT_GAMEPAD_BTN]=a.DPAD_LEFT_GAMEPAD_BTN,f.Wb[a.FACE_UP_GAMEPAD_BTN]=a.FACE_UP_GAMEPAD_BTN,f.Wb[a.FACE_DOWN_GAMEPAD_BTN]=a.FACE_DOWN_GAMEPAD_BTN,f.Wb[a.FACE_RIGHT_GAMEPAD_BTN]=a.FACE_RIGHT_GAMEPAD_BTN,f.Wb[a.FACE_LEFT_GAMEPAD_BTN]=a.FACE_LEFT_GAMEPAD_BTN,f.Wb[a.R1_GAMEPAD_BTN]=a.R1_GAMEPAD_BTN,f.Wb[a.R2_GAMEPAD_BTN]=a.R2_GAMEPAD_BTN,f.Wb[a.L1_GAMEPAD_BTN]=a.L1_GAMEPAD_BTN,f.Wb[a.L2_GAMEPAD_BTN]=a.L2_GAMEPAD_BTN,
f.Wb[a.SELECT_GAMEPAD_BTN]=a.SELECT_GAMEPAD_BTN,f.Wb[a.START_GAMEPAD_BTN]=a.START_GAMEPAD_BTN,f.Wb[a.LEFT_ANALOG_GAMEPAD_BTN]=a.LEFT_ANALOG_GAMEPAD_BTN,f.Wb[a.RIGHT_ANALOG_GAMEPAD_BTN]=a.RIGHT_ANALOG_GAMEPAD_BTN,f.Wb[a.MAIN_GAMEPAD_BTN]=a.MAIN_GAMEPAD_BTN;f&&ga.push(f);return f}function m(a){var b="default",c;for(c in P)if(navigator.userAgent.match(P[c].Yq)){b=c;break}c=P[b];a.kE=b;a.th=c.th;a.Lf=c.Lf;a.yg=c.yg;a.Hm="cardboard_2";k(a);b=S[a.Hm];a.Jg=b.Jg;a.xg=b.xg;a.dg=b.dg;var d=a.xg-a.yg,b=a.Lf-
d;c=a.distortion_coefs;var d=w.rad_to_deg(Math.atan(r(c,d/a.dg))),f=w.rad_to_deg(Math.atan(r(c,b/a.dg))),e=w.rad_to_deg(Math.atan(r(c,b/a.dg))),b=w.rad_to_deg(Math.atan(r(c,b/a.dg)));a.Gf[0]=Math.min(f,60);a.Gf[1]=Math.min(e,60);a.Gf[2]=Math.min(d,60);a.Gf[3]=Math.min(b,60);a.Hf[0]=Math.min(f,60);a.Hf[1]=Math.min(b,60);a.Hf[2]=Math.min(d,60);a.Hf[3]=Math.min(e,60)}function k(a){var b=S[a.Hm];a.distortion_coefs[0]=b.distortion_coefs[0];a.distortion_coefs[1]=b.distortion_coefs[1];a.chromatic_aberration_coefs[0]=
b.chromatic_aberration_coefs[0];a.chromatic_aberration_coefs[1]=b.chromatic_aberration_coefs[1];a.chromatic_aberration_coefs[2]=b.chromatic_aberration_coefs[2];a.chromatic_aberration_coefs[3]=b.chromatic_aberration_coefs[3]}function r(a,b){var c=b*b;return b*(1+a[0]*c+a[1]*c*c)}function h(a,b){a.Hm="default";var c=b.filter(function(a){return a instanceof HMDVRDevice}),d=null;c.length&&(d=c[0],-1!==d.deviceName.toLowerCase().indexOf("oculus")&&(a.Hm="oculus"));c=null;d&&(c=b.filter(function(a){return-1!==
a.deviceName.toLowerCase().indexOf("oculus")&&a.hardwareUnitId==d.hardwareUnitId&&a instanceof PositionSensorVRDevice}));a.Jk=d;a.lf=c;k(a)}function q(a,b,c){switch(a.type){case 20:if(a.Jk){if((b=a.Jk.getEyeParameters(b))&&b.currentFieldOfView){var d=a.distortion_coefs;a=r(d,Math.tan(w.deg_to_rad(b.currentFieldOfView.downDegrees)));a=w.rad_to_deg(Math.atan(a));var f=r(d,Math.tan(w.deg_to_rad(b.currentFieldOfView.upDegrees))),f=w.rad_to_deg(Math.atan(f)),e=r(d,Math.tan(w.deg_to_rad(b.currentFieldOfView.leftDegrees))),
e=w.rad_to_deg(Math.atan(e));b=r(d,Math.tan(w.deg_to_rad(b.currentFieldOfView.rightDegrees)));b=w.rad_to_deg(Math.atan(b));c[0]=f;c[1]=b;c[2]=a;c[3]=e;break}}else Q.copy("left"==b?a.Gf:a.Hf,c);break;default:T.error("fov is undefined for device: ",a.type)}return c}function g(a,b){if(a){for(var c=0;c<a.buttons.length;c++)b.Zh[c]=a.buttons[c].pressed;a.axes&&4<=a.axes.length&&Q.copy(a.axes,b.sj)}}function y(a){for(var b=0;b<a.Zh;b++)a.Zh[b]=!1;a.sj[0]=0;a.sj[1]=0;a.sj[2]=0;a.sj[3]=0}function f(a,b){var c=
a.indexOf(b);0<=c&&(a[c]=null)}function l(a){return null===a}function n(a,b,c,e){switch(b){case 120:c&&f(a.ge,c);if(e||a.we.every(l)&&a.ge.every(l))a.ge.length=0,a.we.length=0,b=a.gb.indexOf(131),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("deviceorientation",u,!1));break;case 130:c&&f(a.we,c);if(e||a.we.every(l)&&a.ge.every(l))a.ge.length=0,a.we.length=0,b=a.gb.indexOf(131),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("deviceorientation",u,!1));break;case 40:c&&f(a.Sf,c);if(e||
a.Sf.every(l))a.Sf.length=0,b=a.gb.indexOf(b),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("mousedown",H,!1));break;case 30:c&&f(a.Tf,c);if(e||a.Tf.every(l))a.Tf.length=0,b=a.gb.indexOf(b),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("mousemove",B,!1));break;case 50:c&&f(a.Uf,c);if(e||a.Uf.every(l)){a.Uf.length=0;b=a.gb.indexOf(b);0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("mouseout",v,!1),a.element.removeEventListener("mouseup",E,!1));break}break;case 60:c&&f(a.Vf,c);
if(e||a.Vf.every(l))a.Vf.length=0,b=a.gb.indexOf(b),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("wheel",z,!1));break;case 80:c&&f(a.Nf,c);if(e||a.Nf.every(l))a.Nf.length=0,b=a.gb.indexOf(b),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("keydown",G,!1));break;case 70:c&&f(a.Of,c);if(e||a.Of.every(l))a.Of.length=0,b=a.gb.indexOf(b),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("keyup",d,!1));break;case 90:c&&f(a.lg,c);if(e||a.lg.every(l))a.lg.length=0,b=a.gb.indexOf(b),0<=
b&&(a.gb.splice(b,1),a.element.removeEventListener("touchstart",F,!1));break;case 100:c&&f(a.kg,c);if(e||a.kg.every(l))a.kg.length=0,b=a.gb.indexOf(b),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("touchmove",J,!1));break;case 110:if(c&&f(a.jg,c),e||a.jg.every(l))a.jg.length=0,b=a.gb.indexOf(b),0<=b&&(a.gb.splice(b,1),a.element.removeEventListener("touchend",C,!1))}}function u(a){var b=U;b[0]=w.deg_to_rad(a.alpha);b[1]=w.deg_to_rad(a.beta);b[2]=w.deg_to_rad(a.gamma);a=c(10,a.currentTarget);
for(var d=0;d<a.we.length;d++){var f=a.we[d];f&&(t.copy(b,Y),f(Y))}if(a.ge.length){var e=Z,e=w.ordered_angles_to_quat(b,w.ZXY,Z),b=w.deg_to_rad(window.orientation),b=K.setAxisAngle(w.AXIS_Z,-b,M);K.multiply(e,b,e);b=K.setAxisAngle(w.AXIS_X,-Math.PI/2,M);K.multiply(b,e,e);b=K.setAxisAngle(w.AXIS_X,Math.PI/2,M);K.multiply(e,b,e);for(d=0;d<a.ge.length;d++)if(f=a.ge[d])K.copy(e,ka),f(ka)}for(d=0;d<a.ge.length;d++)a.ge[d]||a.ge.splice(d,1);for(d=0;d<a.we.length;d++)a.we[d]||a.we.splice(d,1)}function A(a,
b){switch(a.type){case 30:a.wo[0]=b.clientX,a.wo[1]=b.clientY,a.jH=b.which}}function B(a){var b=c(30,a.currentTarget);A(b,a);for(var d=0;d<b.Tf.length;d++){var f=b.Tf[d];f&&(ea[0]=a.clientX,ea[1]=a.clientY,f(ea))}b.Zf&&a.preventDefault();for(d=0;d<b.Tf.length;d++)b.Tf[d]||b.Tf.splice(d,1)}function H(a){var b=c(30,a.currentTarget);A(b,a);for(var d=0;d<b.Sf.length;d++){var f=b.Sf[d];f&&f(a.which)}b.Zf&&a.preventDefault();for(d=0;d<b.Sf.length;d++)b.Sf[d]||b.Sf.splice(d,1)}function v(a){D.Dw(a.relatedTarget)||
E(a)}function E(a){var b=c(30,a.currentTarget);A(b,a);for(var d=0;d<b.Uf.length;d++){var f=b.Uf[d];f&&f(a.which)}b.Zf&&a.preventDefault();for(d=0;d<b.Uf.length;d++)b.Uf[d]||b.Uf.splice(d,1)}function z(a){for(var b=c(30,a.currentTarget),d=0;d<b.Vf.length;d++){var f=b.Vf[d];f&&f(-a.deltaY)}b.Zf&&a.preventDefault();for(d=0;d<b.Vf.length;d++)b.Vf[d]||b.Vf.splice(d,1)}function G(a){for(var b=c(40,a.currentTarget),d=0;d<b.Nf.length;d++){var f=b.Nf[d];f&&f(a.keyCode)}b.Zf&&a.preventDefault();for(d=0;d<b.Nf.length;d++)b.Nf[d]||
b.Nf.splice(d,1)}function d(a){for(var b=c(40,a.currentTarget),d=0;d<b.Of.length;d++){var f=b.Of[d];f&&f(a.keyCode)}b.Zf&&a.preventDefault();for(d=0;d<b.Of.length;d++)b.Of[d]||b.Of.splice(d,1)}function F(a){for(var b=c(50,a.currentTarget),d=0;d<b.lg.length;d++){var f=b.lg[d];f&&f(a.targetTouches)}for(d=0;d<b.lg.length;d++)b.lg[d]||b.lg.splice(d,1)}function J(a){for(var b=c(50,a.currentTarget),d=0;d<b.kg.length;d++){var f=b.kg[d];f&&f(a.targetTouches)}b.Zf&&a.preventDefault();for(d=0;d<b.kg.length;d++)b.kg[d]||
b.kg.splice(d,1)}function C(a){for(var b=c(50,a.currentTarget),d=0;d<b.jg.length;d++){var f=b.jg[d];f&&f(a.targetTouches)}for(d=0;d<b.jg.length;d++)b.jg[d]||b.jg.splice(d,1)}var D=p("__container"),O=p("__config"),T=p("__print"),K=p("__quat"),w=p("__util"),t=p("__vec3"),Q=p("__vec4"),N=O.q,P=O.lE,S=O.bG;a.DEVICE_GYRO=10;a.DEVICE_HMD=20;a.DEVICE_MOUSE=30;a.DEVICE_KEYBOARD=40;a.DEVICE_TOUCH=50;a.Lk=60;a.Nm=70;a.Om=80;a.Pm=90;a.HMD_ORIENTATION_QUAT=10;a.HMD_POSITION=20;a.eA=21;a.fA=22;a.dA=23;a.MOUSE_LOCATION=
30;a.MOUSE_DOWN_WHICH=40;a.MOUSE_UP_WHICH=50;a.MOUSE_WHEEL=60;a.KEYBOARD_UP=70;a.KEYBOARD_DOWN=80;a.TOUCH_START=90;a.TOUCH_MOVE=100;a.TOUCH_END=110;a.GYRO_ORIENTATION_QUAT=120;a.GYRO_ORIENTATION_ANGLES=130;a.DPAD_UP_GAMEPAD_BTN=12;a.DPAD_DOWN_GAMEPAD_BTN=13;a.DPAD_RIGHT_GAMEPAD_BTN=15;a.DPAD_LEFT_GAMEPAD_BTN=14;a.FACE_UP_GAMEPAD_BTN=3;a.FACE_DOWN_GAMEPAD_BTN=0;a.FACE_RIGHT_GAMEPAD_BTN=1;a.FACE_LEFT_GAMEPAD_BTN=2;a.R1_GAMEPAD_BTN=5;a.R2_GAMEPAD_BTN=7;a.L1_GAMEPAD_BTN=4;a.L2_GAMEPAD_BTN=6;a.SELECT_GAMEPAD_BTN=
8;a.START_GAMEPAD_BTN=9;a.LEFT_ANALOG_GAMEPAD_BTN=10;a.RIGHT_ANALOG_GAMEPAD_BTN=11;a.MAIN_GAMEPAD_BTN=16;var Z=K.create(),M=K.create(),U=t.create(),ea=new Float32Array(2);t.create();var Y=t.create(),ka=K.create(),ga=[];a.can_use_device=e;a.get_device_by_type_element=c;a.register_device=function(a){if(!a.$f)switch(a.type){case 20:navigator.getVRDevices?navigator.getVRDevices().then(function(b){h(a,b);b.length?a.$f=!0:T.gc("WebVR devices are not found.")}):(m(a),a.$f=!0);break;default:T.error("register_device() is undefined for device: ",
a.type)}};a.switch_prevent_default=function(a,b){a.Zf=b};a.reset_device=function(a){switch(a.type){case 20:if(a.$f&&a.lf)for(var b=0;b<a.lf.length;b++)a.lf[b].resetSensor();break;default:T.error("reset_device() is undefined for device: ",a.type)}};a.get_vector_param=function(a,b,c){switch(b){case 10:a:switch(a.type){case 20:t.copy(w.Kp,c);if(a.lf)for(b=0;b<a.lf.length;b++){var d=a.lf[b],d=d.getState&&d.getState()||d.getImmediateState&&d.getImmediateState();d.orientation&&(c[0]=d.orientation.x,c[1]=
d.orientation.y,c[2]=d.orientation.z,c[3]=d.orientation.w)}K.normalize(c,c);a=K.setAxisAngle(w.AXIS_X,Math.PI/2,Z);K.multiply(c,a,c);break a;default:T.error("orientation_quat is undefined for device: ",a.type)}return c;case 20:a:switch(a.type){case 20:if(a.lf)for(b=0;b<a.lf.length;b++)d=a.lf[b],d=d.getState&&d.getState()||d.getImmediateState&&d.getImmediateState(),d.position&&(c[0]=d.position.x,c[1]=d.position.y,c[2]=d.position.z);break a;default:T.error("position is undefined for device: ",a.type)}return c;
case 21:return q(a,"left",c);case 22:return q(a,"right",c);case 30:return c[0]=a.wo[0],c[1]=a.wo[1],c}};a.SF=function(a,b){switch(b){case 23:var c;a:{switch(a.type){case 20:if(a.Jk){c=a.Jk.getEyeParameters("left");c=a.Jk.getEyeParameters("right").eyeTranslation.x-c.eyeTranslation.x;break a}c=a.Jg;break a;default:T.error("eye_distance is undefined for device: ",a.type)}c=void 0}return c}};a.HF=function(a,b){return b<a.Zh.length?a.Zh[a.Wb[b]]:!1};a.update=function(){for(var a=navigator.getGamepads?
navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=0;b<ga.length;b++){var c=ga[b];switch(c.type){case 60:y(c);g(a[0],c);break;case 70:y(c);g(a[1],c);break;case 80:y(c);g(a[2],c);break;case 90:y(c),g(a[3],c)}}};a.attach_param_cb=function(a,b,c){if(a){switch(b){case 120:a.ge.push(c);b=131;break;case 130:a.we.push(c);b=131;break;case 40:a.Sf.push(c);break;case 30:a.Tf.push(c);break;case 50:a.Uf.push(c);break;case 60:a.Vf.push(c);break;case 80:a.Nf.push(c);break;case 70:a.Of.push(c);
break;case 90:a.lg.push(c);break;case 100:a.kg.push(c);break;case 110:a.jg.push(c)}if(-1==a.gb.indexOf(b)&&(a.gb.push(b),a.$f))switch(b){case 40:a.element.addEventListener("mousedown",H,!1);break;case 30:a.element.addEventListener("mousemove",B,!1);break;case 50:a.element!=window&&a.element.addEventListener("mouseout",E,!1);a.element.addEventListener("mouseup",E,!1);break;case 60:a.element.addEventListener("wheel",z,!1);break;case 80:a.element.addEventListener("keydown",G,!1);break;case 70:a.element.addEventListener("keyup",
d,!1);break;case 90:a.element.addEventListener("touchstart",F,!1);break;case 100:a.element.addEventListener("touchmove",J,!1);break;case 110:a.element.addEventListener("touchend",C,!1);break;case 131:a.element.addEventListener("deviceorientation",u,!1)}}};a.detach_param_cb=function(a,b,c){a&&n(a,b,c,!1)};a.cleanup=function(){for(var a=0;a<ga.length;a++)for(var b=ga[a],c=0;c<b.gb.length;c++)n(b,b.gb[c],null,!0);ga.length=0};a.set_gamepad_btn_key=function(a,b,c){a.Wb[b]=c};a.get_pressed_gmpd_btn=function(a){switch(a){case 0:a=
60;break;case 1:a=70;break;case 2:a=80;break;case 3:a=90;break;default:a=60}a=c(a);for(var b=0;b<a.Zh.length;b++)if(a.Zh[b])return b;return-1}};b4w.module.__vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,e=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new p(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,e){var k=new p(3);k[0]=a;k[1]=c;k[2]=e;return k};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,e,k){k[0]=a;k[1]=c;k[2]=e;return k};a.add=function(a,c,e){e[0]=a[0]+c[0];e[1]=a[1]+c[1];e[2]=a[2]+c[2];
return e};a.subtract=function(a,c,e){e[0]=a[0]-c[0];e[1]=a[1]-c[1];e[2]=a[2]-c[2];return e};a.sub=a.subtract;a.multiply=function(a,c,e){e[0]=a[0]*c[0];e[1]=a[1]*c[1];e[2]=a[2]*c[2];return e};a.mul=a.multiply;a.divide=function(a,c,e){e[0]=a[0]/c[0];e[1]=a[1]/c[1];e[2]=a[2]/c[2];return e};a.div=a.divide;a.min=function(a,c,e){e[0]=Math.min(a[0],c[0]);e[1]=Math.min(a[1],c[1]);e[2]=Math.min(a[2],c[2]);return e};a.max=function(a,c,e){e[0]=Math.max(a[0],c[0]);e[1]=Math.max(a[1],c[1]);e[2]=Math.max(a[2],
c[2]);return e};a.scale=function(a,c,e){e[0]=a[0]*c;e[1]=a[1]*c;e[2]=a[2]*c;return e};a.scaleAndAdd=function(a,c,e,k){k[0]=a[0]+c[0]*e;k[1]=a[1]+c[1]*e;k[2]=a[2]+c[2]*e;return k};a.distance=function(a,c){var e=c[0]-a[0],k=c[1]-a[1],r=c[2]-a[2];return Math.sqrt(e*e+k*k+r*r)};a.dist=a.distance;a.squaredDistance=function(a,c){var e=c[0]-a[0],k=c[1]-a[1],r=c[2]-a[2];return e*e+k*k+r*r};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],e=a[1];a=a[2];return Math.sqrt(c*c+e*e+a*a)};a.len=a.length;
a.squaredLength=function(a){var c=a[0],e=a[1];a=a[2];return c*c+e*e+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var e=a[0],k=a[1],r=a[2],e=e*e+k*k+r*r;0<e&&(e=1/Math.sqrt(e),c[0]=a[0]*e,c[1]=a[1]*e,c[2]=a[2]*e);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,e){var k=a[0],r=a[1];a=a[2];var h=c[0],q=c[1];c=c[2];
e[0]=r*c-a*q;e[1]=a*h-k*c;e[2]=k*q-r*h;return e};a.lerp=function(a,c,e,k){var r=a[0],h=a[1];a=a[2];k[0]=r+e*(c[0]-r);k[1]=h+e*(c[1]-h);k[2]=a+e*(c[2]-a);return k};a.RM=function(a,c,e,k,r,h){var q=r*r,g=q*(2*r-3)+1,p=q*(r-2)+r,f=q*(r-1);r=q*(3-2*r);h[0]=a[0]*g+c[0]*p+e[0]*f+k[0]*r;h[1]=a[1]*g+c[1]*p+e[1]*f+k[1]*r;h[2]=a[2]*g+c[2]*p+e[2]*f+k[2]*r;return h};a.Hu=function(a,c,e,k,r,h){var q=1-r,g=q*q,p=r*r,f=g*q,g=3*r*g,q=3*p*q;r*=p;h[0]=a[0]*f+c[0]*g+e[0]*q+k[0]*r;h[1]=a[1]*f+c[1]*g+e[1]*q+k[1]*r;h[2]=
a[2]*f+c[2]*g+e[2]*q+k[2]*r;return h};a.random=function(a,c){a=a||1;var m=2*e()*Math.PI,k=2*e()-1,r=Math.sqrt(1-k*k)*a;c[0]=Math.cos(m)*r;c[1]=Math.sin(m)*r;c[2]=k*a;return c};a.transformMat4=function(a,c,e){var k=a[0],r=a[1];a=a[2];var h=c[3]*k+c[7]*r+c[11]*a+c[15],h=h||1;e[0]=(c[0]*k+c[4]*r+c[8]*a+c[12])/h;e[1]=(c[1]*k+c[5]*r+c[9]*a+c[13])/h;e[2]=(c[2]*k+c[6]*r+c[10]*a+c[14])/h;return e};a.transformMat3=function(a,c,e){var k=a[0],r=a[1];a=a[2];e[0]=k*c[0]+r*c[3]+a*c[6];e[1]=k*c[1]+r*c[4]+a*c[7];
e[2]=k*c[2]+r*c[5]+a*c[8];return e};a.transformQuat=function(a,c,e){var k=a[0],r=a[1],h=a[2];a=c[0];var q=c[1],g=c[2];c=c[3];var p=c*k+q*h-g*r,f=c*r+g*k-a*h,l=c*h+a*r-q*k,k=-a*k-q*r-g*h;e[0]=p*c+k*-a+f*-g-l*-q;e[1]=f*c+k*-q+l*-a-p*-g;e[2]=l*c+k*-g+p*-q-f*-a;return e};a.rotateX=function(a,c,e,k){var r=[],h=[];r[0]=a[0]-c[0];r[1]=a[1]-c[1];r[2]=a[2]-c[2];h[0]=r[0];h[1]=r[1]*Math.cos(e)-r[2]*Math.sin(e);h[2]=r[1]*Math.sin(e)+r[2]*Math.cos(e);k[0]=h[0]+c[0];k[1]=h[1]+c[1];k[2]=h[2]+c[2];return k};a.rotateY=
function(a,c,e,k){var r=[],h=[];r[0]=a[0]-c[0];r[1]=a[1]-c[1];r[2]=a[2]-c[2];h[0]=r[2]*Math.sin(e)+r[0]*Math.cos(e);h[1]=r[1];h[2]=r[2]*Math.cos(e)-r[0]*Math.sin(e);k[0]=h[0]+c[0];k[1]=h[1]+c[1];k[2]=h[2]+c[2];return k};a.rotateZ=function(a,c,e,k){var r=[],h=[];r[0]=a[0]-c[0];r[1]=a[1]-c[1];r[2]=a[2]-c[2];h[0]=r[0]*Math.cos(e)-r[1]*Math.sin(e);h[1]=r[0]*Math.sin(e)+r[1]*Math.cos(e);h[2]=r[2];k[0]=h[0]+c[0];k[1]=h[1]+c[1];k[2]=h[2]+c[2];return k};a.forEach=function(){var b=a.create();return function(a,
e,k,r,h,q){e||(e=3);k||(k=0);for(r=r?Math.min(r*e+k,a.length):a.length;k<r;k+=e)b[0]=a[k],b[1]=a[k+1],b[2]=a[k+2],h(b,q,b),a[k]=b[0],a[k+1]=b[1],a[k+2]=b[2];return a}}();a.CL=function(b,c){var e=a.fromValues(b[0],b[1],b[2]),k=a.fromValues(c[0],c[1],c[2]);a.normalize(e,e);a.normalize(k,k);e=a.dot(e,k);return 1<e?0:Math.acos(e)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"}};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,e=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new p(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,e,k){var r=new p(4);r[0]=a;r[1]=c;r[2]=e;r[3]=k;return r};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,e,k,r){r[0]=a;r[1]=c;r[2]=e;r[3]=k;return r};a.add=function(a,c,e){e[0]=
a[0]+c[0];e[1]=a[1]+c[1];e[2]=a[2]+c[2];e[3]=a[3]+c[3];return e};a.subtract=function(a,c,e){e[0]=a[0]-c[0];e[1]=a[1]-c[1];e[2]=a[2]-c[2];e[3]=a[3]-c[3];return e};a.sub=a.subtract;a.multiply=function(a,c,e){e[0]=a[0]*c[0];e[1]=a[1]*c[1];e[2]=a[2]*c[2];e[3]=a[3]*c[3];return e};a.mul=a.multiply;a.divide=function(a,c,e){e[0]=a[0]/c[0];e[1]=a[1]/c[1];e[2]=a[2]/c[2];e[3]=a[3]/c[3];return e};a.div=a.divide;a.min=function(a,c,e){e[0]=Math.min(a[0],c[0]);e[1]=Math.min(a[1],c[1]);e[2]=Math.min(a[2],c[2]);e[3]=
Math.min(a[3],c[3]);return e};a.max=function(a,c,e){e[0]=Math.max(a[0],c[0]);e[1]=Math.max(a[1],c[1]);e[2]=Math.max(a[2],c[2]);e[3]=Math.max(a[3],c[3]);return e};a.scale=function(a,c,e){e[0]=a[0]*c;e[1]=a[1]*c;e[2]=a[2]*c;e[3]=a[3]*c;return e};a.scaleAndAdd=function(a,c,e,k){k[0]=a[0]+c[0]*e;k[1]=a[1]+c[1]*e;k[2]=a[2]+c[2]*e;k[3]=a[3]+c[3]*e;return k};a.distance=function(a,c){var e=c[0]-a[0],k=c[1]-a[1],r=c[2]-a[2],h=c[3]-a[3];return Math.sqrt(e*e+k*k+r*r+h*h)};a.dist=a.distance;a.squaredDistance=
function(a,c){var e=c[0]-a[0],k=c[1]-a[1],r=c[2]-a[2],h=c[3]-a[3];return e*e+k*k+r*r+h*h};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],e=a[1],k=a[2];a=a[3];return Math.sqrt(c*c+e*e+k*k+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],e=a[1],k=a[2];a=a[3];return c*c+e*e+k*k+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var e=a[0],k=a[1],r=a[2],h=a[3],q=e*e+k*k+r*r+h*h;0<q&&(q=1/Math.sqrt(q),c[0]=e*q,c[1]=k*q,c[2]=r*q,c[3]=h*q);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,e,k){var r=a[0],h=a[1],q=a[2];a=a[3];k[0]=r+e*(c[0]-r);k[1]=h+e*(c[1]-h);k[2]=q+e*(c[2]-q);k[3]=a+e*(c[3]-a);return k};a.random=function(b,c){b=b||1;c[0]=e();c[1]=e();c[2]=e();c[3]=e();a.normalize(c,c);a.scale(c,b,c);return c};a.transformMat4=function(a,c,e){var k=a[0],r=a[1],h=
a[2];a=a[3];e[0]=c[0]*k+c[4]*r+c[8]*h+c[12]*a;e[1]=c[1]*k+c[5]*r+c[9]*h+c[13]*a;e[2]=c[2]*k+c[6]*r+c[10]*h+c[14]*a;e[3]=c[3]*k+c[7]*r+c[11]*h+c[15]*a;return e};a.transformQuat=function(a,c,e){var k=a[0],r=a[1],h=a[2],q=c[0],g=c[1],p=c[2];c=c[3];var f=c*k+g*h-p*r,l=c*r+p*k-q*h,n=c*h+q*r-g*k,k=-q*k-g*r-p*h;e[0]=f*c+k*-q+l*-p-n*-g;e[1]=l*c+k*-g+n*-q-f*-p;e[2]=n*c+k*-p+f*-g-l*-q;e[3]=a[3];return e};a.forEach=function(){var b=a.create();return function(a,e,k,r,h,q){e||(e=4);k||(k=0);for(r=r?Math.min(r*
e+k,a.length):a.length;k<r;k+=e)b[0]=a[k],b[1]=a[k+1],b[2]=a[k+2],b[3]=a[k+3],h(b,q,b),a[k]=b[0],a[k+1]=b[1],a[k+2]=b[2],a[k+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,p){var e=p("__vec3"),b=p("__vec4"),c=p("__mat3"),m="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new m(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=e.create(),c=e.fromValues(1,0,0),h=e.fromValues(0,1,0);return function(m,g,p){var f=e.dot(m,g);if(-.9999999>f)return e.cross(c,m,b),1E-6>e.length(b)&&e.cross(h,m,b),e.normalize(b,b),a.setAxisAngle(b,Math.PI,p),p;if(.9999999<f)return p[0]=0,p[1]=0,p[2]=0,p[3]=1,p;e.cross(m,
g,b);p[0]=b[0];p[1]=b[1];p[2]=b[2];p[3]=1+f;return a.normalize(p,p)}}();a.setAxes=function(){var b=c.create();return function(c,e,m,g){b[0]=e[0];b[3]=e[1];b[6]=e[2];b[1]=m[0];b[4]=m[1];b[7]=m[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,g),g)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var e=Math.sin(b);c[0]=e*a[0];c[1]=e*a[1];c[2]=e*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var e=a[0],g=a[1],m=a[2];a=a[3];var f=b[0],l=b[1],n=b[2];b=b[3];c[0]=e*b+a*f+g*n-m*l;c[1]=g*b+a*l+m*f-e*n;c[2]=m*b+a*n+e*l-g*f;c[3]=a*b-e*f-g*l-m*n;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var e=a[0],g=a[1],m=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=e*b+a*f;c[1]=g*b+m*f;c[2]=m*b-g*f;c[3]=a*b-e*f;return c};a.rotateY=function(a,b,c){b*=.5;var e=a[0],g=a[1],m=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=e*
b-m*f;c[1]=g*b+a*f;c[2]=m*b+e*f;c[3]=a*b-g*f;return c};a.rotateZ=function(a,b,c){b*=.5;var e=a[0],g=a[1],m=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=e*b+g*f;c[1]=g*b-e*f;c[2]=m*b+a*f;c[3]=a*b-m*f;return c};a.calculateW=function(a,b){var c=a[0],e=a[1],g=a[2];b[0]=c;b[1]=e;b[2]=g;b[3]=Math.sqrt(Math.abs(1-c*c-e*e-g*g));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,e){var g=a[0],m=a[1],f=a[2];a=a[3];var l=b[0],n=b[1],p=b[2];b=b[3];var A,B,H;B=g*l+m*n+f*p+a*b;0>B&&(B=-B,l=-l,n=-n,
p=-p,b=-b);1E-6<1-B?(A=Math.acos(B),H=Math.sin(A),B=Math.sin((1-c)*A)/H,c=Math.sin(c*A)/H):B=1-c;e[0]=B*g+c*l;e[1]=B*m+c*n;e[2]=B*f+c*p;e[3]=B*a+c*b;return e};a.IN=function(){var b=a.create(),c=a.create();return function(e,m,g,p,f,l){a.slerp(e,p,f,b);a.slerp(m,g,f,c);a.slerp(b,c,2*f*(1-f),l);return l}}();a.invert=function(a,b){var c=a[0],e=a[1],g=a[2],m=a[3],f=c*c+e*e+g*g+m*m,f=f?1/f:0;b[0]=-c*f;b[1]=-e*f;b[2]=-g*f;b[3]=m*f;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=
a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var e=0;a[4]>a[0]&&(e=1);a[8]>a[3*e+e]&&(e=2);var g=(e+1)%3,m=(e+2)%3,c=Math.sqrt(a[3*e+e]-a[3*g+g]-a[3*m+m]+1);b[e]=.5*c;c=.5/c;b[3]=(a[3*g+m]-a[3*m+g])*c;b[g]=(a[3*g+e]+a[3*e+g])*c;b[m]=(a[3*m+e]+a[3*e+m])*c}return b};a.str=
function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new p(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var c=a[1],m=a[2],k=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=m;b[7]=k}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var c=a[0],m=a[1],k=a[2],r=a[3],h=a[4],q=a[5],g=a[6],p=a[7],f=a[8],l=f*h-q*p,n=-f*r+q*g,u=
p*r-h*g,A=c*l+m*n+k*u;if(!A)return null;A=1/A;b[0]=l*A;b[1]=(-f*m+k*p)*A;b[2]=(q*m-k*h)*A;b[3]=n*A;b[4]=(f*c-k*g)*A;b[5]=(-q*c+k*r)*A;b[6]=u*A;b[7]=(-p*c+m*g)*A;b[8]=(h*c-m*r)*A;return b};a.adjoint=function(a,b){var c=a[0],m=a[1],k=a[2],r=a[3],h=a[4],q=a[5],g=a[6],p=a[7],f=a[8];b[0]=h*f-q*p;b[1]=k*p-m*f;b[2]=m*q-k*h;b[3]=q*g-r*f;b[4]=c*f-k*g;b[5]=k*r-c*q;b[6]=r*p-h*g;b[7]=m*g-c*p;b[8]=c*h-m*r;return b};a.determinant=function(a){var b=a[3],c=a[4],m=a[5],k=a[6],r=a[7],h=a[8];return a[0]*(h*c-m*r)+a[1]*
(-h*b+m*k)+a[2]*(r*b-c*k)};a.multiply=function(a,b,c){var m=a[0],k=a[1],r=a[2],h=a[3],q=a[4],g=a[5],p=a[6],f=a[7];a=a[8];var l=b[0],n=b[1],u=b[2],A=b[3],B=b[4],H=b[5],v=b[6],E=b[7];b=b[8];c[0]=l*m+n*h+u*p;c[1]=l*k+n*q+u*f;c[2]=l*r+n*g+u*a;c[3]=A*m+B*h+H*p;c[4]=A*k+B*q+H*f;c[5]=A*r+B*g+H*a;c[6]=v*m+E*h+b*p;c[7]=v*k+E*q+b*f;c[8]=v*r+E*g+b*a;return c};a.mul=a.multiply;a.translate=function(a,b,c){var m=a[0],k=a[1],r=a[2],h=a[3],q=a[4],g=a[5],p=a[6],f=a[7];a=a[8];var l=b[0];b=b[1];c[0]=m;c[1]=k;c[2]=r;
c[3]=h;c[4]=q;c[5]=g;c[6]=l*m+b*h+p;c[7]=l*k+b*q+f;c[8]=l*r+b*g+a;return c};a.rotate=function(a,b,c){var m=a[0],k=a[1],r=a[2],h=a[3],q=a[4],g=a[5],p=a[6],f=a[7];a=a[8];var l=Math.sin(b);b=Math.cos(b);c[0]=b*m+l*h;c[1]=b*k+l*q;c[2]=b*r+l*g;c[3]=b*h-l*m;c[4]=b*q-l*k;c[5]=b*g-l*r;c[6]=p;c[7]=f;c[8]=a;return c};a.scale=function(a,b,c){var m=b[0];b=b[1];c[0]=m*a[0];c[1]=m*a[1];c[2]=m*a[2];c[3]=b*a[3];c[4]=b*a[4];c[5]=b*a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.$E=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.YE=function(a,b){var c=Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=c;b[2]=0;b[3]=-c;b[4]=m;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.ZE=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var c=a[0],m=a[1],k=a[2],r=a[3],h=c+c,q=m+m,g=k+k,c=c*h,p=m*h,m=m*q,f=k*h,l=
k*q,k=k*g,h=r*h,q=r*q,r=r*g;b[0]=1-m-k;b[3]=p-r;b[6]=f+q;b[1]=p+r;b[4]=1-c-k;b[7]=l-h;b[2]=f-q;b[5]=l+h;b[8]=1-c-m;return b};a.normalFromMat4=function(a,b){var c=a[0],m=a[1],k=a[2],r=a[3],h=a[4],q=a[5],g=a[6],p=a[7],f=a[8],l=a[9],n=a[10],u=a[11],A=a[12],B=a[13],H=a[14],v=a[15],E=c*q-m*h,z=c*g-k*h,G=c*p-r*h,d=m*g-k*q,F=m*p-r*q,J=k*p-r*g,C=f*B-l*A,D=f*H-n*A,f=f*v-u*A,O=l*H-n*B,l=l*v-u*B,n=n*v-u*H,u=E*n-z*l+G*O+d*f-F*D+J*C;if(!u)return null;u=1/u;b[0]=(q*n-g*l+p*O)*u;b[1]=(g*f-h*n-p*D)*u;b[2]=(h*l-q*
f+p*C)*u;b[3]=(k*l-m*n-r*O)*u;b[4]=(c*n-k*f+r*D)*u;b[5]=(m*f-c*l-r*C)*u;b[6]=(B*J-H*F+v*d)*u;b[7]=(H*G-A*J-v*z)*u;b[8]=(A*F-B*G+v*E)*u;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.XE=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))}};b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new p(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var c=a[1],m=a[2],k=a[3],r=a[6],h=a[7],q=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=c;b[6]=a[9];b[7]=a[13];b[8]=m;b[9]=r;b[11]=a[14];b[12]=k;b[13]=
h;b[14]=q}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var c=a[0],m=a[1],k=a[2],r=a[3],h=a[4],q=a[5],g=a[6],p=a[7],f=a[8],l=a[9],n=a[10],u=a[11],A=a[12],B=a[13],H=a[14],v=a[15],E=c*q-m*h,z=c*g-k*h,G=c*p-r*h,d=m*g-k*q,F=m*p-r*q,J=k*p-r*g,C=f*B-l*A,D=f*H-n*A,O=f*v-u*A,T=l*H-n*B,K=l*v-u*B,w=n*v-u*H,t=E*w-z*K+G*T+d*O-F*D+J*C;if(!t)return null;
t=1/t;b[0]=(q*w-g*K+p*T)*t;b[1]=(k*K-m*w-r*T)*t;b[2]=(B*J-H*F+v*d)*t;b[3]=(n*F-l*J-u*d)*t;b[4]=(g*O-h*w-p*D)*t;b[5]=(c*w-k*O+r*D)*t;b[6]=(H*G-A*J-v*z)*t;b[7]=(f*J-n*G+u*z)*t;b[8]=(h*K-q*O+p*C)*t;b[9]=(m*O-c*K-r*C)*t;b[10]=(A*F-B*G+v*E)*t;b[11]=(l*G-f*F-u*E)*t;b[12]=(q*D-h*T-g*C)*t;b[13]=(c*T-m*D+k*C)*t;b[14]=(B*z-A*d-H*E)*t;b[15]=(f*d-l*z+n*E)*t;return b};a.adjoint=function(a,b){var c=a[0],m=a[1],k=a[2],r=a[3],h=a[4],q=a[5],g=a[6],p=a[7],f=a[8],l=a[9],n=a[10],u=a[11],A=a[12],B=a[13],H=a[14],v=a[15];
b[0]=q*(n*v-u*H)-l*(g*v-p*H)+B*(g*u-p*n);b[1]=-(m*(n*v-u*H)-l*(k*v-r*H)+B*(k*u-r*n));b[2]=m*(g*v-p*H)-q*(k*v-r*H)+B*(k*p-r*g);b[3]=-(m*(g*u-p*n)-q*(k*u-r*n)+l*(k*p-r*g));b[4]=-(h*(n*v-u*H)-f*(g*v-p*H)+A*(g*u-p*n));b[5]=c*(n*v-u*H)-f*(k*v-r*H)+A*(k*u-r*n);b[6]=-(c*(g*v-p*H)-h*(k*v-r*H)+A*(k*p-r*g));b[7]=c*(g*u-p*n)-h*(k*u-r*n)+f*(k*p-r*g);b[8]=h*(l*v-u*B)-f*(q*v-p*B)+A*(q*u-p*l);b[9]=-(c*(l*v-u*B)-f*(m*v-r*B)+A*(m*u-r*l));b[10]=c*(q*v-p*B)-h*(m*v-r*B)+A*(m*p-r*q);b[11]=-(c*(q*u-p*l)-h*(m*u-r*l)+f*
(m*p-r*q));b[12]=-(h*(l*H-n*B)-f*(q*H-g*B)+A*(q*n-g*l));b[13]=c*(l*H-n*B)-f*(m*H-k*B)+A*(m*n-k*l);b[14]=-(c*(q*H-g*B)-h*(m*H-k*B)+A*(m*g-k*q));b[15]=c*(q*n-g*l)-h*(m*n-k*l)+f*(m*g-k*q);return b};a.determinant=function(a){var b=a[0],c=a[1],m=a[2],k=a[3],r=a[4],h=a[5],q=a[6],g=a[7],p=a[8],f=a[9],l=a[10],n=a[11],u=a[12],A=a[13],B=a[14];a=a[15];return(b*h-c*r)*(l*a-n*B)-(b*q-m*r)*(f*a-n*A)+(b*g-k*r)*(f*B-l*A)+(c*q-m*h)*(p*a-n*u)-(c*g-k*h)*(p*B-l*u)+(m*g-k*q)*(p*A-f*u)};a.multiply=function(a,b,c){var m=
a[0],k=a[1],r=a[2],h=a[3],q=a[4],g=a[5],p=a[6],f=a[7],l=a[8],n=a[9],u=a[10],A=a[11],B=a[12],H=a[13],v=a[14];a=a[15];var E=b[0],z=b[1],G=b[2],d=b[3];c[0]=E*m+z*q+G*l+d*B;c[1]=E*k+z*g+G*n+d*H;c[2]=E*r+z*p+G*u+d*v;c[3]=E*h+z*f+G*A+d*a;E=b[4];z=b[5];G=b[6];d=b[7];c[4]=E*m+z*q+G*l+d*B;c[5]=E*k+z*g+G*n+d*H;c[6]=E*r+z*p+G*u+d*v;c[7]=E*h+z*f+G*A+d*a;E=b[8];z=b[9];G=b[10];d=b[11];c[8]=E*m+z*q+G*l+d*B;c[9]=E*k+z*g+G*n+d*H;c[10]=E*r+z*p+G*u+d*v;c[11]=E*h+z*f+G*A+d*a;E=b[12];z=b[13];G=b[14];d=b[15];c[12]=E*m+
z*q+G*l+d*B;c[13]=E*k+z*g+G*n+d*H;c[14]=E*r+z*p+G*u+d*v;c[15]=E*h+z*f+G*A+d*a;return c};a.mul=a.multiply;a.translate=function(a,b,c){var m=b[0],k=b[1];b=b[2];var r,h,q,g,p,f,l,n,u,A,B,H;a===c?(c[12]=a[0]*m+a[4]*k+a[8]*b+a[12],c[13]=a[1]*m+a[5]*k+a[9]*b+a[13],c[14]=a[2]*m+a[6]*k+a[10]*b+a[14],c[15]=a[3]*m+a[7]*k+a[11]*b+a[15]):(r=a[0],h=a[1],q=a[2],g=a[3],p=a[4],f=a[5],l=a[6],n=a[7],u=a[8],A=a[9],B=a[10],H=a[11],c[0]=r,c[1]=h,c[2]=q,c[3]=g,c[4]=p,c[5]=f,c[6]=l,c[7]=n,c[8]=u,c[9]=A,c[10]=B,c[11]=H,
c[12]=r*m+p*k+u*b+a[12],c[13]=h*m+f*k+A*b+a[13],c[14]=q*m+l*k+B*b+a[14],c[15]=g*m+n*k+H*b+a[15]);return c};a.scale=function(a,b,c){var m=b[0],k=b[1];b=b[2];c[0]=a[0]*m;c[1]=a[1]*m;c[2]=a[2]*m;c[3]=a[3]*m;c[4]=a[4]*k;c[5]=a[5]*k;c[6]=a[6]*k;c[7]=a[7]*k;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.rotate=function(a,b,c,m){var k=c[0],r=c[1];c=c[2];var h=Math.sqrt(k*k+r*r+c*c),q,g,p,f,l,n,u,A,B,H,v,E,z,G,d,F,J,C,D,O;if(1E-7>Math.abs(h))return null;
h=1/h;k*=h;r*=h;c*=h;q=Math.sin(b);g=Math.cos(b);p=1-g;b=a[0];h=a[1];f=a[2];l=a[3];n=a[4];u=a[5];A=a[6];B=a[7];H=a[8];v=a[9];E=a[10];z=a[11];G=k*k*p+g;d=r*k*p+c*q;F=c*k*p-r*q;J=k*r*p-c*q;C=r*r*p+g;D=c*r*p+k*q;O=k*c*p+r*q;k=r*c*p-k*q;r=c*c*p+g;m[0]=b*G+n*d+H*F;m[1]=h*G+u*d+v*F;m[2]=f*G+A*d+E*F;m[3]=l*G+B*d+z*F;m[4]=b*J+n*C+H*D;m[5]=h*J+u*C+v*D;m[6]=f*J+A*C+E*D;m[7]=l*J+B*C+z*D;m[8]=b*O+n*k+H*r;m[9]=h*O+u*k+v*r;m[10]=f*O+A*k+E*r;m[11]=l*O+B*k+z*r;a!==m&&(m[12]=a[12],m[13]=a[13],m[14]=a[14],m[15]=a[15]);
return m};a.rotateX=function(a,b,c){var m=Math.sin(b);b=Math.cos(b);var k=a[4],r=a[5],h=a[6],q=a[7],g=a[8],p=a[9],f=a[10],l=a[11];a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[4]=k*b+g*m;c[5]=r*b+p*m;c[6]=h*b+f*m;c[7]=q*b+l*m;c[8]=g*b-k*m;c[9]=p*b-r*m;c[10]=f*b-h*m;c[11]=l*b-q*m;return c};a.rotateY=function(a,b,c){var m=Math.sin(b);b=Math.cos(b);var k=a[0],r=a[1],h=a[2],q=a[3],g=a[8],p=a[9],f=a[10],l=a[11];a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],
c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=k*b-g*m;c[1]=r*b-p*m;c[2]=h*b-f*m;c[3]=q*b-l*m;c[8]=k*m+g*b;c[9]=r*m+p*b;c[10]=h*m+f*b;c[11]=q*m+l*b;return c};a.rotateZ=function(a,b,c){var m=Math.sin(b);b=Math.cos(b);var k=a[0],r=a[1],h=a[2],q=a[3],g=a[4],p=a[5],f=a[6],l=a[7];a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=k*b+g*m;c[1]=r*b+p*m;c[2]=h*b+f*m;c[3]=q*b+l*m;c[4]=g*b-k*m;c[5]=p*b-r*m;c[6]=f*b-h*m;c[7]=l*b-q*m;return c};
a.$E=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.ZE=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.YE=function(a,b,c){var m=b[0],k=b[1];b=b[2];var r=Math.sqrt(m*m+k*k+b*b),h;if(1E-7>Math.abs(r))return null;r=1/r;m*=r;k*=r;b*=r;r=Math.sin(a);a=Math.cos(a);h=1-a;c[0]=m*m*h+a;c[1]=k*m*h+b*
r;c[2]=b*m*h-k*r;c[3]=0;c[4]=m*k*h-b*r;c[5]=k*k*h+a;c[6]=b*k*h+m*r;c[7]=0;c[8]=m*b*h+k*r;c[9]=k*b*h-m*r;c[10]=b*b*h+a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.qM=function(a,b){var c=Math.sin(a),m=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=m;b[6]=c;b[7]=0;b[8]=0;b[9]=-c;b[10]=m;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.rM=function(a,b){var c=Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=0;b[2]=-c;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=c;b[9]=0;b[10]=m;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.sM=function(a,b){var c=Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=c;b[2]=0;b[3]=0;b[4]=-c;b[5]=m;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,c){var m=a[0],k=a[1],r=a[2],h=a[3],q=m+m,g=k+k,p=r+r;a=m*q;var f=m*g,m=m*p,l=k*g,k=k*p,r=r*p,q=h*q,g=h*g,h=h*p;c[0]=1-(l+r);c[1]=f+h;c[2]=m-g;c[3]=0;c[4]=f-h;c[5]=1-(a+r);c[6]=k+q;c[7]=0;c[8]=m+g;c[9]=k-q;c[10]=1-(a+l);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];
c[15]=1;return c};a.oM=function(a,b,c,m){var k=a[0],r=a[1],h=a[2],q=a[3],g=k+k,p=r+r,f=h+h;a=k*g;var l=k*p,k=k*f,n=r*p,r=r*f,h=h*f,g=q*g,p=q*p,q=q*f,f=c[0],u=c[1];c=c[2];m[0]=(1-(n+h))*f;m[1]=(l+q)*f;m[2]=(k-p)*f;m[3]=0;m[4]=(l-q)*u;m[5]=(1-(a+h))*u;m[6]=(r+g)*u;m[7]=0;m[8]=(k+p)*c;m[9]=(r-g)*c;m[10]=(1-(a+n))*c;m[11]=0;m[12]=b[0];m[13]=b[1];m[14]=b[2];m[15]=1;return m};a.pM=function(a,b,c,m,k){var r=a[0],h=a[1],q=a[2],g=a[3],p=r+r,f=h+h,l=q+q;a=r*p;var n=r*f,r=r*l,u=h*f,h=h*l,q=q*l,p=g*p,f=g*f,g=
g*l,l=c[0],A=c[1];c=c[2];var B=m[0],H=m[1];m=m[2];k[0]=(1-(u+q))*l;k[1]=(n+g)*l;k[2]=(r-f)*l;k[3]=0;k[4]=(n-g)*A;k[5]=(1-(a+q))*A;k[6]=(h+p)*A;k[7]=0;k[8]=(r+f)*c;k[9]=(h-p)*c;k[10]=(1-(a+u))*c;k[11]=0;k[12]=b[0]+B-(k[0]*B+k[4]*H+k[8]*m);k[13]=b[1]+H-(k[1]*B+k[5]*H+k[9]*m);k[14]=b[2]+m-(k[2]*B+k[6]*H+k[10]*m);k[15]=1;return k};a.fromQuat=function(a,b){var c=a[0],m=a[1],k=a[2],r=a[3],h=c+c,q=m+m,g=k+k,c=c*h,p=m*h,m=m*q,f=k*h,l=k*q,k=k*g,h=r*h,q=r*q,r=r*g;b[0]=1-m-k;b[1]=p+r;b[2]=f-q;b[3]=0;b[4]=p-
r;b[5]=1-c-k;b[6]=l+h;b[7]=0;b[8]=f+q;b[9]=l-h;b[10]=1-c-m;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,c,m,k,r,h){var q=1/(b-a),g=1/(m-c),p=1/(k-r);h[0]=2*k*q;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*k*g;h[6]=0;h[7]=0;h[8]=(b+a)*q;h[9]=(m+c)*g;h[10]=(r+k)*p;h[11]=-1;h[12]=0;h[13]=0;h[14]=r*k*2*p;h[15]=0;return h};a.perspective=function(a,b,c,m,k){a=1/Math.tan(a/2);var r=1/(c-m);k[0]=a/b;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=a;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=(m+c)*r;k[11]=-1;k[12]=
0;k[13]=0;k[14]=2*m*c*r;k[15]=0;return k};a.sN=function(a,b,c,m){var k=Math.tan(a.upDegrees*Math.PI/180),r=Math.tan(a.downDegrees*Math.PI/180),h=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var q=2/(h+a),g=2/(k+r);m[0]=q;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=g;m[6]=0;m[7]=0;m[8]=-((h-a)*q*.5);m[9]=(k-r)*g*.5;m[10]=c/(b-c);m[11]=-1;m[12]=0;m[13]=0;m[14]=c*b/(b-c);m[15]=0;return m};a.ortho=function(a,b,c,m,k,r,h){var q=1/(a-b),g=1/(c-m),p=1/(k-r);h[0]=-2*q;h[1]=0;h[2]=0;h[3]=
0;h[4]=0;h[5]=-2*g;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=2*p;h[11]=0;h[12]=(a+b)*q;h[13]=(m+c)*g;h[14]=(r+k)*p;h[15]=1;return h};a.lookAt=function(e,b,c,m){var k,r,h,q,g,p,f,l,n=e[0],u=e[1];e=e[2];h=c[0];q=c[1];r=c[2];f=b[0];c=b[1];k=b[2];if(1E-7>Math.abs(n-f)&&1E-7>Math.abs(u-c)&&1E-7>Math.abs(e-k))return a.identity(m);b=n-f;c=u-c;f=e-k;l=1/Math.sqrt(b*b+c*c+f*f);b*=l;c*=l;f*=l;k=q*f-r*c;r=r*b-h*f;h=h*c-q*b;(l=Math.sqrt(k*k+r*r+h*h))?(l=1/l,k*=l,r*=l,h*=l):h=r=k=0;q=c*h-f*r;g=f*k-b*h;p=b*r-c*k;(l=Math.sqrt(q*
q+g*g+p*p))?(l=1/l,q*=l,g*=l,p*=l):p=g=q=0;m[0]=k;m[1]=q;m[2]=b;m[3]=0;m[4]=r;m[5]=g;m[6]=c;m[7]=0;m[8]=h;m[9]=p;m[10]=f;m[11]=0;m[12]=-(k*n+r*u+h*e);m[13]=-(q*n+g*u+p*e);m[14]=-(b*n+c*u+f*e);m[15]=1;return m};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.XE=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],
2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))}};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a){function p(a,h){var k=a[0],g=a[1],p=a[2],f=a[3],k=b(k,g,p,f,h[0],7,-680876936),f=b(f,k,g,p,h[1],12,-389564586),p=b(p,f,k,g,h[2],17,606105819),g=b(g,p,f,k,h[3],22,-1044525330),k=b(k,g,p,f,h[4],7,-176418897),f=b(f,k,g,p,h[5],12,1200080426),p=b(p,f,k,g,h[6],17,-1473231341),g=b(g,p,f,k,h[7],22,-45705983),k=b(k,g,p,f,h[8],7,1770035416),f=b(f,k,g,p,h[9],12,-1958414417),p=b(p,f,k,g,h[10],17,-42063),g=b(g,p,f,k,h[11],22,-1990404162),k=b(k,g,p,f,h[12],7,1804603682),f=b(f,k,g,p,
h[13],12,-40341101),p=b(p,f,k,g,h[14],17,-1502002290),g=b(g,p,f,k,h[15],22,1236535329),k=c(k,g,p,f,h[1],5,-165796510),f=c(f,k,g,p,h[6],9,-1069501632),p=c(p,f,k,g,h[11],14,643717713),g=c(g,p,f,k,h[0],20,-373897302),k=c(k,g,p,f,h[5],5,-701558691),f=c(f,k,g,p,h[10],9,38016083),p=c(p,f,k,g,h[15],14,-660478335),g=c(g,p,f,k,h[4],20,-405537848),k=c(k,g,p,f,h[9],5,568446438),f=c(f,k,g,p,h[14],9,-1019803690),p=c(p,f,k,g,h[3],14,-187363961),g=c(g,p,f,k,h[8],20,1163531501),k=c(k,g,p,f,h[13],5,-1444681467),f=
c(f,k,g,p,h[2],9,-51403784),p=c(p,f,k,g,h[7],14,1735328473),g=c(g,p,f,k,h[12],20,-1926607734),k=e(g^p^f,k,g,h[5],4,-378558),f=e(k^g^p,f,k,h[8],11,-2022574463),p=e(f^k^g,p,f,h[11],16,1839030562),g=e(p^f^k,g,p,h[14],23,-35309556),k=e(g^p^f,k,g,h[1],4,-1530992060),f=e(k^g^p,f,k,h[4],11,1272893353),p=e(f^k^g,p,f,h[7],16,-155497632),g=e(p^f^k,g,p,h[10],23,-1094730640),k=e(g^p^f,k,g,h[13],4,681279174),f=e(k^g^p,f,k,h[0],11,-358537222),p=e(f^k^g,p,f,h[3],16,-722521979),g=e(p^f^k,g,p,h[6],23,76029189),k=
e(g^p^f,k,g,h[9],4,-640364487),f=e(k^g^p,f,k,h[12],11,-421815835),p=e(f^k^g,p,f,h[15],16,530742520),g=e(p^f^k,g,p,h[2],23,-995338651),k=m(k,g,p,f,h[0],6,-198630844),f=m(f,k,g,p,h[7],10,1126891415),p=m(p,f,k,g,h[14],15,-1416354905),g=m(g,p,f,k,h[5],21,-57434055),k=m(k,g,p,f,h[12],6,1700485571),f=m(f,k,g,p,h[3],10,-1894986606),p=m(p,f,k,g,h[10],15,-1051523),g=m(g,p,f,k,h[1],21,-2054922799),k=m(k,g,p,f,h[8],6,1873313359),f=m(f,k,g,p,h[15],10,-30611744),p=m(p,f,k,g,h[6],15,-1560198380),g=m(g,p,f,k,h[13],
21,1309151649),k=m(k,g,p,f,h[4],6,-145523070),f=m(f,k,g,p,h[11],10,-1120210379),p=m(p,f,k,g,h[2],15,718787259),g=m(g,p,f,k,h[9],21,-343485551);a[0]=k+a[0]&4294967295;a[1]=g+a[1]&4294967295;a[2]=p+a[2]&4294967295;a[3]=f+a[3]&4294967295}function e(a,b,c,e,k,f){b=(b+a&4294967295)+(e+f&4294967295)&4294967295;return(b<<k|b>>>32-k)+c&4294967295}function b(a,b,c,g,k,f,l){return e(b&c|~b&g,a,b,k,f,l)}function c(a,b,c,g,k,f,l){return e(b&g|c&~g,a,b,k,f,l)}function m(a,b,c,g,k,f,l){return e(c^(b|~g),a,b,k,
f,l)}var k="0123456789abcdef".split("");a.zw=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var e;for(e=64;e<=b.length;e+=64){for(var m=b.substring(e-64,e),f=[],l=void 0,l=0;64>l;l+=4)f[l>>2]=m.charCodeAt(l)+(m.charCodeAt(l+1)<<8)+(m.charCodeAt(l+2)<<16)+(m.charCodeAt(l+3)<<24);p(a,f)}b=b.substring(e-64);m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<b.length;e++)m[e>>2]|=b.charCodeAt(e)<<(e%4<<3);m[e>>2]|=128<<(e%4<<3);if(55<e)for(p(a,m),e=0;16>e;e++)m[e]=0;m[14]=8*
c;p(a,m);for(b=0;b<a.length;b++){c=a[b];e="";for(m=0;4>m;m++)e+=k[c>>8*m+4&15]+k[c>>8*m&15];a[b]=e}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",b:[{type:"var",name:"ANCHOR_NUM",a:["0"]},{type:"include",file:"math.glslv"},{type:"textline",a:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_proj_matrix ; void main ( ) { gl_Position = u_view_proj_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",b:[{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",a:["0"]},{type:"var",name:"NUM_VALUES",a:["0"]},{type:"var",name:"NUM_RGBS",a:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",a:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",a:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_MAX_CLIP",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",a:["0.0"]},{type:"var",name:"RGB_IND",a:["0"]},{type:"var",name:"VALUE_IND",a:["0"]},{type:"var",name:"LAMP_INDEX",a:["0"]},{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",
a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NUM_LFACTORS",a:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"std_enums.glsl"},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",b:[{type:"if",d:["CAUSTICS"],group:{type:"group",b:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},
{type:"include",file:"math.glslv"}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",a:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
d:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:"uniform sampler2D u_sampler ; uniform float u_alpha_factor ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",
d:["USE_OUTLINE",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_color_id",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION"],
group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",b:[{type:"if",d:["USE_REFRACTION"],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",a:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform",
"float","u_mirror_factor",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_LAMP"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["USE_NODE_VALUE"],group:{type:"group",b:[{type:"textline",a:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_RGB"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["USE_OUTLINE"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES",
"ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]},{type:"condition",b:[{type:"if",
d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:"varying vec4 bI ; varying vec4 bJ ; varying vec4 bK ; varying vec4 bL ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["USE_REFRACTION"],group:{type:"group",b:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",a:"void main ( ) { mat4 qN ; float qO , qP ; vec4 qQ ; vec3 qR , qS , qT , qU ;".split(" ")},
{type:"condition",b:[{type:"if",d:["ALPHA"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NODES"],group:{type:"group",b:[{type:"textline",a:"qR = u_camera_eye_frag - bC ; qR = normalize ( qR ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"qN = O ( u_view_tsr_frag ) ; qM ( qR , qN , qS , qT , qU , qQ , qO ) ;".split(" ")}]}},{type:"else",
group:{type:"group",b:[{type:"textline",a:"qM ( qR , mat4 ( 0.0 ) , qS , qT , qU , qQ , qO ) ;".split(" ")}]}}]},{type:"textline",a:["qO","=","qO",";"]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:"qO = ( texture2D ( u_sampler , bM ) ) . a ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"qP = u_alpha_factor * qO ; qP += ( 1.0 - step ( 0.0 , qP ) ) ; qO = mix ( qP , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"qO = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["ALPHA_CLIP"],group:{type:"group",b:[{type:"textline",a:"if ( qO < 0.5 ) discard ; qO = 1.0 ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["USE_OUTLINE"],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",a:["}"]}]};a["color_id.glslv"]={type:"group",b:[{type:"var",name:"AU_QUALIFIER",a:["uniform"]},{type:"var",name:"MAX_BONES",a:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",a:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",a:["attribute","vec3","a_position",";"]},{type:"condition",
b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:5}],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_tangent",
";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MAIN_BEND_COL"],group:{type:"group",b:[{type:"textline",a:["attribute","float","a_bending_col_main",";"]},{type:"condition",b:[{type:"if",d:["DETAIL_BEND"],group:{type:"group",b:[{type:"textline",a:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",a:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",b:[{type:"if",d:["BEND_CENTER_ONLY"],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",
b:[{type:"textline",a:["attribute","vec3","a_position_next",";"]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_normal_next",";"]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:["attribute",
"vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",b:[{type:"if",d:["STATIC_BATCH"],group:{type:"group",b:[{type:"textline",a:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",
a:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD","DYNAMIC_GRASS",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["SMAA_JITTER"],group:{type:"group",b:[{type:"textline",a:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",
b:[{type:"if",d:["USE_NODE_B4W_REFRACTION"],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",b:[{type:"if",d:["FRAMES_BLENDING"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["BILLBOARD_JITTERED"],group:{type:"group",b:[{type:"textline",a:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",a:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",b:[{type:"if",
d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:5}],group:{type:"group",
b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",
e:2}],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",a:"void main ( ) { vec4 tv ; float tw , tx , ty ; vec3 tz , tA , tB , tC , tD , tE ; mat4 tF , tG , tH ; tF = O ( u_view_tsr ) ; tz = a_position ;".split(" ")},
{type:"condition",b:[{type:"if",d:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:5},{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["tA","=","a_normal",";"]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:"tB = vec3 ( a_tangent ) ; tC = a_tangent [ 3 ] * cross ( tA , tB ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"tA = vec3 ( 0.0 ) ; tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:"tz = mix ( tz , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",
b:[{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:"tA = mix ( tA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:"tD = vec3 ( a_tangent ) ; tE = a_tangent_next [ 3 ] * cross ( a_normal_next , tD ) ; tB = mix ( tB , tD , u_va_frame_factor ) ; tC = mix ( tC , tE , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:"sB ( tz , tB , tC , tA ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["tC","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",a:"tG = O ( u_model_tsr ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD"],group:{type:"group",
b:[{type:"textline",a:"tB = ( tG * vec4 ( tC , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"tH = ru ( u_camera_eye , tB , tF , tG ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"tH = ro ( u_camera_eye , tB , tF ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","BILLBOARD_JITTERED",
{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"tH = tH * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , tB ) ;".split(" ")}]}}]},{type:"textline",a:"c tI = rB ( tz - tC , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tH ) ; tI . b = tB ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"c tI = rB ( tz , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tG ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",
b:[{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["tA","=","a_normal",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"tA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",a:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2},{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bC = tI . a ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:5}],group:{type:"group",b:[{type:"textline",a:"bE = tI . e ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:"tw = ( dot ( cross ( tI . e , tI . c ) , tI . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( tI . c , tw ) ;".split(" ")}]}}]},{type:"textline",a:"bD = tF * vec4 ( tI . a , 1.0 ) ; tv = u_proj_matrix * bD ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SMAA_JITTER"],group:{type:"group",b:[{type:"textline",a:"tv . xy += u_subpixel_jitter * tv . w ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"tw = tv . x ; tx = tv . y ; ty = tv . w ; bG . x = ( tw + ty ) / 2.0 ; bG . y = ( tx + ty ) / 2.0 ; bG . z = ty ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",
d:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",a:["tu","(",")",";"]}]}}]},{type:"textline",a:"gl_Position = u_proj_matrix * tF * vec4 ( tI . a , 1.0 ) ; }".split(" ")}]};a["grass_map.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_SIZE"],group:{type:"group",b:[{type:"condition",b:[{type:"if",
d:["DYNAMIC_GRASS_COLOR"],group:{type:"group",b:[{type:"textline",a:["varying","vec4","tv",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["varying","float","tv",";"]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_COLOR"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","tv",";"]}]}}]}]}}]},{type:"textline",a:["void","main","(",")","{"]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_SIZE"],group:{type:"group",b:[{type:"condition",
b:[{type:"if",d:["DYNAMIC_GRASS_COLOR"],group:{type:"group",b:[{type:"textline",a:["gl_FragColor","=","tv",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( tv , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_COLOR"],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( 1.0 , tv ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",a:["}"]}]};a["grass_map.glslv"]={type:"group",b:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",a:["attribute","vec3","a_position",";"]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_SIZE"],group:{type:"group",b:[{type:"textline",a:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_COLOR"],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",
b:[{type:"if",d:["STATIC_BATCH"],group:{type:"group",b:[{type:"textline",a:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",a:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD"],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",
b:[{type:"if",d:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_SIZE"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_COLOR"],group:{type:"group",b:[{type:"textline",a:["varying","vec4","tv",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",
a:["varying","float","tv",";"]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_COLOR"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","tv",";"]}]}}]}]}}]},{type:"textline",a:"void main ( ) { vec4 tw ; vec3 tx ; mat4 ty , tz , tA ; ty = O ( u_view_tsr ) ; tz = O ( u_model_tsr ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD"],group:{type:"group",b:[{type:"textline",a:"tx = ( tz * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; tA = ro ( u_camera_eye , tx , ty ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"tA = tA * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",a:"c tB = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tA ) ; tB . b = tx ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"c tB = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tz ) ;".split(" ")}]}}]},
{type:"textline",a:"tw = u_proj_matrix * ty * vec4 ( tB . a , 1.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_SIZE"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_COLOR"],group:{type:"group",b:[{type:"textline",a:"tv = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["tv","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",b:[{type:"textline",a:["tv","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",a:["gl_Position","=","tw",";","}"]}]};a["halo.glslf"]={type:"group",b:[{type:"var",name:"NUM_LINES",a:["0"]},{type:"var",name:"NUM_RINGS",a:["0"]},{type:"var",name:"NUM_STARS",a:["0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SKY_STARS"],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 tw ;".split(" ")}]}}]}]}}]},{type:"textline",a:"varying vec2 bM ; varying float tx ;".split(" ")},
{type:"include",file:"color_util.glslf"},{type:"include",file:"halo_color.glslf"},{type:"textline",a:"void main ( ) { float ui ; vec3 uj ; vec4 uk ; uk = uh ( ) ; uj = uk . rgb ; ui = uk . a ; bu ( uj ) ; bx ( uj , ui ) ; gl_FragColor = vec4 ( uj , ui ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",a:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; attribute float a_random_vals ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform PRECISION float u_halo_size ; varying vec2 bM ; varying float tx ;".split(" ")},
{type:"condition",b:[{type:"if",d:["STATIC_BATCH"],group:{type:"group",b:[{type:"textline",a:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","tw",";"]}]}}]},
{type:"textline",a:"void main ( ) { vec4 ui , uj ; vec3 uk ; mat4 ul , um , un ; ul = O ( u_view_tsr ) ; um = O ( u_model_tsr ) ; uk = ( um * vec4 ( a_position , 1.0 ) ) . xyz ; bM = a_halo_bb_vertex * 2.0 ; tx = a_random_vals ;".split(" ")},{type:"condition",b:[{type:"if",d:["SKY_STARS"],group:{type:"group",b:[{type:"textline",a:"um = qT ( uk , ul ) ; un = ul ; un [ 3 ] [ 0 ] = 0.0 ; un [ 3 ] [ 1 ] = 0.0 ; un [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",
a:"um = qT ( uk , ul ) ;".split(" ")}]}}]},{type:"textline",a:"ui = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; ui = um * ui ;".split(" ")},{type:"condition",b:[{type:"if",d:["SKY_STARS"],group:{type:"group",b:[{type:"textline",a:"uj = u_proj_matrix * un * ui ; uj . z = 0.99999 * uj . w ;".split(" ")},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["tw","=","ui",
";"]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"uj = u_proj_matrix * ul * ui ;".split(" ")}]}}]},{type:"textline",a:["gl_Position","=","uj",";","}"]}]};a["line.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",a:"uniform vec4 u_diffuse_color ; void main ( ) { float ui ; vec3 uj ; uj = u_diffuse_color . xyz ; ui = u_diffuse_color . a ; bu ( uj ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["ALPHA"],
group:{type:"group",b:[{type:"textline",a:"bx ( uj , ui ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = vec4 ( uj , ui ) ; }".split(" ")}]};a["line.glslv"]={type:"group",b:[{type:"var",name:"AU_QUALIFIER",a:["uniform"]},{type:"var",name:"PRECISION",a:["lowp"]},{type:"var",name:"MAX_BONES",a:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",a:"attribute vec3 a_position ; attribute vec3 a_direction ; uniform mat3 u_model_tsr ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_line_width ;".split(" ")},
{type:"define",name:"M_PI",a:["3.14159265359"]},{type:"textline",a:"void main ( ) { mat2 ui ; float uj ; vec2 uk , ul ; vec4 um ; mat4 un , uo ; un = O ( u_view_tsr ) ; uo = O ( u_model_tsr ) ; c up = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , normalize ( a_direction ) , uo ) ; um = u_proj_matrix * un * vec4 ( up . a , 1.0 ) ; um . xyz /= um . w ; uk = ( u_proj_matrix * un * vec4 ( up . e , 0.0 ) ) . xy ; uj = M_PI / 2.0 ; ui = mat2 ( cos ( uj ) , sin ( uj ) , - sin ( uj ) , cos ( uj ) ) ; uk = ui * normalize ( uk ) ; ul = ( u_line_width / u_height ) * vec2 ( u_proj_matrix [ 0 ] [ 0 ] / u_proj_matrix [ 1 ] [ 1 ] , 1.0 ) ; gl_Position = vec4 ( um . xy + uk . xy * ul / 2.0 , um . z , 1.0 ) ; gl_Position *= um . w ; }".split(" ")}]};
a["main.glslf"]={type:"group",b:[{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",a:["0"]},{type:"var",name:"NUM_VALUES",a:["0"]},{type:"var",name:"NUM_RGBS",a:["0"]},{type:"var",name:"PARALLAX_STEPS",a:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",a:["0.0"]},{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},{type:"var",
name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NUM_LFACTORS",a:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",
e:1}],group:{type:"group",b:[{type:"include",file:"procedural.glslf"},{type:"condition",b:[{type:"if",d:["CAUSTICS"],group:{type:"group",b:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",a:["uniform","float","u_time",";"]},{type:"condition",b:[{type:"if",d:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_sky_texture",
";"]}]}},{type:"elif",d:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",a:["uniform","float","u_environment_energy",";"]},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",a:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},
{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["PROCEDURAL_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",b:[{type:"if",d:["USE_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3",
"u_sun_direction",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform",
"samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",d:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",b:[{type:"if",
d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},
{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",e:4}],group:{type:"group",
b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",a:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_LAMP"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["USE_NODE_VALUE"],group:{type:"group",b:[{type:"textline",a:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_RGB"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D",
"u_nodes_texture",";"]}]}}]},{type:"textline",a:["varying","vec3","bC",";"]},{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","DISABLE_FOG",{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","PARALLAX",
{type:"logical_and_expr",e:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bD",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]},{type:"condition",
b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bI",";"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bJ",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:["varying","vec4","bK",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:["varying",
"vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",
{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",a:"void main ( ) { vec2 uP ; mat4 uQ ; vec4 uR ; vec3 uS , uT , uU , uV , uW ; float uX , uY , uZ ;".split(" ")},{type:"condition",b:[{type:"if",d:["NODES","DISABLE_FOG",{type:"logic_negative_expr",e:1},
"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",e:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:"uX = length ( bD ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"uY = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",
b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uS","=","u_sun_intensity",";"]}]}}]},{type:"textline",a:"uT = normalize ( u_camera_eye_frag - bC ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:"uQ = O ( u_view_tsr_frag ) ; qM ( uT , uQ , uU , uV , uW , uR , uZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"qM ( uT , mat4 ( 0.0 ) , uU , uV , uW , uR , uZ ) ;".split(" ")}]}}]},{type:"textline",a:"uU = uU ; uZ = uZ ; uW = uW ; uR = uR ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WETTABLE"],
group:{type:"group",b:[{type:"textline",a:"uU = max ( uU - sqrt ( 0.01 * - min ( uY , 0.0 ) ) , 0.5 * uU ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CAUSTICS"],group:{type:"group",b:[{type:"textline",a:"bp ( uU , uY , u_time , uR , uW , u_sun_direction , uS , u_sun_quaternion , bC , uX ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["ALPHA"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["ALPHA_CLIP"],group:{type:"group",b:[{type:"textline",a:"if ( uZ < 0.5 ) discard ; uZ = 1.0 ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:["uZ","=","1.0",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"uO ( uU , length ( bD ) , uT , uY ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"uO ( uU , length ( bD ) , uT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["SSAO_ONLY",
"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uP = texture2DProj ( u_shadow_mask , bG ) . rg ; uY = uP . g ; uU = vec3 ( uY ) ;".split(" ")}]}}]},{type:"textline",a:["bu","(","uU",")",";"]},{type:"condition",b:[{type:"if",d:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bx ( uU , uZ ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = vec4 ( uU , uZ ) ; }".split(" ")}]};
a["main.glslv"]={type:"group",b:[{type:"var",name:"AU_QUALIFIER",a:["uniform"]},{type:"var",name:"MAX_BONES",a:["0"]},{type:"var",name:"NUM_CAST_LAMPS",a:["0"]},{type:"var",name:"PRECISION",a:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",a:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",a:["attribute","vec3","a_position",";"]},{type:"condition",
b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",e:7}],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["attribute","vec4",
"a_tangent",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MAIN_BEND_COL"],group:{type:"group",b:[{type:"textline",
a:["attribute","float","a_bending_col_main",";"]},{type:"condition",b:[{type:"if",d:["DETAIL_BEND"],group:{type:"group",b:[{type:"textline",a:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",a:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",b:[{type:"if",d:["BEND_CENTER_ONLY"],
group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_position_next",";"]},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:["attribute","vec3",
"a_normal_next",";"]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXCOORD"],group:{type:"group",b:[{type:"textline",a:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_COLOR"],
group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["STATIC_BATCH"],group:{type:"group",b:[{type:"textline",a:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_PASS"],group:{type:"group",b:[{type:"textline",a:"uniform mat4 u_view_matrix ; uniform mat3 u_view_tsr ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",a:["uniform","mat4","u_proj_matrix",";"]},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1},"BILLBOARD","DYNAMIC_GRASS",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_JITTER"],group:{type:"group",b:[{type:"textline",a:["uniform","vec2","u_subpixel_jitter",
";"]}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS"],group:{type:"group",b:[{type:"textline",a:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FRAMES_BLENDING"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["BILLBOARD_JITTERED"],group:{type:"group",b:[{type:"textline",a:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",a:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_normal_offset",";"]},{type:"condition",
b:[{type:"if",d:["MAC_OS_SHADOW_HACK"],group:{type:"group",b:[{type:"textline",a:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},{type:"textline",a:["uniform","mat4","u_p_light_matrix0",";"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",
b:[{type:"if",d:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",a:["varying","vec3","bC",";"]},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",
e:7}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","DISABLE_FOG",{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",e:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:["varying","vec4",
"bD",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","uP",";"]},{type:"condition",b:[{type:"if",d:["TEXCOORD"],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_COLOR",
"DYNAMIC_GRASS",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","uQ",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bI",";"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bJ",";"]}]}}]},{type:"condition",
b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bK",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",
{type:"equal_expr",e:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE","NODES",{type:"logic_negative_expr",e:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},
{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",b:[{type:"if",d:["NODES"],group:{type:"group",b:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",a:"void main ( ) { vec4 vI , vJ ; float vK ; vec3 vL , vM , vN , vO , vP , vQ , vR ; mat4 vS , vT , vU , vV ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFLECTION_PASS"],group:{type:"group",b:[{type:"textline",a:["vS","=","u_view_matrix",";"]},{type:"condition",b:[{type:"if",d:["NODES","DISABLE_FOG",
{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",e:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:"vT = O ( u_view_tsr ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vS = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",
a:"vU = O ( u_model_tsr ) ; vL = a_position ;".split(" ")},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},"NODES",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:["vM","=","a_normal",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vM = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",
d:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",e:2},{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vN = vec3 ( a_tangent ) ; vO = a_tangent [ 3 ] * cross ( vM , vN ) ;".split(" ")}]}},{type:"elif",d:["NODES",{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:"vP = ( vU * vec4 ( a_position , 1.0 ) ) . xyz ; vQ = normalize ( ( vU * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vP = vP - u_camera_eye ; vO = cross ( vP , vQ ) ; vN = cross ( vQ , vO ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vN = vec3 ( 0.0 ) ; vO = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:"vL = mix ( vL , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",b:[{type:"if",
d:["NODES",{type:"logic_negative_expr",e:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",e:5}],group:{type:"group",b:[{type:"textline",a:"vM = mix ( vM , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO"],group:{type:"group",b:[{type:"textline",a:"vQ = vec3 ( a_tangent ) ; vP = a_tangent_next [ 3 ] * cross ( a_normal_next , vQ ) ; vN = mix ( vN , vQ , u_va_frame_factor ) ; vO = mix ( vO , vP , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:"sB ( vL , vN , vO , vM ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["vP","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vP = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS"],group:{type:"group",b:[{type:"textline",
a:"c vW = vv ( vL , vN , vO , vM , vP , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , vS ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["BILLBOARD"],group:{type:"group",b:[{type:"textline",a:"vQ = ( vU * vec4 ( vP , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:"vV = ru ( u_camera_eye , vQ , vS , vU ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vV = ro ( u_camera_eye , vQ , vS ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vR = ( vU * vec4 ( vP , 1.0 ) ) . xyz ; vV = vV * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vR ) ;".split(" ")}]}}]},{type:"textline",a:"c vW = rB ( vL - vP , vP , vN , vO , vM , vV ) ; vW . b = vQ ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"c vW = rB ( vL , vP , vN , vO , vM , vU ) ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vK = ( dot ( cross ( vW . e , vW . c ) , vW . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( vW . c , vK ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"textline",a:"tp ( vW . a , vW . b , vM ) ;".split(" ")}]}}]},
{type:"textline",a:"bC = vW . a ;".split(" ")},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:"bE = vW . e ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"uP = u_camera_eye - vW . a ;".split(" ")},
{type:"condition",b:[{type:"if",d:["TEXCOORD"],group:{type:"group",b:[{type:"textline",a:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS"],group:{type:"group",b:[{type:"textline",a:"uQ = vW . f ;".split(" ")}]}},{type:"elif",d:["VERTEX_COLOR"],group:{type:"group",b:[{type:"textline",a:["uQ","=","a_color",";"]}]}}]}]}}]},{type:"textline",a:"vI = vS * vec4 ( vW . a , 1.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["NODES","DISABLE_FOG",
{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",e:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["REFLECTION_PASS"],group:{type:"group",b:[{type:"textline",a:"vJ = vT * vec4 ( vW . a , 1.0 ) ; bD = vJ ;".split(" ")}]}},{type:"else",group:{type:"group",
b:[{type:"textline",a:["bD","=","vI",";"]}]}}]}]}}]},{type:"textline",a:"vJ = u_proj_matrix * vI ;".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_JITTER"],group:{type:"group",b:[{type:"textline",a:"vJ . xy += u_subpixel_jitter * vJ . w ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:4}],group:{type:"group",
b:[{type:"textline",a:"bG = L ( vJ ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vH ( vW . a , vW . e ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE","NODES",{type:"logic_negative_expr",e:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bH = - vI . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["NODES"],group:{type:"group",b:[{type:"textline",a:["tu","(",")",";"]}]}}]},{type:"textline",a:["gl_Position","=","vJ",";","}"]}]};a["main_stack.glslf"]={type:"group",b:[{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",a:["0"]},{type:"var",name:"NUM_VALUES",a:["0"]},{type:"var",name:"NUM_RGBS",a:["0"]},{type:"var",name:"PARALLAX_STEPS",a:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",a:["0.0"]},
{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NUM_LFACTORS",a:["0"]},{type:"include",file:"std_enums.glsl"},
{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"procedural.glslf"},{type:"condition",b:[{type:"if",d:["CAUSTICS"],group:{type:"group",b:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",a:["uniform","float","u_time",";"]},{type:"condition",b:[{type:"if",
d:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",d:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",a:["uniform","float","u_environment_energy",";"]},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",
e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform",
"vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],
group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["PROCEDURAL_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",
e:1},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR0_CO"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_SPEC",
"ALPHA_AS_SPEC",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",b:[{type:"textline",a:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_mirrormap",
";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",d:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",
1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",a:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",a:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR0_CO"],group:{type:"group",b:[{type:"textline",a:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["TEXTURE_SPEC"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",a:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",
b:[{type:"textline",a:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",a:"varying vec3 bC ; varying vec3 bE ;".split(" ")},{type:"condition",b:[{type:"if",d:["NODES","DISABLE_FOG",{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",e:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:6}],group:{type:"group",
b:[{type:"textline",a:["varying","vec4","bD",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]},{type:"textline",a:["varying","vec3","uP",";"]},{type:"condition",b:[{type:"if",d:["TEXCOORD"],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:["varying","vec3","uQ",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bI",";"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bJ",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",
e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bK",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2},"REFRACTIVE",{type:"logical_or_expr",
e:3}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"include",file:"refraction.glslf"}]}}]},
{type:"include",file:"environment.glslf"},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",a:"void main ( ) { vec4 xN , xO , xP , xQ ; mat4 xR ; mat3 xS ; vec2 xT , xU , xV , xW ; vec3 xX , xY , xZ , x_ , ya , yb , yc , yd , ye ; float yf , yg , yh , yi , yj ;".split(" ")},
{type:"condition",b:[{type:"if",d:["NODES","DISABLE_FOG",{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",e:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",e:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:"yf = length ( bD ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",
b:[{type:"textline",a:"yg = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["xX","=","u_sun_intensity",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXCOORD"],group:{type:"group",b:[{type:"textline",a:["xT","=","bM",";"]}]}}]},{type:"textline",a:"xY = normalize ( bE ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["INVERT_FRONTFACING"],group:{type:"group",b:[{type:"textline",a:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",a:"xY = xY ; else xY = - xY ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO"],group:{type:"group",b:[{type:"textline",a:"xZ = cross ( xY , bF . xyz ) * bF . w ; xS = mat3 ( bF . xyz , xZ , xY ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD","REFRACTIVE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xR = O ( u_view_tsr_frag ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD"],group:{type:"group",b:[{type:"textline",a:"xU = normalize ( xR * vec4 ( bE , 0.0 ) ) . st ; xU = xU * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:"if ( yf < PARALLAX_LOD_DIST ) { yh = clamp ( 0.5 * ( PARALLAX_LOD_DIST - yf ) , 0.0 , 1.0 ) ; yh = u_parallax_scale * yh ; xZ = normalize ( uP * xS ) ; yi = 1.0 / PARALLAX_STEPS ; xV = xZ . xy * yh / ( PARALLAX_STEPS * xZ . z ) ; yh = 1.0 ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["xW","=","xU",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["xW",
"=","xT",";"]}]}}]},{type:"textline",a:"yj = texture2D ( u_normalmap0 , xW ) . a ; for ( float yk = 1.0 ; yk <= PARALLAX_STEPS ; yk ++ ) { if ( yj < yh ) { yh -= yi ; xW -= xV ; yj = texture2D ( u_normalmap0 , xW ) . a ; } } xV = xW + xV ; yi = texture2D ( u_normalmap0 , xV ) . a - ( yh + yi ) ; yh = yj - yh ; yi = yh / ( yh - yi ) ; xW = yi * xV + ( 1.0 - yi ) * xW ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",e:2}],group:{type:"group",
b:[{type:"condition",b:[{type:"if",d:["TEXCOORD"],group:{type:"group",b:[{type:"textline",a:"xT += xW - xU ;".split(" ")}]}}]},{type:"textline",a:["xU","=","xW",";"]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD"],group:{type:"group",b:[{type:"textline",a:"xU += xW - xT ;".split(" ")}]}}]},{type:"textline",a:["xT","=","xW",";"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO"],group:{type:"group",b:[{type:"textline",
a:[";"]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xN = texture2D ( u_normalmap0 , xU ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"xN = texture2D ( u_normalmap0 , xT ) ;".split(" ")}]}}]},{type:"textline",a:"xZ = xN . rgb - 0.5 ; xZ = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , xZ , u_normal_factor ) ; xZ = xS * xZ ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",
a:["xZ","=","xY",";"]}]}}]},{type:"textline",a:"xZ = normalize ( xZ ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD"],group:{type:"group",b:[{type:"textline",a:"xU = normalize ( xR * vec4 ( xZ , 0.0 ) ) . st ; xU = xU * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",a:"xY = normalize ( uP ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"x_ = uQ ; br ( x_ ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xN = vec4 ( x_ , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["xN","=","u_diffuse_color",";"]}]}}]},{type:"textline",a:["yi","=","1.0",";"]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xO = texture2D ( u_colormap0 , xU ) ;".split(" ")}]}},
{type:"elif",d:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xO = texture2D ( u_colormap0 , xT ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR0_CO"],group:{type:"group",b:[{type:"textline",a:"br ( xO . rgb ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",b:[{type:"textline",a:[";"]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",
{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xP = texture2D ( u_colormap1 , xU ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"xP = texture2D ( u_colormap1 , xT ) ;".split(" ")}]}}]},{type:"textline",a:"br ( xP . rgb ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xQ = texture2D ( u_stencil0 , xU ) ;".split(" ")}]}},{type:"else",
group:{type:"group",b:[{type:"textline",a:"xQ = texture2D ( u_stencil0 , xT ) ;".split(" ")}]}}]},{type:"textline",a:"xO = mix ( xO , xP , xQ . r ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xN . rgb = mix ( xN . rgb , xO . rgb , u_diffuse_color_factor ) ; yh = u_alpha_factor * xO . a ; yh += ( 1.0 - step ( 0.0 , yh ) ) ; xN . a = mix ( yh , 1.0 , u_diffuse_color . a ) ; yi = xO . a ;".split(" ")}]}},
{type:"elif",d:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"xN . rgb *= mix ( vec3 ( 1.0 ) , xO . rgb , u_diffuse_color_factor ) ; xN . a = xO . a ; yi = xO . a ;".split(" ")}]}}]}]}}]},{type:"textline",a:"x_ = u_diffuse_intensity * xN . rgb ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHADELESS"],group:{type:"group",b:[{type:"textline",a:["ya","=","x_",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"yb = u_environment_energy * dS ( xZ ) ; yb = u_ambient * yb ; xO = du ( x_ ) ; yc = u_emit * xN . rgb ; yd = u_specular_color ;".split(" ")},
{type:"condition",b:[{type:"if",d:["TEXTURE_SPEC"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["ALPHA_AS_SPEC"],group:{type:"group",b:[{type:"textline",a:"ye = vec3 ( yi ) ;".split(" ")}]}},{type:"elif",d:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"ye = texture2D ( u_specmap0 , xU ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"ye = texture2D ( u_specmap0 , xT ) . rgb ;".split(" ")}]}}]},
{type:"textline",a:"br ( ye . rgb ) ; yd = mix ( yd , ye , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",a:"yi = u_specular_params [ 0 ] ; xT = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; yd = yi * yd ; xM ( yc , yb , x_ , yd , bC , xZ , xY , xT , u_diffuse_params , xO , 0.0 , vec4 ( 0.0 ) , ya , ye ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2},
{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD"],group:{type:"group",b:[{type:"textline",a:"dP ( ya , xY , xZ , u_reflect_factor , xR ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"dP ( ya , xY , xZ , u_reflect_factor , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD"],group:{type:"group",
b:[{type:"textline",a:"dP ( ya , xY , xZ , 0.0 , xR ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"dP ( ya , xY , xZ , 0.0 , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["ya","+=","ye",";"]}]}}]},{type:"textline",a:"yi = xN . a ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",
b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WETTABLE"],group:{type:"group",b:[{type:"textline",a:"ya = max ( ya - sqrt ( 0.01 * - min ( yg , 0.0 ) ) , 0.5 * ya ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CAUSTICS"],group:{type:"group",b:[{type:"textline",a:"bp ( ya , yg , u_time , xO , xZ , u_sun_direction , xX , u_sun_quaternion , bC , yf ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["ALPHA"],group:{type:"group",
b:[{type:"condition",b:[{type:"if",d:["ALPHA_CLIP"],group:{type:"group",b:[{type:"textline",a:"if ( yi < 0.5 ) discard ; yi = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"yh = max ( max ( ye . r , ye . g ) , ye . b ) * u_specular_alpha ; yi = xN . a * ( 1.0 - yh ) + yh ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["yi","=","1.0",
";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:"xT = - ( xR * vec4 ( xZ , 0.0 ) ) . xy ; ya = mix ( ef ( bG , xT * u_refr_bump ) , ya , yi ) ; yi = 1.0 ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"uO ( ya , yf , xY , yg ) ;".split(" ")}]}},{type:"else",group:{type:"group",
b:[{type:"textline",a:"uO ( ya , yf , xY , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",a:["bu","(","ya",")",";"]},{type:"condition",b:[{type:"if",d:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bx ( ya , yi ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = vec4 ( ya , yi ) ; }".split(" ")}]};a["particle_system.glslf"]={type:"group",b:[{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},
{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NUM_LFACTORS",a:["0"]},{type:"var",name:"NUM_VALUES",a:["0"]},{type:"var",name:"NUM_RGBS",a:["0"]},{type:"var",name:"NUM_LAMP_LIGHTS",a:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"color_util.glslf"},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES","NODES",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",a:["0"]},{type:"var",name:"SOFT_STRENGTH",a:["1.0"]},{type:"textline",a:["uniform","float","u_environment_energy",";"]},{type:"condition",b:[{type:"if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["PROCEDURAL_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",b:[{type:"if",d:["USE_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",d:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"textline",a:"uniform float u_emit ; uniform float u_ambient ; uniform float u_time ; uniform vec3 u_camera_eye_frag ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_LAMP"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
b:[{type:"if",d:["USE_NODE_VALUE"],group:{type:"group",b:[{type:"textline",a:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_RGB"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uniform",
"mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES"],group:{type:"group",b:[{type:"textline",a:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{type:"logical_or_expr",
e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",e:7}],group:{type:"group",b:[{type:"textline",a:["varying","vec2",
"bM",";"]}]}}]},{type:"textline",a:["varying","vec3","bC",";"]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES","DISABLE_FOG",{type:"logic_negative_expr",e:1},"NODES",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bD",";"]}]}}]},{type:"textline",a:["varying","vec3","bE",";"]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"fog.glslf"}]}}]},{type:"include",file:"environment.glslf"},
{type:"include",file:"math.glslv"},{type:"include",file:"particles_nodes.glslf"},{type:"textline",a:"void main ( ) { mat4 Ki ; float Kj , Kk , Kl ; vec4 Km ; vec3 Kn , Ko , Kp , Kq ; Kn = normalize ( u_camera_eye_frag - bC ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Ki = O ( u_view_tsr_frag ) ; Kh ( Kn , Ki , Ko , Kp , Kq , Km , Kj ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"Kh ( Kn , mat4 ( 0.0 ) , Ko , Kp , Kq , Km , Kj ) ;".split(" ")}]}}]},{type:"textline",a:"Ko = Ko ; Kj = Kj ;".split(" ")},{type:"condition",b:[{type:"if",d:["ALPHA"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["ALPHA_CLIP"],group:{type:"group",b:[{type:"textline",a:"if ( Kj < 0.5 ) discard ; Kj = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["Kj","=","1.0",";"]}]}}]},{type:"condition",b:[{type:"if",
d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"uO ( Ko , length ( bD ) , Kn , 1.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES"],group:{type:"group",b:[{type:"textline",a:"Kk = - bD . z / u_view_max_depth ; Km = texture2DProj ( u_scene_depth , bG ) ; Kl = Z ( Km ) ; Kk = Kl - Kk ; Kk = u_view_max_depth / SOFT_STRENGTH * Kk ; Kj = Kj * min ( Kk , 1.0 ) ;".split(" ")}]}}]},{type:"textline",a:["bu","(","Ko",")",";"]},{type:"condition",
b:[{type:"if",d:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bx ( Ko , Kj ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = vec4 ( Ko , Kj ) ; }".split(" ")}]};a["particle_system.glslv"]={type:"group",b:[{type:"var",name:"BILLBOARD_ALIGN",a:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",a:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",a:["0"]},{type:"define",name:"BILLBOARD_ALIGN_VIEW",a:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",
a:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",a:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",a:["4"]},{type:"define",name:"M_PI",a:["3.14159265359"]},{type:"textline",a:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute vec3 a_p_data ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_tangent",";"]}]}}]},{type:"textline",a:["attribute",
"vec2","a_p_bb_vertex",";"]},{type:"condition",b:[{type:"if",d:["COLOR_RAMP_LENGTH",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",a:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform float u_p_tilt ; uniform float u_p_tilt_rand ;".split(" ")},
{type:"condition",b:[{type:"if",d:["REFLECTION_PASS"],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",a:"uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_p_size ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",b:[{type:"if",d:["WORLD_SPACE",{type:"logic_negative_expr",e:1},"NODES","HALO_PARTICLES",{type:"logical_or_expr",
e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_COLOR_RAMP"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_color_ramp_tex",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["HALO_PARTICLES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["varying","float","Ki",";"]}]}}]},
{type:"textline",a:["varying","vec3","uQ",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR","HALO_PARTICLES","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",e:8}],group:{type:"group",b:[{type:"textline",a:["varying",
"vec2","bM",";"]}]}}]},{type:"textline",a:["varying","vec3","bC",";"]},{type:"condition",b:[{type:"if",d:["PARTICLES_SHADELESS",{type:"logic_negative_expr",e:1},"DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","uP",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES","DISABLE_FOG",{type:"logic_negative_expr",e:1},"NODES",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["varying",
"vec4","bD",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["HALO_PARTICLES"],group:{type:"group",b:[{type:"textline",a:["varying","float","tx",";"]}]}}]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"particles.glslv"},
{type:"condition",b:[{type:"if",d:["NODES"],group:{type:"group",b:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"particles_nodes.glslv"}]}}]},{type:"textline",a:"float KW ( vec2 KU , vec2 KV ) { return ( atan ( KV . y , KV . x ) - atan ( KU . y , KU . x ) ) ; } void main ( ) { vec3 KX , KY ; vec4 KZ , K_ , La ; float Lb , Lc , Ld ; mat4 Le , Lf ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFLECTION_PASS"],group:{type:"group",b:[{type:"textline",a:["Le","=","u_view_matrix",";"]}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"Le = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",a:"Kj Lg ; Lg = KL ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { Lb = Lg . e ; Lf = qT ( Lg . b , Le ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { Lb = Lg . e ; Lf = w ( ) ; Lf [ 3 ] = vec4 ( Lg . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { Lb = Lg . e ; Lf = A ( radians ( 90.0 ) ) ; Lf [ 3 ] = vec4 ( Lg . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { Lb = KW ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + Lg . e ; Lf = y ( radians ( - 90.0 ) ) ; Lf [ 3 ] = vec4 ( Lg . b , 1.0 ) ; } KZ = vec4 ( a_p_bb_vertex * 2.0 * Lg . a * u_p_size , 0.0 , 1.0 ) ; Lc = a_p_data [ 2 ] ; Ld = u_p_tilt * u_p_tilt_rand * ( 2.0 * Lc - 1.0 ) ; Ld = ( Ld + u_p_tilt ) * M_PI ; KZ = Lf * C ( Ld + Lb ) * KZ ; K_ = Le * KZ ; La = u_proj_matrix * K_ ;".split(" ")},
{type:"condition",b:[{type:"if",d:["HALO_PARTICLES"],group:{type:"group",b:[{type:"textline",a:["tx","=","Lc",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",e:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",e:2},{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"KX = vec3 ( a_tangent ) ; KY = a_tangent [ 3 ] * cross ( a_normal , KX ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"KX = vec3 ( 0.0 ) ; KY = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",a:"c Lh = rB ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , KX , KY , vec3 ( 0.0 ) , Lf * C ( Lb ) ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Lb = ( dot ( cross ( a_normal , Lh . c ) , Lh . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( Lh . c , Lb ) ;".split(" ")}]}}]},{type:"condition",
b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:["bE","=","a_normal",";"]}]}}]},{type:"textline",a:"KT ( Lg . b , Lg . f , Lg . g , Lg . h , Lg . a , a_p_bb_vertex , a_p_data [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],
group:{type:"group",b:[{type:"textline",a:"bM = a_p_bb_vertex + 0.5 ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["HALO_PARTICLES"],group:{type:"group",b:[{type:"textline",a:"bM = a_p_bb_vertex * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Ki = Lg . c ;".split(" ")}]}}]},{type:"textline",a:"uQ = Lg . d ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES"],group:{type:"group",b:[{type:"textline",a:"Lb = La . x ; Lc = La . y ; Ld = La . w ; bG . x = ( Lb + Ld ) / 2.0 ; bG . y = ( Lc + Ld ) / 2.0 ; bG . z = Ld ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES","DISABLE_FOG",{type:"logic_negative_expr",e:1},"NODES",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["bD","=","K_",";"]}]}}]},{type:"textline",a:"gl_Position = La ; bC = KZ . xyz ;".split(" ")},{type:"condition",b:[{type:"if",d:["PARTICLES_SHADELESS",{type:"logic_negative_expr",e:1},"DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uP = u_camera_eye - KZ . xyz ;".split(" ")}]}}]},
{type:"textline",a:["}"]}]};a["particle_system_stack.glslf"]={type:"group",b:[{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NUM_LFACTORS",a:["0"]},{type:"var",name:"NUM_VALUES",a:["0"]},
{type:"var",name:"NUM_RGBS",a:["0"]},{type:"var",name:"NUM_LAMP_LIGHTS",a:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES","NODES",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",a:["0"]},{type:"var",name:"SOFT_STRENGTH",a:["1.0"]},{type:"condition",b:[{type:"if",d:["HALO_PARTICLES",
{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",a:["uniform","float","u_environment_energy",";"]},{type:"condition",b:[{type:"if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",d:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"textline",a:"uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"uniform float u_halo_size ; uniform vec3 u_halo_rings_color ; uniform float u_halo_hardness ; uniform vec3 u_halo_lines_color ;".split(" ")},{type:"condition",b:[{type:"if",d:["SKY_STARS"],group:{type:"group",b:[{type:"textline",
a:"uniform vec3 u_sun_intensity ; uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ;".split(" ")}]}}]},{type:"textline",a:"uniform float u_p_alpha_start ; uniform float u_p_alpha_end ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["PROCEDURAL_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"textline",a:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES"],group:{type:"group",b:[{type:"textline",a:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR","HALO_PARTICLES","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",e:8}],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]},{type:"textline",a:["varying","vec3","bC",";"]},{type:"condition",
b:[{type:"if",d:["NODES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["HALO_PARTICLES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:["varying","float","Ki",";"]}]}}]},{type:"textline",a:["varying","vec3","uQ",";"]}]}}]},{type:"condition",b:[{type:"if",d:["PARTICLES_SHADELESS",{type:"logic_negative_expr",e:1},"DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:["varying","vec3","uP",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES","DISABLE_FOG",{type:"logic_negative_expr",e:1},"NODES",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bD",";"]}]}}]},{type:"condition",b:[{type:"if",d:["HALO_PARTICLES"],group:{type:"group",b:[{type:"textline",a:["varying","float","tx",";"]},{type:"condition",b:[{type:"if",d:["SKY_STARS"],group:{type:"group",b:[{type:"textline",a:["varying","vec4","tw",";"]}]}}]}]}}]},
{type:"include",file:"lighting_nodes.glslf"},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",b:[{type:"if",d:["HALO_PARTICLES",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"environment.glslf"}]}}]},{type:"condition",b:[{type:"if",d:["HALO_PARTICLES"],group:{type:"group",b:[{type:"include",file:"halo_color.glslf"}]}}]},{type:"textline",a:"void main ( ) { vec2 KU ; float KV , KW , KX ; vec4 KY , KZ ; vec3 K_ , La , Lb , Lc , Ld , Le , Lf , Lg ;".split(" ")},
{type:"condition",b:[{type:"if",d:["PARTICLES_SHADELESS",{type:"logic_negative_expr",e:1},"DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"K_ = normalize ( uP ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["HALO_PARTICLES"],group:{type:"group",b:[{type:"textline",a:"KY = uh ( ) ; La = KY . rgb * uQ ; KV = 0.9 * length ( bM ) ; KV = smoothstep ( u_p_alpha_start , u_p_alpha_end , KV ) ; KV = KY . a * ( 1.0 - KV ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:["KY","=","u_diffuse_color",";"]},{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:"KZ = texture2D ( u_sampler , bM ) ; br ( KZ . rgb ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"KY . rgb = mix ( KY . rgb , KZ . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",d:["TEXTURE_BLEND_TYPE",
"TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"KY . rgb *= mix ( vec3 ( 1.0 ) , KZ . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",a:"KY . a = KZ . a ;".split(" ")}]}}]},{type:"textline",a:"KY . rgb *= uQ ; Lb = u_diffuse_intensity * KY . rgb ;".split(" ")},{type:"condition",b:[{type:"if",d:["PARTICLES_SHADELESS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"Lc = u_emit * KY . rgb ; Ld = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",e:1},"SKY_COLOR",{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"textline",a:"Le = u_environment_energy * dS ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Le = u_environment_energy * dS ( Ld ) ;".split(" ")}]}}]},{type:"textline",a:"Le = u_ambient * Le ; KW = u_specular_params [ 0 ] ; KU = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; Lf = KW * u_specular_color ; xM ( Lc , Le , Lb , Lf , bC , Ld , K_ , KU , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , La , Lg ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:["La","=","Lb",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"uO ( La , length ( bD ) , K_ , 1.0 ) ;".split(" ")}]}}]},{type:"textline",a:"KV = KY . a * Ki ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"uO ( La , length ( bD ) , K_ , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SOFT_PARTICLES"],group:{type:"group",b:[{type:"textline",a:"KW = - bD . z / u_view_max_depth ; KY = texture2DProj ( u_scene_depth , bG ) ; KX = Z ( KY ) ; KW = KX - KW ; KW = u_view_max_depth / SOFT_STRENGTH * KW ; KV = KV * min ( KW , 1.0 ) ;".split(" ")}]}}]},{type:"textline",a:["bu","(","La",")",";"]},{type:"condition",b:[{type:"if",d:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:"bx ( La , KV ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = vec4 ( La , KV ) ; }".split(" ")}]};a["procedural_skydome.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",a:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 KU ; const float KV = 0.99 ; const float KW = 1.8 ; const int KX = 8 ; float Lc ( vec3 KY , vec3 KZ ) { float K_ , La , Lb ; K_ = dot ( KZ , KZ ) ; La = 2.0 * dot ( KZ , KY ) ; Lb = dot ( KY , KY ) - 1.0 ; K_ = La * La - 4.0 * K_ * Lb ; K_ = sqrt ( K_ ) ; K_ = ( - La - K_ ) / 2.0 ; K_ = Lb / K_ ; return K_ ; } float Lj ( float Ld , float Le ) { float Lf , Lg , Lh , Li ; Lf = 3.0 * ( 1.0 - Le * Le ) ; Lg = 2.0 * ( 2.0 + Le * Le ) ; Lh = 1.0 + Ld * Ld ; Li = pow ( 1.0 + Le * Le - 2.0 * Le * Ld , 1.5 ) ; Li = max ( Li , 0.00001 ) ; return ( Lf / Lg ) * ( Lh / Li ) ; } float Lp ( vec3 Lk , vec3 Ll , float Lm ) { vec3 Ln ; float Lo ; Lo = dot ( Ll , - Lk ) ; if ( Lo < 0.0 ) { return 1.0 ; } Ln = Lk + Lo * Ll ; if ( length ( Ln ) < Lm ) { return 0.0 ; } else if ( length ( Ln ) >= Lm ) { Ln = normalize ( Ln ) * Lm - Lk ; Lo = acos ( dot ( normalize ( Ln ) , Ll ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( Lo * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 Lt ( float Lq , vec3 Lr , float Ls ) { return Lr - Lr * pow ( u_sky_color , vec3 ( Ls / Lq ) ) ; } void main ( ) { float Lu , Lv , Lw , Lx , Ly , Lz , LA , LB , LC ; vec3 LD , LE , LF , LG , LH , LI , LJ ; LD = normalize ( KU ) ; LE = u_sun_direction ; Lu = dot ( LD , LE ) ; Lv = Lj ( Lu , - 0.01 ) * u_rayleigh_brightness * LE . y ; Lw = Lj ( Lu - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - LE . y ) ; Lu = smoothstep ( 0.0 , 100.0 , Lj ( Lu , 0.9995 ) ) * u_spot_brightness ; LF = vec3 ( 0.0 , KV , 0.0 ) ; Lx = Lc ( LF , LD ) ; Ly = Lx / float ( KX ) ; Lz = Lp ( LF , LD , KV - 0.3 ) ; LG = vec3 ( 0.0 , 0.0 , 0.0 ) ; LH = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int LK = 0 ; LK < KX ; LK ++ ) { LA = Ly * float ( LK ) ; LI = LF + LD * LA ; LB = Lp ( LI , LE , KV - 0.2 ) ; LC = Lc ( LI , LE ) ; LJ = Lt ( LC , vec3 ( KW ) , u_scatter_strength ) * LB ; LG += Lt ( sqrt ( LA ) , u_sky_color * LJ , u_rayleigh_strength ) ; LH += Lt ( LA , LJ , u_mie_strength ) ; } LG = LG * Lz * pow ( Lx , u_rayleigh_collection_power ) / float ( KX ) ; LH = ( LH * Lz * pow ( Lx , u_mie_collection_power ) ) / float ( KX ) ; LG = vec3 ( Lu * LH + Lw * LH + Lv * LG ) ; bu ( LG ) ; gl_FragColor = vec4 ( LG , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",b:[{type:"textline",a:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 KU ; void main ( ) { vec4 KV , KW ; KV = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; KW = u_cube_view_matrix * KV ; KU = KW . xyz ; gl_Position = KV ; }".split(" ")}]};a["shadow.glslf"]={type:"group",b:[{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",a:["0"]},{type:"var",name:"NUM_VALUES",
a:["0"]},{type:"var",name:"NUM_RGBS",a:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",a:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",a:["0.0"]},{type:"var",name:"RGB_IND",a:["0"]},{type:"var",name:"VALUE_IND",a:["0"]},{type:"var",name:"LAMP_INDEX",
a:["0"]},{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NUM_LFACTORS",a:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"condition",
b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1},"NODES","ALPHA",{type:"logical_and_expr",e:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"include",file:"pack.glslf"},{type:"condition",b:[{type:"if",d:["CAUSTICS"],group:{type:"group",b:[{type:"include",file:"caustics.glslf"}]}}]},
{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",a:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
d:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",a:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_LAMP"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["USE_NODE_VALUE"],group:{type:"group",b:[{type:"textline",a:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_RGB"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:"uniform sampler2D u_colormap0 ; uniform float u_alpha_factor ;".split(" ")}]}}]},
{type:"textline",a:["uniform","vec4","u_diffuse_color",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform",
"PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",b:[{type:"if",d:["USE_REFRACTION"],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bC",";"]},{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",
e:4}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"NODES","ALPHA",{type:"logical_and_expr",
e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bD",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bI",";"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bJ",";"]}]}}]},{type:"condition",b:[{type:"if",
d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bK",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["SHADELESS",{type:"logic_negative_expr",e:1},"NODES","ALPHA",{type:"logical_and_expr",e:2},
"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["USE_REFRACTION"],group:{type:"group",
b:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",a:"void main ( ) { mat4 KV ; float KW , KX ; vec4 KY ; vec3 KZ , K_ , La , Lb ;".split(" ")},{type:"condition",b:[{type:"if",d:["ALPHA"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NODES"],group:{type:"group",b:[{type:"textline",a:"KZ = u_camera_eye_frag - bC ; KZ = normalize ( KZ ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"KV = O ( u_view_tsr_frag ) ; qM ( KZ , KV , K_ , La , Lb , KY , KW ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"qM ( KZ , mat4 ( 0.0 ) , K_ , La , Lb , KY , KW ) ;".split(" ")}]}}]},{type:"textline",a:["KW","=","KW",";"]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:"KW = ( texture2D ( u_colormap0 , bM ) ) . a ;".split(" ")},
{type:"condition",b:[{type:"if",d:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"KX = u_alpha_factor * KW ; KX += ( 1.0 - step ( 0.0 , KX ) ) ; KW = mix ( KX , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"KW = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",a:"if ( KW < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","NO_SHADOWS",
{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = dr ( bD . z ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",
d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:"gl_FragColor . a *= clamp ( bF . r , 0.999999999 , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",a:["}"]}]};a["shadow.glslv"]={type:"group",b:[{type:"var",name:"AU_QUALIFIER",a:["uniform"]},{type:"var",name:"MAX_BONES",a:["0"]},{type:"var",name:"NUM_CAST_LAMPS",a:["0"]},{type:"var",name:"SHADOW_TEX_RES",a:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",a:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",
file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",a:["attribute","vec3","a_position",";"]},{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},{type:"logical_or_expr",e:6}],group:{type:"group",
b:[{type:"textline",a:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",e:3}],group:{type:"group",
b:[{type:"textline",a:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MAIN_BEND_COL"],group:{type:"group",b:[{type:"textline",a:["attribute","float","a_bending_col_main",";"]},{type:"condition",b:[{type:"if",d:["DETAIL_BEND"],group:{type:"group",b:[{type:"textline",a:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",a:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",b:[{type:"if",d:["BEND_CENTER_ONLY"],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_position_next",";"]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",
b:[{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_normal_next",";"]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2},{type:"logic_negative_expr",e:1},
"TEXTURE_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",b:[{type:"if",d:["STATIC_BATCH"],group:{type:"group",b:[{type:"textline",a:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_JITTER"],group:{type:"group",b:[{type:"textline",
a:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",a:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",b:[{type:"if",d:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform",
"mat3","u_shadow_cast_billboard_view_tsr",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS"],group:{type:"group",b:[{type:"textline",a:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FRAMES_BLENDING"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["BILLBOARD_JITTERED"],group:{type:"group",b:[{type:"textline",a:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",a:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2},{type:"logic_negative_expr",e:1},"TEXTURE_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:["uniform","float","u_normal_offset",";"]},{type:"condition",b:[{type:"if",d:["MAC_OS_SHADOW_HACK"],group:{type:"group",b:[{type:"textline",a:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},{type:"textline",a:["uniform","mat4","u_p_light_matrix0",";"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION1",
"NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION"],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bC",";"]},{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:5}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",
d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"NODES","ALPHA",{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bD",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bI",";"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",
e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bJ",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bK",";"]}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",
d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},
{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",a:"void main ( ) { vec2 KV ; vec4 KW , KX ; float KY ; vec3 KZ , K_ , La , Lb , Lc , Ld ; mat4 Le , Lf , Lg , Lh ; Le = O ( u_view_tsr ) ; KZ = a_position ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",e:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:["K_","=","a_normal",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"K_ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"textline",
a:"La = vec3 ( a_tangent ) ; Lb = a_tangent [ 3 ] * cross ( K_ , La ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"La = vec3 ( 0.0 ) ; Lb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:"KZ = mix ( KZ , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",
d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:"K_ = mix ( K_ , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:"Lc = vec3 ( a_tangent ) ; Ld = a_tangent_next [ 3 ] * cross ( a_normal_next , Lc ) ; La = mix ( La , Lc , u_va_frame_factor ) ; Lb = mix ( Lb , Ld , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:"sB ( KZ , La , Lb , K_ ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["Lb","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Lb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS"],group:{type:"group",b:[{type:"textline",
a:"c Li = vv ( KZ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , K_ , Lb , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , Le ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Lf = O ( u_model_tsr ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD"],group:{type:"group",b:[{type:"textline",a:"La = ( Lf * vec4 ( Lb , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",b:[{type:"if",d:["HAIR_BILLBOARD",{type:"logic_negative_expr",
e:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Lg = O ( u_shadow_cast_billboard_view_tsr ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["Lg","=","Le",";"]}]}}]},{type:"condition",b:[{type:"if",d:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Lh = ru ( u_camera_eye , La , Lg , Lf ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"Lh = ro ( u_camera_eye , La , Lg ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Lh = Lh * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , La ) ;".split(" ")}]}}]},{type:"textline",a:"c Li = rB ( KZ - Lb , Lb , vec3 ( 0.0 ) , vec3 ( 0.0 ) , K_ , Lh ) ; Li . b = La ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",
a:"c Li = rB ( KZ , Lb , vec3 ( 0.0 ) , vec3 ( 0.0 ) , K_ , Lf ) ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["K_","=","a_normal",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"K_ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",a:"tp ( Li . a , Li . b , K_ ) ;".split(" ")}]}}]},{type:"condition",
b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bC = Li . a ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",e:3},{type:"logical_or_expr",e:5}],group:{type:"group",b:[{type:"textline",a:"bE = Li . e ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",
a:"KY = ( dot ( cross ( Li . e , Li . c ) , Li . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( Li . c , KY ) ;".split(" ")}]}}]}]}}]},{type:"textline",a:"KW = Le * vec4 ( Li . a , 1.0 ) ; KX = u_proj_matrix * KW ;".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_JITTER"],group:{type:"group",b:[{type:"textline",a:"KX . xy += u_subpixel_jitter * KX . w ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NODES","ALPHA",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",
d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bG = L ( KX ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",a:["tu","(",")",";"]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",
d:["TEXTURE_COLOR"],group:{type:"group",b:[{type:"textline",a:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vH ( Li . a , Li . e ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"NODES","ALPHA",{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:["bD","=","KW",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"KV = ( u_proj_matrix * Le [ 3 ] ) . xy ; KY = SHADOW_TEX_RES / 2.0 ; KV = floor ( KV * KY + 0.5 ) / KY - KV ; KX . xy += KV ;".split(" ")}]}}]},{type:"textline",a:["gl_Position","=","KX",";","}"]}]};a["special_lens_flares.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},
{type:"textline",a:"uniform sampler2D u_sampler ; varying vec2 bM ; void main ( ) { vec4 KV ; KV = texture2D ( u_sampler , bM ) ; bu ( KV . rgb ) ; bx ( KV . rgb , KV . a ) ; gl_FragColor = KV ; }".split(" ")}]};a["special_lens_flares.glslv"]={type:"group",b:[{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"define",name:"LIGHT_INDEX",a:["0"]},{type:"include",file:"math.glslv"},{type:"textline",a:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 bM ; void main ( ) { vec2 KV ; float KW ; vec4 KX ; vec3 KY ; mat4 KZ ; KZ = O ( u_view_tsr ) ; bM = a_texcoord ; KY = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; KX = u_proj_matrix * KZ * vec4 ( KY , 0.0 ) ; KX . x /= KX . w ; KX . y /= KX . w ; KX += 99999.0 * step ( KX . z , 0.0 ) ; KX += 100.0 * ( step ( 1.0 , abs ( KX . x ) ) + step ( 1.0 , abs ( KX . y ) ) ) ; KX . x = - a_lf_dist * KX . x ; KX . y = - a_lf_dist * KX . y ; KW = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; KV = vec2 ( a_lf_bb_vertex . x / KW , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float K_ = 1.9 ; KV *= ( 1.0 + K_ * length ( KX . xy ) ) ; } gl_Position = vec4 ( KX . xy + KV , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",b:[{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"define",name:"INV_PI",a:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",b:[{type:"if",d:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",b:[{type:"if",d:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",e:1},"WO_SKYTEX",
{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",a:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 MZ ( vec3 MU , vec3 MV , float MW , float MX ) { float MY ; MY = MW * MX ;".split(" ")},{type:"condition",b:[{type:"if",d:["BLENDTYPE","MIX",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Li ( MV , MU , MY ) ;".split(" ")}]}},
{type:"elif",d:["BLENDTYPE","ADD",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Lm ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","SUBTRACT",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Lq ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","MULTIPLY",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Lv ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","SCREEN",{type:"equal_expr",
e:2}],group:{type:"group",b:[{type:"textline",a:"return LA ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","OVERLAY",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return LF ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return LJ ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","DIVIDE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:"return LN ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","DARKEN",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return LR ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","LIGHTEN",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return LV ( MU , MV , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","HUE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Ma ( MV , MU , MY ) ;".split(" ")}]}},{type:"elif",
d:["BLENDTYPE","SATURATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Mg ( MV , MU , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","VALUE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Mm ( MV , MU , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","COLOR",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Ms ( MV , MU , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",e:2}],
group:{type:"group",b:[{type:"textline",a:"return Mx ( MV , MU , MY ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return MB ( MV , MU , MY ) ;".split(" ")}]}}]},{type:"textline",a:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float Ng ( float M_ , float Na , float Nb , float Nc ) { float Nd ; vec3 Ne , Nf ; Ne = vec3 ( M_ ) , Nf = vec3 ( Na ) ; Nd = Nb * Nc ;".split(" ")},{type:"condition",b:[{type:"if",d:["BLENDTYPE","MIX",
{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Li ( Nf , Ne , Nd ) . x ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","ADD",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Lm ( Ne , Nf , Nd ) . x ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","SUBTRACT",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Lq ( Ne , Nf , Nd ) . x ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","MULTIPLY",{type:"equal_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:"return MH ( M_ , Na , Nd , Nc ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","SCREEN",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return MN ( M_ , Na , Nd , Nc ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","OVERLAY",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return MT ( M_ , Na , Nd , Nc ) ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return LJ ( Ne , Nf , Nd ) . x ;".split(" ")}]}},
{type:"elif",d:["BLENDTYPE","DIVIDE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return LN ( Ne , Nf , Nd ) . x ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","DARKEN",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return LR ( Ne , Nf , Nd ) . x ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","LIGHTEN",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return LV ( Ne , Nf , Nd ) . x ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","SOFT_LIGHT",
{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Mx ( Nf , Ne , Nd ) . x ;".split(" ")}]}},{type:"elif",d:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return MB ( Nf , Ne , Nd ) . x ;".split(" ")}]}}]},{type:"textline",a:["return","0.0",";","}"]}]}}]},{type:"condition",b:[{type:"if",d:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},"REFLECTION_PASS",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_camera_eye_frag ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",a:["varying","vec3","KU",";"]},{type:"condition",b:[{type:"if",d:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",e:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",
e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]},{type:"textline",a:"void main ( ) { vec4 Nh ; float Ni , Nj , Nk ; vec3 Nl , Nm , Nn , No , Np ; Nm = normalize ( KU ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["PROCEDURAL_SKYDOME"],group:{type:"group",b:[{type:"textline",a:"Nl = textureCube ( u_sky , Nm ) . rgb ;".split(" ")}]}},{type:"elif",d:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",e:2},{type:"logic_negative_expr",
e:1}],group:{type:"group",b:[{type:"textline",a:"Nl = u_horizon_color ; bu ( Nl ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:[";"]},{type:"condition",b:[{type:"if",d:["WO_SKYPAPER"],group:{type:"group",b:[{type:"textline",a:"Nn = vec3 ( bM , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nn = vec3 ( KU . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",a:["Ni","=","0.0",";"]},{type:"condition",b:[{type:"if",d:["WO_SKYBLEND"],group:{type:"group",
b:[{type:"condition",b:[{type:"if",d:["WO_SKYPAPER"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WO_SKYREAL"],group:{type:"group",b:[{type:"textline",a:"Ni = abs ( bM . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Ni = ( bM . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nj = acos ( Nm . y ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["WO_SKYREAL"],group:{type:"group",b:[{type:"textline",a:"Ni = abs ( Nj * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"Ni = 1.0 - Nj * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",a:"No = u_horizon_color ; Np = u_zenith_color ;".split(" ")},{type:"condition",b:[{type:"if",d:["WO_SKYTEX"],group:{type:"group",b:[{type:"textline",a:"Nj = 1.0 ; Nh = textureCube ( u_sky , Nm ) ; br ( Nh . rgb ) ; Nj = Nh . a ;".split(" ")},{type:"condition",b:[{type:"if",d:["MTEX_RGBTOINT"],group:{type:"group",b:[{type:"textline",a:"Nj = bB ( Nh ) ;".split(" ")}]}}]},{type:"condition",
b:[{type:"if",d:["MTEX_NEGATIVE"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MTEX_RGBTOINT",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"Nh = vec4 ( vec3 ( 1.0 ) - Nh . rgb , Nh . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nj = 1.0 - Nj ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"condition",b:[{type:"if",
d:["MTEX_RGBTOINT"],group:{type:"group",b:[{type:"textline",a:"Nh = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nj = Nh . a ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WOMAP_HORIZ"],group:{type:"group",b:[{type:"textline",a:"No = MZ ( Nh . rgb , No , Nj , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:["Nk","=","0.0",";"]},{type:"condition",b:[{type:"if",d:["WO_SKYREAL"],group:{type:"group",b:[{type:"textline",a:"if ( dot ( Nn , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",b:[{type:"if",d:["WOMAP_ZENUP"],group:{type:"group",b:[{type:"textline",a:"Nk = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:[";"]}]}}]},{type:"textline",a:["}"]},{type:"condition",b:[{type:"if",d:["WOMAP_ZENDOWN"],group:{type:"group",b:[{type:"textline",
a:"else Nk = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WOMAP_ZENUP"],group:{type:"group",b:[{type:"textline",a:"Nk = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",d:["WOMAP_ZENDOWN"],group:{type:"group",b:[{type:"textline",a:"Nk = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",a:"if ( Nk != 0.0 ) Np = MZ ( Nh . rgb , Np , Nj , Nk ) ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WOMAP_BLEND"],
group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MTEX_RGBTOINT",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"Nj = dot ( Nh . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",a:"Ni = Ng ( u_sky_tex_dvar , Ni , Nj , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["WO_SKYBLEND"],group:{type:"group",b:[{type:"textline",a:"Nl = mix ( No , Np , Ni ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",
a:["Nl","=","No",";"]}]}}]},{type:"textline",a:["bu","(","Nl",")",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"bu ( No ) ; bu ( Np ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["WO_SKYBLEND"],group:{type:"group",b:[{type:"textline",a:"Nl = mix ( No , Np , Ni ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["Nl","=","No",";"]}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},"REFLECTION_PASS",
{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"textline",a:"br ( Nl ) ; Ni = WATER_LEVEL - u_camera_eye_frag . y ; No = vec3 ( 0.0 ) ; No = mix ( u_underwater_fog_color_density . rgb , No , min ( - Nm . y , 1.0 ) ) ; No *= min ( 1.0 - min ( 0.03 * Ni , 0.8 ) , 1.0 ) ; Ni = clamp ( sign ( 0.01 * Ni - Nm . y ) , 0.0 , 1.0 ) ; Nl = mix ( Nl , No , Ni ) ; bu ( Nl ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = vec4 ( Nl , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslv"]={type:"group",b:[{type:"textline",a:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 KU ;".split(" ")},{type:"condition",b:[{type:"if",d:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",e:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]},{type:"textline",a:"void main ( ) { vec4 MU , MV ; MU = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; MV = u_sky_vp_inverse * MU ; KU = MV . xyz ;".split(" ")},
{type:"condition",b:[{type:"if",d:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",e:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bM = a_position . xy ;".split(" ")}]}}]},{type:"textline",a:["gl_Position","=","MU",";","}"]}]};a["special_water.glslf"]={type:"group",b:[{type:"var",name:"ABSORB",a:["0.0"]},{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"var",name:"SSS_STRENGTH",a:["6.0"]},{type:"var",name:"SSS_WIDTH",
a:["0.0"]},{type:"var",name:"PRECISION",a:["lowp"]},{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NUM_LFACTORS",a:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",a:["0.001"]},{type:"define",name:"REFR_BUMP",a:["0.0005"]},{type:"textline",a:["uniform","float","u_time",";"]},{type:"condition",b:[{type:"if",d:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
d:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",a:["uniform","float","u_environment_energy",";"]},{type:"condition",b:[{type:"if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",a:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],
group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",b:[{type:"if",d:["PROCEDURAL_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_FOG"],group:{type:"group",b:[{type:"textline",a:["uniform","vec4","u_fog_params",
";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_plane_reflection",";"]}]}},
{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING"],group:{type:"group",b:[{type:"textline",a:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",a:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",1,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",2,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec2",
"u_normalmap2_scale",";"]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",3,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",
b:[{type:"if",d:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"textline",a:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DEBUG_WIREFRAME"],group:{type:"group",b:[{type:"textline",a:"const float MU = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",a:"varying vec3 uP ; varying vec3 bC ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2},"FOAM",{type:"logical_or_expr",e:2},"GENERATED_MESH",
{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec2","bM",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"varying vec3 bF ; varying vec3 MV ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},
{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2},"FOAM",{type:"logical_or_expr",e:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","MW",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","MX",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE",{type:"logical_or_expr",
e:3}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DEBUG_WIREFRAME"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","MY",";"]}]}}]},{type:"include",
file:"environment.glslf"},{type:"condition",b:[{type:"if",d:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",a:"vec3 Nj ( in vec2 MZ , in vec3 M_ , in vec3 Na , in vec3 Nb , out float Nc ) { float Nd , Ne , Nf ; vec2 Ng ; vec3 Nh , Ni ; Nc = 0.0 ; Nh = reflect ( - Na , M_ ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Ng = MZ . xy + M_ . xz * REFL_BUMP / bH ; Nc = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1},"WATER_EFFECTS",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Ni = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
b:[{type:"textline",a:"Ni = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",a:"} else { Ni = texture2D ( u_plane_reflection , Ng ) . rgb ; br ( Ni ) ; }".split(" ")}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nc = u_mirror_factor ; Ni = Nb * textureCube ( u_mirrormap , Nh ) . rgb ; br ( Ni ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nc = u_reflect_factor ; Ni = Nb * vec3 ( 0.3 , 0.5 , 1.0 ) ; br ( Ni ) ;".split(" ")}]}}]},
{type:"textline",a:"Nh = normalize ( Nh + Na ) ; Nd = 1.0 - dot ( Na , Nh ) ; Ne = u_fresnel_params [ 3 ] ; Nf = u_fresnel_params [ 2 ] ; Nf = Ne + ( 1.0 - Ne ) * pow ( Nd , Nf ) ; Nc = min ( Nc * Nf , 1.0 ) ; return Ni ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",a:"void main ( ) { vec4 Nk ; vec2 Nl , Nm , Nn ; float No , Np , Nq , Nr , Ns ; vec3 Nt , Nu , Nv , Nw , Nx , Ny , Nz , NA , NB ; mat3 NC ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",
0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"NC = mat3 ( bF , MV , bE ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC"],group:{type:"group",b:[{type:"textline",a:"Nt = normalize ( bE ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nt = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC","FOAM",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"No = bC . y - WATER_LEVEL ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2},"FOAM",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["GENERATED_MESH"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DYNAMIC"],group:{type:"group",b:[{type:"textline",a:"Nl = vec2 ( MW . x , - MW . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nl = vec2 ( bC . x , - bC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
b:[{type:"textline",a:["Nl","=","bM",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nu = vec3 ( 0.0 ) ; Nv = texture2D ( u_normalmap0 , Nl * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Nu += Nv ;".split(" ")},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"textline",a:"Nw = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["NORM_FOAM0"],
group:{type:"group",b:[{type:"textline",a:["Nw","+=","Nv",";"]}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",1,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nv = texture2D ( u_normalmap0 , Nl * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Nu += Nv ;".split(" ")},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NORM_FOAM1"],group:{type:"group",b:[{type:"textline",
a:["Nw","+=","Nv",";"]}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",2,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nv = texture2D ( u_normalmap0 , Nl * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Nu += Nv ;".split(" ")},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NORM_FOAM2"],group:{type:"group",b:[{type:"textline",a:["Nw","+=","Nv",";"]}]}}]}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",3,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nv = texture2D ( u_normalmap0 , Nl * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Nu += Nv ;".split(" ")},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NORM_FOAM3"],group:{type:"group",b:[{type:"textline",a:["Nw","+=","Nv",";"]}]}}]}]}}]}]}}]},{type:"condition",b:[{type:"if",
d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"textline",a:"Nw = NC * Nw ; if ( ! f ( Nw , vec3 ( 0.0 ) ) ) Nw = normalize ( Nw ) ; Nw = mix ( Nt , Nw , 0.2 ) ; Nw = normalize ( Nw ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC"],group:{type:"group",b:[{type:"textline",a:"Nt = mix ( Nt , normalize ( NC * Nu ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",
a:"Nt = mix ( Nt , normalize ( NC * Nu ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",a:"Nt = normalize ( Nt ) ;".split(" ")}]}}]},{type:"textline",a:"Nu = normalize ( uP ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nm = bG . xy / bG . z ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:"Nn = Nm + Nt . xz * u_refr_bump / bH ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING"],group:{type:"group",b:[{type:"textline",a:"Np = u_diffuse_color . a ; Nk = texture2DProj ( u_scene_depth , bG ) ; Nq = Z ( Nk ) ; Nr = max ( Nq - bH , 0.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:"Nq = dY ( Nq , Nn , Nm ) ; Nq = max ( Nq - bH , 0.0 ) ; Nq = u_view_max_depth / ABSORB * Nq ; Nq = min ( Np * Nq , 1.0 ) ; Np = min ( 15.0 * Np * u_view_max_depth * Nr , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"Ns = u_view_max_depth / ABSORB * Nr ; if ( u_cam_water_depth > 0.0 ) Np = min ( Np * Ns , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Np = u_diffuse_color . a ;".split(" ")},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:["Nq","=","Np",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:"if ( u_cam_water_depth < 0.0 ) Nq = 0.0 ; Nv = texture2D ( u_refractmap , Nn ) . rgb ; br ( Nv ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:"Ns = pow ( min ( MX . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; Nx = mix ( u_shallow_water_col , u_diffuse_color . rgb , Ns ) ; Ns = pow ( min ( MX . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; Nx = mix ( u_shore_water_col , Nx , Ns ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nx = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",
b:[{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING"],group:{type:"group",b:[{type:"textline",a:"Nr = max ( 1.0 - u_view_max_depth * Nr , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nr = 1.0 - Np ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC"],group:{type:"group",b:[{type:"textline",a:"No = max ( No / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:"Ny = normalize ( vec3 ( MX . r , 0.0 , MX . g ) ) ; Ny = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , Ny , 0.8 ) ) ; Ns = 1.25 * max ( dot ( Nw , Ny ) - 0.2 , 0.0 ) ; Ns += max ( dot ( Nw , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; Nr += Ns * ( 1.0 - MX . b ) ; No *= ( 1.0 - 0.95 * pow ( MX . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",a:"Nr += No ; Nr = min ( u_foam_factor * Nr , 1.0 ) ;".split(" ")}]}}]},{type:"textline",a:"Nk = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + Nl * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",a:"No = u_specular_params [ 0 ] ; Nl = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; Nw = No * u_specular_color ; Ny = u_environment_energy * dS ( Nt ) ; Ny = u_ambient * Ny ; Ny = Ny + u_sun_intensity ;".split(" ")},{type:"condition",b:[{type:"if",
d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nz = Nj ( Nm , Nt , Nu , Ny , No ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nz = Nj ( vec2 ( 0.0 ) , Nt , Nu , Ny , No ) ;".split(" ")}]}}]},{type:"textline",a:"Nx = u_diffuse_intensity * Nx ; xM ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , Nx , Nw , bC , Nt , Nu , Nl , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , NA , NB ) ;".split(" ")},{type:"condition",b:[{type:"if",
d:["DYNAMIC"],group:{type:"group",b:[{type:"textline",a:"Ns = max ( dot ( u_sun_direction , - bE ) + SSS_WIDTH , 0.0 ) * max ( dot ( - Nu , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; Ns = clamp ( SSS_STRENGTH * Ns , 0.0 , 1.0 ) ; NA = mix ( NA , u_shallow_water_col , Ns ) ; NA = mix ( NA , u_shore_water_col , Ns ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"textline",a:"NA = mix ( Nv , NA , Nq ) ;".split(" ")}]}}]},
{type:"textline",a:"NA = mix ( NA , Nz , No ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"textline",a:"No = mix ( Nk . g , Nk . r , max ( 4.0 * ( Nr - 0.75 ) , 0.0 ) ) ; No = mix ( Nk . b , No , max ( 2.0 * Nr - 1.0 , 0.0 ) ) ; No = mix ( 0.0 , No , Nr ) ; NA = mix ( NA , Ny , No ) ;".split(" ")}]}}]},{type:"textline",a:["NA","+=","NB",";"]},{type:"condition",b:[{type:"if",d:["DISABLE_FOG",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",
a:"Nr = bH * u_view_max_depth ; Nq = 1.0 ; if ( u_cam_water_depth > 1.0 ) Nq = 2.0 ; uO ( NA , Nr , Nu , Nq ) ;".split(" ")}]}}]},{type:"textline",a:["bu","(","NA",")",";"]},{type:"condition",b:[{type:"if",d:["REFRACTIVE",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"Np = max ( Np , NB . r ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["FOAM"],group:{type:"group",b:[{type:"textline",a:["Np","+=","No",";"]}]}}]}]}},{type:"elif",d:["SHORE_SMOOTHING",{type:"logic_negative_expr",
e:1}],group:{type:"group",b:[{type:"textline",a:["Np","=","1.0",";"]}]}}]},{type:"condition",b:[{type:"if",d:["ALPHA"],group:{type:"group",b:[{type:"textline",a:"bx ( NA , Np ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DEBUG_WIREFRAME",1,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"extension",a:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",a:"NB = fwidth ( MY ) ; NB = smoothstep ( vec3 ( 0.0 ) , NB * MU , MY ) ; No = min ( min ( NB . x , NB . y ) , NB . z ) ; No = clamp ( No , 0.0 , 1.0 ) ; NA = mix ( u_wireframe_edge_color , NA , No ) ; Np = mix ( 1.0 , Np , No ) ;".split(" ")}]}},
{type:"elif",d:["DEBUG_WIREFRAME",2,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"NB = sign ( MY - vec3 ( 0.02 * MU ) ) ; No = 1.0 ; if ( NB . x < 0.0 || NB . y < 0.0 || NB . z < 0.0 ) No = 0.0 ; NA = mix ( u_wireframe_edge_color , NA , No ) ; Np = mix ( 1.0 , Np , No ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = vec4 ( NA , Np ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",b:[{type:"var",name:"DIR_MIN_SHR_FAC",a:["0.0"]},{type:"var",name:"DIR_FREQ",a:["0.0"]},
{type:"var",name:"DIR_NOISE_SCALE",a:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",a:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",a:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",a:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",a:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",a:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",a:["0.0"]},{type:"var",name:"DST_MIN_FAC",a:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",a:["0.0"]},{type:"var",name:"PRECISION",a:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",a:["0.0"]},
{type:"var",name:"SHORE_MAP_SIZE_X",a:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",a:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",a:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",a:["0.0"]},{type:"var",name:"WATER_LEVEL",a:["0.0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"var",name:"WAVES_LENGTH",a:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",a:["attribute",
"vec3","a_position",";"]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2},"DYNAMIC",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["GENERATED_MESH",{type:"logic_negative_expr",e:1},"NUM_NORMALMAPS",0,{type:"g_expr",e:2},"FOAM",{type:"logical_or_expr",e:2},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DEBUG_WIREFRAME"],group:{type:"group",b:[{type:"textline",a:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",b:[{type:"if",d:["STATIC_BATCH"],group:{type:"group",b:[{type:"textline",a:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",
a:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",b:[{type:"if",d:["DYNAMIC"],group:{type:"group",b:[{type:"textline",a:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:["uniform",
"PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",a:"varying vec3 uP ; varying vec3 bC ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2},"FOAM",{type:"logical_or_expr",e:2},"GENERATED_MESH",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying",
"vec2","bM",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"varying vec3 bF ; varying vec3 MV ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2},"FOAM",{type:"logical_or_expr",e:2},"GENERATED_MESH",
"DYNAMIC",{type:"logical_and_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","MW",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","MX",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","bG",";"]}]}}]},{type:"condition",b:[{type:"if",
d:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:["varying","float","bH",";"]}]}}]},{type:"condition",b:[{type:"if",d:["DEBUG_WIREFRAME"],group:{type:"group",b:[{type:"textline",a:["varying","vec3","MY",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:"vec3 Nc ( in vec2 MU ) { float MZ ; vec4 M_ ; vec2 Na ; Na = 0.5 + vec2 ( ( MU . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( MU . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; M_ = texture2D ( u_shore_dist_map , Na ) ; const vec2 Nb = vec2 ( 1.0 / 255.0 , 1.0 ) ; MZ = dot ( M_ . ba , Nb ) ; Na = normalize ( M_ . rg * 2.0 - 1.0 ) ; return vec3 ( Na , MZ ) ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["DYNAMIC"],group:{type:"group",b:[{type:"define",name:"M_PI",a:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",a:["0.3"]},{type:"textline",a:"void No ( inout vec3 Nd , in float Ne , in vec3 Nf ) { vec2 Ng , Nh , Ni ; float Nj , Nk , Nl , Nm , Nn ; Nj = aU ( DST_NOISE_SCALE_0 * ( Nd . xz + DST_NOISE_FREQ_0 * Ne ) ) * aU ( DST_NOISE_SCALE_1 * ( Nd . zx - DST_NOISE_FREQ_1 * Ne ) ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",
b:[{type:"textline",a:"Nk = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; Nl = Nf . b ; Nm = sqrt ( Nl ) ; Nk = max ( Nl , DIR_MIN_SHR_FAC ) * sin ( Nm / Nk + DIR_FREQ * Ne ) ; Nn = max ( aU ( DIR_NOISE_SCALE * ( Nd . xz + DIR_NOISE_FREQ * Ne ) ) , DIR_MIN_NOISE_FAC ) ; Nk *= Nn ; Nm = WAVES_HEIGHT * mix ( Nk , Nj , max ( Nm , DST_MIN_FAC ) ) ; Ng = Nf . rg ; Nk = WAVES_HOR_FAC * Nk * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - Nl ) , 0.0 ) ; Ng = Nk * Ng ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",
a:"Nm = WAVES_HEIGHT * Nj ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["GENERATED_MESH"],group:{type:"group",b:[{type:"textline",a:"Nh = 2.0 * ( Nd . xz - 0.1 * Ne ) ; Ni = 1.3 * ( Nd . zx + 0.03 * Ne ) ; Nj = ay ( 0.5 * ( Nh + Ni ) ) . x - 0.5 ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:"Nd . xz += Ng ; Nj *= Nl ;".split(" ")}]}}]},{type:"textline",a:"Nm += SMALL_WAVES_FAC * Nj ;".split(" ")}]}}]},{type:"textline",a:"Nd . y += Nm ; }".split(" ")}]}}]},
{type:"textline",a:"void main ( ) { vec4 Np , Nq ; vec2 Nr ; float Ns , Nt , Nu ; vec3 Nv , Nw , Nx , Ny , Nz ; mat4 NA , NB ; NA = O ( u_view_tsr ) ; NB = O ( u_model_tsr ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["DEBUG_WIREFRAME"],group:{type:"group",b:[{type:"textline",a:"if ( a_polyindex == 0.0 ) MY = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) MY = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) MY = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
b:[{type:"if",d:["GENERATED_MESH"],group:{type:"group",b:[{type:"textline",a:"Nv = a_position ; Ns = abs ( Nv . y ) ; Nr = u_camera_eye . xz - mod ( u_camera_eye . xz , Ns ) ; Nv . y = WATER_LEVEL ; Nv . xz += Nr ; Nv = Nv ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2},"FOAM",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["bM","=","a_texcoord",";"]}]}}]},{type:"textline",a:"c NC = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , NB ) ; Nv = NC . a ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:"MX = Nc ( Nv . xz ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC"],group:{type:"group",b:[{type:"textline",a:"Nt = length ( u_wind ) ; Nu = u_time ; Nu *= Nt ;".split(" ")},{type:"condition",b:[{type:"if",d:["GENERATED_MESH"],group:{type:"group",b:[{type:"textline",a:"Ns = Ns ; Nw = Nv + vec3 ( Ns , 0.0 , 0.0 ) ; Nx = Nv + vec3 ( 0.0 , 0.0 , Ns ) ;".split(" ")},{type:"condition",b:[{type:"if",
d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2},"FOAM",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["MW","=","Nv",";"]}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nw = Nv + vec3 ( 0.05 , 0.0 , 0.0 ) ; Nx = Nv + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_PARAMS"],group:{type:"group",b:[{type:"textline",a:"Ny = Nc ( Nw . xz ) ; Nz = Nc ( Nx . xz ) ; No ( Nw , Nu , Ny ) ; No ( Nx , Nu , Nz ) ; No ( Nv , Nu , MX ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"No ( Nw , Nu , vec3 ( 0.0 ) ) ; No ( Nx , Nu , vec3 ( 0.0 ) ) ; No ( Nv , Nu , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["GENERATED_MESH"],group:{type:"group",b:[{type:"textline",a:"if ( a_position . y < 0.0 ) { Nv . y = WATER_LEVEL - 1.0 ; Nw . y = Nv . y ; Nx . y = Nv . y ; }".split(" ")}]}}]},{type:"textline",a:"Nw = normalize ( Nw - Nv ) ; Nx = normalize ( Nx - Nv ) ; bE = normalize ( cross ( Nx , Nw ) ) ; Nu = dot ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Nu = clamp ( 0.8 - Nu , 0.0 , 1.0 ) ; bE = mix ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) , Nu ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["NUM_NORMALMAPS",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DYNAMIC",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"Nx = a_tangent ; bE = a_normal ;".split(" ")}]}}]},{type:"textline",a:"bF = Nx ; MV = cross ( bE , bF ) ;".split(" ")}]}}]},{type:"textline",a:"bC = Nv ; uP = u_camera_eye - Nv ; Np = NA * vec4 ( Nv , 1.0 ) ; Nq = u_proj_matrix * Np ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:"Nu = Nq . x ; Ns = Nq . y ; Nt = Nq . w ; bG . x = ( Nu + Nt ) / 2.0 ; bG . y = ( Ns + Nt ) / 2.0 ; bG . z = Nt ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",
a:"bH = - Np . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",a:["gl_Position","=","Nq",";","}"]}]};a["wireframe.glslf"]={type:"group",b:[{type:"define",name:"WM_NONE",a:["0"]},{type:"define",name:"WM_OPAQUE_WIREFRAME",a:["1"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",a:["2"]},{type:"define",name:"WM_FRONT_BACK_VIEW",a:["3"]},{type:"define",name:"WM_DEBUG_SPHERES",a:["4"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",
b:[{type:"if",d:["DEBUG_SPHERE",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",a:"varying vec3 MY ; const float MU = 1.0 ;".split(" ")},{type:"condition",b:[{type:"if",d:["DEBUG_SPHERE"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",b:[{type:"textline",a:"const vec3 MZ = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"const vec3 MZ = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"const vec3 M_ = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Na = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Nb = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",a:"void main ( ) { float Nc , Nd ; vec3 Ne , Nf ; Ne = vec3 ( 0.0 ) ; Nc = 0.0 ;".split(" ")},{type:"condition",b:[{type:"if",d:["DEBUG_SPHERE"],group:{type:"group",
b:[{type:"textline",a:"Nf = sign ( MY - vec3 ( 0.02 * MU ) ) ; if ( Nf . x < 0.0 || Nf . y < 0.0 || Nf . z < 0.0 ) { Ne = MZ ; Nc = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",d:["WIREFRAME_QUALITY",0,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nf = sign ( MY - vec3 ( 0.02 * MU ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Nf . x < 0.0 || Nf . y < 0.0 || Nf . z < 0.0 ) Ne = u_wireframe_edge_color ; else Ne = Nb ; Nc = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Nf . x < 0.0 || Nf . y < 0.0 || Nf . z < 0.0 ) Nc = 1.0 ; else Nc = 0.0 ; Ne = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Nf . x < 0.0 || Nf . y < 0.0 || Nf . z < 0.0 ) Ne = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ne = M_ ; else Ne = Na ; Nc = 1.0 ; }".split(" ")}]}},
{type:"elif",d:["WIREFRAME_QUALITY",1,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"extension",a:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",a:"Nf = fwidth ( MY ) ; Nf = smoothstep ( vec3 ( 0.0 ) , Nf * MU , MY ) ; Nd = min ( min ( Nf . x , Nf . y ) , Nf . z ) ; Nd = clamp ( Nd , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ne = vec3 ( mix ( u_wireframe_edge_color , Nb , Nd ) ) ; Nc = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ne = u_wireframe_edge_color ; Nc = mix ( 1.0 , 0.0 , Nd ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ne = mix ( u_wireframe_edge_color , M_ , Nd ) ; else Ne = mix ( u_wireframe_edge_color , Na , Nd ) ; Nc = 1.0 ; }".split(" ")}]}}]},
{type:"textline",a:["bu","(","Ne",")",";"]},{type:"condition",b:[{type:"if",d:["ALPHA"],group:{type:"group",b:[{type:"textline",a:"bx ( Ne , Nc ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = vec4 ( Ne , Nc ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",b:[{type:"var",name:"AU_QUALIFIER",a:["uniform"]},{type:"var",name:"PRECISION",a:["lowp"]},{type:"var",name:"MAX_BONES",a:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",a:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",b:[{type:"if",d:["DEBUG_SPHERE",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MAIN_BEND_COL"],group:{type:"group",b:[{type:"textline",a:["attribute","float","a_bending_col_main",";"]},{type:"condition",b:[{type:"if",d:["DETAIL_BEND"],group:{type:"group",b:[{type:"textline",a:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",a:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",b:[{type:"if",d:["BEND_CENTER_ONLY"],group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],
group:{type:"group",b:[{type:"textline",a:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["STATIC_BATCH"],group:{type:"group",b:[{type:"textline",a:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uniform","mat3","u_model_tsr",
";"]}]}}]},{type:"textline",a:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",b:[{type:"if",d:["DEBUG_SPHERE",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"textline",a:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FRAMES_BLENDING"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS"],group:{type:"group",b:[{type:"textline",a:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",a:["varying","vec3","MY",";"]},{type:"condition",b:[{type:"if",d:["DEBUG_SPHERE",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",a:"void main ( ) { vec3 MU , MZ , M_ , Na , Nb ; mat4 Nc , Nd , Ne ; Nc = O ( u_view_tsr ) ; Nd = O ( u_model_tsr ) ; if ( a_polyindex == 0.0 ) MY = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) MY = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) MY = vec3 ( 0.0 , 0.0 , 1.0 ) ; MU = a_position ; MZ = a_normal ;".split(" ")},
{type:"condition",b:[{type:"if",d:["DEBUG_SPHERE"],group:{type:"group",b:[{type:"textline",a:"c Nf = rB ( MU , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Nd ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["VERTEX_ANIM"],group:{type:"group",b:[{type:"textline",a:"MU = mix ( MU , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"textline",a:"M_ = vec3 ( 0.0 ) ; Na = vec3 ( 0.0 ) ; sB ( MU , M_ , Na , MZ ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:["Na","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Na = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS"],group:{type:"group",b:[{type:"textline",a:"c Nf = vv ( MU , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Na , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , Nc ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["BILLBOARD"],group:{type:"group",b:[{type:"textline",a:"M_ = ( Nd * vec4 ( Na , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Ne = ru ( u_camera_eye , M_ , Nc , Nd ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Ne = ro ( u_camera_eye , M_ , Nc ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nb = ( Nd * vec4 ( Na , 1.0 ) ) . xyz ; Ne = Ne * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , Nb ) ;".split(" ")}]}}]},{type:"textline",a:"c Nf = rB ( MU - Na , Na , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ne ) ; Nf . b = M_ ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"c Nf = rB ( MU , Na , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Nd ) ;".split(" ")}]}}]}]}}]},
{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"textline",a:"tp ( Nf . a , Nf . b , MZ ) ;".split(" ")}]}}]}]}}]},{type:"textline",a:"gl_Position = u_proj_matrix * Nc * vec4 ( Nf . a , 1.0 ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",a:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"define",
name:"AA_METHOD_FXAA_LIGHT",a:["1"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",a:["2"]},{type:"define",name:"AA_QUALITY_LOW",a:["0"]},{type:"define",name:"AA_QUALITY_MEDIUM",a:["1"]},{type:"define",name:"AA_QUALITY_HIGH",a:["2"]},{type:"condition",b:[{type:"if",d:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_REDUCE_MIN",a:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",a:["(","1.0","/","8.0",")"]},{type:"define",
name:"FXAA_SPAN_MAX",a:["8.0"]},{type:"textline",a:"vec4 Na ( float MU , float MZ ) { vec2 M_ ; M_ = bM + vec2 ( MU , MZ ) * u_texel_size ; return texture2D ( u_color , M_ ) ; } vec4 Nn ( ) { vec2 Nb ; float Nc , Nd , Ne , Nf , Ng , Nh ; vec4 Ni , Nj , Nk , Nl , Nm ; Ni = Na ( - 1.0 , - 1.0 ) ; Nj = Na ( 1.0 , - 1.0 ) ; Nk = Na ( - 1.0 , 1.0 ) ; Nl = Na ( 1.0 , 1.0 ) ; Nm = Na ( 0.0 , 0.0 ) ; Nc = bB ( Nm ) ; Nd = bB ( Ni ) ; Ne = bB ( Nj ) ; Nf = bB ( Nk ) ; Ng = bB ( Nl ) ; Nh = min ( Nc , min ( min ( Nd , Ne ) , min ( Nf , Ng ) ) ) ; Nc = max ( Nc , max ( max ( Nd , Ne ) , max ( Nf , Ng ) ) ) ; Nb . x = - ( ( Nd + Ne ) - ( Nf + Ng ) ) ; Nb . y = ( ( Nd + Nf ) - ( Ne + Ng ) ) ; Ng = max ( ( Nd + Ne + Nf + Ng ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; Ng = 1.0 / ( min ( abs ( Nb . x ) , abs ( Nb . y ) ) + Ng ) ; Nb = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , Nb * Ng ) ) * u_texel_size ; Nl = 0.5 * ( texture2D ( u_color , bM + Nb * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , bM + Nb * ( 2.0 / 3.0 - 0.5 ) ) ) ; Nk = Nl * 0.5 + 0.25 * ( texture2D ( u_color , bM + Nb * - 0.5 ) + texture2D ( u_color , bM + Nb * 0.5 ) ) ; Ng = bB ( Nk ) ; if ( ( Ng < Nh ) || ( Ng > Nc ) ) return Nl ; else return Nk ; }".split(" ")}]}},
{type:"elif",d:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_GREEN_AS_LUMA",a:["1"]},{type:"define",name:"FXAA_BLEND4WEB",a:["1"]},{type:"include",file:"fxaa.glslf"},{type:"condition",b:[{type:"if",d:["AA_QUALITY","AA_QUALITY_HIGH",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PRESET",a:["39"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",a:["1.00"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",
a:["0.063"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",a:["0.0312"]}]}},{type:"elif",d:["AA_QUALITY","AA_QUALITY_MEDIUM",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PRESET",a:["20"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",a:["0.65"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",a:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",a:["0.0625"]}]}},{type:"elif",d:["AA_QUALITY","AA_QUALITY_LOW",{type:"equal_expr",e:2}],group:{type:"group",
b:[{type:"define",name:"FXAA_QUALITY_PRESET",a:["12"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",a:["0.50"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",a:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",a:["0.0833"]}]}}]}]}}]},{type:"textline",a:"void main ( ) { vec2 Oe ;".split(" ")},{type:"condition",b:[{type:"if",d:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = Nn ( ) ;".split(" ")}]}},{type:"elif",d:["AA_METHOD",
"AA_METHOD_FXAA_QUALITY",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Oe = u_texel_size ; gl_FragColor = Od ( bM , u_color , Oe , FXAA_QUALITY_SUBPIX , FXAA_QUALITY_EDGE_THRESHOLD , FXAA_QUALITY_EDGE_THRESHOLD_MIN ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 MU ; vec2 MZ , M_ ; MZ = vec2 ( 0.0 , 0.0 ) ; M_ = u_texel_size ; MU = texture2D ( u_color , bM ) ; gl_FragColor = MU * 0.0875447373698 ; MZ += M_ ; gl_FragColor += texture2D ( u_color , bM + MZ ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , bM - MZ ) * 0.0858112354248 ; MZ += M_ ; gl_FragColor += texture2D ( u_color , bM + MZ ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , bM - MZ ) * 0.0808139781061 ; MZ += M_ ; gl_FragColor += texture2D ( u_color , bM + MZ ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , bM - MZ ) * 0.0731235112908 ; MZ += M_ ; gl_FragColor += texture2D ( u_color , bM + MZ ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , bM - MZ ) * 0.0635705267419 ; MZ += M_ ; gl_FragColor += texture2D ( u_color , bM + MZ ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , bM - MZ ) * 0.0530985673112 ; MZ += M_ ; gl_FragColor += texture2D ( u_color , bM + MZ ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , bM - MZ ) * 0.0426125984122 ; MZ += M_ ; gl_FragColor += texture2D ( u_color , bM + MZ ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , bM - MZ ) * 0.0328565115809 ; MZ += M_ ; gl_FragColor += texture2D ( u_color , bM + MZ ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , bM - MZ ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * MU , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 bM ; void main ( ) { vec4 MU , MZ ; MU = texture2D ( u_main , bM ) ; MZ = texture2D ( u_bloom , bM ) ; MU = MU ; MU += MZ ; gl_FragColor = vec4 ( MU . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},
{type:"define",name:"PI_4",a:["0.785398163"]},{type:"textline",a:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 bM ; void main ( ) { float MU ; vec3 MZ ; vec4 M_ ; M_ = texture2D ( u_color , bM ) ; MZ = M_ . rgb ; if ( u_brightness < 0.0 ) MZ = MZ * ( 1.0 + u_brightness ) ; else MZ = MZ + ( ( 1.0 - MZ ) * u_brightness ) ; MZ = ( MZ - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; MZ *= u_exposure ; MU = bB ( vec4 ( MZ , 0.0 ) ) ; MZ = mix ( vec3 ( MU ) , MZ , u_saturation ) ; gl_FragColor = vec4 ( MZ , M_ . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"textline",a:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",a:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { gl_FragColor = V ( clamp ( Ok ( u_depth , bM , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]=
{type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"textline",a:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",a:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { float MU , MZ ; vec4 M_ , Na ; M_ = texture2D ( u_sharp , bM ) ; if ( u_dof_dist > 0.0 ) { MU = Ok ( u_depth , bM , u_camera_range ) ; MU *= u_view_max_depth ; if ( MU < u_dof_dist ) MZ = ( u_dof_dist - MU ) / u_dof_front ; else MZ = ( MU - u_dof_dist ) / u_dof_rear ; MZ = clamp ( MZ , 0.0 , 1.0 ) ; Na = texture2D ( u_blurred , bM ) ; gl_FragColor = mix ( M_ , Na , MZ ) ; } else gl_FragColor = M_ ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 bM ; void main ( ) { float MU ; vec4 MZ , M_ , Na ; MZ = texture2D ( u_src_color , bM ) ; M_ = texture2D ( u_glow_mask_small , bM ) ; Na = texture2D ( u_glow_mask_large , bM ) ; gl_FragColor = MZ ; if ( Na . a != 0.0 ) { MU = u_glow_mask_large_coeff * Na . a ; MU = clamp ( MU , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Na . rgb / Na . a , MU ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , MU ) ; } if ( M_ . a != 0.0 ) { MU = u_glow_mask_small_coeff * M_ . a ; MU = clamp ( MU , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , M_ . rgb / M_ . a , MU ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , MU ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"textline",a:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",a:["0.0"]},{type:"textline",a:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",
b:[{type:"if",d:["DEPTH_RGBA"],group:{type:"group",b:[{type:"textline",a:["uniform","vec2","u_camera_range",";"]},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"varying float Ol ; varying vec2 Om ;".split(" ")}]}}]}]}}]},{type:"textline",a:"varying vec2 bM ; varying vec4 On ; void main ( ) { vec4 Oo ; int Op ; float Oq , Or , Os , Ot ; vec2 Ou , Ov , Ow ; Ou = ( On . xy - bM ) ; Oq = length ( Ou ) ; Ou = u_radial_blur_step * Ou / Oq ; Or = Oq / u_radial_blur_step ; Ou *= min ( Or , STEPS_PER_PASS ) / STEPS_PER_PASS ; Or = max ( Or , STEPS_PER_PASS ) ; Ov = bM ; Os = 0.0 ; const int Ox = int ( STEPS_PER_PASS ) ; Op = int ( Or + 0.5 ) ; for ( int Oy = 0 ; Oy < Ox ; Oy += 1 ) { if ( Oy <= Op ) {".split(" ")},
{type:"condition",b:[{type:"if",d:["DEPTH_RGBA"],group:{type:"group",b:[{type:"textline",a:"Or = Ok ( u_input , Ov , u_camera_range ) ; Os += max ( ( 1.0 - pow ( Oq , 0.3 ) ) * step ( 0.9 , Or ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Oo = texture2D ( u_input , Ov ) ; Os += Z ( Oo ) ;".split(" ")}]}}]},{type:"textline",a:"} Ov += Ou ; }".split(" ")},{type:"condition",b:[{type:"if",d:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:"Ow = bM + Om ; Ot = ay ( vec2 ( 2.5 * ( Ow . x ) , 2.5 * ( Ow . y ) + 1.0 * u_time ) ) . x + 0.75 * ay ( vec2 ( 5.0 * ( Ow . x ) - 0.66 * u_time , 5.0 * ( Ow . y ) + 0.66 * u_time ) ) . x + 0.5 * aU ( vec2 ( 7.5 * ( Ow . x ) + 0.33 * u_time , 7.5 * ( Ow . y ) - 0.33 * u_time ) ) ; Ot *= clamp ( 1.2 - sqrt ( 0.2 * Oq ) , 0.0 , 1.0 ) * Ol ; Os = max ( Ot , Os ) ;".split(" ")}]}}]},{type:"textline",a:"gl_FragColor = V ( Os / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",b:[{type:"include",file:"math.glslv"},{type:"textline",a:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",b:[{type:"if",d:["DEPTH_RGBA"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float Ol ; varying vec2 Om ;".split(" ")}]}}]}]}}]},{type:"textline",a:"varying vec2 bM ; varying vec4 On ; void main ( ) { float MU , MZ ; vec3 M_ ; bM = a_bb_vertex + 0.5 ; M_ = normalize ( u_sun_direction ) ; On = u_view_proj_matrix * vec4 ( M_ , 0.0 ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( u_cam_water_depth < 0.0 ) { Ol = 1.0 ; M_ = vec3 ( 0.0 , 1.0 , 0.0 ) ; M_ = i ( u_camera_quat , M_ ) ; M_ = normalize ( M_ ) ; MU = dot ( M_ , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; MZ = atan ( M_ . x , M_ . z ) ; Om = vec2 ( - MZ , acos ( MU ) ) ; } else { Ol = 0.0 ; }".split(" ")}]}}]},{type:"textline",a:"On . xy = 0.5 * ( On . xy / On . w + 1.0 ) ; On += 99999.0 * step ( On . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",a:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 bM ; void main ( ) { float MU ; vec3 MZ ; vec4 M_ ; M_ = texture2D ( u_main , bM ) ; MZ = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; br ( M_ . rgb ) ; MU = Z ( texture2D ( u_god_rays , bM ) ) ; MZ = M_ . rgb + u_god_rays_intensity * vec3 ( MU ) * MZ ; bu ( MZ ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SAFARI_CANVAS_ALPHA_HACK"],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( MZ , max ( 0.01 , M_ . a ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( MZ , M_ . a ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]};a["postprocessing/luminance.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform sampler2D u_input ; varying vec2 bM ; void main ( ) { float MU ; vec4 MZ ; MZ = texture2D ( u_input , bM ) ; MU = dot ( MZ . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( MU ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_av.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform sampler2D u_input ; void main ( ) { float MU , MZ , M_ , Na ; MZ = 0.0 ; M_ = 0.025 ; Na = 0.025 ; for ( int Nb = 0 ; Nb < 20 ; Nb += 1 ) { Na = 0.025 ; for ( int Nc = 0 ; Nc < 20 ; Nc += 1 ) { MU = max ( texture2D ( u_input , vec2 ( M_ , Na ) ) . r , 0.01 ) ; MZ += log ( MU ) ; Na += 0.05 ; } M_ += 0.05 ; } MZ = exp ( MZ / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( MZ ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 bM ; varying float Oo ; void main ( ) { vec4 Op ; float Oq , Or ; Oq = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; Or = texture2D ( u_luminance , bM ) . r ; Op = texture2D ( u_main , bM ) ; Oq = Or / Oq ; Or = u_bloom_edge_lum ; gl_FragColor = Op * max ( Oq - Or , 0.0 ) * Oo ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",b:[{type:"textline",a:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 bM ; varying float Oo ; const vec3 MU = vec3 ( 0.0 , 1.0 , 0.0 ) ; void Nf ( in vec4 MZ , in vec3 M_ , out vec3 Na ) { float Nb , Nc , Nd , Ne ; Nb = MZ . w * M_ . x + MZ . y * M_ . z - MZ . z * M_ . y ; Nc = MZ . w * M_ . y + MZ . z * M_ . x - MZ . x * M_ . z ; Nd = MZ . w * M_ . z + MZ . x * M_ . y - MZ . y * M_ . x ; Ne = - MZ . x * M_ . x - MZ . y * M_ . y - MZ . z * M_ . z ; Na . x = Nb * MZ . w - Ne * MZ . x - Nc * MZ . z + Nd * MZ . y ; Na . y = Nc * MZ . w - Ne * MZ . y - Nd * MZ . x + Nb * MZ . z ; Na . z = Nd * MZ . w - Ne * MZ . z - Nb * MZ . y + Nc * MZ . x ; } void main ( ) { vec3 Ng ; bM = 2.0 * a_position ; Nf ( u_camera_quat , MU , Ng ) ; Oo = dot ( - Ng , u_sun_direction ) * u_bloom_key ; Oo *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 bM ; float MU = 0.0042 ; void main ( ) { vec4 MZ , M_ , Na , Nb ; MZ = texture2D ( u_mb_tex_curr , bM ) ; M_ = texture2D ( u_mb_tex_accum , bM ) ; if ( length ( MZ - M_ ) > u_motion_blur_decay_threshold ) { Na = ( 1.0 - u_motion_blur_exp ) * MZ + u_motion_blur_exp * M_ ; Na = Na - M_ ; Nb = MZ - M_ ; Na = min ( max ( abs ( Na ) , vec4 ( MU ) ) , abs ( Nb ) ) * sign ( Na ) ; gl_FragColor = M_ + Na ; } else { gl_FragColor = MZ ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",a:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 bM ; void main ( ) { vec3 MU ; float MZ ; vec4 M_ , Na , Nb ; M_ = texture2D ( u_outline_src , bM ) ; gl_FragColor = M_ ; if ( u_draw_outline != 0.0 ) { Na = texture2D ( u_outline_mask , bM ) ; Nb = texture2D ( u_outline_mask_blurred , bM ) ; MZ = Nb . a - Na . a ; if ( MZ != 0.0 ) { MZ = smoothstep ( 0.0 , 1.0 , Nb . a ) ; if ( Na . a == 0.0 ) { MU = u_outline_color ; bu ( MU ) ; Na = vec4 ( clamp ( MU , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( M_ , Na , MZ ) ; } } } }".split(" ")}]};
a["postprocessing/performance.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"textline",a:"uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 MU ; MU = vec4 ( 0.0 ) ; for ( int MZ = 0 ; MZ < 100 ; MZ ++ ) MU += 0.001 * texture2D ( u_color , bM + vec2 ( 0.001 * vec2 ( MZ ) ) ) ; gl_FragColor = MU ; }".split(" ")}]};a["postprocessing/postprocessing.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",
a:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",a:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",a:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",a:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",a:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",a:["6"]},{type:"define",name:"FLIP_CUBEMAP_COORDS",a:["7"]},{type:"textline",a:"uniform vec2 u_texel_size ; uniform sampler2D u_color ;".split(" ")},{type:"condition",b:[{type:"if",d:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",e:2}],
group:{type:"group",b:[{type:"textline",a:"uniform int u_tex_number ; uniform vec2 u_delta ;".split(" ")}]}}]},{type:"textline",a:"varying vec2 bM ; void main ( ) { float MU , MZ , M_ , Na ; vec2 Nb , Nc ; vec4 Nd ;".split(" ")},{type:"condition",b:[{type:"if",d:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = texture2D ( u_color , bM ) ;".split(" ")}]}},{type:"elif",d:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",e:2}],
group:{type:"group",b:[{type:"textline",a:"Nd = texture2D ( u_color , bM ) ; gl_FragColor . rgb = vec3 ( ( Nd . r + Nd . g + Nd . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",d:["POST_EFFECT","POST_EFFECT_X_BLUR",{type:"equal_expr",e:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nb = vec2 ( 0.0 , 0.0 ) ; Nc = u_texel_size ; Nd = texture2D ( u_color , bM ) ; gl_FragColor = Nd * 0.2270270270 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * 0.1945945946 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * 0.1945945946 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * 0.1216216216 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * 0.1216216216 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * 0.0540540541 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * 0.0540540541 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * 0.0162162162 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * 0.0162162162 ;".split(" ")}]}},
{type:"elif",d:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",e:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nb = vec2 ( 0.0 , 0.0 ) ; Nc = u_texel_size ; Nd = texture2D ( u_color , bM ) ; gl_FragColor = Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.152507 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.141763 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.141763 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.113861 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.113861 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.079019 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.079019 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.047383 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.047383 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.024549 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.024549 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.01099 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.01099 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.00425 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.00425 ; Nb += Nc ; Nd = texture2D ( u_color , bM + Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.00142 ; Nd = texture2D ( u_color , bM - Nb ) ; gl_FragColor += Nd * ( 1.0 - step ( 0.0 , - Nd . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",d:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",e:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nc = u_texel_size ; Nd = texture2D ( u_color , bM ) ; gl_FragColor = Nd ; if ( Nd . a == 0.0 ) { Nd = texture2D ( u_color , bM + Nc ) ; if ( Nd . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Nd . a ) ; else { Nd = texture2D ( u_color , bM - Nc ) ; if ( Nd . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Nd . a ) ; } }".split(" ")}]}},
{type:"elif",d:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"MU = u_delta [ 0 ] ; MZ = u_delta [ 1 ] ; M_ = 1.0 / 3.0 ; Na = 0.5 ; Nc = vec2 ( M_ , Na ) ; if ( u_tex_number == 0 ) { Nb = bM * Nc + vec2 ( 2.0 * M_ , 0.0 ) ; Nb [ 0 ] = min ( Nb [ 0 ] , 1.0 - MU ) ; Nb [ 1 ] = min ( Nb [ 1 ] , 0.5 - MZ ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * M_ - Nb [ 0 ] , Nb [ 1 ] ) ) ; } else if ( u_tex_number == 1 ) { Nb = bM * Nc ; Nb [ 0 ] = max ( Nb [ 0 ] , MU ) ; Nb [ 1 ] = min ( Nb [ 1 ] , 0.5 - MZ ) ; gl_FragColor = texture2D ( u_color , vec2 ( M_ - Nb [ 0 ] , Nb [ 1 ] ) ) ; } else if ( u_tex_number == 2 ) { Nb = bM * Nc + vec2 ( M_ , Na ) ; Nb [ 0 ] = max ( Nb [ 0 ] , M_ + MU ) ; Nb [ 0 ] = min ( Nb [ 0 ] , 2.0 * M_ - MU ) ; Nb [ 1 ] = min ( Nb [ 1 ] , 1.0 - MZ ) ; gl_FragColor = texture2D ( u_color , vec2 ( Nb [ 0 ] , 3.0 * Na - Nb [ 1 ] ) ) ; } else if ( u_tex_number == 3 ) { Nb = bM * Nc + vec2 ( 0.0 , Na ) ; Nb [ 0 ] = min ( Nb [ 0 ] , M_ - MU ) ; Nb [ 1 ] = min ( Nb [ 1 ] , 1.0 - MZ ) ; gl_FragColor = texture2D ( u_color , vec2 ( Nb [ 0 ] , 3.0 * Na - Nb [ 1 ] ) ) ; } else if ( u_tex_number == 4 ) { Nb = bM * Nc + vec2 ( M_ , 0.0 ) ; Nb [ 0 ] = max ( Nb [ 0 ] , M_ + MU ) ; Nb [ 0 ] = min ( Nb [ 0 ] , 2.0 * M_ - MU ) ; Nb [ 1 ] = min ( Nb [ 1 ] , 0.5 - MZ ) ; gl_FragColor = texture2D ( u_color , vec2 ( 1.0 - Nb [ 0 ] , Nb [ 1 ] ) ) ; } else { Nc = bM * Nc + vec2 ( 2.0 * M_ , Na ) ; Nc [ 0 ] = min ( Nc [ 0 ] , 1.0 - MU ) ; Nc [ 1 ] = max ( Nc [ 1 ] , 0.5 + MZ ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * M_ - Nc [ 0 ] , Nc [ 1 ] ) ) ; }".split(" ")}]}}]},
{type:"textline",a:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",b:[{type:"textline",a:"attribute vec2 a_position ; varying vec2 bM ; void main ( ) { bM = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",a:["1"]},{type:"define",
name:"SMAA_EDGE_DETECTION",a:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",a:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",a:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",a:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",a:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",a:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",a:["4"]},{type:"textline",a:["uniform","sampler2D","u_color",";"]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_REPROJECTION"],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",e:2},"SMAA_PREDICATION",{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",a:"uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","Op",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"varying vec4 Oq ; varying vec4 Or ; varying vec4 Os ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec2","Ot",";"]}]}}]},{type:"condition",
b:[{type:"if",d:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"SMAA_THRESHOLD",a:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",a:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",a:["1"]}]}},{type:"elif",d:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"SMAA_THRESHOLD",a:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",a:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",
a:["1"]}]}},{type:"elif",d:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"SMAA_THRESHOLD",a:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",a:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",a:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",a:["25"]}]}},{type:"elif",d:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"SMAA_THRESHOLD",a:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
a:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",a:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",a:["25"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",b:[{type:"define",name:"SMAA_THRESHOLD",a:["0.1"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",b:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",a:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
group:{type:"group",b:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",a:["8"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",b:[{type:"define",name:"SMAA_CORNER_ROUNDING",a:["25"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",b:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",a:["2.0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",b:[{type:"define",
name:"SMAA_PREDICATION",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",b:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",a:["0.01"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",b:[{type:"define",name:"SMAA_PREDICATION_SCALE",a:["2.0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",b:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",a:["0.4"]}]}}]},
{type:"condition",b:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",b:[{type:"define",name:"SMAA_REPROJECTION",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",b:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",a:["30.0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",b:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",a:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",a:["16"]},
{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",a:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",a:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",a:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",a:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",a:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",a:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},
{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vec3 Oz ( vec2 Ou , sampler2D Ov ) { float Ow , Ox , Oy ; Ow = texture2D ( Ov , Ou ) . r ; Ox = texture2D ( Ov , Oq . xy ) . r ; Oy = texture2D ( Ov , Oq . zw ) . r ; return vec3 ( Ow , Ox , Oy ) ; }".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vec2 OE ( vec2 OA , sampler2D OB ) { vec2 OC ; vec3 OD ; OD = Oz ( OA , OB ) ; OC = abs ( OD . xx - OD . yz ) ; OC = step ( SMAA_PREDICATION_THRESHOLD , OC ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * OC ) ; }".split(" ")}]}}]},
{type:"textline",a:"void OI ( bvec2 OF , inout vec2 OG , vec2 OH ) { if ( OF . x ) OG . x = OH . x ; if ( OF . y ) OG . y = OH . y ; } void OI ( bvec4 OJ , inout vec4 OK , vec4 OL ) { OI ( OJ . xy , OK . xy , OL . xy ) ; OI ( OJ . zw , OK . zw , OL . zw ) ; } vec2 ON ( vec2 OM ) { return sign ( OM ) * floor ( abs ( OM ) + .5 ) ; } vec4 ON ( vec4 OO ) { return sign ( OO ) * floor ( abs ( OO ) + .5 ) ; }".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",
e:2}],group:{type:"group",b:[{type:"textline",a:"vec2 Pa ( vec2 OP , sampler2D OQ".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_PREDICATION"],group:{type:"group",b:[{type:"textline",a:[",","sampler2D","OR"]}]}}]},{type:"textline",a:") { vec4 OS ; float OT , OU , OV , OW , OX ; vec3 OY ; vec2 OZ , O_ ;".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_PREDICATION"],group:{type:"group",b:[{type:"textline",a:"OZ = OE ( OP , OR ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",
a:"OZ = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",a:"OY = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; OT = dot ( texture2D ( OQ , OP ) . rgb , OY ) ; OU = dot ( texture2D ( OQ , Oq . xy ) . rgb , OY ) ; OV = dot ( texture2D ( OQ , Oq . zw ) . rgb , OY ) ; OS . xy = abs ( OT - vec2 ( OU , OV ) ) ; OZ = step ( OZ , OS . xy ) ; if ( dot ( OZ , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; OW = dot ( texture2D ( OQ , Or . xy ) . rgb , OY ) ; OX = dot ( texture2D ( OQ , Or . zw ) . rgb , OY ) ; OS . zw = abs ( OT - vec2 ( OW , OX ) ) ; O_ = max ( OS . xy , OS . zw ) ; OX = dot ( texture2D ( OQ , Os . xy ) . rgb , OY ) ; OW = dot ( texture2D ( OQ , Os . zw ) . rgb , OY ) ; OS . zw = abs ( vec2 ( OU , OV ) - vec2 ( OX , OW ) ) ; O_ = max ( O_ . xy , OS . zw ) ; OW = max ( O_ . x , O_ . y ) ; OZ . xy *= step ( OW , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * OS . xy ) ; return OZ ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"vec2 Pc ( vec2 Pb ) { Pb . r = Pb . r * abs ( 5.0 * Pb . r - 5.0 * 0.75 ) ; return ON ( Pb ) ; } vec4 Pc ( vec4 Pd ) { Pd . rb = Pd . rb * abs ( 5.0 * Pd . rb - 5.0 * 0.75 ) ; return ON ( Pd ) ; } vec2 Pl ( sampler2D Pe , vec2 Pf , vec2 Pg , out vec2 Ph ) { vec3 Pi ; vec4 Pj ; Pj = vec4 ( Pf , - 1.0 , 1.0 ) ; Pi = vec3 ( u_texel_size , 1.0 ) ; for ( int Pk = 0 ; Pk < SMAA_MAX_SEARCH_STEPS_DIAG ; Pk ++ ) { if ( Pj . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Pj . w > 0.9 ) { Pj . xyz += Pi * vec3 ( Pg , 1.0 ) ; Ph = texture2D ( Pe , Pj . xy , 0.0 ) . rg ; Pj . w = dot ( Ph , vec2 ( 0.5 , 0.5 ) ) ; } } return Pj . zw ; } vec2 Pt ( sampler2D Pm , vec2 Pn , vec2 Po , out vec2 Pp ) { vec3 Pq ; vec4 Pr ; Pr = vec4 ( Pn , - 1.0 , 1.0 ) ; Pr . x += 0.25 * u_texel_size . x ; Pq = vec3 ( u_texel_size , 1.0 ) ; for ( int Ps = 0 ; Ps < SMAA_MAX_SEARCH_STEPS_DIAG ; Ps ++ ) { if ( Pr . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Pr . w > 0.9 ) { Pr . xyz = Pq * vec3 ( Po , 1.0 ) + Pr . xyz ; Pp = texture2D ( Pm , Pr . xy , 0.0 ) . rg ; Pp = Pc ( Pp ) ; Pr . w = dot ( Pp , vec2 ( 0.5 , 0.5 ) ) ; } } return Pr . zw ; } vec2 Pz ( sampler2D Pu , vec2 Pv , vec2 Pw , float Px ) { vec2 Py ; Py = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * Pw + Pv ; Py = SMAA_AREATEX_PIXEL_SIZE * Py + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; Py . x += 0.5 ; Py . y += SMAA_AREATEX_SUBTEX_SIZE * Px ; return texture2D ( Pu , Py , 0.0 ) . rg ; } vec2 PL ( sampler2D PA , sampler2D PB , vec2 PC , vec2 PD , vec4 PE ) { vec4 PF , PG , PH ; vec2 PI , PJ , PK ; PI = vec2 ( 0.0 , 0.0 ) ; if ( PD . r > 0.0 ) { PF . xz = Pl ( PA , PC , vec2 ( - 1.0 , 1.0 ) , PJ ) ; PF . x += float ( PJ . y > 0.9 ) ; } else PF . xz = vec2 ( 0.0 , 0.0 ) ; PF . yw = Pl ( PA , PC , vec2 ( 1.0 , - 1.0 ) , PJ ) ; if ( PF . x + PF . y > 2.0 ) { PG = vec4 ( - PF . x + 0.25 , PF . x , PF . y , - PF . y - 0.25 ) * u_texel_size . xyxy + PC . xyxy ; PH . xy = texture2D ( PA , PG . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; PH . zw = texture2D ( PA , PG . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; PH . yxwz = Pc ( PH . xyzw ) ; PK = vec2 ( 2.0 , 2.0 ) * PH . xz + PH . yw ; OI ( bvec2 ( step ( 0.9 , PF . zw ) ) , PK , vec2 ( 0.0 , 0.0 ) ) ; PI += Pz ( PB , PF . xy , PK , PE . z ) ; } PF . xz = Pt ( PA , PC , vec2 ( - 1 , - 1 ) , PJ ) ; if ( texture2D ( PA , PC + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { PF . yw = Pt ( PA , PC , vec2 ( 1 , 1 ) , PJ ) ; PF . y += float ( PJ . y > 0.9 ) ; } else PF . yw = vec2 ( 0.0 , 0.0 ) ; if ( PF . x + PF . y > 2.0 ) { PH = vec4 ( - PF . x , - PF . x , PF . y , PF . y ) * u_texel_size . xyxy + PC . xyxy ; PG . x = texture2D ( PA , PH . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; PG . y = texture2D ( PA , PH . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; PG . zw = texture2D ( PA , PH . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; PJ = vec2 ( 2.0 , 2.0 ) * PG . xz + PG . yw ; OI ( bvec2 ( step ( 0.9 , PF . zw ) ) , PJ , vec2 ( 0 , 0 ) ) ; PI += Pz ( PB , PF . xy , PJ , PE . w ) . gr ; } return PI ; }".split(" ")}]}}]},
{type:"textline",a:"float PR ( sampler2D PM , vec2 PN , float PO ) { vec2 PP , PQ ; PP = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; PQ = SMAA_SEARCHTEX_SIZE * vec2 ( PO , 1.0 ) ; PP += vec2 ( - 1.0 , 1.0 ) ; PQ += vec2 ( 0.5 , - 0.5 ) ; PP *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; PQ *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( PM , PP * PN + PQ , 0.0 ) . r ; } float PZ ( sampler2D PS , sampler2D PT , vec2 PU , float PV ) { float PW ; vec2 PX ; PX = vec2 ( 0.0 , 1.0 ) ; for ( int PY = 0 ; PY < SMAA_MAX_SEARCH_STEPS ; PY ++ ) { if ( PU . x > PV && PX . g > 0.8281 && PX . r == 0.0 ) { PX = texture2D ( PS , PU , 0.0 ) . rg ; PU = - vec2 ( 2.0 , 0.0 ) * u_texel_size + PU ; } } PW = - ( 255.0 / 127.0 ) * PR ( PT , PX , 0.0 ) + 3.25 ; return u_texel_size . x * PW + PU . x ; } float Qg ( sampler2D P_ , sampler2D Qa , vec2 Qb , float Qc ) { float Qd ; vec2 Qe ; Qe = vec2 ( 0.0 , 1.0 ) ; for ( int Qf = 0 ; Qf < SMAA_MAX_SEARCH_STEPS ; Qf ++ ) { if ( Qb . x < Qc && Qe . g > 0.8281 && Qe . r == 0.0 ) { Qe = texture2D ( P_ , Qb , 0.0 ) . rg ; Qb = vec2 ( 2.0 , 0.0 ) * u_texel_size + Qb ; } } Qd = - ( 255.0 / 127.0 ) * PR ( Qa , Qe , 0.5 ) + 3.25 ; return - u_texel_size . x * Qd + Qb . x ; } float Qo ( sampler2D Qh , sampler2D Qi , vec2 Qj , float Qk ) { float Ql ; vec2 Qm ; Qm = vec2 ( 1.0 , 0.0 ) ; for ( int Qn = 0 ; Qn < SMAA_MAX_SEARCH_STEPS ; Qn ++ ) { if ( Qj . y > Qk && Qm . r > 0.8281 && Qm . g == 0.0 ) { Qm = texture2D ( Qh , Qj , 0.0 ) . rg ; Qj = - vec2 ( 0.0 , 2.0 ) * u_texel_size + Qj ; } } Ql = - ( 255.0 / 127.0 ) * PR ( Qi , Qm . gr , 0.0 ) + 3.25 ; return u_texel_size . y * Ql + Qj . y ; } float Qw ( sampler2D Qp , sampler2D Qq , vec2 Qr , float Qs ) { float Qt ; vec2 Qu ; Qu = vec2 ( 1.0 , 0.0 ) ; for ( int Qv = 0 ; Qv < SMAA_MAX_SEARCH_STEPS ; Qv ++ ) { if ( Qr . y < Qs && Qu . r > 0.8281 && Qu . g == 0.0 ) { Qu = texture2D ( Qp , Qr , 0.0 ) . rg ; Qr = vec2 ( 0.0 , 2.0 ) * u_texel_size + Qr ; } } Qt = - ( 255.0 / 127.0 ) * PR ( Qq , Qu . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * Qt + Qr . y ; } vec2 QD ( sampler2D Qx , vec2 Qy , float Qz , float QA , float QB ) { vec2 QC ; QC = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * ON ( 4.0 * vec2 ( Qz , QA ) ) + Qy ; QC = SMAA_AREATEX_PIXEL_SIZE * QC + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; QC . y = SMAA_AREATEX_SUBTEX_SIZE * QB + QC . y ; return texture2D ( Qx , QC , 0.0 ) . rg ; } void QK ( sampler2D QE , inout vec2 QF , vec4 QG , vec2 QH ) { vec2 QI , QJ ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"QI = step ( QH . xy , QH . yx ) ; QJ = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * QI ; QJ /= QI . x + QI . y ; QI = vec2 ( 1.0 , 1.0 ) ; QI . x -= QJ . x * texture2D ( QE , QG . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; QI . x -= QJ . y * texture2D ( QE , QG . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; QI . y -= QJ . x * texture2D ( QE , QG . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; QI . y -= QJ . y * texture2D ( QE , QG . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; QF *= clamp ( QI , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",a:"} void QR ( sampler2D QL , inout vec2 QM , vec4 QN , vec2 QO ) { vec2 QP , QQ ;".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"QP = step ( QO . xy , QO . yx ) ; QQ = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * QP ; QQ /= QP . x + QP . y ; QP = vec2 ( 1.0 , 1.0 ) ; QP . x -= QQ . x * texture2D ( QL , QN . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; QP . x -= QQ . y * texture2D ( QL , QN . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; QP . y -= QQ . x * texture2D ( QL , QN . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; QP . y -= QQ . y * texture2D ( QL , QN . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; QM *= clamp ( QP , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",a:["}"]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vec4 Re ( vec2 QS , vec2 QT , sampler2D QU , sampler2D QV , sampler2D QW , vec4 QX ) { float QY , QZ ; vec3 Q_ ; vec2 Ra , Rb , Rc ; vec4 Rd ; Rd = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; Ra = texture2D ( QU , QS ) . rg ; if ( Ra . g > 0.0 ) {".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",
e:1}],group:{type:"group",b:[{type:"textline",a:"Rd . rg = PL ( QU , QV , QS , Ra , QX ) ; if ( Rd . r == - Rd . g ) {".split(" ")}]}}]},{type:"textline",a:"; Q_ . x = PZ ( QU , QW , Oq . xy , Os . x ) ; Q_ . y = Or . y ; Rb . x = Q_ . x ; QY = texture2D ( QU , Q_ . xy , 0.0 ) . r ; Q_ . z = Qg ( QU , QW , Oq . zw , Os . y ) ; Rb . y = Q_ . z ; Rb = abs ( ON ( Rb / u_texel_size . xx - QT . xx ) ) ; Rc = sqrt ( Rb ) ; QZ = texture2D ( QU , Q_ . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Rd . rg = QD ( QV , Rc , QY , QZ , QX . y ) ; Q_ . y = QS . y ; QK ( QU , Rd . rg , Q_ . xyzy , Rb ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"} else Ra . r = 0.0 ;".split(" ")}]}}]},{type:"textline",a:"} if ( Ra . r > 0.0 ) { ; Q_ . y = Qo ( QU , QW , Or . xy , Os . z ) ; Q_ . x = Oq . x ; Ra . x = Q_ . y ; QZ = texture2D ( QU , Q_ . xy , 0.0 ) . g ; Q_ . z = Qw ( QU , QW , Or . zw , Os . w ) ; Ra . y = Q_ . z ; Ra = abs ( ON ( Ra / u_texel_size . yy - QT . yy ) ) ; Rb = sqrt ( Ra ) ; QY = texture2D ( QU , Q_ . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Rd . ba = QD ( QV , Rb , QZ , QY , QX . x ) ; Q_ . x = QS . x ; QR ( QU , Rd . ba , Q_ . xyxz , Ra ) ; } return Rd ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vec4 Rq ( vec2 Rf , sampler2D Rg , sampler2D Rh".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_REPROJECTION"],group:{type:"group",b:[{type:"textline",a:[",","sampler2D","Ri"]}]}}]},{type:"textline",a:") { bool Rj ; vec2 Rk , Rl , Rm ; vec4 Rn , Ro , Rp ; Rn . x = texture2D ( Rh , Op . xy ) . a ; Rn . y = texture2D ( Rh , Op . zw ) . g ; Rn . wz = texture2D ( Rh , Rf ) . xz ; if ( dot ( Rn , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { Ro = texture2D ( Rg , Rf , 0.0 ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SMAA_REPROJECTION"],group:{type:"group",b:[{type:"textline",a:"Rp = texture2D ( Ri , bM ) ; Rk = 2.0 * ag ( Rp ) - 1.0 ; Ro . a = sqrt ( 2.0 * length ( Rk ) ) ;".split(" ")}]}}]},{type:"textline",a:"return Ro ; } else { Rj = max ( Rn . x , Rn . z ) > max ( Rn . y , Rn . w ) ; Ro = vec4 ( 0.0 , Rn . y , 0.0 , Rn . w ) ; Rk = Rn . yw ; OI ( bvec4 ( Rj , Rj , Rj , Rj ) , Ro , vec4 ( Rn . x , 0.0 , Rn . z , 0.0 ) ) ; OI ( bvec2 ( Rj , Rj ) , Rk , Rn . xz ) ; Rk /= dot ( Rk , vec2 ( 1.0 , 1.0 ) ) ; Ro = Ro * vec4 ( u_texel_size , - u_texel_size ) + Rf . xyxy ; Rn = Rk . x * texture2D ( Rg , Ro . xy , 0.0 ) ; Rn += Rk . y * texture2D ( Rg , Ro . zw , 0.0 ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SMAA_REPROJECTION"],group:{type:"group",b:[{type:"textline",a:"Rp = texture2D ( Ri , Ro . xy ) ; Rl = 2.0 * ag ( Rp ) - 1.0 ; Rm = Rk . x * Rl ; Rp = texture2D ( Ri , Ro . zw ) ; Rl = 2.0 * ag ( Rp ) - 1.0 ; Rm += Rk . y * Rl ; Rn . a = sqrt ( 2.0 * length ( Rm ) ) ;".split(" ")}]}}]},{type:"textline",a:["return","Rn",";","}","}"]}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:"vec4 RA ( vec2 Rr , sampler2D Rs , sampler2D Rt".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_REPROJECTION"],group:{type:"group",b:[{type:"textline",a:[",","sampler2D","Ru"]}]}}]},{type:"textline",a:") { float Rv ; vec2 Rw ; vec4 Rx , Ry , Rz ;".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_REPROJECTION"],group:{type:"group",b:[{type:"textline",a:"Rx = texture2D ( Ru , bM ) ; Rw = 2.0 * ag ( Rx ) - 1.0 ; Rx = texture2D ( Rs , Rr ) ; Ry = texture2D ( Rt , Rr - Rw ) ; Rv = abs ( Rx . a * Rx . a - Ry . a * Ry . a ) / 2.0 ; Rv = 0.5 * clamp ( 1.0 - sqrt ( Rv ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; Rz = mix ( Rx , Ry , Rv ) ; Rz . a = 1.0 ; return Rz ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"Rx = texture2D ( Rs , Rr ) ; Ry = texture2D ( Rt , Rr ) ; return mix ( Rx , Ry , 0.5 ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:"void main ( ) { vec4 RB ;".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"RB = vec4 ( Pa ( bM , u_color".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_PREDICATION"],group:{type:"group",
b:[{type:"textline",a:[",","u_predication_tex"]}]}}]},{type:"textline",a:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",d:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"RB = Re ( bM , Ot , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",d:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"RB = Rq ( bM , u_color , u_blend".split(" ")},
{type:"condition",b:[{type:"if",d:["SMAA_REPROJECTION"],group:{type:"group",b:[{type:"textline",a:[",","u_velocity_tex"]}]}}]},{type:"textline",a:[")",";"]}]}},{type:"elif",d:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"RB = vec4 ( RA ( bM , u_color , u_color_prev".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_REPROJECTION"],group:{type:"group",b:[{type:"textline",a:[",","u_velocity_tex"]}]}}]},{type:"textline",a:[")",")",";"]}]}},{type:"else",
group:{type:"group",b:[{type:"textline",a:"RB = texture2D ( u_color , bM ) ;".split(" ")}]}}]},{type:"textline",a:["gl_FragColor","=","RB",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",b:[{type:"define",name:"SMAA_EDGE_DETECTION",a:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",a:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",a:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",a:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",a:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",
a:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",a:["4"]},{type:"textline",a:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec4","Op",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"varying vec4 Oq ; varying vec4 Or ; varying vec4 Os ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",
d:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec2","Ot",";"]}]}}]},{type:"condition",b:[{type:"if",d:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",a:["4"]}]}},{type:"elif",d:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",a:["8"]}]}},{type:"elif",d:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",a:["16"]}]}},{type:"elif",d:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",a:["32"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",b:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",a:["16"]}]}}]},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"void MZ ( vec2 MU ) { Oq = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + MU . xyxy ; Or = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + MU . xyxy ; Os = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + MU . xyxy ; }".split(" ")}]}},{type:"elif",d:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"void Nb ( vec2 M_ , out vec2 Na ) { Na = M_ / u_texel_size ; Oq = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + M_ . xyxy ; Or = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + M_ . xyxy ; Os = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( Oq . xz , Or . yw ) ; }".split(" ")}]}},
{type:"elif",d:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"void Nd ( vec2 Nc ) { Op = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Nc . xyxy ; }".split(" ")}]}}]},{type:"textline",a:"void main ( ) { bM = 2.0 * a_position ;".split(" ")},{type:"condition",b:[{type:"if",d:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["MZ","(","bM",")",";"]}]}},{type:"elif",d:["SMAA_PASS",
"SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Nb ( bM , Ot ) ;".split(" ")}]}},{type:"elif",d:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["Nd","(","bM",")",";"]}]}}]},{type:"textline",a:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"textline",
a:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",a:["1"]},{type:"define",name:"SSAO_QUALITY_16",a:["2"]},{type:"define",name:"SSAO_QUALITY_24",a:["3"]},{type:"define",name:"SSAO_QUALITY_32",a:["4"]},{type:"textline",a:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 bM ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float MZ ( in vec2 MU ) { return Ok ( u_depth , MU , u_camera_range ) ; } void main ( ) { float M_ , Na , Nb , Nc , Nd , Ne ; vec3 Nf , Ng , Nh , Ni ; Nf = texture2D ( u_color , bM ) . rgb ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SSAO_WHITE"],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( Nf , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",a:"Ng = normalize ( 2.0 * texture2D ( u_ssao_special_tex , bM * 0.25 / u_texel_size ) . rgb - 1.0 ) ; M_ = MZ ( bM ) ; Na = M_ * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"const float Nj = 8.0 ; const int Nk = 1 ;".split(" ")}]}},
{type:"elif",d:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"const float Nj = 16.0 ; const int Nk = 2 ;".split(" ")}]}},{type:"elif",d:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"const float Nj = 24.0 ; const int Nk = 3 ;".split(" ")}]}},{type:"elif",d:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"const float Nj = 32.0 ; const int Nk = 4 ;".split(" ")}]}}]},
{type:"textline",a:"Nb = u_ssao_radius_increase * 0.001 ; const float Nl = 1.0 + 2.4 / Nj ; Nc = 0.0 ; for ( int Nm = 0 ; Nm < Nk ; Nm ++ ) for ( int Nn = - 1 ; Nn <= 1 ; Nn += 2 ) for ( int Ou = - 1 ; Ou <= 1 ; Ou += 2 ) for ( int Ov = - 1 ; Ov <= 1 ; Ov += 2 ) { Nh = reflect ( normalize ( vec3 ( Nn , Ou , Ov ) ) , Ng ) * ( Nb *= Nl ) ; Ni = vec3 ( bM , Na ) ; Ni += vec3 ( Nh . xy , Nh . z * Na * 2.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["SSAO_HEMISPHERE"],group:{type:"group",b:[{type:"textline",
a:"Ni . z -= 1.4 * ( Ni . z - Na ) * step ( Na , Ni . z ) ;".split(" ")}]}}]},{type:"textline",a:"Nd = MZ ( Ni . xy ) * ( u_camera_range . y - u_camera_range . x ) ; Ne = clamp ( ( Na - Nd ) / Nd , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["SSAO_HEMISPHERE"],group:{type:"group",b:[{type:"textline",a:"Nc += mix ( 1.0 , Ne , step ( Nd , Ni . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nc += mix ( step ( Ni . z , Nd ) , 0.5 , Ne ) ;".split(" ")}]}}]},
{type:"textline",a:"} Nc = Nc / Nj ;".split(" ")},{type:"condition",b:[{type:"if",d:["SSAO_HEMISPHERE"],group:{type:"group",b:[{type:"textline",a:"Nc = clamp ( Nc * Nc + 0.6 * Nc , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nc = clamp ( Nc * Nc + Nc , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",a:"M_ = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * M_ ) ; Nc = mix ( 1.0 , Nc , M_ ) ; gl_FragColor = vec4 ( Nf , Nc ) ; }".split(" ")}]};a["postprocessing/ssao_blur.glslf"]=
{type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"textline",a:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",b:[{type:"if",d:["SSAO_BLUR_DEPTH"],group:{type:"group",b:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",a:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",b:[{type:"if",d:["SSAO_BLUR_DEPTH"],group:{type:"group",b:[{type:"textline",a:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float MZ ( in vec2 MU ) { return Ok ( u_depth , MU , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",a:"void main ( ) { vec2 M_ , Na ; float Nb , Nc , Nd , Ne , Nf , Ng , Nh ; Nb = 0.0 ;".split(" ")},{type:"condition",b:[{type:"if",d:["SSAO_BLUR_DEPTH"],group:{type:"group",b:[{type:"textline",a:"Nc = MZ ( bM ) ; Nd = 0.0 ; Ne = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",a:"M_ = vec2 ( - 2.0 ) ; for ( int Ni = 0 ; Ni < 4 ; ++ Ni ) { for ( int Nj = 0 ; Nj < 4 ; ++ Nj ) { Na = ( M_ + vec2 ( float ( Ni ) , float ( Nj ) ) ) * u_texel_size ; Nf = texture2D ( u_ssao_mask , bM + Na ) . a ;".split(" ")},
{type:"condition",b:[{type:"if",d:["SSAO_BLUR_DEPTH"],group:{type:"group",b:[{type:"textline",a:"Ng = MZ ( bM + Na ) ; Nh = 1.0 - clamp ( abs ( Ng - Nc ) * Ne , 0.0 , 1.0 ) ; Nb += Nf * Nh ; Nd += Nh ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["Nb","+=","Nf",";"]}]}}]},{type:"textline",a:["}","}"]},{type:"condition",b:[{type:"if",d:["SSAO_BLUR_DEPTH"],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . rgb , Nb / Nd ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . rgb , Nb / 16.0 ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]};a["postprocessing/stereo.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",a:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 bM ;".split(" ")},{type:"condition",b:[{type:"if",d:["ANAGLYPH",{type:"logic_negative_expr",
e:1}],group:{type:"group",b:[{type:"textline",a:["uniform","int","u_enable_hmd_stereo",";"]},{type:"condition",b:[{type:"if",d:["DISABLE_DISTORTION_CORRECTION",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"uniform vec4 u_distortion_params ; uniform vec4 u_chromatic_aberration_coefs ; void Ng ( vec2 MU , vec2 MZ , sampler2D M_ ) { vec4 Na ; float Nb ; vec2 Nc , Nd , Ne , Nf ; Nc = ( MU - MZ ) * 2.0 ; Nb = Nc . x * Nc . x + Nc . y * Nc . y ; Nc = Nc * ( 1.0 + u_distortion_params [ 0 ] * Nb + u_distortion_params [ 1 ] * Nb * Nb ) ; Nc = Nc * 0.5 / ( 1.0 + u_distortion_params [ 0 ] + u_distortion_params [ 1 ] ) ; if ( length ( u_chromatic_aberration_coefs ) > 0.0 ) { Nd = Nc * ( 1.0 + u_chromatic_aberration_coefs [ 0 ] + Nb * u_chromatic_aberration_coefs [ 1 ] ) + MZ ; Ne = Nc + MZ ; Nf = Nc * ( 1.0 + u_chromatic_aberration_coefs [ 2 ] + Nb * u_chromatic_aberration_coefs [ 3 ] ) + MZ ; if ( clamp ( Nf , 0.0 , 1.0 ) != Nf ) { gl_FragColor = vec4 ( 0.0 ) ; } else { Na = texture2D ( M_ , Ne ) ; gl_FragColor [ 0 ] = texture2D ( M_ , Nd ) . x ; gl_FragColor [ 1 ] = Na . y ; gl_FragColor [ 2 ] = texture2D ( M_ , Nf ) . z ; gl_FragColor [ 3 ] = Na . w ; } } else { Nc += MZ ; if ( clamp ( Nc , 0.0 , 1.0 ) != Nc ) { gl_FragColor = vec4 ( 0.0 ) ; } else { gl_FragColor = texture2D ( M_ , Nc ) ; } } }".split(" ")}]}}]}]}}]},
{type:"textline",a:"void main ( ) { vec2 Nh , Ni ; mat3 Nj , Nk ; vec3 Nl , Nm ; vec4 Nn , Ou ;".split(" ")},{type:"condition",b:[{type:"if",d:["ANAGLYPH"],group:{type:"group",b:[{type:"textline",a:"Nn = texture2D ( u_sampler_left , bM ) ; Ou = texture2D ( u_sampler_right , bM ) ; Nl = vec3 ( Nn [ 0 ] , Nn [ 1 ] , Nn [ 2 ] ) ; br ( Nl ) ; Nm = vec3 ( Ou [ 0 ] , Ou [ 1 ] , Ou [ 2 ] ) ; br ( Nm ) ; Nj = mat3 ( 0.437 , - 0.062 , - 0.048 , 0.449 , - 0.062 , - 0.050 , 0.164 , - 0.024 , - 0.017 ) ; Nk = mat3 ( - 0.011 , 0.377 , - 0.026 , - 0.032 , 0.761 , - 0.093 , - 0.007 , 0.009 , 1.234 ) ; Nm = clamp ( Nj * Nl , 0.0 , 1.0 ) + clamp ( Nk * Nm , 0.0 , 1.0 ) ; bu ( Nm ) ; gl_FragColor = vec4 ( Nm , Nn [ 3 ] + Ou [ 3 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"if ( u_enable_hmd_stereo != 0 ) { if ( bM [ 0 ] < 0.5 ) { Nh = vec2 ( 2.0 * bM [ 0 ] , bM [ 1 ] ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["DISABLE_DISTORTION_CORRECTION"],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = texture2D ( u_sampler_left , Nh ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Ni = vec2 ( 0.5 - u_distortion_params [ 3 ] , u_distortion_params [ 2 ] ) ; Ng ( Nh , Ni , u_sampler_left ) ;".split(" ")}]}}]},
{type:"textline",a:"} else { Ni = vec2 ( 2.0 * ( bM [ 0 ] - 0.5 ) , bM [ 1 ] ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["DISABLE_DISTORTION_CORRECTION"],group:{type:"group",b:[{type:"textline",a:"gl_FragColor = texture2D ( u_sampler_right , Ni ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"Nh = vec2 ( 0.5 + u_distortion_params [ 3 ] , u_distortion_params [ 2 ] ) ; Ng ( Ni , Nh , u_sampler_right ) ;".split(" ")}]}}]},{type:"textline",a:"} } else { gl_FragColor = texture2D ( u_sampler_left , bM ) ; }".split(" ")}]}}]},
{type:"textline",a:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",b:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",a:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 bM ; void main ( ) { vec2 MU ; vec4 MZ , M_ ; float Na ; Na = texture2D ( u_depth , bM ) . x ; MZ = vec4 ( bM * 2.0 - 1.0 , 2.0 * Na - 1.0 , 1.0 ) ; M_ = u_view_proj_inverse * MZ ; M_ = M_ / M_ . w ; M_ = u_view_proj_prev * M_ ; M_ /= M_ . w ; MU = ( MZ . xy - M_ . xy ) / 4.0 + 0.5 ; MU = clamp ( MU , 0.0 , 1.0 ) ; gl_FragColor = V ( MU ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"textline",a:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",b:[{type:"var",name:"EPSILON",a:["0.0001"]},{type:"textline",a:"float a = 0.0 ; float b = 1.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } vec4 k ( in vec4 j ) { return vec4 ( - j . xyz , j . w ) / dot ( j , j ) ; } vec3 p ( vec4 l , vec4 m , vec4 n ) { vec3 o ; o = n . xyz * l . w ; o = i ( m , o ) ; o += l . xyz * n . w ; return o ; } vec3 v ( vec4 q , vec4 r , vec4 s ) { vec4 t ; vec3 u ; u = s . xyz - q . xyz * s . w ; t = k ( r ) ; u = i ( t , u ) ; u /= q . w ; return u ; } mat4 w ( ) { return mat4 ( b , a , a , a , a , b , a , a , a , a , b , a , a , a , a , b ) ; } mat4 y ( float x ) { return mat4 ( b , a , a , a , a , cos ( x ) , sin ( x ) , a , a , - sin ( x ) , cos ( x ) , a , a , a , a , b ) ; } mat4 A ( float z ) { return mat4 ( cos ( z ) , a , - sin ( z ) , a , a , b , a , a , sin ( z ) , a , cos ( z ) , a , a , a , a , b ) ; } mat4 C ( float B ) { return mat4 ( cos ( B ) , sin ( B ) , a , a , - sin ( B ) , cos ( B ) , a , a , a , a , b , a , a , a , a , b ) ; } c E ( in c D ) { return c ( D . a , D . b , normalize ( D . c ) , normalize ( D . d ) , normalize ( D . e ) , D . f ) ; }".split(" ")},
{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",e:4}],group:{type:"group",b:[{type:"textline",a:"vec3 L ( vec4 F ) { vec3 G ; float H , I , J ; H = F . x ; I = F . y ; J = F . w ; G . x = ( H + J ) / 2.0 ; G . y = ( I + J ) / 2.0 ; G . z = J ; return G ; }".split(" ")}]}}]},{type:"textline",a:"mat4 O ( mat3 M ) { mat4 N ; N [ 0 ] [ 0 ] = ( b - ( M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 1 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 2 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 3 ] = a ; N [ 1 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) - M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 1 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 2 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 3 ] = a ; N [ 2 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 1 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 2 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 3 ] = a ; N [ 3 ] [ 0 ] = M [ 0 ] [ 0 ] ; N [ 3 ] [ 1 ] = M [ 0 ] [ 1 ] ; N [ 3 ] [ 2 ] = M [ 0 ] [ 2 ] ; N [ 3 ] [ 3 ] = 1.0 ; return N ; }".split(" ")}]};
a["include/std_enums.glsl"]={type:"group",b:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",a:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",a:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",a:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",a:["2"]},{type:"define",name:"SHADOW_SRC_NONE",a:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",a:["2"]},{type:"define",name:"SHADOW_SRC_MASK",a:["3"]},{type:"define",name:"SHADOW_DST_NONE",a:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",a:["2"]},
{type:"define",name:"SHADOW_DST_MASK",a:["3"]},{type:"define",name:"NO_SHADOWS",a:["1"]},{type:"define",name:"SHADOW_CASTING",a:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",a:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",a:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",a:["5"]},{type:"define",name:"SPECULAR_PHONG",a:["1"]},{type:"define",name:"SPECULAR_COOKTORR",a:["2"]},{type:"define",name:"SPECULAR_WARDISO",a:["3"]},{type:"define",name:"SPECULAR_BLINN",a:["4"]},{type:"define",name:"SPECULAR_TOON",
a:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",a:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",a:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",a:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",a:["4"]},{type:"define",name:"DIFFUSE_TOON",a:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",a:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",a:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",a:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",a:["3.0"]},{type:"define",name:"MIX",a:["0"]},{type:"define",
name:"ADD",a:["1"]},{type:"define",name:"SUBTRACT",a:["2"]},{type:"define",name:"MULTIPLY",a:["3"]},{type:"define",name:"SCREEN",a:["4"]},{type:"define",name:"OVERLAY",a:["5"]},{type:"define",name:"DIFFERENCE",a:["6"]},{type:"define",name:"DIVIDE",a:["7"]},{type:"define",name:"DARKEN",a:["8"]},{type:"define",name:"LIGHTEN",a:["9"]},{type:"define",name:"HUE",a:["10"]},{type:"define",name:"SATURATION",a:["11"]},{type:"define",name:"VALUE",a:["12"]},{type:"define",name:"COLOR",a:["13"]},{type:"define",
name:"SOFT_LIGHT",a:["14"]},{type:"define",name:"LINEAR_LIGHT",a:["15"]},{type:"define",name:"REFL_NONE",a:["0"]},{type:"define",name:"REFL_MIRRORMAP",a:["1"]},{type:"define",name:"REFL_PLANE",a:["2"]},{type:"define",name:"REFL_CUBE",a:["3"]},{type:"define",name:"INVERSE_QUADRATIC",a:["0"]},{type:"define",name:"LINEAR",a:["1"]},{type:"define",name:"QUADRATIC",a:["2"]},{type:"define",name:"HEMI",a:["1"]},{type:"define",name:"SPOT",a:["2"]},{type:"define",name:"POINT",a:["3"]},{type:"define",name:"SUN",
a:["4"]}]};a["include/pack.glslf"]={type:"group",b:[{type:"textline",a:"float P = 255.0 ; float Q = 0.0 ; float R = 1.0 ; vec4 V ( const in float S ) { vec4 T , U ; T = vec4 ( P * P * P , P * P , P , R ) ; U = vec4 ( Q , R / P , R / P , R / P ) ; T = fract ( S * T ) ; T -= T . xxyz * U ; return T ; } float Z ( const in vec4 W ) { vec4 X ; float Y ; X = vec4 ( R / ( P * P * P ) , R / ( P * P ) , R / P , R ) ; Y = dot ( W , X ) ; return Y ; } vec4 V ( const in vec2 _ ) { vec4 aa ; vec2 ab , ac ; ab = vec2 ( P , R ) ; ac = vec2 ( Q , R / P ) ; aa = fract ( _ . xxyy * ab . xyxy ) ; aa -= aa . xxzz * ac . xyxy ; if ( _ . r == R ) aa . rg = vec2 ( Q , R ) ; if ( _ . g == R ) aa . ba = vec2 ( Q , R ) ; return aa ; } vec2 ag ( const in vec4 ad ) { vec2 ae , af ; af = vec2 ( R / P , R ) ; ae . r = dot ( ad . rg , af ) ; ae . g = dot ( ad . ba , af ) ; return ae ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",b:[{type:"textline",a:"float ah = 0.0 ; float ai = 1.0 ; vec4 ak ( vec4 aj ) { return aj - floor ( aj * ( ai / 289.0 ) ) * 289.0 ; } vec3 ak ( vec3 al ) { return al - floor ( al * ( ai / 289.0 ) ) * 289.0 ; } vec2 ak ( vec2 am ) { return am - floor ( am * ( ai / 289.0 ) ) * 289.0 ; } vec4 ao ( vec4 an ) { return an - floor ( an * ( ai / 7.0 ) ) * 7.0 ; } vec4 aq ( vec4 ap ) { return ak ( ( 34.0 * ap + 5.0 ) * ap ) ; }".split(" ")},{type:"define",name:"K",
a:["0.142857142857"]},{type:"define",name:"K2",a:["0.0714285714285"]},{type:"define",name:"JITTER",a:["0.7"]},{type:"textline",a:"vec2 ay ( vec2 ar ) { vec4 as , at , au , av ; vec2 aw , ax ; aw = ak ( floor ( ar ) ) ; ax = fract ( ar ) ; as = ax . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; at = ax . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; au = aq ( aw . x + vec4 ( ah , ai , ah , ai ) ) ; au = aq ( au + aw . y + vec4 ( ah , ah , ai , ai ) ) ; av = ao ( au ) * K + K2 ; au = ao ( floor ( au * K ) ) * K + K2 ; av = as + JITTER * av ; au = at + JITTER * au ; au = av * av + au * au ;".split(" ")},
{type:"condition",b:[{type:"if",d:[1],group:{type:"group",b:[{type:"textline",a:"au . xy = min ( au . xy , au . zw ) ; au . x = min ( au . x , au . y ) ; return au . xx ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"au . xy = ( au . x < au . y ) ? au . xy : au . yx ; au . xz = ( au . x < au . z ) ? au . xz : au . zx ; au . xw = ( au . x < au . w ) ? au . xw : au . wx ; au . y = min ( au . y , au . z ) ; au . y = min ( au . y , au . w ) ; return sqrt ( au . xy ) ;".split(" ")}]}}]},
{type:"textline",a:"} vec3 aH ( vec2 az , float aA ) { vec4 aB , aC , aD , aE ; vec2 aF , aG ; aF = ak ( floor ( az ) ) ; aG = fract ( az ) ; aB = aG . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; aC = aG . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; aD = aq ( aF . x + vec4 ( ah , ai , ah , ai ) ) ; aD = aq ( aD + aF . y + vec4 ( ah , ah , ai , ai ) ) ; aE = ao ( aD ) * K + K2 ; aD = ao ( floor ( aD * K ) ) * K + K2 ; aE = aB + JITTER * aE ; aD = aC + JITTER * aD ; aC = aE * aE + aD * aD ; aE += aA ; aD += aA ; aB = aE * aE + aD * aD ; aE += aA ; aD += aA ; aD = aE * aE + aD * aD ; aC . xy = min ( aC . xy , aC . zw ) ; aC . x = min ( aC . x , aC . y ) ; aB . xy = min ( aB . xy , aB . zw ) ; aB . x = min ( aB . x , aB . y ) ; aD . xy = min ( aD . xy , aD . zw ) ; aD . x = min ( aD . x , aD . y ) ; return vec3 ( aC . x , aB . x , aD . x ) ; } vec3 aJ ( vec3 aI ) { return ak ( ( ( aI * 34.0 ) + ai ) * aI ) ; } float aU ( vec2 aK ) { vec3 aL , aM , aN , aO ; vec4 aP ; vec2 aQ , aR , aS ; const vec4 aT = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; aQ = floor ( aK + dot ( aK , aT . yy ) ) ; aR = aK - aQ + dot ( aQ , aT . xx ) ; aS = ( aR . x > aR . y ) ? vec2 ( ai , ah ) : vec2 ( ah , ai ) ; aP = aR . xyxy + aT . xxzz ; aP . xy -= aS ; aQ = ak ( aQ ) ; aL = aJ ( aJ ( aQ . y + vec3 ( ah , aS . y , ai ) ) + aQ . x + vec3 ( ah , aS . x , ai ) ) ; aM = max ( 0.5 - vec3 ( dot ( aR , aR ) , dot ( aP . xy , aP . xy ) , dot ( aP . zw , aP . zw ) ) , ah ) ; aM = aM * aM ; aM = aM * aM ; aL = 2.0 * fract ( aL * aT . www ) - ai ; aN = abs ( aL ) - 0.5 ; aO = floor ( aL + 0.5 ) ; aO = aL - aO ; aM *= 1.79284291400159 - 0.85373472095314 * ( aO * aO + aN * aN ) ; aL . x = aO . x * aR . x + aN . x * aR . y ; aL . yz = aO . yz * aP . xz + aN . yz * aP . yw ; return 130.0 * dot ( aM , aL ) ; } vec2 aY ( vec2 aV ) { float aW , aX ; aW = dot ( aV , vec2 ( 12.9898 , 78.233 ) ) ; aX = dot ( aV , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; aW = fract ( sin ( aW ) * 43758.5453 ) * 2.0 - ai ; aX = fract ( sin ( aX ) * 43758.5453 ) * 2.0 - ai ; return vec2 ( aW , aX ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",b:[{type:"var",name:"CAUST_SPEED",a:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",a:["0.0"]},{type:"var",name:"CAUST_BRIGHT",a:["0.0"]},{type:"var",name:"SUN_NUM",a:["0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",a:["100.0"]},{type:"textline",a:"void bp ( inout vec3 aZ , float a_ , float ba , vec4 bb , vec3 bc , vec3 bd , vec3 be , vec4 bf , vec3 bg , float bh ) { float bi , bj , bk ; vec2 bl , bm ; vec3 bn ; vec4 bo ; if ( bh > CAUSTICS_VIEW_DISTANCE ) return ; bo = bf ; bn = bg + bc ; bn . xz = 10.0 * sin ( 0.1 * bn . xz ) ; bn = bn + 2.0 * cross ( - bo . xyz , cross ( - bo . xyz , bn ) + bo . w * bn ) ; bl = bn . xz ; bn = bd ; bi = max ( dot ( bc , bn ) , 0.0 ) ; bj = 0.025 ; bm = CAUST_SPEED * ba ; bl . s += 0.25 * sin ( dot ( bg + ba , vec3 ( 1.0 ) ) ) ; bl . t += 0.35 * ( - sin ( dot ( bg - ba , vec3 ( - 0.7 ) ) ) ) ; bl . st += 0.15 * cos ( 4.0 * a_ - bm . x ) + 1.5 * sin ( a_ - 0.3 * bm . y ) ; bk = CAUST_SCALE * ( 1.0 + max ( 0.1 * a_ , 0.0 ) ) ; bn = aH ( ( bl / bk ) , bj ) ; bn *= CAUST_BRIGHT ; bn *= bn ; bj = min ( 0.25 * a_ , - a_ ) + 1.0 ; bj = max ( bj , 0.0 ) ; bi = bb [ SUN_NUM ] * bi ; bk = max ( sign ( a_ ) , 0.0 ) ; bi = bi + max ( 0.5 * sign ( - bc . y ) * bk , 0.0 ) ; bi = min ( bi , 1.0 ) ; aZ += be * bn * bj * bi ; }".split(" ")}]};
a["include/color_util.glslf"]={type:"group",b:[{type:"define",name:"GAMMA",a:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",a:["1"]},{type:"textline",a:"void br ( inout vec3 bq ) {".split(" ")},{type:"condition",b:[{type:"if",d:["GAMMA"],group:{type:"group",b:[{type:"textline",a:"bq = max ( vec3 ( 0.0 ) , bq ) ; bq = pow ( bq , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",a:"} void br ( inout float bs ) {".split(" ")},{type:"condition",b:[{type:"if",d:["GAMMA"],group:{type:"group",b:[{type:"textline",
a:"bs = pow ( max ( 0.0 , bs ) , 2.2 ) ;".split(" ")}]}}]},{type:"textline",a:"} void bu ( inout vec3 bt ) {".split(" ")},{type:"condition",b:[{type:"if",d:["GAMMA"],group:{type:"group",b:[{type:"textline",a:"bt = max ( vec3 ( 0.0 ) , bt ) ; bt = pow ( bt , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",a:"} void bx ( inout vec3 bv , in float bw ) {".split(" ")},{type:"condition",b:[{type:"if",d:["PREMULTIPLY_ALPHA"],group:{type:"group",b:[{type:"textline",a:"bv = bv * bw ;".split(" ")}]}}]},
{type:"textline",a:"} float bB ( vec4 by ) { float bz ; vec3 bA ; bA = vec3 ( 0.299 , 0.587 , 0.114 ) ; bz = dot ( by . rgb , bA ) ; return bz ; }".split(" ")}]};a["include/shadow.glslf"]={type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",a:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",a:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",a:["0.0"]},{type:"define",name:"M_PI",a:["3.14159265359"]},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"const float bN = 0.1 ; const float bO = 0.1 ; const float bP = - 0.01 ; const float bQ = 0.05 ; vec4 bR = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 bS = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 bT = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 bU = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 bV = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 bW = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 bX = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 bY = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool ca ( vec2 bZ , float b_ ) { return all ( lessThanEqual ( bZ , vec2 ( 1.0 + b_ ) ) ) && all ( greaterThanEqual ( bZ , vec2 ( 0.0 - b_ ) ) ) ; } float cj ( float cb , float cc , mat2 cd , vec3 ce , float cf , PRECISION sampler2D cg ) { vec2 ch , ci ; ci . x = cb ; ci . y = cc ; ci = cd * ci ; ch = ce . xy + ci * cf / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",b:[{type:"if",d:["CSM_SECTION1",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"if ( ! ca ( ch , bP ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",a:"return step ( ce . z , texture2D ( cg , ch ) . r ) ; } float cs ( vec3 ck , PRECISION sampler2D cl , float cm ) { mat2 cn ; float co , cp , cq ; co = 0.0 ; ck . z = clamp ( ck . z , 0.0 , 1.0 ) ; cp = aY ( ck . xy ) . x * M_PI ; cq = cos ( cp ) ; cp = sin ( cp ) ; cn = mat2 ( cq , cp , - cp , cq ) ; for ( int cr = 0 ; cr < 4 ; cr ++ ) { co += cj ( bR [ cr ] , bV [ cr ] , cn , ck , cm , cl ) ; co += cj ( bS [ cr ] , bW [ cr ] , cn , ck , cm , cl ) ; co += cj ( bT [ cr ] , bX [ cr ] , cn , ck , cm , cl ) ; co += cj ( bU [ cr ] , bY [ cr ] , cn , ck , cm , cl ) ; } return clamp ( co / 16.0 , 0.0 , 1.0 ) ; } float cH ( vec3 ct , PRECISION sampler2D cu , vec3 cv , PRECISION sampler2D cw , float cx , float cy , float cz ) { mat2 cA ; float cB , cC , cD , cE ; ct . z = clamp ( ct . z , 0.0 , 1.0 ) ; cv . z = clamp ( cv . z , 0.0 , 1.0 ) ; cB = 0.0 ; cC = 0.0 ; cD = aY ( ct . xy ) . x * M_PI ; cE = cos ( cD ) ; cD = sin ( cD ) ; cA = mat2 ( cE , cD , - cD , cE ) ; for ( int cF = 0 ; cF < 4 ; cF ++ ) { cB += cj ( bR [ cF ] , bV [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bS [ cF ] , bW [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bT [ cF ] , bX [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bU [ cF ] , bY [ cF ] , cA , ct , cx , cu ) ; } for ( int cG = 0 ; cG < 4 ; cG ++ ) { cC += cj ( bR [ cG ] , bV [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bS [ cG ] , bW [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bT [ cG ] , bX [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bU [ cG ] , bY [ cG ] , cA , cv , cy , cw ) ; } cB = mix ( cB , cC , cz ) ; cB /= 16.0 ; return clamp ( cB , 0.0 , 1.0 ) ; } float cL ( vec2 cI ) { float cJ , cK ; cJ = min ( cI . x , cI . y ) ; cK = min ( 1.0 - cI . x , 1.0 - cI . y ) ; return min ( cJ , cK ) ; } float cO ( float cM , float cN ) { if ( cN >= 0.0 && cN <= bO ) cM = ( cM - 1.0 ) / bO * cN + 1.0 ; return cM ; } float cZ ( vec3 cP , vec3 cQ , PRECISION sampler2D cR , PRECISION sampler2D cS , float cT , float cU , float cV , float cW ) { float cX , cY ;".split(" ")},
{type:"condition",b:[{type:"if",d:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",b:[{type:"textline",a:"cY = cL ( cP . xy ) ; if ( - cW > cV && cY >= 0.0 && cY <= bN && ca ( cQ . xy , 0.0 ) ) { cY = 1.0 - cY / bN ; cX = cH ( cP , cR , cQ , cS , cT , cU , cY ) ; } else".split(" ")}]}}]},{type:"textline",a:"cX = cs ( cP , cR , cT ) ; return cX ; } float dg ( vec3 c_ , PRECISION sampler2D da , float db , float dc , float dd ) { float de , df ; de = cs ( c_ , da , db ) ;".split(" ")},{type:"condition",
b:[{type:"if",d:["CSM_FADE_LAST_CASCADE"],group:{type:"group",b:[{type:"textline",a:"if ( - dd > dc ) { df = cL ( c_ . xy ) ; de = cO ( de , df ) ; }".split(" ")}]}}]},{type:"textline",a:"return de ; } vec4 dr ( float dh ) { vec3 di , dj , dk , dl ; float dm , dn , dp , dq ; dm = 1.0 ; di = bI . xyz / bI . w ; if ( bI . w < 0.0 ) di . z = 0.0 ;".split(" ")},{type:"condition",b:[{type:"if",d:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",
a:"dj = bJ . xyz / bJ . w ; if ( bJ . w < 0.0 ) dj . z = 0.0 ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dk = bK . xyz / bK . w ; if ( bK . w < 0.0 ) dk . z = 0.0 ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dl = bL . xyz / bL . w ; if ( bL . w < 0.0 ) dl . z = 0.0 ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["CSM_SECTION1"],group:{type:"group",b:[{type:"textline",a:"if ( ca ( di . xy , 0.0 ) ) { dm = cZ ( di , dj , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , dh ) ; }".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"if ( ca ( di . xy , bQ ) ) { dm = dg ( di , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , dh ) ; }".split(" ")}]}}]},{type:"condition",b:[{type:"if",
d:["CSM_SECTION1"],group:{type:"group",b:[{type:"textline",a:"else { if ( ca ( dj . xy , 0.0 ) ) {".split(" ")},{type:"condition",b:[{type:"if",d:["CSM_SECTION2"],group:{type:"group",b:[{type:"textline",a:"dm = cZ ( dj , dk , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , dh ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"dm = dg ( dj , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , dh ) ;".split(" ")}]}}]},
{type:"textline",a:["}"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2"],group:{type:"group",b:[{type:"textline",a:"else { if ( ca ( dk . xy , 0.0 ) ) {".split(" ")},{type:"condition",b:[{type:"if",d:["CSM_SECTION3"],group:{type:"group",b:[{type:"textline",a:"dm = cZ ( dk , dl , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , dh ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"dm = dg ( dk , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , dh ) ;".split(" ")}]}}]},
{type:"textline",a:["}"]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3"],group:{type:"group",b:[{type:"textline",a:"else { if ( ca ( dl . xy , 0.0 ) ) dm = dg ( dl , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , dh ) ; }".split(" ")}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_CAST_LAMPS",1,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dn = cs ( dj , u_shadow_map1 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:["dn","=","0.0",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_CAST_LAMPS",2,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dp = cs ( dk , u_shadow_map2 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["dp","=","0.0",";"]}]}}]},{type:"condition",b:[{type:"if",d:["NUM_CAST_LAMPS",3,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dq = cs ( dl , u_shadow_map3 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:["dq","=","1.0",";"]}]}}]},{type:"textline",a:"return vec4 ( dm , dn , dp , dq ) ; }".split(" ")}]}}]},{type:"textline",a:"vec4 du ( inout vec3 ds ) { vec4 dt ;".split(" ")},{type:"condition",b:[{type:"if",d:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dt = texture2DProj ( u_shadow_mask , bG ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_CAST_LAMPS",3,{type:"l_expr",e:2}],
group:{type:"group",b:[{type:"textline",a:"ds *= dt . a ;".split(" ")}]}}]},{type:"textline",a:["return","dt",";"]}]}},{type:"elif",d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dt = dr ( bD . z ) ; return dt ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"return vec4 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]};
a["include/mirror.glslf"]={type:"group",b:[{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2},"REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2},{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"define",name:"REFL_BUMP",a:["0.1"]},{type:"textline",a:"float dB ( in vec3 dv , vec3 dw , float dx , float dy ) { float dz ; vec3 dA ; dA = normalize ( dw + dv ) ; dz = 1.0 - dot ( dv , dA ) ; dz = dy + ( 1.0 - dy ) * pow ( dz , dx ) ; return dz ; } void dP ( inout vec3 dC , vec3 dD , vec3 dE , float dF , mat4 dG ) { vec2 dH , dI ; float dJ , dK , dL ; vec3 dM , dN , dO ; dM = reflect ( - dD , dE ) ; dJ = u_fresnel_params [ 2 ] ; dK = u_fresnel_params [ 3 ] ; dL = 1.0 ; if ( dJ != 0.0 ) dL = dB ( dD , dM , dJ , dK ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dN = textureCube ( u_cube_reflection , dM ) . xyz ;".split(" ")}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["REFLECTION_PASS",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"dO = u_refl_plane . xyz * dot ( dE , u_refl_plane . xyz ) ; dO = dE - dO ; dH = ( dG * vec4 ( dO , 0.0 ) ) . xy ; dI = bG . xy / bG . z ; dI += dH * REFL_BUMP ; dN = texture2D ( u_plane_reflection , dI ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"dN = vec3 ( 1.0 ) ; dF = 0.0 ;".split(" ")}]}}]}]}},{type:"elif",d:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"dN = textureCube ( u_mirrormap , dM ) . xyz ; dF = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",a:"br ( dN . rgb ) ; dC = mix ( dC , dN , dF * dL ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",b:[{type:"textline",a:"vec3 dS ( vec3 dQ ) { float dR ;".split(" ")},
{type:"condition",b:[{type:"if",d:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["SKY_TEXTURE"],group:{type:"group",b:[{type:"textline",a:"return textureCube ( u_sky_texture , dQ ) . rgb ;".split(" ")}]}},{type:"elif",d:["SKY_COLOR"],group:{type:"group",b:[{type:"textline",a:"dR = 0.5 * dQ . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , dR ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]};a["include/refraction.glslf"]={type:"group",b:[{type:"condition",b:[{type:"if",d:["REFRACTIVE"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["USE_REFRACTION_CORRECTION"],group:{type:"group",b:[{type:"textline",a:"float dY ( in float dT , inout vec2 dU , in vec2 dV ) { float dW ; vec4 dX ; dX = texture2D ( u_scene_depth , dU ) ; dW = Z ( dX ) ; if ( dW < bH ) { dU = dV ; return dT ; } else { return dW ; } return dT ; }".split(" ")}]}}]},
{type:"textline",a:"vec3 ef ( in vec3 dZ , in vec2 d_ ) { vec3 ea ; float eb ; vec4 ec ; vec2 ed , ee ; ed = dZ . xy / dZ . z ; ee = ed + d_ ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_REFRACTION_CORRECTION"],group:{type:"group",b:[{type:"textline",a:"ec = texture2DProj ( u_scene_depth , dZ ) ; eb = Z ( ec ) ; dY ( eb , ee , ed ) ;".split(" ")}]}}]},{type:"textline",a:"ea = texture2D ( u_refractmap , ee ) . rgb ; br ( ea ) ; return ea ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",
b:[{type:"var",name:"MAPPING_TRS_MATRIX",a:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",a:["0.0"]},{type:"var",name:"RGB_IND",a:["0"]},{type:"var",name:"VALUE_IND",a:["0"]},{type:"var",name:"LAMP_INDEX",a:["0"]},{type:"var",name:"NUM_LIGHTS",
a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NODE_TEX_ROW",a:["0.0"]},{type:"define",name:"M_PI",a:["3.14159265359"]},{type:"condition",b:[{type:"if",d:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",
e:2}],group:{type:"group",b:[{type:"textline",a:["varying","vec3","eg",";"]}]}}]},{type:"textline",a:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float eh = 0.5 ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_B4W_REFRACTION"],group:{type:"group",b:[{type:"textline",a:"vec3 el ( in vec3 ei , in float ej ) { vec3 ek ; ek = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_REFRACTION"],group:{type:"group",b:[{type:"textline",a:"ek = ef ( bG , ei . xy * ej ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"ek = texture2D ( u_refractmap , bG . xy / bG . z ) . rgb ; br ( ek ) ;".split(" ")}]}}]},{type:"textline",a:["return","ek",";","}"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:"vec3 eq ( vec3 em ) { float en , eo ; vec4 ep ; ep = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; ep = mix ( vec4 ( em . bg , ep . wz ) , vec4 ( em . gb , ep . xy ) , step ( em . b , em . g ) ) ; ep = mix ( vec4 ( ep . xyw , em . r ) , vec4 ( em . r , ep . yzx ) , step ( ep . x , em . r ) ) ; en = ep . x - min ( ep . w , ep . y ) ; eo = 1.0e-10 ; return vec3 ( abs ( ep . z + ( ep . w - ep . y ) / ( 6.0 * en + eo ) ) , en / ( ep . x + eo ) , ep . x ) ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:"vec3 eu ( vec3 er ) { vec3 es ; vec4 et ; et = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; es = abs ( fract ( vec3 ( er . r , er . r , er . r ) + et . xyz ) * 6.0 - et . www ) ; return er . b * mix ( et . xxx , clamp ( es - et . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , er . g ) ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:"vec3 ew ( vec2 ev ) { return vec3 ( ev * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:"vec2 ey ( vec3 ex ) { return vec2 ( ex . xy * eh + vec2 ( eh , eh ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",h:[{type:"node_out",name:"fm",qualifier:["vec3"],c:!0},{type:"node_out",name:"fn",qualifier:["float"],c:!0},{type:"node_out",name:"fo",qualifier:["float"],c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_fm"],f:[{type:"textline",a:"fm = normalize ( fd . xyz ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_fn"],f:[{type:"textline",a:"fn = abs ( fd . z ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_fo"],
f:[{type:"textline",a:"fo = length ( fd . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",h:[{type:"node_in",name:"fp",qualifier:["float"],c:!1},{type:"node_in",name:"fq",qualifier:["float"],c:!1},{type:"node_in",name:"fr",qualifier:["float"],c:!1},{type:"node_out",name:"fs",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"fs = vec3 ( fp , fq , fr ) ;".split(" ")}]},{type:"node",name:"COMBHSV",h:[{type:"node_in",name:"ft",qualifier:["float"],c:!1},{type:"node_in",name:"fu",qualifier:["float"],
c:!1},{type:"node_in",name:"fv",qualifier:["float"],c:!1},{type:"node_out",name:"fw",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"fw = eu ( vec3 ( ft , fu , fv ) ) ;".split(" ")}]},{type:"node",name:"EMPTY_UV",h:[{type:"node_out",name:"fx",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"fx = vec3 ( - UNITY_VALUE_NODES , - UNITY_VALUE_NODES , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",h:[{type:"node_out",name:"fy",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"fy = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_UV",h:[{type:"node_out",name:"fz",qualifier:["vec3"],c:!1},{type:"node_param",name:"ez",qualifier:["varying","vec2"],c:!1}],f:[{type:"textline",a:"fz = ew ( ez ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",h:[{type:"node_out",name:"fA",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"fA = 2.0 * eg - vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",h:[{type:"node_out",name:"fB",qualifier:["vec3"],c:!1},{type:"node_param",name:"eA",qualifier:["varying",
"vec3"],c:!1}],f:[{type:"textline",a:"fB = eA ; br ( fB ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_out",name:"fC",qualifier:["float"],c:!1},{type:"node_param",name:"eB",qualifier:["varying","float"],c:!1}],f:[{type:"textline",a:"fC = eB ; br ( fC ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC2",h:[{type:"node_out",name:"fD",qualifier:["float"],c:!1},{type:"node_out",name:"fE",qualifier:["float"],c:!1},{type:"node_param",name:"eC",qualifier:["varying","vec2"],c:!1}],f:[{type:"textline",
a:"fD = eC [ 0 ] ; fE = eC [ 1 ] ; br ( fD ) ; br ( fE ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",h:[{type:"node_out",name:"fF",qualifier:["float"],c:!1},{type:"node_out",name:"fG",qualifier:["float"],c:!1},{type:"node_out",name:"fH",qualifier:["float"],c:!1},{type:"node_param",name:"eD",qualifier:["varying","vec3"],c:!1}],f:[{type:"textline",a:"fF = eD [ 0 ] ; fG = eD [ 1 ] ; fH = eD [ 2 ] ; br ( fF ) ; br ( fG ) ; br ( fH ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",h:[{type:"node_out",
name:"fI",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["fI","=","fg",";"]}]},{type:"node",name:"GEOMETRY_FB",h:[{type:"node_out",name:"fJ",qualifier:["float"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["INVERT_FRONTFACING"],f:[{type:"textline",a:"fJ = ( gl_FrontFacing ) ? ZERO_VALUE_NODES : UNITY_VALUE_NODES ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"fJ = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}]}]},{type:"node",name:"GEOMETRY_VW",h:[{type:"node_out",
name:"fK",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["fK","=","eM",";"]}]},{type:"node",name:"GEOMETRY_LO",h:[{type:"node_out",name:"fL",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"fL [ 0 ] = fd [ 0 ] ; fL [ 1 ] = fd [ 1 ] ; fL [ 2 ] = fd [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",h:[{type:"node_out",name:"fM",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"fM = vec3 ( fh . r , - fh . b , fh . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",h:[{type:"node_out",name:"fN",
qualifier:["vec3"],c:!1},{type:"node_out",name:"fO",qualifier:["vec3"],c:!1},{type:"node_out",name:"fP",qualifier:["vec3"],c:!1},{type:"node_out",name:"fQ",qualifier:["vec3"],c:!1},{type:"node_out",name:"fR",qualifier:["vec3"],c:!1},{type:"node_out",name:"fS",qualifier:["vec3"],c:!1},{type:"node_out",name:"fT",qualifier:["float"],c:!1},{type:"node_out",name:"fU",qualifier:["float"],c:!1}],f:[{type:"textline",a:"fN = vec3 ( ZERO_VALUE_NODES ) ; fO = vec3 ( ZERO_VALUE_NODES ) ; fP = vec3 ( ZERO_VALUE_NODES ) ; fQ = vec3 ( ZERO_VALUE_NODES ) ; fR = vec3 ( ZERO_VALUE_NODES ) ; fS = vec3 ( ZERO_VALUE_NODES ) ; fT = ZERO_VALUE_NODES ; fU = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"HUE_SAT",h:[{type:"node_in",name:"fV",qualifier:["float"],c:!1},{type:"node_in",name:"fW",qualifier:["float"],c:!1},{type:"node_in",name:"fX",qualifier:["float"],c:!1},{type:"node_in",name:"fY",qualifier:["float"],c:!1},{type:"node_in",name:"fZ",qualifier:["vec3"],c:!1},{type:"node_out",name:"f_",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"fj = eq ( fZ ) ; fj [ 0 ] += ( fV - eh ) ; if ( fj [ 0 ] > UNITY_VALUE_NODES ) fj [ 0 ] -= UNITY_VALUE_NODES ; else if ( fj [ 0 ] < ZERO_VALUE_NODES ) fj [ 0 ] += UNITY_VALUE_NODES ; fj *= vec3 ( UNITY_VALUE_NODES , fW , fX ) ; fj = mix ( vec3 ( UNITY_VALUE_NODES ) , mix ( vec3 ( ZERO_VALUE_NODES ) , fj , step ( vec3 ( ZERO_VALUE_NODES ) , fj ) ) , step ( fj , vec3 ( UNITY_VALUE_NODES ) ) ) ; f_ = mix ( fZ , eu ( fj ) , fY ) ;".split(" ")}]},
{type:"node",name:"INVERT",h:[{type:"node_in",name:"ga",qualifier:["float"],c:!1},{type:"node_in",name:"gb",qualifier:["vec3"],c:!1},{type:"node_out",name:"gc",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"gc = mix ( gb , vec3 ( UNITY_VALUE_NODES ) - gb , ga ) ;".split(" ")}]},{type:"node",name:"LAMP",h:[{type:"node_out",name:"gd",qualifier:["vec3"],c:!0},{type:"node_out",name:"ge",qualifier:["vec3"],c:!1},{type:"node_out",name:"gf",qualifier:["float"],c:!1},{type:"node_out",name:"gg",qualifier:["float"],
c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_gd"],f:[{type:"textline",a:"gd = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",a:"fe = u_lamp_light_factors [ LAMP_INDEX ] ; fj = u_lamp_light_directions [ LAMP_INDEX ] ; fk = u_lamp_light_positions [ LAMP_INDEX ] ; eX = fe . z ; if ( eX != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",a:"ge = fk - bC ; gf = length ( ge ) ; ge = normalize ( ge ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",
d:["USE_OUT_gg"],f:[{type:"textline",a:"gg = eX / ( eX + gf * gf ) ; eX = fe . x ; eY = fe . y ; if ( eX > - UNITY_VALUE_NODES ) { eZ = dot ( ge , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - eX ) / eY ) ; gg *= eZ ; }".split(" ")}]}]},{type:"textline",a:["}","else","{"]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_ge"],f:[{type:"textline",a:["ge","=","fj",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_gf"],f:[{type:"textline",a:"gf = length ( fk - bC ) ;".split(" ")}]}]},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_gg"],f:[{type:"textline",a:["gg","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",a:["}"]}]},{type:"node",name:"NORMAL",h:[{type:"node_in",name:"gh",qualifier:["vec3"],c:!1},{type:"node_out",name:"gi",qualifier:["vec3"],c:!0},{type:"node_out",name:"gj",qualifier:["float"],c:!0},{type:"node_param",name:"eE",qualifier:["vec3"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_gi"],f:[{type:"textline",a:["gi","=","eE",";"]}]}]},{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_gj"],f:[{type:"textline",a:"gj = - dot ( gh , eE ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",h:[{type:"node_in",name:"gk",qualifier:["vec3"],c:!1},{type:"node_out",name:"gl",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"gl = - ( eN * vec4 ( gk , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",h:[{type:"node_in",name:"gm",qualifier:["vec3"],c:!1},{type:"node_in",name:"gn",qualifier:["float"],c:!1},{type:"node_in",name:"go",
qualifier:["float"],c:!1},{type:"node_in",name:"gp",qualifier:["float"],c:!1},{type:"node_in",name:"gq",qualifier:["vec3"],c:!1},{type:"node_in",name:"gr",qualifier:["vec3"],c:!1},{type:"node_out",name:"gs",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["gs","=","gm",";"]},{type:"textline",a:"gn ; go ; gp ; gq ; gr ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",h:[{type:"node_in",name:"gt",qualifier:["vec3"],c:!1},{type:"node_in",name:"gu",qualifier:["float"],c:!1},{type:"node_in",name:"gv",
qualifier:["vec3"],c:!1},{type:"node_out",name:"gw",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["gw","=","gt",";"]},{type:"textline",a:["gu",";","gv",";"]}]},{type:"node",name:"BSDF_GLASS",h:[{type:"node_in",name:"gx",qualifier:["vec3"],c:!1},{type:"node_in",name:"gy",qualifier:["float"],c:!1},{type:"node_in",name:"gz",qualifier:["float"],c:!1},{type:"node_in",name:"gA",qualifier:["vec3"],c:!1},{type:"node_out",name:"gB",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["gB","=","gx",";"]},{type:"textline",
a:"gy ; gz ; gA ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",h:[{type:"node_in",name:"gC",qualifier:["vec3"],c:!1},{type:"node_in",name:"gD",qualifier:["float"],c:!1},{type:"node_in",name:"gE",qualifier:["vec3"],c:!1},{type:"node_out",name:"gF",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["gF","=","gC",";"]},{type:"textline",a:["gD",";","gE",";"]}]},{type:"node",name:"BSDF_HAIR",h:[{type:"node_in",name:"gG",qualifier:["vec3"],c:!1},{type:"node_in",name:"gH",qualifier:["float"],c:!1},{type:"node_in",
name:"gI",qualifier:["float"],c:!1},{type:"node_in",name:"gJ",qualifier:["float"],c:!1},{type:"node_out",name:"gK",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["gK","=","gG",";"]},{type:"textline",a:"gH ; gI ; gJ ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",h:[{type:"node_in",name:"gL",qualifier:["vec3"],c:!1},{type:"node_out",name:"gM",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["gM","=","gL",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",h:[{type:"node_in",name:"gN",qualifier:["vec3"],
c:!1},{type:"node_in",name:"gO",qualifier:["vec3"],c:!1},{type:"node_out",name:"gP",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["gP","=","gN",";"]},{type:"textline",a:["gO",";"]}]},{type:"node",name:"BSDF_REFRACTION",h:[{type:"node_in",name:"gQ",qualifier:["vec3"],c:!1},{type:"node_in",name:"gR",qualifier:["float"],c:!1},{type:"node_in",name:"gS",qualifier:["float"],c:!1},{type:"node_in",name:"gT",qualifier:["vec3"],c:!1},{type:"node_out",name:"gU",qualifier:["vec3"],c:!1}],f:[{type:"textline",
a:"gU [ 0 ] = gU [ 1 ] = gU [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:"gQ ; gR ; gS ; gT ;".split(" ")}]},{type:"node",name:"BSDF_TOON",h:[{type:"node_in",name:"gV",qualifier:["vec3"],c:!1},{type:"node_in",name:"gW",qualifier:["float"],c:!1},{type:"node_in",name:"gX",qualifier:["float"],c:!1},{type:"node_in",name:"gY",qualifier:["vec3"],c:!1},{type:"node_out",name:"gZ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["gZ","=","gV",";"]},{type:"textline",a:"gW ; gX ; gY ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",h:[{type:"node_in",name:"g_",qualifier:["vec3"],c:!1},{type:"node_in",name:"ha",qualifier:["float"],c:!1},{type:"node_in",name:"hb",qualifier:["vec3"],c:!1},{type:"node_out",name:"hc",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["hc","=","g_",";"]},{type:"textline",a:["ha",";","hb",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",h:[{type:"node_in",name:"hd",qualifier:["vec3"],c:!1},{type:"node_in",name:"he",qualifier:["float"],c:!1},{type:"node_in",name:"hf",
qualifier:["vec3"],c:!1},{type:"node_in",name:"hg",qualifier:["float"],c:!1},{type:"node_in",name:"hh",qualifier:["float"],c:!1},{type:"node_in",name:"hi",qualifier:["vec3"],c:!1},{type:"node_out",name:"hj",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"hj [ 0 ] = hj [ 1 ] = hj [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:"hd ; hf ; hg ; hh ; hi ; he ;".split(" ")}]},{type:"node",name:"EMISSION",h:[{type:"node_in",name:"hk",qualifier:["vec3"],c:!1},{type:"node_in",name:"hl",qualifier:["float"],
c:!1},{type:"node_out",name:"hm",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["hm","=","hk",";"]},{type:"textline",a:["hl",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",h:[{type:"node_in",name:"hn",qualifier:["vec3"],c:!1},{type:"node_out",name:"ho",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"ho [ 0 ] = ho [ 1 ] = ho [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["hn",";"]}]},{type:"node",name:"HOLDOUT",h:[{type:"node_out",name:"hp",qualifier:["vec3"],c:!1}],f:[{type:"textline",
a:"hp [ 0 ] = hp [ 1 ] = hp [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",h:[{type:"node_in",name:"hq",qualifier:["vec3"],c:!1},{type:"node_in",name:"hr",qualifier:["float"],c:!1},{type:"node_out",name:"hs",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"hs [ 0 ] = hs [ 1 ] = hs [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["hq",";","hr",";"]}]},{type:"node",name:"VOLUME_SCATTER",h:[{type:"node_in",name:"ht",qualifier:["vec3"],c:!1},{type:"node_in",
name:"hu",qualifier:["float"],c:!1},{type:"node_in",name:"hv",qualifier:["float"],c:!1},{type:"node_out",name:"hw",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"hw [ 0 ] = hw [ 1 ] = hw [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:"ht ; hu ; hv ;".split(" ")}]},{type:"node",name:"BUMP",h:[{type:"node_in",name:"hx",qualifier:["float"],c:!1},{type:"node_in",name:"hy",qualifier:["float"],c:!1},{type:"node_in",name:"hz",qualifier:["float"],c:!1},{type:"node_in",name:"hA",qualifier:["vec3"],
c:!1},{type:"node_out",name:"hB",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["hB","=","hA",";"]},{type:"textline",a:"hx ; hy ; hz ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",h:[{type:"node_in",name:"hC",qualifier:["float"],c:!1},{type:"node_in",name:"hD",qualifier:["vec3"],c:!1},{type:"node_out",name:"hE",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["hE","=","hD",";"]},{type:"textline",a:["hC",";"]}]},{type:"node",name:"VECT_TRANSFORM",h:[{type:"node_in",name:"hF",qualifier:["vec3"],
c:!1},{type:"node_out",name:"hG",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"hG [ 0 ] = hG [ 1 ] = hG [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["hF",";"]}]},{type:"node",name:"BLACKBODY",h:[{type:"node_in",name:"hH",qualifier:["float"],c:!1},{type:"node_out",name:"hI",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"hI [ 0 ] = hI [ 1 ] = hI [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["hH",";"]}]},{type:"node",name:"WAVELENGTH",h:[{type:"node_in",name:"hJ",qualifier:["float"],
c:!1},{type:"node_out",name:"hK",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"hK [ 0 ] = hK [ 1 ] = hK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["hJ",";"]}]},{type:"node",name:"SEPXYZ",h:[{type:"node_in",name:"hL",qualifier:["vec3"],c:!1},{type:"node_out",name:"hM",qualifier:["float"],c:!1},{type:"node_out",name:"hN",qualifier:["float"],c:!1},{type:"node_out",name:"hO",qualifier:["float"],c:!1}],f:[{type:"textline",a:"hM = hL [ 0 ] ; hN = hL [ 1 ] ; hO = hL [ 2 ] ;".split(" ")}]},
{type:"node",name:"COMBXYZ",h:[{type:"node_in",name:"hP",qualifier:["float"],c:!1},{type:"node_in",name:"hQ",qualifier:["float"],c:!1},{type:"node_in",name:"hR",qualifier:["float"],c:!1},{type:"node_out",name:"hS",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"hS [ 0 ] = hP ; hS [ 1 ] = hQ ; hS [ 2 ] = hR ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",h:[{type:"node_in",name:"hT",qualifier:["vec3"],c:!1},{type:"node_in",name:"hU",qualifier:["float"],c:!1},{type:"node_in",name:"hV",qualifier:["float"],
c:!1},{type:"node_out",name:"hW",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eZ = hU - hV * eh ; hW = max ( ( UNITY_VALUE_NODES + hV ) * hT + eZ , vec3 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",h:[{type:"node_in",name:"hX",qualifier:["float"],c:!1},{type:"node_in",name:"hY",qualifier:["float"],c:!1},{type:"node_out",name:"hZ",qualifier:["float"],c:!1},{type:"node_out",name:"h_",qualifier:["float"],c:!1},{type:"node_out",name:"ia",qualifier:["float"],c:!1}],f:[{type:"textline",
a:"hZ = h_ = ia = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["hX",";","hY",";"]}]},{type:"node",name:"TEX_IMAGE",h:[{type:"node_in",name:"ib",qualifier:["vec3"],c:!1},{type:"node_out",name:"ic",qualifier:["vec3"],c:!1},{type:"node_out",name:"id",qualifier:["float"],c:!1}],f:[{type:"textline",a:"ic [ 0 ] = ic [ 1 ] = ic [ 2 ] = ZERO_VALUE_NODES ; id = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:["ib",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",h:[{type:"node_in",name:"ie",qualifier:["vec3"],
c:!1},{type:"node_out",name:"ig",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"ig [ 0 ] = ig [ 1 ] = ig [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["ie",";"]}]},{type:"node",name:"TEX_SKY",h:[{type:"node_in",name:"ih",qualifier:["vec3"],c:!1},{type:"node_out",name:"ii",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"ii [ 0 ] = ii [ 1 ] = ii [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["ih",";"]}]},{type:"node",name:"TEX_NOISE",h:[{type:"node_in",name:"ij",qualifier:["vec3"],
c:!1},{type:"node_in",name:"ik",qualifier:["float"],c:!1},{type:"node_in",name:"il",qualifier:["float"],c:!1},{type:"node_in",name:"im",qualifier:["float"],c:!1},{type:"node_out",name:"io",qualifier:["vec3"],c:!1},{type:"node_out",name:"ip",qualifier:["float"],c:!1}],f:[{type:"textline",a:"io [ 0 ] = io [ 1 ] = io [ 2 ] = ZERO_VALUE_NODES ; ip = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:"ij ; ik ; il ; im ;".split(" ")}]},{type:"node",name:"TEX_WAVE",h:[{type:"node_in",name:"iq",qualifier:["vec3"],
c:!1},{type:"node_in",name:"ir",qualifier:["float"],c:!1},{type:"node_in",name:"is",qualifier:["float"],c:!1},{type:"node_in",name:"it",qualifier:["float"],c:!1},{type:"node_in",name:"iu",qualifier:["float"],c:!1},{type:"node_out",name:"iv",qualifier:["vec3"],c:!1},{type:"node_out",name:"iw",qualifier:["float"],c:!1}],f:[{type:"textline",a:"iv [ 0 ] = iv [ 1 ] = iv [ 2 ] = ZERO_VALUE_NODES ; iw = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:"iq ; ir ; is ; it ; iu ;".split(" ")}]},{type:"node",
name:"TEX_VORONOI",h:[{type:"node_in",name:"ix",qualifier:["vec3"],c:!1},{type:"node_in",name:"iy",qualifier:["float"],c:!1},{type:"node_out",name:"iz",qualifier:["vec3"],c:!1},{type:"node_out",name:"iA",qualifier:["float"],c:!1}],f:[{type:"textline",a:"iz [ 0 ] = iz [ 1 ] = iz [ 2 ] = ZERO_VALUE_NODES ; iA = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:["ix",";","iy",";"]}]},{type:"node",name:"TEX_MUSGRAVE",h:[{type:"node_in",name:"iB",qualifier:["vec3"],c:!1},{type:"node_in",name:"iC",qualifier:["float"],
c:!1},{type:"node_in",name:"iD",qualifier:["float"],c:!1},{type:"node_in",name:"iE",qualifier:["float"],c:!1},{type:"node_in",name:"iF",qualifier:["float"],c:!1},{type:"node_in",name:"iG",qualifier:["float"],c:!1},{type:"node_in",name:"iH",qualifier:["float"],c:!1},{type:"node_out",name:"iI",qualifier:["vec3"],c:!1},{type:"node_out",name:"iJ",qualifier:["float"],c:!1}],f:[{type:"textline",a:"iI [ 0 ] = iI [ 1 ] = iI [ 2 ] = ZERO_VALUE_NODES ; iJ = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",
a:"iB ; iC ; iD ; iE ; iF ; iG ; iH ;".split(" ")}]},{type:"node",name:"TEX_GRADIENT",h:[{type:"node_in",name:"iK",qualifier:["vec3"],c:!1},{type:"node_out",name:"iL",qualifier:["vec3"],c:!1},{type:"node_out",name:"iM",qualifier:["float"],c:!1}],f:[{type:"textline",a:"iL [ 0 ] = iL [ 1 ] = iL [ 2 ] = ZERO_VALUE_NODES ; iM = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:["iK",";"]}]},{type:"node",name:"TEX_MAGIC",h:[{type:"node_in",name:"iN",qualifier:["vec3"],c:!1},{type:"node_in",name:"iO",
qualifier:["float"],c:!1},{type:"node_in",name:"iP",qualifier:["float"],c:!1},{type:"node_out",name:"iQ",qualifier:["vec3"],c:!1},{type:"node_out",name:"iR",qualifier:["float"],c:!1}],f:[{type:"textline",a:"iQ [ 0 ] = iQ [ 1 ] = iQ [ 2 ] = ZERO_VALUE_NODES ; iR = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:"iN ; iO ; iP ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",h:[{type:"node_in",name:"iS",qualifier:["vec3"],c:!1},{type:"node_in",name:"iT",qualifier:["vec3"],c:!1},{type:"node_in",name:"iU",
qualifier:["vec3"],c:!1},{type:"node_in",name:"iV",qualifier:["float"],c:!1},{type:"node_out",name:"iW",qualifier:["vec3"],c:!1},{type:"node_out",name:"iX",qualifier:["float"],c:!1}],f:[{type:"textline",a:"iW [ 0 ] = iW [ 1 ] = iW [ 2 ] = ZERO_VALUE_NODES ; iX = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:"iS ; iT ; iU ; iV ;".split(" ")}]},{type:"node",name:"TEX_BRICK",h:[{type:"node_in",name:"iY",qualifier:["vec3"],c:!1},{type:"node_in",name:"iZ",qualifier:["vec3"],c:!1},{type:"node_in",
name:"i_",qualifier:["vec3"],c:!1},{type:"node_in",name:"ja",qualifier:["vec3"],c:!1},{type:"node_in",name:"jb",qualifier:["float"],c:!1},{type:"node_in",name:"jc",qualifier:["float"],c:!1},{type:"node_in",name:"jd",qualifier:["float"],c:!1},{type:"node_in",name:"je",qualifier:["float"],c:!1},{type:"node_in",name:"jf",qualifier:["float"],c:!1},{type:"node_out",name:"jg",qualifier:["vec3"],c:!1},{type:"node_out",name:"jh",qualifier:["float"],c:!1}],f:[{type:"textline",a:"jg [ 0 ] = jg [ 1 ] = jg [ 2 ] = ZERO_VALUE_NODES ; jh = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",a:"iY ; iZ ; i_ ; ja ; jb ; jc ; jd ; je ; jf ;".split(" ")}]},{type:"node",name:"ADD_SHADER",h:[{type:"node_in",name:"ji",qualifier:["vec3"],c:!1},{type:"node_in",name:"jj",qualifier:["vec3"],c:!1},{type:"node_out",name:"jk",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"jk = clamp ( ji + jj , vec3 ( ZERO_VALUE_NODES ) , vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",h:[{type:"node_in",name:"jl",qualifier:["float"],c:!1},{type:"node_in",name:"jm",
qualifier:["vec3"],c:!1},{type:"node_in",name:"jn",qualifier:["vec3"],c:!1},{type:"node_out",name:"jo",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eZ = clamp ( jl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jo = eZ * jm + ( UNITY_VALUE_NODES - eZ ) * jn ;".split(" ")}]},{type:"node",name:"UV_MERGED",h:[{type:"node_out",name:"jp",qualifier:["vec3"],c:!1},{type:"node_out",name:"jq",qualifier:["vec3"],c:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"],c:!1}],f:[{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_jp"],f:[{type:"textline",a:"jp = ew ( eF ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_jq"],f:[{type:"textline",a:"jq = vec3 ( eF , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",h:[{type:"node_out",name:"jr",qualifier:["vec3"],c:!1},{type:"node_param",name:"eG",qualifier:["varying","vec2"],c:!1}],f:[{type:"textline",a:"jr = vec3 ( eG , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",h:[{type:"node_out",
name:"js",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["js","=","fi",";"]}]},{type:"node",name:"TEX_COORD_GE",h:[{type:"node_out",name:"jt",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["jt","=","eg",";"]}]},{type:"node",name:"TEX_COORD_OB",h:[{type:"node_out",name:"ju",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"ju [ 0 ] = ju [ 1 ] = ju [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",h:[{type:"node_out",name:"jv",qualifier:["vec3"],c:!1}],f:[{type:"textline",
a:"jv [ 0 ] = fd [ 0 ] ; jv [ 1 ] = fd [ 1 ] ; jv [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_WI",h:[{type:"node_out",name:"jw",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"jw [ 0 ] = jw [ 1 ] = jw [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",h:[{type:"node_out",name:"jx",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"jx [ 0 ] = jx [ 1 ] = jx [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",h:[{type:"node_out",name:"jy",
qualifier:["vec3"],c:!1},{type:"node_param",name:"eH",qualifier:["varying","vec2"],c:!1}],f:[{type:"textline",a:"jy = vec3 ( eH , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",h:[{type:"node_out",name:"jz",qualifier:["float"],c:!1},{type:"node_out",name:"jA",qualifier:["float"],c:!1},{type:"node_out",name:"jB",qualifier:["float"],c:!1},{type:"node_out",name:"jC",qualifier:["vec3"],c:!1},{type:"node_out",name:"jD",qualifier:["float"],c:!1},{type:"node_out",name:"jE",qualifier:["vec3"],
c:!1},{type:"node_out",name:"jF",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"jz = ZERO_VALUE_NODES ; jA = ZERO_VALUE_NODES ; jB = ZERO_VALUE_NODES ; jC = vec3 ( ZERO_VALUE_NODES ) ; jD = ZERO_VALUE_NODES ; jE = jC ; jF = jC ;".split(" ")}]},{type:"node",name:"HAIR_INFO",h:[{type:"node_out",name:"jG",qualifier:["float"],c:!1},{type:"node_out",name:"jH",qualifier:["float"],c:!1},{type:"node_out",name:"jI",qualifier:["float"],c:!1},{type:"node_out",name:"jJ",qualifier:["vec3"],c:!1}],f:[{type:"textline",
a:"jG = ZERO_VALUE_NODES ; jH = ZERO_VALUE_NODES ; jI = ZERO_VALUE_NODES ; jJ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"OBJECT_INFO",h:[{type:"node_out",name:"jK",qualifier:["vec3"],c:!1},{type:"node_out",name:"jL",qualifier:["float"],c:!1},{type:"node_out",name:"jM",qualifier:["float"],c:!1},{type:"node_out",name:"jN",qualifier:["float"],c:!1}],f:[{type:"textline",a:"jL = ZERO_VALUE_NODES ; jM = ZERO_VALUE_NODES ; jN = ZERO_VALUE_NODES ; jK = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"WIREFRAME",h:[{type:"node_in",name:"jO",qualifier:["float"],c:!1},{type:"node_out",name:"jP",qualifier:["float"],c:!1}],f:[{type:"textline",a:["jP","=","jO",";"]}]},{type:"node",name:"TANGENT",h:[{type:"node_out",name:"jQ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"jQ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",h:[{type:"node_in",name:"jR",qualifier:["float"],c:!1},{type:"node_in",name:"jS",qualifier:["vec3"],c:!1},{type:"node_out",name:"jT",
qualifier:["float"],c:!1},{type:"node_out",name:"jU",qualifier:["float"],c:!1}],f:[{type:"textline",a:"jT = jU = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["jS",";","jR",";"]}]},{type:"node",name:"LIGHT_PATH",h:[{type:"node_out",name:"jV",qualifier:["float"],c:!1},{type:"node_out",name:"jW",qualifier:["float"],c:!1},{type:"node_out",name:"jX",qualifier:["float"],c:!1},{type:"node_out",name:"jY",qualifier:["float"],c:!1},{type:"node_out",name:"jZ",qualifier:["float"],c:!1},{type:"node_out",
name:"j_",qualifier:["float"],c:!1},{type:"node_out",name:"ka",qualifier:["float"],c:!1},{type:"node_out",name:"kb",qualifier:["float"],c:!1},{type:"node_out",name:"kc",qualifier:["float"],c:!1},{type:"node_out",name:"kd",qualifier:["float"],c:!1}],f:[{type:"textline",a:"jV = jW = jX = ZERO_VALUE_NODES ; jY = jZ = j_ = ZERO_VALUE_NODES ; ka = ka = kc = kd = ZERO_VALUE_NODES ; kb = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",h:[{type:"node_out",name:"ke",qualifier:["vec3"],c:!1},
{type:"node_out",name:"kf",qualifier:["vec3"],c:!1},{type:"node_out",name:"kg",qualifier:["float"],c:!1}],f:[{type:"textline",a:"ke = kf = vec3 ( ZERO_VALUE_NODES ) ; kg = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"SCRIPT",h:[],f:[]},{type:"node",name:"CURVE_VEC",h:[{type:"node_in",name:"kh",qualifier:["float"],c:!1},{type:"node_in",name:"ki",qualifier:["vec3"],c:!1},{type:"node_out",name:"kj",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["kj","=","ki",";"]},{type:"node_condition",b:[{type:"node_if",
d:["READ_R"],f:[{type:"textline",a:"kj . r = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * ki . r + 0.5 , NODE_TEX_ROW ) ) . r - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["READ_G"],f:[{type:"textline",a:"kj . g = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * ki . g + 0.5 , NODE_TEX_ROW ) ) . g - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["READ_B"],f:[{type:"textline",a:"kj . b = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * ki . b + 0.5 , NODE_TEX_ROW ) ) . b - 0.5 ) * 2.0 ;".split(" ")}]}]},
{type:"textline",a:"kj = mix ( ki , kj , kh ) ;".split(" ")}]},{type:"node",name:"CURVE_RGB",h:[{type:"node_in",name:"kk",qualifier:["float"],c:!1},{type:"node_in",name:"kl",qualifier:["vec3"],c:!1},{type:"node_out",name:"km",qualifier:["vec3"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["READ_A"],f:[{type:"textline",a:"eZ = texture2D ( u_nodes_texture , vec2 ( kl . r , NODE_TEX_ROW ) ) . a ; eY = texture2D ( u_nodes_texture , vec2 ( kl . g , NODE_TEX_ROW ) ) . a ; eX = texture2D ( u_nodes_texture , vec2 ( kl . b , NODE_TEX_ROW ) ) . a ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",a:"eZ = kl . r ; eY = kl . g ; eX = kl . b ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["READ_R"],f:[{type:"textline",a:"km . r = texture2D ( u_nodes_texture , vec2 ( eZ , NODE_TEX_ROW ) ) . r ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"km . r = eZ ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["READ_G"],f:[{type:"textline",a:"km . g = texture2D ( u_nodes_texture , vec2 ( eY , NODE_TEX_ROW ) ) . g ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",a:"km . g = eY ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["READ_B"],f:[{type:"textline",a:"km . b = texture2D ( u_nodes_texture , vec2 ( eX , NODE_TEX_ROW ) ) . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"km . b = eX ;".split(" ")}]}]},{type:"textline",a:"km = mix ( kl , km , kk ) ;".split(" ")}]},{type:"node",name:"VALTORGB",h:[{type:"node_in",name:"kn",qualifier:["float"],c:!1},{type:"node_out",name:"ko",qualifier:["vec3"],
c:!1},{type:"node_out",name:"kp",qualifier:["float"],c:!1}],f:[{type:"textline",a:"fe = texture2D ( u_nodes_texture , vec2 ( kn , NODE_TEX_ROW ) ) ; ko = fe . rgb ; kp = fe . a ;".split(" ")}]},{type:"node",name:"MAPPING",h:[{type:"node_in",name:"kq",qualifier:["vec3"],c:!1},{type:"node_out",name:"kr",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["kr","=","kq",";"]},{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",a:"kr = ( MAPPING_TRS_MATRIX * vec4 ( kr , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},
{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_SCALE",f:[{type:"textline",a:"kr = kr * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",a:"kr = kr + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",a:"kr = max ( kr , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",
a:"kr = min ( kr , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["MAPPING_IS_NORMAL"],f:[{type:"textline",a:"kr = normalize ( kr ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",h:[{type:"node_in",name:"ks",qualifier:["float"],c:!1},{type:"node_in",name:"kt",qualifier:["float"],c:!1},{type:"node_out",name:"ku",qualifier:["float"],c:!1}],f:[{type:"textline",a:"ku = ks + kt ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",
a:"ku = clamp ( ku , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",h:[{type:"node_in",name:"kv",qualifier:["float"],c:!1},{type:"node_in",name:"kw",qualifier:["float"],c:!1},{type:"node_out",name:"kx",qualifier:["float"],c:!1}],f:[{type:"textline",a:"kx = kv - kw ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"kx = clamp ( kx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MULTIPLY",h:[{type:"node_in",name:"ky",qualifier:["float"],c:!1},{type:"node_in",name:"kz",qualifier:["float"],c:!1},{type:"node_out",name:"kA",qualifier:["float"],c:!1}],f:[{type:"textline",a:"kA = ky * kz ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"kA = clamp ( kA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",h:[{type:"node_in",name:"kB",qualifier:["float"],c:!1},{type:"node_in",name:"kC",
qualifier:["float"],c:!1},{type:"node_out",name:"kD",qualifier:["float"],c:!1}],f:[{type:"textline",a:"kD = ( kC != ZERO_VALUE_NODES ) ? kB / kC : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"kD = clamp ( kD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",h:[{type:"node_in",name:"kE",qualifier:["float"],c:!1},{type:"node_in",name:"kF",qualifier:["float"],c:!1},{type:"node_out",name:"kG",
qualifier:["float"],c:!1}],f:[{type:"textline",a:"kG = sin ( kE ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"kG = clamp ( kG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["kF",";"]}]},{type:"node",name:"MATH_COSINE",h:[{type:"node_in",name:"kH",qualifier:["float"],c:!1},{type:"node_in",name:"kI",qualifier:["float"],c:!1},{type:"node_out",name:"kJ",qualifier:["float"],c:!1}],f:[{type:"textline",a:"kJ = cos ( kH ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"kJ = clamp ( kJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["kI",";"]}]},{type:"node",name:"MATH_TANGENT",h:[{type:"node_in",name:"kK",qualifier:["float"],c:!1},{type:"node_in",name:"kL",qualifier:["float"],c:!1},{type:"node_out",name:"kM",qualifier:["float"],c:!1}],f:[{type:"textline",a:"kM = tan ( kK ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],
f:[{type:"textline",a:"kM = clamp ( kM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["kL",";"]}]},{type:"node",name:"MATH_ARCSINE",h:[{type:"node_in",name:"kN",qualifier:["float"],c:!1},{type:"node_in",name:"kO",qualifier:["float"],c:!1},{type:"node_out",name:"kP",qualifier:["float"],c:!1}],f:[{type:"textline",a:"kP = ( kN <= UNITY_VALUE_NODES && kN >= - UNITY_VALUE_NODES ) ? asin ( kN ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",b:[{type:"node_if",
d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"kP = clamp ( kP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["kO",";"]}]},{type:"node",name:"MATH_ARCCOSINE",h:[{type:"node_in",name:"kQ",qualifier:["float"],c:!1},{type:"node_in",name:"kR",qualifier:["float"],c:!1},{type:"node_out",name:"kS",qualifier:["float"],c:!1}],f:[{type:"textline",a:"kS = ( kQ <= UNITY_VALUE_NODES && kQ >= - UNITY_VALUE_NODES ) ? acos ( kQ ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"kS = clamp ( kS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["kR",";"]}]},{type:"node",name:"MATH_ARCTANGENT",h:[{type:"node_in",name:"kT",qualifier:["float"],c:!1},{type:"node_in",name:"kU",qualifier:["float"],c:!1},{type:"node_out",name:"kV",qualifier:["float"],c:!1}],f:[{type:"textline",a:"kV = atan ( kT ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",
a:"kV = clamp ( kV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["kU",";"]}]},{type:"node",name:"MATH_POWER",h:[{type:"node_in",name:"kW",qualifier:["float"],c:!1},{type:"node_in",name:"kX",qualifier:["float"],c:!1},{type:"node_out",name:"kY",qualifier:["float"],c:!1}],f:[{type:"textline",a:"if ( kW < ZERO_VALUE_NODES && kX != floor ( kX ) ) kY = ZERO_VALUE_NODES ; else if ( kX == ZERO_VALUE_NODES )".split(" ")},{type:"textline",a:"kY = UNITY_VALUE_NODES ; else if ( kW < ZERO_VALUE_NODES ) kY = mix ( UNITY_VALUE_NODES , - UNITY_VALUE_NODES , sign ( mod ( - kX , 2.0 ) ) ) * pow ( - kW , kX ) ; else if ( kW == ZERO_VALUE_NODES ) kY = ZERO_VALUE_NODES ; else kY = pow ( kW , kX ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"kY = clamp ( kY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",h:[{type:"node_in",name:"kZ",qualifier:["float"],c:!1},{type:"node_in",name:"k_",qualifier:["float"],c:!1},{type:"node_out",name:"la",qualifier:["float"],c:!1}],f:[{type:"textline",a:"la = ( kZ > ZERO_VALUE_NODES && k_ > ZERO_VALUE_NODES ) ? log2 ( kZ ) / log2 ( k_ ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"la = clamp ( la , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",h:[{type:"node_in",name:"lb",qualifier:["float"],c:!1},{type:"node_in",name:"lc",qualifier:["float"],c:!1},{type:"node_out",name:"ld",qualifier:["float"],c:!1}],f:[{type:"textline",a:"ld = min ( lb , lc ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"ld = clamp ( ld , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",h:[{type:"node_in",name:"le",qualifier:["float"],c:!1},{type:"node_in",name:"lf",qualifier:["float"],c:!1},{type:"node_out",name:"lg",qualifier:["float"],c:!1}],f:[{type:"textline",a:"lg = max ( le , lf ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"lg = clamp ( lg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",h:[{type:"node_in",name:"lh",qualifier:["float"],c:!1},
{type:"node_in",name:"li",qualifier:["float"],c:!1},{type:"node_out",name:"lj",qualifier:["float"],c:!1}],f:[{type:"textline",a:"lj = floor ( lh + eh ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"lj = clamp ( lj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["li",";"]}]},{type:"node",name:"MATH_LESS_THAN",h:[{type:"node_in",name:"lk",qualifier:["float"],c:!1},{type:"node_in",name:"ll",qualifier:["float"],c:!1},
{type:"node_out",name:"lm",qualifier:["float"],c:!1}],f:[{type:"textline",a:"lm = ( lk < ll ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"lm = clamp ( lm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",h:[{type:"node_in",name:"ln",qualifier:["float"],c:!1},{type:"node_in",name:"lo",qualifier:["float"],c:!1},{type:"node_out",name:"lp",qualifier:["float"],
c:!1}],f:[{type:"textline",a:"lp = ( ln > lo ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"lp = clamp ( lp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",h:[{type:"node_in",name:"lq",qualifier:["float"],c:!1},{type:"node_in",name:"lr",qualifier:["float"],c:!1},{type:"node_out",name:"ls",qualifier:["float"],c:!1}],f:[{type:"textline",a:"ls = abs ( lr ) > 0.000001 ? mod ( lq , lr ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"ls = clamp ( ls , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",h:[{type:"node_in",name:"lt",qualifier:["float"],c:!1},{type:"node_in",name:"lu",qualifier:["float"],c:!1},{type:"node_out",name:"lv",qualifier:["float"],c:!1}],f:[{type:"textline",a:"lv = abs ( lt ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"lv = clamp ( lv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",a:["lu",";"]}]},{type:"node",name:"MIX_RGB_MIX",h:[{type:"node_in",name:"lw",qualifier:["float"],c:!1},{type:"node_in",name:"lx",qualifier:["vec3"],c:!1},{type:"node_in",name:"ly",qualifier:["vec3"],c:!1},{type:"node_out",name:"lz",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( lw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lz = mix ( lx , ly , eX ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"lz = clamp ( lz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_ADD",h:[{type:"node_in",name:"lA",qualifier:["float"],c:!1},{type:"node_in",name:"lB",qualifier:["vec3"],c:!1},{type:"node_in",name:"lC",qualifier:["vec3"],c:!1},{type:"node_out",name:"lD",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( lA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lD = mix ( lB , lB + lC , eX ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"lD = clamp ( lD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",h:[{type:"node_in",name:"lE",qualifier:["float"],c:!1},{type:"node_in",name:"lF",qualifier:["vec3"],c:!1},{type:"node_in",name:"lG",qualifier:["vec3"],c:!1},{type:"node_out",name:"lH",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( lE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lH = mix ( lF , lF * lG , eX ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"lH = clamp ( lH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",h:[{type:"node_in",name:"lI",qualifier:["float"],c:!1},{type:"node_in",name:"lJ",qualifier:["vec3"],c:!1},{type:"node_in",name:"lK",qualifier:["vec3"],c:!1},{type:"node_out",name:"lL",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( lI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lL = mix ( lJ , lJ - lK , eX ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"lL = clamp ( lL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",h:[{type:"node_in",name:"lM",qualifier:["float"],c:!1},{type:"node_in",name:"lN",qualifier:["vec3"],c:!1},{type:"node_in",name:"lO",qualifier:["vec3"],c:!1},{type:"node_out",name:"lP",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( lM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eX ; lP = vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( eY ) + eX * ( vec3 ( UNITY_VALUE_NODES ) - lO ) ) * ( vec3 ( UNITY_VALUE_NODES ) - lN ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"lP = clamp ( lP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",h:[{type:"node_in",name:"lQ",qualifier:["float"],c:!1},{type:"node_in",name:"lR",qualifier:["vec3"],c:!1},{type:"node_in",name:"lS",qualifier:["vec3"],c:!1},{type:"node_out",name:"lT",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( lQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eX ; lS += step ( lS , vec3 ( ZERO_VALUE_NODES ) ) ; lT = eY * lR + eX * lR / lS ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"lT = clamp ( lT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",h:[{type:"node_in",name:"lU",qualifier:["float"],c:!1},{type:"node_in",name:"lV",qualifier:["vec3"],c:!1},{type:"node_in",name:"lW",qualifier:["vec3"],c:!1},{type:"node_out",name:"lX",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( lU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lX = mix ( lV , abs ( lV - lW ) , eX ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"lX = clamp ( lX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",h:[{type:"node_in",name:"lY",qualifier:["float"],c:!1},{type:"node_in",name:"lZ",qualifier:["vec3"],c:!1},{type:"node_in",name:"l_",qualifier:["vec3"],c:!1},{type:"node_out",name:"ma",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( lY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ma = min ( lZ . rgb , l_ . rgb * eX ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"ma = clamp ( ma , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",h:[{type:"node_in",name:"mb",qualifier:["float"],c:!1},{type:"node_in",name:"mc",qualifier:["vec3"],c:!1},{type:"node_in",name:"md",qualifier:["vec3"],c:!1},{type:"node_out",name:"me",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; me = max ( mc . rgb , md . rgb * eX ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"me = clamp ( me , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",h:[{type:"node_in",name:"mf",qualifier:["float"],c:!1},{type:"node_in",name:"mg",qualifier:["vec3"],c:!1},{type:"node_in",name:"mh",qualifier:["vec3"],c:!1},{type:"node_out",name:"mi",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eX ) ; mi = mix ( mg * ( fk + 2.0 * eX * mh ) , vec3 ( UNITY_VALUE_NODES ) - ( fk + 2.0 * eX * ( vec3 ( UNITY_VALUE_NODES ) - mh ) ) * ( vec3 ( UNITY_VALUE_NODES ) - mg ) , step ( eh , mg ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"mi = clamp ( mi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",h:[{type:"node_in",name:"mj",qualifier:["float"],c:!1},{type:"node_in",name:"mk",qualifier:["vec3"],c:!1},{type:"node_in",name:"ml",qualifier:["vec3"],c:!1},{type:"node_out",name:"mm",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES ) - eX * ml ; fj = clamp ( mk / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mm = mix ( mix ( fj , vec3 ( UNITY_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) , mk , step ( mk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"mm = clamp ( mm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",h:[{type:"node_in",name:"mn",qualifier:["float"],c:!1},{type:"node_in",name:"mo",qualifier:["vec3"],c:!1},{type:"node_in",name:"mp",qualifier:["vec3"],c:!1},{type:"node_out",name:"mq",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eX ) ; fk = fk + eX * mp ; fj = clamp ( vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( UNITY_VALUE_NODES ) - mo ) / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mq = mix ( fj , vec3 ( ZERO_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"mq = clamp ( mq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",h:[{type:"node_in",name:"mr",qualifier:["float"],c:!1},{type:"node_in",name:"ms",qualifier:["vec3"],c:!1},{type:"node_in",name:"mt",qualifier:["vec3"],c:!1},{type:"node_out",name:"mu",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mu = ms ; fj = eq ( mt ) ; if ( fj . y != ZERO_VALUE_NODES ) { fk = eq ( mu ) ; fk . x = fj . x ; fl = eu ( fk ) ; mu = mix ( mu , fl , eX ) ; }".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"mu = clamp ( mu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",h:[{type:"node_in",name:"mv",qualifier:["float"],c:!1},{type:"node_in",name:"mw",qualifier:["vec3"],c:!1},{type:"node_in",name:"mx",qualifier:["vec3"],c:!1},{type:"node_out",name:"my",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eX ; my = mw ; fl = eq ( my ) ; if ( fl . y != ZERO_VALUE_NODES ) { fk = eq ( mx ) ; fl . y = eY * fl . y + eX * fk . y ; my = eu ( fl ) ; }".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"my = clamp ( my , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",h:[{type:"node_in",name:"mz",qualifier:["float"],c:!1},{type:"node_in",name:"mA",qualifier:["vec3"],c:!1},{type:"node_in",name:"mB",qualifier:["vec3"],c:!1},{type:"node_out",name:"mC",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eX ; fl = eq ( mA ) ; fk = eq ( mB ) ; fl . z = eY * fl . z + eX * fk . z ; mC = eu ( fl ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"mC = clamp ( mC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",h:[{type:"node_in",name:"mD",qualifier:["float"],c:!1},{type:"node_in",name:"mE",qualifier:["vec3"],c:!1},{type:"node_in",name:"mF",qualifier:["vec3"],c:!1},{type:"node_out",name:"mG",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mG = mE ; fk = eq ( mF ) ; if ( fk . y != ZERO_VALUE_NODES ) { fl = eq ( mG ) ; fl . x = fk . x ; fl . y = fk . y ; fj = eu ( fl ) ; mG = mix ( mG , fj , eX ) ; }".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"mG = clamp ( mG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",h:[{type:"node_in",name:"mH",qualifier:["float"],c:!1},{type:"node_in",name:"mI",qualifier:["vec3"],c:!1},{type:"node_in",name:"mJ",qualifier:["vec3"],c:!1},{type:"node_out",name:"mK",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eX ; fj = mJ + mI - mJ * mI ; mK = mI * ( vec3 ( eY ) + vec3 ( eX ) * ( ( vec3 ( UNITY_VALUE_NODES ) - mI ) * mJ + fj ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"mK = clamp ( mK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",h:[{type:"node_in",name:"mL",qualifier:["float"],c:!1},{type:"node_in",name:"mM",qualifier:["vec3"],c:!1},{type:"node_in",name:"mN",qualifier:["vec3"],c:!1},{type:"node_out",name:"mO",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"eX = clamp ( mL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mO = mM + eX * ( 2.0 * mN - vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"mO = clamp ( mO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",h:[{type:"node_in",name:"mP",qualifier:["vec3"],c:!1},{type:"node_in",name:"mQ",qualifier:["float"],c:!1}],f:[{type:"textline",a:"eO = mP ; eS = mQ ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",h:[{type:"node_in",name:"mR",qualifier:["vec3"],c:!1},{type:"node_in",name:"mS",qualifier:["vec3"],c:!1},{type:"node_in",
name:"mT",qualifier:["float"],c:!1},{type:"node_in",name:"mU",qualifier:["vec3"],c:!0},{type:"node_in",name:"mV",qualifier:["float"],c:!0},{type:"node_out",name:"mW",qualifier:["vec3"],c:!1},{type:"node_out",name:"mX",qualifier:["vec3"],c:!1},{type:"node_out",name:"mY",qualifier:["vec3"],c:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],c:!1},{type:"node_out",name:"m_",qualifier:["vec3"],c:!1},{type:"node_out",name:"na",qualifier:["vec2"],c:!1},{type:"node_out",name:"nb",qualifier:["vec2"],c:!1},
{type:"node_out",name:"nc",qualifier:["vec4"],c:!1},{type:"node_param",name:"eI",qualifier:["const","vec2"],c:!1},{type:"node_param",name:"eJ",qualifier:["const","vec3"],c:!1}],f:[{type:"textline",a:"mY = clamp ( mR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",a:"mZ = eJ [ 0 ] * clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_NORMAL"],f:[{type:"textline",a:"m_ = normalize ( mU ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",a:["m_","=","fi",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["SHADELESS_MAT",{type:"logic_negative_expr",e:1}],f:[{type:"node_condition",b:[{type:"node_if",d:["MATERIAL_EXT"],f:[{type:"textline",a:"mW = mV * mY ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"mW = eV * mY ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",a:["mY","*=","mT",";"]}]}]},{type:"textline",a:"mX = eW * u_environment_energy * dS ( m_ ) ; nc = du ( mY ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],f:[{type:"textline",a:"na = vec2 ( eI [ 0 ] , eI [ 1 ] ) ;".split(" ")},{type:"textline",a:"nb = vec2 ( eJ [ 1 ] , eJ [ 2 ] ) ;".split(" ")}]}]},{type:"textline",a:["eR","=","nc",";"]}]},{type:"node_else",f:[{type:"textline",a:"mW = vec3 ( ZERO_VALUE_NODES ) ; mX = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",h:[{type:"node_in",name:"nd",qualifier:["vec4"],c:!1},{type:"node_in",name:"ne",
qualifier:["vec3"],c:!1},{type:"node_in",name:"nf",qualifier:["vec3"],c:!1},{type:"node_in",name:"ng",qualifier:["float"],c:!0},{type:"node_in",name:"nh",qualifier:["float"],c:!0},{type:"node_in",name:"ni",qualifier:["float"],c:!0},{type:"node_out",name:"nj",qualifier:["vec3"],c:!0},{type:"node_out",name:"nk",qualifier:["float"],c:!0},{type:"node_out",name:"nl",qualifier:["vec3"],c:!0},{type:"node_out",name:"nm",qualifier:["vec3"],c:!0},{type:"node_out",name:"nn",qualifier:["vec3"],c:!0},{type:"node_param",
name:"eK",qualifier:["float"],c:!1},{type:"node_param",name:"eL",qualifier:["float"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_nj"],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",a:"nj = nd . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"nj = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",e:2},{type:"logical_and_expr",
e:2}],f:[{type:"node_condition",b:[{type:"node_if",d:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",e:2}],f:[{type:"textline",a:"dP ( nj , eM , nf , ng , eN ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"dP ( nj , eM , nf , ng , mat4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",a:["nj","+=","ne",";"]}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_nl"],f:[{type:"textline",a:["nl",
"=","nf",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["MATERIAL_EXT"],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_nm"],f:[{type:"textline",a:"nm = nd . rgb ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_nn"],f:[{type:"textline",a:["nn","=","ne",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_nk"],f:[{type:"textline",a:"nk = clamp ( ni , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",a:"eX = max ( max ( ne . r , ne . g ) , ne . b ) * nh ; nk = clamp ( ni * ( UNITY_VALUE_NODES - eX ) + eX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_nk"],f:[{type:"textline",a:"nk = clamp ( eK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",a:"eX = max ( max ( ne . r , ne . g ) , ne . b ) * eL ; nk = eK * ( UNITY_VALUE_NODES - eX ) + eX ;".split(" ")}]}]}]}]}]}]},
{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",a:["eP","=","ne",";"]}]},{type:"node_else",f:[{type:"textline",a:"eP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["eQ","=","nf",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"no",qualifier:["vec3"],c:!1},{type:"node_in",name:"np",qualifier:["vec3"],c:!1},{type:"node_in",name:"nq",qualifier:["vec3"],c:!1},{type:"node_out",name:"nr",qualifier:["vec4"],c:!1},{type:"node_out",
name:"ns",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"nr = vec4 ( no + nq * np , ZERO_VALUE_NODES ) ; ns = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"nt",qualifier:["vec4"],c:!1},{type:"node_out",name:"nu",qualifier:["vec3"],c:!1},{type:"node_out",name:"nv",qualifier:["vec2"],c:!1},{type:"node_out",name:"nw",qualifier:["vec3"],c:!1},{type:"node_out",name:"nx",qualifier:["float"],c:!1}],f:[{type:"textline",a:"nv = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["LAMP_TYPE","HEMI",{type:"equal_expr",e:2}],f:[{type:"textline",a:["nx","=","eh",";"]}]},{type:"node_else",f:[{type:"textline",a:["nx","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",a:"nw = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",e:1},{type:"non_equal_expr",e:2}],f:[{type:"textline",a:"nw *= nt [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",
b:[{type:"node_if",d:["LAMP_TYPE","SPOT",{type:"equal_expr",e:2},"LAMP_TYPE","POINT",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],f:[{type:"textline",a:"fj = u_light_positions [ LAMP_IND ] ; nu = fj - fh ;".split(" ")},{type:"textline",a:"eX = length ( nu ) ; nw *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + eX * eX ) ; nu = normalize ( nu ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["LAMP_TYPE","SPOT",{type:"equal_expr",e:2}],f:[{type:"textline",a:"fj = u_light_directions [ LAMP_IND ] ; eX = dot ( nu , fj ) ; eX *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eX - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; nw *= eX ;".split(" ")}]}]}]},
{type:"node_else",f:[{type:"textline",a:"nu = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"ny",qualifier:["vec3"],c:!1},{type:"node_in",name:"nz",qualifier:["vec2"],c:!1},{type:"node_in",name:"nA",qualifier:["vec3"],c:!1},{type:"node_in",name:"nB",qualifier:["float"],c:!1},{type:"node_in",name:"nC",qualifier:["vec2"],c:!1},{type:"node_out",name:"nD",qualifier:["float"],c:!1}],f:[{type:"textline",a:"nD = ZERO_VALUE_NODES ; if ( nz . r != ZERO_VALUE_NODES ) { eX = ( UNITY_VALUE_NODES - nB ) * dot ( nA , ny ) + nB ; if ( nC [ 0 ] == ZERO_VALUE_NODES ) { nD = UNITY_VALUE_NODES ; } else { eX = UNITY_VALUE_NODES + abs ( eX ) ; eX = nC [ 1 ] + ( UNITY_VALUE_NODES - nC [ 1 ] ) * pow ( eX , nC [ 0 ] ) ; nD = clamp ( eX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } nD = max ( nD , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"nE",qualifier:["vec3"],c:!1},{type:"node_in",name:"nF",qualifier:["vec2"],c:!1},{type:"node_in",name:"nG",qualifier:["vec3"],c:!1},{type:"node_in",name:"nH",qualifier:["float"],c:!1},{type:"node_out",name:"nI",qualifier:["float"],c:!1}],f:[{type:"textline",a:"nI = ZERO_VALUE_NODES ; if ( nF . r != ZERO_VALUE_NODES ) { eX = ( UNITY_VALUE_NODES - nH ) * dot ( nG , nE ) + nH ; nI = max ( eX , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"nJ",qualifier:["vec3"],c:!1},{type:"node_in",name:"nK",qualifier:["vec2"],c:!1},{type:"node_in",name:"nL",qualifier:["vec3"],c:!1},{type:"node_in",name:"nM",qualifier:["float"],c:!1},{type:"node_in",name:"nN",qualifier:["vec2"],c:!1},{type:"node_out",name:"nO",qualifier:["float"],c:!1}],f:[{type:"textline",a:"nO = ZERO_VALUE_NODES ; if ( nK . r != ZERO_VALUE_NODES ) { eX = ( UNITY_VALUE_NODES - nM ) * dot ( nL , nJ ) + nM ; if ( nN [ 0 ] > ZERO_VALUE_NODES ) { eY = max ( dot ( nL , eM ) , ZERO_VALUE_NODES ) ; eZ = nN [ 0 ] * nN [ 0 ] ; e_ = UNITY_VALUE_NODES - eh * ( eZ / ( eZ + 0.33 ) ) ; fj = nJ - eX * nL ; fl = eM - eY * nL ;".split(" ")},
{type:"textline",a:"if ( length ( fj ) == ZERO_VALUE_NODES || length ( fl ) == ZERO_VALUE_NODES || abs ( eX ) > UNITY_VALUE_NODES || abs ( eY ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",a:"nO = eX * e_ ; else { fa = acos ( eX ) ; eY = acos ( eY ) ; fj = normalize ( fj ) ; fl = normalize ( fl ) ; fb = max ( fa , eY ) ; fc = min ( fa , eY ) ; fc *= 0.95 ; eY = max ( dot ( fj , fl ) , ZERO_VALUE_NODES ) ; eZ = 0.45 * ( eZ / ( eZ + 0.09 ) ) ; nO = eX * ( e_ + ( eZ * eY * sin ( fb ) * tan ( fc ) ) ) ; } } else nO = eX ; nO = max ( nO , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"nP",qualifier:["vec3"],c:!1},{type:"node_in",name:"nQ",qualifier:["vec2"],c:!1},{type:"node_in",name:"nR",qualifier:["vec3"],c:!1},{type:"node_in",name:"nS",qualifier:["float"],c:!1},{type:"node_in",name:"nT",qualifier:["vec2"],c:!1},{type:"node_out",name:"nU",qualifier:["float"],c:!1}],f:[{type:"textline",a:"nU = ZERO_VALUE_NODES ; if ( nQ . r != ZERO_VALUE_NODES ) { eX = ( UNITY_VALUE_NODES - nS ) * dot ( nR , nP ) + nS ; fc = max ( dot ( nR , eM ) , ZERO_VALUE_NODES ) ; if ( nT [ 0 ] <= UNITY_VALUE_NODES ) nU = eX * pow ( max ( fc * eX , 0.1 ) , nT [ 0 ] - UNITY_VALUE_NODES ) ; else nU = eX * pow ( 1.0001 - fc , nT [ 0 ] - UNITY_VALUE_NODES ) ; nU = max ( nU , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"nV",qualifier:["vec3"],c:!1},{type:"node_in",name:"nW",qualifier:["vec2"],c:!1},{type:"node_in",name:"nX",qualifier:["vec3"],c:!1},{type:"node_in",name:"nY",qualifier:["float"],c:!1},{type:"node_in",name:"nZ",qualifier:["vec2"],c:!1},{type:"node_out",name:"n_",qualifier:["float"],c:!1}],f:[{type:"textline",a:"n_ = ZERO_VALUE_NODES ; if ( nW . r != ZERO_VALUE_NODES ) { fc = ( UNITY_VALUE_NODES - nY ) * dot ( nX , nV ) + nY ; fc = acos ( fc ) ; if ( fc < nZ [ 0 ] ) n_ = UNITY_VALUE_NODES ; else if ( fc > ( nZ [ 0 ] + nZ [ 1 ] ) || nZ [ 1 ] == ZERO_VALUE_NODES ) n_ = ZERO_VALUE_NODES ; else n_ = UNITY_VALUE_NODES - ( ( fc - nZ [ 0 ] ) / nZ [ 1 ] ) ; n_ = max ( n_ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"oa",qualifier:["vec3"],c:!1},{type:"node_in",name:"ob",qualifier:["vec2"],c:!1},{type:"node_in",name:"oc",qualifier:["vec3"],c:!1},{type:"node_in",name:"od",qualifier:["float"],c:!1},{type:"node_in",name:"oe",qualifier:["vec2"],c:!1},{type:"node_out",name:"of",qualifier:["float"],c:!1}],f:[{type:"textline",a:"of = ZERO_VALUE_NODES ; if ( ob . g == UNITY_VALUE_NODES ) { fl = normalize ( oa + eM ) ; of = ( UNITY_VALUE_NODES - od ) * max ( dot ( oc , fl ) , ZERO_VALUE_NODES ) + od ; of = pow ( of , oe [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"og",qualifier:["vec3"],c:!1},{type:"node_in",name:"oh",qualifier:["vec2"],c:!1},{type:"node_in",name:"oi",qualifier:["vec3"],c:!1},{type:"node_in",name:"oj",qualifier:["vec2"],c:!1},{type:"node_out",name:"ok",qualifier:["float"],c:!1}],f:[{type:"textline",a:"ok = ZERO_VALUE_NODES ; if ( oh . g == UNITY_VALUE_NODES ) { fl = normalize ( og + eM ) ; fc = max ( dot ( oi , fl ) , 0.001 ) ;".split(" ")},{type:"textline",a:"eX = max ( dot ( oi , eM ) , 0.01 ) ; fb = max ( dot ( oi , og ) , 0.01 ) ; fc = tan ( acos ( fc ) ) ; eY = max ( oj [ 0 ] , 0.001 ) ; ok = fb * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * eY * eY ) ) * ( exp ( - ( fc * fc ) / ( eY * eY ) ) / ( sqrt ( eX * fb ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"ol",qualifier:["vec3"],c:!1},{type:"node_in",name:"om",qualifier:["vec2"],c:!1},{type:"node_in",name:"on",qualifier:["vec3"],c:!1},{type:"node_in",name:"oo",qualifier:["vec2"],c:!1},{type:"node_out",name:"op",qualifier:["float"],c:!1}],f:[{type:"textline",a:"op = ZERO_VALUE_NODES ; if ( om . g == UNITY_VALUE_NODES ) { fl = normalize ( ol + eM ) ; fb = acos ( dot ( fl , on ) ) ; if ( fb < oo [ 0 ] ) op = UNITY_VALUE_NODES ; else if ( fb >= oo [ 0 ] + oo [ 1 ] || oo [ 1 ] == ZERO_VALUE_NODES ) op = ZERO_VALUE_NODES ; else op = UNITY_VALUE_NODES - ( fb - oo [ 0 ] ) / oo [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"oq",qualifier:["vec3"],c:!1},{type:"node_in",name:"or",qualifier:["vec2"],c:!1},{type:"node_in",name:"os",qualifier:["vec3"],c:!1},{type:"node_in",name:"ot",qualifier:["float"],c:!1},{type:"node_in",name:"ou",qualifier:["vec2"],c:!1},{type:"node_out",name:"ov",qualifier:["float"],c:!1}],f:[{type:"textline",a:"ov = ZERO_VALUE_NODES ; if ( or . g == UNITY_VALUE_NODES ) { if ( ou [ 0 ] < UNITY_VALUE_NODES || ou [ 1 ] == ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { if ( ou [ 1 ] < 100.0 ) ou [ 1 ] = sqrt ( UNITY_VALUE_NODES / ou [ 1 ] ) ; else ou [ 1 ] = 10.0 / ou [ 1 ] ; fl = normalize ( eM + oq ) ; fb = ( UNITY_VALUE_NODES - ot ) * max ( dot ( os , fl ) , ZERO_VALUE_NODES ) + ot ; if ( fb < ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { eX = max ( dot ( os , eM ) , 0.01 ) ; eY = dot ( os , oq ) ; if ( eY <= 0.01 ) ov = ZERO_VALUE_NODES ; else { fc = max ( dot ( eM , fl ) , 0.01 ) ; eZ = UNITY_VALUE_NODES ; eX = ( 2.0 * fb * eX ) / fc ; eY = ( 2.0 * fb * eY ) / fc ; eY = min ( min ( eZ , eX ) , eY ) ; eX = sqrt ( pow ( ou [ 0 ] , 2.0 ) + pow ( fc , 2.0 ) - UNITY_VALUE_NODES ) ; fc = pow ( eX - fc , 2.0 ) / pow ( eX + fc , 2.0 ) * ( UNITY_VALUE_NODES + pow ( fc * ( eX + fc ) - UNITY_VALUE_NODES , 2.0 ) / pow ( fc * ( eX - fc ) + UNITY_VALUE_NODES , 2.0 ) ) ; fb = acos ( fb ) ; ov = max ( fc * eY * exp ( - pow ( fb , 2.0 ) / ( 2.0 * pow ( ou [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"ow",qualifier:["vec4"],c:!1},{type:"node_in",name:"ox",qualifier:["vec3"],c:!1},{type:"node_in",name:"oy",qualifier:["float"],c:!1},{type:"node_in",name:"oz",qualifier:["float"],c:!1},{type:"node_in",name:"oA",qualifier:["vec3"],c:!1},{type:"node_in",name:"oB",qualifier:["vec3"],c:!1},{type:"node_in",name:"oC",qualifier:["vec4"],c:!1},{type:"node_in",name:"oD",qualifier:["vec3"],c:!1},{type:"node_in",name:"oE",qualifier:["vec3"],c:!1},{type:"node_in",
name:"oF",qualifier:["vec3"],c:!1},{type:"node_in",name:"oG",qualifier:["float"],c:!1},{type:"node_out",name:"oH",qualifier:["vec4"],c:!1},{type:"node_out",name:"oI",qualifier:["vec3"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_NODE_B4W_TRANSLUCENCY"],f:[{type:"textline",a:"if ( dot ( oA , oB ) * dot ( eM , oB ) < ZERO_VALUE_NODES ) { fb = oC . x ; eY = oC . y ; fc = oC . z ; eX = oC . w ;".split(" ")},{type:"textline",a:"eZ = clamp ( abs ( dot ( oA , oB ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; e_ = clamp ( dot ( eM , - oA ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = pow ( e_ , eY ) ;".split(" ")},
{type:"textline",a:"oH = ow + oG * vec4 ( oF * eZ * pow ( oD , vec3 ( fb ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",a:"oH += fc * mix ( vec4 ( oD , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , eX ) * oG * vec4 ( oF * eZ * vec3 ( eY ) , UNITY_VALUE_NODES ) ; oI = ox ; } else {".split(" ")},{type:"textline",a:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ; }".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ;".split(" ")}]}]}]},
{type:"node",name:"RGB",h:[{type:"node_out",name:"oJ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"oJ = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",h:[{type:"node_in",name:"oK",qualifier:["vec3"],c:!1},{type:"node_out",name:"oL",qualifier:["float"],c:!1}],f:[{type:"textline",a:"oL = dot ( oK , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",h:[{type:"node_in",name:"oM",qualifier:["vec3"],c:!1},{type:"node_out",name:"oN",qualifier:["float"],c:!0},
{type:"node_out",name:"oO",qualifier:["float"],c:!0},{type:"node_out",name:"oP",qualifier:["float"],c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_oN"],f:[{type:"textline",a:"oN = oM . r ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_oO"],f:[{type:"textline",a:"oO = oM . g ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_oP"],f:[{type:"textline",a:"oP = oM . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",h:[{type:"node_in",name:"oQ",
qualifier:["vec3"],c:!1},{type:"node_out",name:"oR",qualifier:["float"],c:!0},{type:"node_out",name:"oS",qualifier:["float"],c:!0},{type:"node_out",name:"oT",qualifier:["float"],c:!0}],f:[{type:"textline",a:"fl = eq ( oQ ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_oR"],f:[{type:"textline",a:"oR = fl . r ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_oS"],f:[{type:"textline",a:"oS = fl . g ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",
d:["USE_OUT_oT"],f:[{type:"textline",a:"oT = fl . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",h:[{type:"node_in",name:"oU",qualifier:["float"],c:!1},{type:"node_in",name:"oV",qualifier:["float"],c:!1},{type:"node_in",name:"oW",qualifier:["float"],c:!1},{type:"node_out",name:"oX",qualifier:["float"],c:!1}],f:[{type:"textline",a:"oX = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( oU - oW ) * oV ) ) ;".split(" ")}]},{type:"node",name:"GAMMA",h:[{type:"node_in",name:"oY",qualifier:["vec3"],
c:!1},{type:"node_in",name:"oZ",qualifier:["float"],c:!1},{type:"node_out",name:"o_",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"o_ = oY ; if ( o_ . x > ZERO_VALUE_NODES ) o_ . x = pow ( oY . x , oZ ) ; if ( o_ . y > ZERO_VALUE_NODES ) o_ . y = pow ( oY . y , oZ ) ; if ( o_ . z > ZERO_VALUE_NODES ) o_ . z = pow ( oY . z , oZ ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",h:[{type:"node_in",name:"pa",qualifier:["vec3"],c:!1},{type:"node_out",name:"pb",qualifier:["vec3"],c:!1}],f:[{type:"textline",
a:"pb = max ( vec3 ( ZERO_VALUE_NODES ) , pa ) ; pb = pow ( pb , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",h:[{type:"node_in",name:"pc",qualifier:["vec3"],c:!1},{type:"node_out",name:"pd",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"pd = max ( vec3 ( ZERO_VALUE_NODES ) , pc ) ; pd = pow ( pd , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",h:[{type:"node_out",name:"pe",qualifier:["vec3"],c:!1},{type:"node_out",name:"pf",qualifier:["vec3"],
c:!1},{type:"node_out",name:"pg",qualifier:["float"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pe"],f:[{type:"textline",a:"pe [ 2 ] = pe [ 1 ] = pe [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pf"],f:[{type:"textline",a:"pf [ 2 ] = pf [ 1 ] = pf [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pg"],f:[{type:"textline",a:["pg","=","ZERO_VALUE_NODES",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",
h:[{type:"node_in",name:"ph",qualifier:["vec3"],c:!1},{type:"node_out",name:"pi",qualifier:["vec3"],c:!0},{type:"node_out",name:"pj",qualifier:["float"],c:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"],c:!1}],f:[{type:"textline",a:"fe = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , ph ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pi"],f:[{type:"textline",a:"pi = fe . xyz ; br ( pi ) ;".split(" ")}]}]},{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_pj"],f:[{type:"textline",a:"pj = fe . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",h:[{type:"node_in",name:"pk",qualifier:["vec3"],c:!0},{type:"node_in",name:"pl",qualifier:["vec3"],c:!0},{type:"node_in",name:"pm",qualifier:["vec3"],c:!0},{type:"node_in",name:"pn",qualifier:["vec3"],c:!0},{type:"node_out",name:"po",qualifier:["vec3"],c:!0},{type:"node_out",name:"pp",qualifier:["float"],c:!0},{type:"node_out",name:"pq",qualifier:["vec3"],c:!0},{type:"node_out",
name:"pr",qualifier:["float"],c:!0},{type:"node_out",name:"ps",qualifier:["vec3"],c:!0},{type:"node_out",name:"pt",qualifier:["float"],c:!0},{type:"node_out",name:"pu",qualifier:["vec3"],c:!0},{type:"node_out",name:"pv",qualifier:["float"],c:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"],c:!1}],f:[{type:"textline",a:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pk ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_po"],
f:[{type:"textline",a:"po = fe . xyz ; br ( po ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pp"],f:[{type:"textline",a:"pp = fe . w ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv2"],f:[{type:"textline",a:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pl ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pq"],f:[{type:"textline",a:"pq = fe . xyz ; br ( pq ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",
d:["USE_OUT_pr"],f:[{type:"textline",a:"pr = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv3"],f:[{type:"textline",a:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pm ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_ps"],f:[{type:"textline",a:"ps = fe . xyz ; br ( ps ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pt"],f:[{type:"textline",a:"pt = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",
d:["USE_uv4"],f:[{type:"textline",a:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pn ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pu"],f:[{type:"textline",a:"pu = fe . xyz ; br ( pu ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pv"],f:[{type:"textline",a:"pv = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",h:[{type:"node_in",name:"pw",qualifier:["vec3"],c:!0},{type:"node_in",name:"px",qualifier:["vec3"],c:!0},{type:"node_in",
name:"py",qualifier:["vec3"],c:!0},{type:"node_in",name:"pz",qualifier:["vec3"],c:!0},{type:"node_out",name:"pA",qualifier:["vec3"],c:!0},{type:"node_out",name:"pB",qualifier:["float"],c:!0},{type:"node_out",name:"pC",qualifier:["vec3"],c:!0},{type:"node_out",name:"pD",qualifier:["float"],c:!0},{type:"node_out",name:"pE",qualifier:["vec3"],c:!0},{type:"node_out",name:"pF",qualifier:["float"],c:!0},{type:"node_out",name:"pG",qualifier:["vec3"],c:!0},{type:"node_out",name:"pH",qualifier:["float"],c:!0},
{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"],c:!1}],f:[{type:"textline",a:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pw ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pA"],f:[{type:"textline",a:"pA = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pB"],f:[{type:"textline",a:"pB = fe . w ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv2"],
f:[{type:"textline",a:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( px ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pC"],f:[{type:"textline",a:"pC = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pD"],f:[{type:"textline",a:"pD = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv3"],f:[{type:"textline",a:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( py ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pE"],f:[{type:"textline",a:"pE = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pF"],f:[{type:"textline",a:"pF = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv4"],f:[{type:"textline",a:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pz ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pG"],f:[{type:"textline",a:"pG = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pH"],f:[{type:"textline",a:"pH = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",h:[{type:"node_out",name:"pI",qualifier:["float"],c:!1}],f:[{type:"textline",a:"pI = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",h:[{type:"node_in",name:"pJ",qualifier:["vec3"],c:!1},{type:"node_in",name:"pK",qualifier:["vec3"],c:!1},{type:"node_out",name:"pL",qualifier:["vec3"],c:!1},{type:"node_out",name:"pM",qualifier:["float"],
c:!0}],f:[{type:"textline",a:"pL = pJ + pK ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pM"],f:[{type:"textline",a:"pM = ( abs ( pL [ 0 ] ) + abs ( pL [ 1 ] ) + abs ( pL [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",h:[{type:"node_in",name:"pN",qualifier:["vec3"],c:!1},{type:"node_in",name:"pO",qualifier:["vec3"],c:!1},{type:"node_out",name:"pP",qualifier:["vec3"],c:!1},{type:"node_out",name:"pQ",qualifier:["float"],c:!0}],f:[{type:"textline",
a:"pP = pN - pO ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pQ"],f:[{type:"textline",a:"pQ = ( abs ( pP [ 0 ] ) + abs ( pP [ 1 ] ) + abs ( pP [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",h:[{type:"node_in",name:"pR",qualifier:["vec3"],c:!1},{type:"node_in",name:"pS",qualifier:["vec3"],c:!1},{type:"node_out",name:"pT",qualifier:["vec3"],c:!1},{type:"node_out",name:"pU",qualifier:["float"],c:!0}],f:[{type:"textline",a:"pT = pR + pS ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pU"],f:[{type:"textline",a:"pU = length ( pT ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pT"],f:[{type:"textline",a:"pT = normalize ( pT ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",h:[{type:"node_in",name:"pV",qualifier:["vec3"],c:!1},{type:"node_in",name:"pW",qualifier:["vec3"],c:!1},{type:"node_out",name:"pX",qualifier:["vec3"],c:!1},{type:"node_out",name:"pY",qualifier:["float"],c:!0}],f:[{type:"textline",
a:"pX = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_pY"],f:[{type:"textline",a:"pY = dot ( pV , pW ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",h:[{type:"node_in",name:"pZ",qualifier:["vec3"],c:!1},{type:"node_in",name:"p_",qualifier:["vec3"],c:!1},{type:"node_out",name:"qa",qualifier:["vec3"],c:!1},{type:"node_out",name:"qb",qualifier:["float"],c:!0}],f:[{type:"textline",a:"qa = cross ( pZ , p_ ) ;".split(" ")},{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_qb"],f:[{type:"textline",a:"qb = length ( qa ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",h:[{type:"node_in",name:"qc",qualifier:["vec3"],c:!1},{type:"node_in",name:"qd",qualifier:["vec3"],c:!1},{type:"node_out",name:"qe",qualifier:["vec3"],c:!1},{type:"node_out",name:"qf",qualifier:["float"],c:!0}],f:[{type:"textline",a:"qe = normalize ( qc ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_qf"],f:[{type:"textline",a:"qf = length ( qc ) ;".split(" ")}]}]},
{type:"textline",a:["qd",";"]}]},{type:"node",name:"B4W_REFLECT",h:[{type:"node_in",name:"qg",qualifier:["vec3"],c:!1},{type:"node_in",name:"qh",qualifier:["vec3"],c:!1},{type:"node_out",name:"qi",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"qi = reflect ( - qg , qh ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",h:[{type:"node_in",name:"qj",qualifier:["vec3"],c:!1},{type:"node_in",name:"qk",qualifier:["float"],c:!1},{type:"node_in",name:"ql",qualifier:["const","float"],c:!1},{type:"node_in",
name:"qm",qualifier:["const","float"],c:!1},{type:"node_out",name:"qn",qualifier:["vec3"],c:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"],c:!1}],f:[{type:"textline",a:"eY = length ( fd ) ; if ( eY < qm ) { eT = ey ( qj ) ; eY = clamp ( eh * ( qm - eY ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = qk * eY ;".split(" ")},{type:"textline",a:"fl = normalize ( eM * ff ) ;".split(" ")},{type:"textline",a:"eZ = UNITY_VALUE_NODES / ql ;".split(" ")},{type:"textline",
a:"eU = fl . xy * eY / ( ql * fl . z ) ; eY = UNITY_VALUE_NODES ; eX = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ;".split(" ")},{type:"textline",a:"for ( float qo = 1.0 ; qo <= ql ; qo ++ ) { if ( eX < eY ) { eY -= eZ ; eT -= eU ; eX = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ; } }".split(" ")},{type:"textline",a:"eU = eT + eU ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eU ) . a - ( eY + eZ ) ; eY = eX - eY ; eZ = eY / ( eY - eZ ) ;".split(" ")},{type:"textline",a:"eT = eZ * eU + ( UNITY_VALUE_NODES - eZ ) * eT ; qn = ew ( eT ) ; } else qn = qj ;".split(" ")}]},
{type:"node",name:"B4W_CLAMP",h:[{type:"node_in",name:"qp",qualifier:["vec3"],c:!1},{type:"node_out",name:"qq",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"qq = clamp ( qp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",h:[{type:"node_in",name:"qr",qualifier:["vec3"],c:!1},{type:"node_in",name:"qs",qualifier:["float"],c:!1},{type:"node_out",name:"qt",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"qt = el ( qr , qs ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",h:[{type:"node_in",name:"qu",qualifier:["float"],c:!1},{type:"node_in",name:"qv",qualifier:["float"],c:!1},{type:"node_in",name:"qw",qualifier:["float"],c:!1},{type:"node_in",name:"qx",qualifier:["float"],c:!1},{type:"node_in",name:"qy",qualifier:["float"],c:!1},{type:"node_out",name:"qz",qualifier:["float"],c:!0},{type:"node_out",name:"qA",qualifier:["vec4"],c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_qz"],f:[{type:"textline",a:["qz","=","qu",";"]}]}]},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_qA"],f:[{type:"textline",a:"qA = vec4 ( qv , qw , qx , qy ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",h:[{type:"node_out",name:"qB",qualifier:["float"],c:!1}],f:[{type:"textline",a:["qB","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",h:[{type:"node_in",name:"qC",qualifier:["float"],c:!1},{type:"node_in",name:"qD",qualifier:["float"],c:!1},{type:"node_in",name:"qE",qualifier:["float"],c:!1},{type:"node_out",name:"qF",qualifier:["float"],
c:!1}],f:[{type:"textline",a:"qF = smoothstep ( qD , qE , qC ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",h:[{type:"node_in",name:"qG",qualifier:["vec3"],c:!1},{type:"node_in",name:"qH",qualifier:["float"],c:!1}],f:[{type:"textline",a:"eO = qG ; eS = qH ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",h:[{type:"node_in",name:"qI",qualifier:["vec3"],c:!1},{type:"node_out",name:"qJ",qualifier:["float"],c:!1}],f:[{type:"textline",a:"qJ = ( qI . r + qI . g + qI . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",h:[{type:"node_in",name:"qK",qualifier:["float"],c:!1},{type:"node_out",name:"qL",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"qL [ 0 ] = qK ; qL [ 1 ] = qK ; qL [ 2 ] = qK ;".split(" ")}]},{type:"nodes_global"},{type:"textline",a:"void qM ( in vec3 eM , in mat4 eN , out vec3 eO , out vec3 eP , out vec3 eQ , out vec4 eR , out float eS ) { vec2 eT , eU ; float eV , eW , eX , eY , eZ , e_ , fa , fb , fc ; vec4 fd , fe ; mat3 ff ; vec3 fg , fh , fi , fj , fk , fl ; eO = vec3 ( ZERO_VALUE_NODES ) ; eP = vec3 ( ZERO_VALUE_NODES ) ; eQ = vec3 ( ZERO_VALUE_NODES ) ; eR = vec4 ( ZERO_VALUE_NODES ) ; eS = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",e:5}],group:{type:"group",b:[{type:"textline",a:"fg = normalize ( bE ) ; fh = fg ;".split(" ")},{type:"condition",b:[{type:"if",d:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["INVERT_FRONTFACING"],group:{type:"group",b:[{type:"textline",a:["if","(","!",
"gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",a:"fh = fh ; else fh = - fh ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",b:[{type:"textline",a:["fi","=","fh",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["fi","=","fg",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_GEOMETRY_NO"],group:{type:"group",b:[{type:"textline",a:["fg","=",
"fh",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:"fj = cross ( fh , bF . xyz ) * bF . w ; ff = mat3 ( bF . xyz , fj , fh ) ; ff = ff ;".split(" ")}]}}]},{type:"textline",a:"fh = bC ; fd = bD ; eV = u_emit ; eW = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",a:["}"]}]};a["include/to_world.glslv"]={type:"group",b:[{type:"define",name:"M_PI",a:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",a:["(","M_PI",
"/","4.0",")"]},{type:"textline",a:"const vec3 qN = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",e:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",e:2},{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"mat4 qT ( vec3 qO , mat4 qP ) { vec3 qQ , qR , qS ; qQ = vec3 ( qP [ 0 ] [ 0 ] , qP [ 1 ] [ 0 ] , qP [ 2 ] [ 0 ] ) ; qR = vec3 ( qP [ 0 ] [ 1 ] , qP [ 1 ] [ 1 ] , qP [ 2 ] [ 1 ] ) ; qS = vec3 ( qP [ 0 ] [ 2 ] , qP [ 1 ] [ 2 ] , qP [ 2 ] [ 2 ] ) ; qR = cross ( qS , qQ ) ; return mat4 ( vec4 ( qQ , 0.0 ) , vec4 ( qR , 0.0 ) , vec4 ( qS , 0.0 ) , vec4 ( qO , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"mat4 qZ ( vec3 qU , vec3 qV ) { vec3 qW , qX , qY ; qW = qU - qV ; qW . y = 0.0 ; qW = normalize ( qW ) ; qX = normalize ( cross ( qN , qW ) ) ; qY = normalize ( cross ( qW , qX ) ) ; return mat4 ( vec4 ( qX , 0.0 ) , vec4 ( qY , 0.0 ) , vec4 ( qW , 0.0 ) , vec4 ( qV , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["BILLBOARD_JITTERED"],group:{type:"group",b:[{type:"textline",a:"mat4 rg ( in vec3 q_ , float ra , float rb , float rc , vec3 rd ) { float re , rf ; re = fract ( length ( rd ) / 0.17 ) ; rf = rc + re / 10.0 ; re = re ; if ( rc != 0.0 ) re /= rc ; q_ *= 1.0 + 0.5 * sin ( ra ) ; re = length ( q_ ) * rb * sin ( 2.0 * 3.14 * ra * rf + re ) ; return C ( re ) ; }".split(" ")}]}}]},
{type:"textline",a:"mat4 ro ( in vec3 rh , in vec3 ri , in mat4 rj ) { vec3 rk ; float rl , rm ; mat4 rn ;".split(" ")},{type:"condition",b:[{type:"if",d:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",e:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",e:2},{type:"logical_and_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"rn = qT ( ri , rj ) ;".split(" ")}]}},{type:"elif",d:["BILLBOARD_RANDOM"],group:{type:"group",b:[{type:"textline",
a:"rl = fract ( ( ri . x * 1.43 + ri . y * 0.123 + ri . z * 6.1 ) ) ; rl = 2.0 * M_PI * rl ; rk = normalize ( vec3 ( rj [ 0 ] [ 2 ] , 0.0 , rj [ 2 ] [ 2 ] ) ) ; rm = acos ( rk [ 2 ] ) ; if ( rk [ 0 ] < 0.0 ) rm = 2.0 * M_PI - rm ; rm = rm - rl ; if ( rm < 0.0 ) rm = 2.0 * M_PI + rm ; rl = rl ; if ( rm <= MAX_BILLBOARD_ANGLE ) rl += rm ; else if ( rm <= M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( rm <= M_PI + MAX_BILLBOARD_ANGLE ) rl += rm - M_PI ; else if ( rm <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else rl += rm - 2.0 * M_PI ; rn = A ( rl ) ; rn [ 3 ] = vec4 ( ri , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"rn = qZ ( rh , ri ) ;".split(" ")}]}}]},{type:"textline",a:["return","rn",";","}"]},{type:"condition",b:[{type:"if",d:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"mat4 ru ( in vec3 rp , in vec3 rq , in mat4 rr , mat4 rs ) { mat4 rt ; rt = ro ( rp , rq , rr ) ; rs [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; rt = rt * rs ; return rt ; }".split(" ")}]}}]},
{type:"textline",a:"c rB ( in vec3 rv , in vec3 rw , in vec3 rx , in vec3 ry , in vec3 rz , in mat4 rA ) { rv = ( rA * vec4 ( rv , 1.0 ) ) . xyz ; rw = ( rA * vec4 ( rw , 1.0 ) ) . xyz ; rx = ( rA * vec4 ( rx , 0.0 ) ) . xyz ; ry = ( rA * vec4 ( ry , 0.0 ) ) . xyz ; rz = ( rA * vec4 ( rz , 0.0 ) ) . xyz ; return E ( c ( rv , rw , rx , ry , rz , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",b:[{type:"textline",a:"vec2 rE ( vec2 rC , vec3 rD ) { return ( rC + 0.5 ) * rD . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",b:[{type:"define",name:"SKIN_SLERP",a:["0"]},{type:"condition",b:[{type:"if",d:["SKINNED"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["SKIN_SLERP"],group:{type:"group",b:[{type:"textline",a:"vec4 rL ( in vec4 rF , in vec4 rG , in float rH ) { float rI , rJ , rK ; rI = rF [ 0 ] * rG [ 0 ] + rF [ 1 ] * rG [ 1 ] + rF [ 2 ] * rG [ 2 ] + rF [ 3 ] * rG [ 3 ] ; if ( rI < 0.0 ) { rG *= - 1.0 ; rI = - rI ; } if ( abs ( rI ) >= 1.0 ) return rF ; rJ = acos ( rI ) ; rI = sqrt ( 1.0 - rI * rI ) ; if ( abs ( rI ) < 0.001 ) return vec4 ( rF * 0.5 + rG * 0.5 ) ; rK = sin ( ( 1.0 - rH ) * rJ ) / rI ; rI = sin ( rH * rJ ) / rI ; return rF * rK + rG * rI ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["FRAMES_BLENDING"],group:{type:"group",b:[{type:"textline",a:"vec3 rX ( in vec3 rM , in vec4 rN , in vec4 rO , in vec4 rP , in vec4 rQ , in float rR ) { vec4 rS , rT ; vec3 rU , rV , rW ; rU = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rM , 1.0 ) ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["SKIN_SLERP"],group:{type:"group",b:[{type:"textline",a:"rS = rL ( rN , rO , rR ) ; rT = mix ( rP , rQ , rR ) ; rV = i ( rS , rU ) ; rV = rV * rT . w + rT . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",b:[{type:"textline",a:"rW = i ( rN , rU ) ; rU = i ( rO , rU ) ; rW = rW * rP . w + rP . xyz ; rU = rU * rQ . w + rQ . xyz ; rV = mix ( rW , rU , rR ) ;".split(" ")}]}}]},{type:"textline",a:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rV , 1.0 ) ) ; } vec3 sf ( in vec3 rY , in vec4 rZ , in vec4 r_ , in float sa ) { vec4 sb ; vec3 sc , sd , se ; sc = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rY , 0.0 ) ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["SKIN_SLERP"],
group:{type:"group",b:[{type:"textline",a:"sb = rL ( rZ , r_ , sa ) ; sd = i ( sb , sc ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"se = i ( rZ , sc ) ; sc = i ( r_ , sc ) ; sd = mix ( se , sc , sa ) ;".split(" ")}]}}]},{type:"textline",a:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sd , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vec3 rX ( in vec3 sg , in vec4 sh , in vec4 si ) { vec3 sj ; sj = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sg , 1.0 ) ) ; sj = i ( sh , sj ) ; sj = sj * si . w + si . xyz ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sj , 1.0 ) ) ; } vec3 sf ( in vec3 sk , in vec4 sl ) { vec3 sm ; sm = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sk , 0.0 ) ) ; sm = i ( sl , sm ) ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sm , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",a:"void sB ( inout vec3 sn , inout vec3 so , inout vec3 sp , inout vec3 sq ) { int sr , ss ; vec4 st ; vec3 su , sv , sw , sx ; float sy , sz ;".split(" ")},{type:"condition",b:[{type:"if",d:["FRAMES_BLENDING"],group:{type:"group",b:[{type:"textline",a:["sy","=","u_frame_factor",";"]}]}}]},{type:"textline",a:"if ( a_influence . y > 0.0 ) { su = vec3 ( 0.0 , 0.0 , 0.0 ) ; sv = vec3 ( 0.0 , 0.0 , 0.0 ) ; sw = vec3 ( 0.0 , 0.0 , 0.0 ) ; sx = vec3 ( 0.0 , 0.0 , 0.0 ) ; st = a_influence ; for ( int sA = 0 ; sA < 4 ; sA ++ ) { sr = int ( st [ sA ] ) ; sz = fract ( st [ sA ] ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FRAMES_BLENDING"],group:{type:"group",b:[{type:"textline",a:"su += sz * rX ( sn , u_quatsb [ sr ] , u_quatsa [ sr ] , u_transb [ sr ] , u_transa [ sr ] , sy ) ; sv += sz * sf ( so , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sw += sz * sf ( sp , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sx += sz * sf ( sq , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"su += sz * rX ( sn , u_quatsb [ sr ] , u_transb [ sr ] ) ; sx += sz * sf ( sq , u_quatsb [ sr ] ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"sv += sz * sf ( so , u_quatsb [ sr ] ) ; sw += sz * sf ( sp , u_quatsb [ sr ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",a:"} sn = su ; sq = sx ;".split(" ")},{type:"condition",b:[{type:"if",d:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"so = sv ; sp = sw ;".split(" ")}]}}]},{type:"textline",a:"} if ( ! ( a_influence . y > 0.0 ) ) { ss = int ( a_influence [ 0 ] - 1.0 ) ; if ( ss > - 1 ) {".split(" ")},
{type:"condition",b:[{type:"if",d:["FRAMES_BLENDING"],group:{type:"group",b:[{type:"textline",a:"sn = rX ( sn , u_quatsb [ ss ] , u_quatsa [ ss ] , u_transb [ ss ] , u_transa [ ss ] , sy ) ; so = sf ( so , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sp = sf ( sp , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sq = sf ( sq , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"sn = rX ( sn , u_quatsb [ ss ] , u_transb [ ss ] ) ; sq = sf ( sq , u_quatsb [ ss ] ) ;".split(" ")},
{type:"condition",b:[{type:"if",d:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",e:1}],group:{type:"group",b:[{type:"textline",a:"so = sf ( so , u_quatsb [ ss ] ) ; sp = sf ( sp , u_quatsb [ ss ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",a:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",b:[{type:"condition",b:[{type:"if",d:["WIND_BEND"],group:{type:"group",b:[{type:"textline",a:"void sM ( inout vec3 sC , in vec3 sD , in float sE , in float sF , in float sG , in vec3 sH , in float sI ) { vec3 sJ ; float sK , sL ; sK = length ( sD ) ; sL = sF * ( 1.0 + 0.1 * fract ( sK ) ) ; sK = sE * sI * ( 1.0 + sin ( 2.0 * 3.14 * sG * sL + sK ) ) ; sL = ( sC . y - sD . y ) * abs ( sK ) ; sL += 1.0 ; sL *= sL ; sL = sL * sL - sL ; sJ = sC ; sJ . xz += sH . xz * sL * sign ( sK ) ; sJ = sJ - sD ; if ( all ( equal ( sJ , vec3 ( 0.0 ) ) ) ) sC = sD ; else { sK = length ( sC - sD ) ; sC = sD + normalize ( sJ ) * sK ; } }".split(" ")},
{type:"condition",b:[{type:"if",d:["DETAIL_BEND"],group:{type:"group",b:[{type:"textline",a:"vec4 sO ( vec4 sN ) { return sN * sN * ( 3.0 - 2.0 * sN ) ; } vec4 sQ ( vec4 sP ) { return abs ( fract ( sP + 0.5 ) * 2.0 - 1.0 ) ; } vec4 sS ( vec4 sR ) { return sO ( sQ ( sR ) ) ; } void ti ( inout vec3 sT , in float sU , in vec3 sV , in vec3 sW , in vec3 sX , in float sY , in float sZ , in float s_ , in vec3 ta ) { vec3 tb ; vec4 tc ; vec2 td , te ; float tf , tg , th ; tf = dot ( sX , vec3 ( 1.0 ) ) ; tg = tf + ta . g ; th = dot ( sT , vec3 ( ta . g ) ) ; td = ( sU + vec2 ( th , tg ) ) ; tc = ( ( fract ( ( td . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( sW ) * sY ; tc = sS ( tc ) ; te = tc . xz + tc . yw ; te . y = 0.5 - te . y ; tb = te . xyx * ta . rbr * vec3 ( sZ * sV . x , s_ , sZ * sV . z ) ; sT += tb ; }".split(" ")}]}}]},
{type:"textline",a:"void tp ( inout vec3 tj , inout vec3 tk , in vec3 tl ) { vec3 tm , tn , to ; tm = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["BEND_CENTER_ONLY"],group:{type:"group",b:[{type:"textline",a:"tn = tk ; to = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"tn = tj ; to = tk ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["MAIN_BEND_COL"],group:{type:"group",b:[{type:"condition",b:[{type:"if",
d:["DETAIL_BEND"],group:{type:"group",b:[{type:"textline",a:"ti ( tn , u_time , tl , tm , to , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",a:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
b:[{type:"if",d:["BEND_CENTER_ONLY"],group:{type:"group",b:[{type:"textline",a:"tj += tn - tk ; tk = tn ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"tj = tn ; tk = to ;".split(" ")}]}}]},{type:"textline",a:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",b:[{type:"condition",b:[{type:"if",d:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",e:2},"PARTICLE_BATCH",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:"attribute vec3 a_orco_tex_coord ; varying vec3 eg ;".split(" ")}]}}]},{type:"node",name:"TEX_COORD_UV",h:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"],c:!1},{type:"node_param",name:"eG",qualifier:["varying","vec2"],c:!1}],f:[{type:"textline",a:["eG","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",h:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"],c:!1},{type:"node_param",name:"eF",
qualifier:["varying","vec2"],c:!1}],f:[{type:"textline",a:["eF","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",name:"UVMAP",h:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"],c:!1},{type:"node_param",name:"eH",qualifier:["varying","vec2"],c:!1}],f:[{type:"textline",a:["eH","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",h:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"],c:!1},{type:"node_param",name:"ez",qualifier:["varying",
"vec2"],c:!1}],f:[{type:"textline",a:["ez","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",h:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"],c:!1},{type:"node_param",name:"tq",qualifier:["varying","vec3"],c:!1}],f:[{type:"textline",a:["tq","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"],c:!1},{type:"node_param",
name:"tr",qualifier:["varying","float"],c:!1}],f:[{type:"textline",a:["tr","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",h:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"],c:!1},{type:"node_param",name:"ts",qualifier:["varying","vec2"],c:!1}],f:[{type:"textline",a:["ts","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",h:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",
qualifier:["attribute","vec3"],c:!1},{type:"node_param",name:"tt",qualifier:["varying","vec3"],c:!1}],f:[{type:"textline",a:["tt","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",a:["void","tu","(",")","{"]},{type:"condition",b:[{type:"if",d:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:["eg","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",a:["}"]}]};a["include/halo_color.glslf"]=
{type:"group",b:[{type:"var",name:"NUM_LINES",a:["0"]},{type:"var",name:"NUM_RINGS",a:["0"]},{type:"var",name:"NUM_STARS",a:["0"]},{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"condition",b:[{type:"if",d:["NUM_RINGS","NUM_LINES",{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"const int ty = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"const int ty = NUM_LINES ;".split(" ")}]}}]},{type:"textline",a:"float tA ( float tz ) { return tz - floor ( tz * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},
{type:"condition",b:[{type:"if",d:["NUM_RINGS"],group:{type:"group",b:[{type:"textline",a:"void tJ ( inout float tB , in float tC [ ty ] , in float tD ) { float tE , tF , tG , tH ; for ( int tI = 0 ; tI < NUM_RINGS ; tI ++ ) { tE = 40.0 * tC [ tI ] ; tF = 300.0 * ( tA ( tE ) - 0.005 ) ; tG = tE ; tH = abs ( tG * ( u_halo_size * tF - tD ) ) ; tB += 1.0 - min ( tH , 1.0 ) ; } }".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NUM_LINES"],group:{type:"group",b:[{type:"textline",a:"void tS ( inout float tK , in float tL [ ty ] , in float tM ) { float tN , tO , tP , tQ ; for ( int tR = 0 ; tR < NUM_LINES ; tR ++ ) { tN = tL [ tR ] ; tO = tN ; tP = 1000.0 * ( tA ( tN ) - 0.005 ) ; tQ = 20.0 * abs ( tO * bM . x + tP * bM . y ) ; tK += 1.0 - min ( tQ , 1.0 ) ; } tK *= tM ; }".split(" ")}]}}]},
{type:"textline",a:"void tZ ( inout float tT , in vec2 tU ) { float tV , tW , tX , tY ; tW = atan ( tU . y , tU . x ) ; tW *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; tX = cos ( tW ) ; tY = sin ( tW ) ; tW = ( tX * tU . x + tY * tU . y ) * ( tX * tU . y - tY * tU . x ) ; tV = abs ( tW ) ; if ( tV < 1.0 ) { tV = ( 0.01 * u_halo_size ) / ( tV ) ; tT *= sqrt ( min ( tV , 1.0 ) ) ; } } vec4 uh ( ) { vec4 t_ ; vec3 ua ; float ub , uc , ud , ue ; ub = ( bM . x * bM . x + bM . y * bM . y ) ; uc = sqrt ( ub ) ; ub = max ( 1.0 - ub , 0.0 ) ; ub = pow ( ub , u_halo_hardness ) ; ud = u_diffuse_color . a ;".split(" ")},
{type:"condition",b:[{type:"if",d:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"float uf [ ty ] ; for ( int ug = 0 ; ug < ty ; ug ++ ) { uf [ ug ] = fract ( tx / float ( ug + 1 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NUM_RINGS"],group:{type:"group",b:[{type:"textline",a:"ue = 0.0 ; tJ ( ue , uf , uc ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NUM_LINES"],group:{type:"group",b:[{type:"textline",a:"uc = 0.0 ; tS ( uc , uf , ub ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["NUM_STARS"],group:{type:"group",b:[{type:"textline",a:"tZ ( ub , bM ) ;".split(" ")}]}}]},{type:"textline",a:"ub *= ud ; ua = u_diffuse_color . rgb ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_RINGS"],group:{type:"group",b:[{type:"textline",a:"ue *= ub ; ua += u_halo_rings_color * ue ; ub += ue ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NUM_LINES"],group:{type:"group",b:[{type:"textline",a:"uc *= ud ; ua += u_halo_lines_color * uc ; ub += uc ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["SKY_STARS"],group:{type:"group",b:[{type:"textline",a:"ub *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",e:1},{type:"logical_and_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"uc = u_halo_stars_blend * ( tw . y - u_halo_stars_height ) ; ub *= clamp ( uc , 0.0 , 1.0 ) ; ub *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",a:"t_ = vec4 ( ua , ub ) ; return t_ ; }".split(" ")}]};a["include/fog.glslf"]={type:"group",b:[{type:"var",name:"WAVES_HEIGHT",a:["0.0"]},{type:"condition",b:[{type:"if",d:["USE_FOG"],group:{type:"group",b:[{type:"textline",a:"void uo ( inout vec3 ui , in float uj , in float uk , in vec4 ul ) { float um , un ; um = clamp ( ( uj - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["FOG_TYPE","QUADRATIC",{type:"equal_expr",e:2}],group:{type:"group",
b:[{type:"textline",a:["um","*=","um",";"]}]}},{type:"elif",d:["FOG_TYPE","LINEAR",{type:"equal_expr",e:2}],group:{type:"group",b:[]}},{type:"elif",d:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"um = sqrt ( um ) ;".split(" ")}]}}]},{type:"textline",a:"if ( u_fog_params . w > 0.0 ) { if ( uk > u_fog_params . w ) um = 0.0 ; else { un = ( u_fog_params . w - max ( uk , 0.0 ) ) / u_fog_params . w ; um *= un * un ; } } ul . a = 1.0 - ( 1.0 - um ) * ( 1.0 - u_fog_params . x ) ; ui = mix ( ui , ul . rgb , ul . a ) ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["PROCEDURAL_FOG"],group:{type:"group",b:[{type:"textline",a:"vec3 uu ( in mat4 up , in vec3 uq ) { vec3 ur , us , ut ; ur = mix ( up [ 0 ] . rgb , up [ 1 ] . rgb , max ( sign ( uq . x ) , 0.0 ) ) ; us = mix ( up [ 2 ] . rgb , up [ 3 ] . rgb , max ( sign ( uq . z ) , 0.0 ) ) ; ut = vec3 ( up [ 0 ] . a , up [ 1 ] . a , up [ 2 ] . a ) ; us = mix ( ur , us , abs ( uq . z ) ) ; us = mix ( us , ut , abs ( uq . y ) ) ; br ( us ) ; return us ; }".split(" ")}]}}]},{type:"condition",
b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"void uw ( inout float uv ) { uv -= 0.5 ; uv = 4.0 * ( uv * uv * uv ) + 0.5 ; }".split(" ")},{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"void uH ( inout vec3 ux , in float uy , in vec3 uz , in float uA , in vec4 uB , in float uC ) { vec3 uD , uE ; float uF , uG ; uF = max ( uz . y , 0.0 ) ; uG = max ( uy - max ( uA / uF , 0.0 ) , 0.0 ) ; uG = uB . w * uG ; uD = vec3 ( 0.0 , 0.02 , 0.05 ) ; uE = uB . rgb ; uG = min ( uG , 1.0 ) ; uw ( uG ) ; uG *= clamp ( 2.0 - uC , 0.0 , 1.0 ) ; uD = mix ( uE , uD , min ( uF , 1.0 ) ) ; uA = clamp ( - uA * 0.03 , 0.0 , 0.8 ) ; uD *= 1.0 - uA ; ux = mix ( ux , uD , uG ) ; }".split(" ")}]}}]}]}}]},
{type:"textline",a:"void uO ( inout vec3 uI , float uJ , vec3 uK , float uL ) { vec4 uM ; vec3 uN ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_FOG"],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["PROCEDURAL_FOG"],group:{type:"group",b:[{type:"textline",a:"uN = uu ( u_cube_fog , uK ) ; uM = vec4 ( uN , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["uM","=","u_fog_color_density",";"]}]}}]},{type:"textline",a:"uo ( uI , uJ , bC . y , uM ) ;".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["WATER_EFFECTS"],group:{type:"group",b:[{type:"textline",a:"uH ( uI , uJ , uK , u_cam_water_depth , u_underwater_fog_color_density , uL ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[]}}]},{type:"textline",a:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",b:[{type:"var",name:"PRECISION",a:["lowp"]},{type:"condition",b:[{type:"if",d:["DYNAMIC_GRASS"],group:{type:"group",b:[{type:"textline",a:"vec2 uV ( vec3 uR , float uS , vec2 uT ) { vec2 uU ; uU = vec2 ( ( uR . x - uT . x ) / uS , - ( uR . z - uT . y ) / uS ) ; return fract ( uU ) ; } vec2 uZ ( vec2 uW , float uX , vec2 uY ) { return vec2 ( uW . x * uX , - uW . y * uX ) + uY ; } c u_ ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c vv ( vec3 va , vec3 vb , vec3 vc , vec3 vd , vec3 ve , PRECISION sampler2D vf , sampler2D vg , vec3 vh , float vi , vec3 vj , vec4 vk , mat4 vl ) { mat4 vm ; vec4 vn ; vec2 vo , vp , vq ; float vr , vs ; vec3 vt ; vt = i ( vk , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; vr = - vt . x ; vs = - vt . z ; vo = vec2 ( vj . x + vi * ( - 1.0 - vr ) / 2.0 , vj . z + vi * ( 1.0 - vs ) / 2.0 ) ; vp = uV ( ve , vi , vo ) ; vs = vi / 2.0 ; vq = abs ( uZ ( vp - vec2 ( 0.5 ) , vi , vec2 ( 0.0 ) ) ) ; vs = vs * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( vq ) > vs ) return u_ ( ) ; vs = vi / vh . z ; vq = ( vp - vec2 ( 0.5 ) ) * vs + vec2 ( 0.5 ) ; vt = vt * ( vi / vh . z - 1.0 ) / 2.0 ; vq . x += vt . x ; vq . y -= vt . z ; vn = texture2D ( vg , vq ) ; vs = vn . r ; if ( vs < u_scale_threshold ) return u_ ( ) ; vr = vh . y - vh . x ; vr = vh . y - texture2D ( vf , vq ) . r * vr ; vq = va . xz - ve . xz ; ve . xz = uZ ( vp , vi , vo ) ; ve . y = vr ; va . xz = ve . xz + vq ; va . y *= vs ; va . y += vr ; vt = vn . gba ;".split(" ")},
{type:"condition",b:[{type:"if",d:["BILLBOARD"],group:{type:"group",b:[{type:"textline",a:"va -= ve ; vm = ro ( vj , ve , vl ) ; c vu = rB ( va , ve , vb , vc , vd , vm ) ; vu . b = ve ; vu . f = vt ; return E ( vu ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"return E ( c ( va , ve , vb , vc , vd , vt ) ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",b:[{type:"var",name:"SHADOW_TEX_RES",a:["0.0"]},{type:"condition",b:[{type:"if",
d:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",e:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vec4 vC ( mat4 vw , vec4 vx , mat4 vy ) { vec4 vz ; float vA ; vec2 vB ; vB = ( vw * vy [ 3 ] ) . xy ; vA = SHADOW_TEX_RES / 2.0 ; vB = floor ( vB * vA + 0.5 ) / vA - vB ; vz = vw * vx ; vz . xy += vB ; vz . xyz = 0.5 * ( vz . xyz + vz . w ) ; return vz ; } void vH ( vec3 vD , vec3 vE ) { vec4 vF ; mat4 vG ;".split(" ")},
{type:"condition",b:[{type:"if",d:["MAC_OS_SHADOW_HACK"],group:{type:"group",b:[{type:"textline",a:"vG = O ( u_v_light_tsr [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vG = O ( mat3 ( u_v_light_ts [ 0 ] , u_v_light_r [ 0 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",a:"vF = vG * vec4 ( vD + u_normal_offset * vE , 1.0 ) ; bI = vC ( u_p_light_matrix0 , vF , vG ) ;".split(" ")},{type:"condition",b:[{type:"if",d:["NUM_CAST_LAMPS",1,{type:"g_expr",e:2}],group:{type:"group",
b:[{type:"condition",b:[{type:"if",d:["MAC_OS_SHADOW_HACK"],group:{type:"group",b:[{type:"textline",a:"vG = O ( u_v_light_tsr [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vG = O ( mat3 ( u_v_light_ts [ 1 ] , u_v_light_r [ 1 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",a:"vF = vG * vec4 ( vD + u_normal_offset * vE , 1.0 ) ; bJ = vC ( u_p_light_matrix1 , vF , vG ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NUM_CAST_LAMPS",2,{type:"g_expr",e:2}],
group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MAC_OS_SHADOW_HACK"],group:{type:"group",b:[{type:"textline",a:"vG = O ( u_v_light_tsr [ 2 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vG = O ( mat3 ( u_v_light_ts [ 2 ] , u_v_light_r [ 2 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",a:"vF = vG * vec4 ( vD + u_normal_offset * vE , 1.0 ) ; bK = vC ( u_p_light_matrix2 , vF , vG ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["NUM_CAST_LAMPS",3,{type:"g_expr",
e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["MAC_OS_SHADOW_HACK"],group:{type:"group",b:[{type:"textline",a:"vG = O ( u_v_light_tsr [ 3 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"vG = O ( mat3 ( u_v_light_ts [ 3 ] , u_v_light_r [ 3 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",a:"vF = vG * vec4 ( vD + u_normal_offset * vE , 1.0 ) ; bL = vC ( u_p_light_matrix3 , vF , vG ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION1"],
group:{type:"group",b:[{type:"textline",a:"bJ = vC ( u_p_light_matrix1 , vF , vG ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION2"],group:{type:"group",b:[{type:"textline",a:"bK = vC ( u_p_light_matrix2 , vF , vG ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["CSM_SECTION3"],group:{type:"group",b:[{type:"textline",a:"bL = vC ( u_p_light_matrix3 , vF , vG ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]}}]}]};a["include/lighting_nodes.glslf"]={type:"group",b:[{type:"var",
name:"LAMP_IND",a:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"define",name:"M_PI",a:["3.14159265359"]},{type:"textline",a:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float vI = 0.5 ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",h:[{type:"node_out",
name:"wf",qualifier:["vec3"],c:!1},{type:"node_out",name:"wg",qualifier:["vec3"],c:!1},{type:"node_out",name:"wh",qualifier:["vec3"],c:!1},{type:"node_out",name:"wi",qualifier:["vec3"],c:!0},{type:"node_out",name:"wj",qualifier:["vec3"],c:!0},{type:"node_out",name:"wk",qualifier:["vec2"],c:!0},{type:"node_out",name:"wl",qualifier:["vec2"],c:!0},{type:"node_out",name:"wm",qualifier:["vec4"],c:!0},{type:"node_out",name:"wn",qualifier:["float"],c:!0},{type:"node_out",name:"wo",qualifier:["vec4"],c:!0}],
f:[{type:"textline",a:"wf = vJ ; wg = vK ; wh = vL ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_wi"],f:[{type:"textline",a:["wi","=","vM",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_wj"],f:[{type:"textline",a:["wj","=","vO",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_wl"],f:[{type:"textline",a:["wl","=","vQ",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_wk"],f:[{type:"textline",a:["wk","=","vR",";"]}]}]},{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_wm"],f:[{type:"textline",a:["wm","=","vS",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_wn"],f:[{type:"textline",a:["wn","=","vT",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_wo"],f:[{type:"textline",a:["wo","=","vU",";"]}]}]}]},{type:"node",name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"wp",qualifier:["vec3"],c:!1},{type:"node_in",name:"wq",qualifier:["vec3"],c:!1},{type:"node_in",name:"wr",qualifier:["vec3"],c:!1},{type:"node_out",
name:"ws",qualifier:["vec4"],c:!1},{type:"node_out",name:"wt",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"ws = vec4 ( wp + wr * wq , ZERO_VALUE_NODES ) ; wt = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"wu",qualifier:["vec4"],c:!1},{type:"node_out",name:"wv",qualifier:["vec3"],c:!1},{type:"node_out",name:"ww",qualifier:["vec2"],c:!1},{type:"node_out",name:"wx",qualifier:["vec3"],c:!1},{type:"node_out",name:"wy",qualifier:["float"],c:!1}],
f:[{type:"textline",a:"ww = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["LAMP_TYPE","HEMI",{type:"equal_expr",e:2}],f:[{type:"textline",a:["wy","=","vI",";"]}]},{type:"node_else",f:[{type:"textline",a:["wy","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",a:"wx = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",e:1},{type:"non_equal_expr",
e:2}],f:[{type:"textline",a:"wx *= wu [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["LAMP_TYPE","SPOT",{type:"equal_expr",e:2},"LAMP_TYPE","POINT",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],f:[{type:"textline",a:"wd = u_light_positions [ LAMP_IND ] ; wv = wd - vN ;".split(" ")},{type:"textline",a:"vX = length ( wv ) ; wx *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + vX * vX ) ; wv = normalize ( wv ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",
d:["LAMP_TYPE","SPOT",{type:"equal_expr",e:2}],f:[{type:"textline",a:"wd = u_light_directions [ LAMP_IND ] ; vX = dot ( wv , wd ) ; vX *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( vX - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; wx *= vX ;".split(" ")}]}]}]},{type:"node_else",f:[{type:"textline",a:"wv = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"wz",qualifier:["vec3"],c:!1},{type:"node_in",name:"wA",qualifier:["vec2"],c:!1},
{type:"node_in",name:"wB",qualifier:["vec3"],c:!1},{type:"node_in",name:"wC",qualifier:["float"],c:!1},{type:"node_in",name:"wD",qualifier:["vec2"],c:!1},{type:"node_out",name:"wE",qualifier:["float"],c:!1}],f:[{type:"textline",a:"wE = ZERO_VALUE_NODES ; if ( wA . r != ZERO_VALUE_NODES ) { vX = ( UNITY_VALUE_NODES - wC ) * dot ( wB , wz ) + wC ; if ( wD [ 0 ] == ZERO_VALUE_NODES ) { wE = UNITY_VALUE_NODES ; } else { vX = UNITY_VALUE_NODES + abs ( vX ) ; vX = wD [ 1 ] + ( UNITY_VALUE_NODES - wD [ 1 ] ) * pow ( vX , wD [ 0 ] ) ; wE = clamp ( vX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } wE = max ( wE , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"wF",qualifier:["vec3"],c:!1},{type:"node_in",name:"wG",qualifier:["vec2"],c:!1},{type:"node_in",name:"wH",qualifier:["vec3"],c:!1},{type:"node_in",name:"wI",qualifier:["float"],c:!1},{type:"node_out",name:"wJ",qualifier:["float"],c:!1}],f:[{type:"textline",a:"wJ = ZERO_VALUE_NODES ; if ( wG . r != ZERO_VALUE_NODES ) { vX = ( UNITY_VALUE_NODES - wI ) * dot ( wH , wF ) + wI ; wJ = max ( vX , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"wK",qualifier:["vec3"],c:!1},{type:"node_in",name:"wL",qualifier:["vec2"],c:!1},{type:"node_in",name:"wM",qualifier:["vec3"],c:!1},{type:"node_in",name:"wN",qualifier:["float"],c:!1},{type:"node_in",name:"wO",qualifier:["vec2"],c:!1},{type:"node_out",name:"wP",qualifier:["float"],c:!1}],f:[{type:"textline",a:"wP = ZERO_VALUE_NODES ; if ( wL . r != ZERO_VALUE_NODES ) { vX = ( UNITY_VALUE_NODES - wN ) * dot ( wM , wK ) + wN ; if ( wO [ 0 ] > ZERO_VALUE_NODES ) { vY = max ( dot ( wM , vP ) , ZERO_VALUE_NODES ) ; vZ = wO [ 0 ] * wO [ 0 ] ; v_ = UNITY_VALUE_NODES - vI * ( vZ / ( vZ + 0.33 ) ) ; wd = wK - vX * wM ; we = vP - vY * wM ;".split(" ")},
{type:"textline",a:"if ( length ( wd ) == ZERO_VALUE_NODES || length ( we ) == ZERO_VALUE_NODES || abs ( vX ) > UNITY_VALUE_NODES || abs ( vY ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",a:"wP = vX * v_ ; else { wa = acos ( vX ) ; vY = acos ( vY ) ; wd = normalize ( wd ) ; we = normalize ( we ) ; wb = max ( wa , vY ) ; wc = min ( wa , vY ) ; wc *= 0.95 ; vY = max ( dot ( wd , we ) , ZERO_VALUE_NODES ) ; vZ = 0.45 * ( vZ / ( vZ + 0.09 ) ) ; wP = vX * ( v_ + ( vZ * vY * sin ( wb ) * tan ( wc ) ) ) ; } } else wP = vX ; wP = max ( wP , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"wQ",qualifier:["vec3"],c:!1},{type:"node_in",name:"wR",qualifier:["vec2"],c:!1},{type:"node_in",name:"wS",qualifier:["vec3"],c:!1},{type:"node_in",name:"wT",qualifier:["float"],c:!1},{type:"node_in",name:"wU",qualifier:["vec2"],c:!1},{type:"node_out",name:"wV",qualifier:["float"],c:!1}],f:[{type:"textline",a:"wV = ZERO_VALUE_NODES ; if ( wR . r != ZERO_VALUE_NODES ) { vX = ( UNITY_VALUE_NODES - wT ) * dot ( wS , wQ ) + wT ; wc = max ( dot ( wS , vP ) , ZERO_VALUE_NODES ) ; if ( wU [ 0 ] <= UNITY_VALUE_NODES ) wV = vX * pow ( max ( wc * vX , 0.1 ) , wU [ 0 ] - UNITY_VALUE_NODES ) ; else wV = vX * pow ( 1.0001 - wc , wU [ 0 ] - UNITY_VALUE_NODES ) ; wV = max ( wV , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"wW",qualifier:["vec3"],c:!1},{type:"node_in",name:"wX",qualifier:["vec2"],c:!1},{type:"node_in",name:"wY",qualifier:["vec3"],c:!1},{type:"node_in",name:"wZ",qualifier:["float"],c:!1},{type:"node_in",name:"w_",qualifier:["vec2"],c:!1},{type:"node_out",name:"xa",qualifier:["float"],c:!1}],f:[{type:"textline",a:"xa = ZERO_VALUE_NODES ; if ( wX . r != ZERO_VALUE_NODES ) { wc = ( UNITY_VALUE_NODES - wZ ) * dot ( wY , wW ) + wZ ; wc = acos ( wc ) ; if ( wc < w_ [ 0 ] ) xa = UNITY_VALUE_NODES ; else if ( wc > ( w_ [ 0 ] + w_ [ 1 ] ) || w_ [ 1 ] == ZERO_VALUE_NODES ) xa = ZERO_VALUE_NODES ; else xa = UNITY_VALUE_NODES - ( ( wc - w_ [ 0 ] ) / w_ [ 1 ] ) ; xa = max ( xa , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"xb",qualifier:["vec3"],c:!1},{type:"node_in",name:"xc",qualifier:["vec2"],c:!1},{type:"node_in",name:"xd",qualifier:["vec3"],c:!1},{type:"node_in",name:"xe",qualifier:["float"],c:!1},{type:"node_in",name:"xf",qualifier:["vec2"],c:!1},{type:"node_out",name:"xg",qualifier:["float"],c:!1}],f:[{type:"textline",a:"xg = ZERO_VALUE_NODES ; if ( xc . g != ZERO_VALUE_NODES ) { we = normalize ( xb + vP ) ; xg = ( UNITY_VALUE_NODES - xe ) * max ( dot ( xd , we ) , ZERO_VALUE_NODES ) + xe ; xg = pow ( xg , xf [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"xh",qualifier:["vec3"],c:!1},{type:"node_in",name:"xi",qualifier:["vec2"],c:!1},{type:"node_in",name:"xj",qualifier:["vec3"],c:!1},{type:"node_in",name:"xk",qualifier:["vec2"],c:!1},{type:"node_out",name:"xl",qualifier:["float"],c:!1}],f:[{type:"textline",a:"xl = ZERO_VALUE_NODES ; if ( xi . g != ZERO_VALUE_NODES ) { we = normalize ( xh + vP ) ; wc = max ( dot ( xj , we ) , 0.001 ) ;".split(" ")},{type:"textline",a:"vX = max ( dot ( xj , vP ) , 0.01 ) ; wb = max ( dot ( xj , xh ) , 0.01 ) ; wc = tan ( acos ( wc ) ) ; vY = max ( xk [ 0 ] , 0.001 ) ; xl = wb * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * vY * vY ) ) * ( exp ( - ( wc * wc ) / ( vY * vY ) ) / ( sqrt ( vX * wb ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"xm",qualifier:["vec3"],c:!1},{type:"node_in",name:"xn",qualifier:["vec2"],c:!1},{type:"node_in",name:"xo",qualifier:["vec3"],c:!1},{type:"node_in",name:"xp",qualifier:["vec2"],c:!1},{type:"node_out",name:"xq",qualifier:["float"],c:!1}],f:[{type:"textline",a:"xq = ZERO_VALUE_NODES ; if ( xn . g != ZERO_VALUE_NODES ) { we = normalize ( xm + vP ) ; wb = acos ( dot ( we , xo ) ) ; if ( wb < xp [ 0 ] ) xq = UNITY_VALUE_NODES ; else if ( wb >= xp [ 0 ] + xp [ 1 ] || xp [ 1 ] == ZERO_VALUE_NODES ) xq = ZERO_VALUE_NODES ; else xq = UNITY_VALUE_NODES - ( wb - xp [ 0 ] ) / xp [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"xr",qualifier:["vec3"],c:!1},{type:"node_in",name:"xs",qualifier:["vec2"],c:!1},{type:"node_in",name:"xt",qualifier:["vec3"],c:!1},{type:"node_in",name:"xu",qualifier:["float"],c:!1},{type:"node_in",name:"xv",qualifier:["vec2"],c:!1},{type:"node_out",name:"xw",qualifier:["float"],c:!1}],f:[{type:"textline",a:"xw = ZERO_VALUE_NODES ; if ( xs . g != ZERO_VALUE_NODES ) { if ( xv [ 0 ] < 1.0 || xv [ 1 ] == ZERO_VALUE_NODES ) xw = ZERO_VALUE_NODES ; else { if ( xv [ 1 ] < 100.0 ) xv [ 1 ] = sqrt ( 1.0 / xv [ 1 ] ) ; else xv [ 1 ] = 10.0 / xv [ 1 ] ; we = normalize ( vP + xr ) ; wb = ( UNITY_VALUE_NODES - xu ) * max ( dot ( xt , we ) , ZERO_VALUE_NODES ) + xu ; if ( wb < ZERO_VALUE_NODES ) xw = ZERO_VALUE_NODES ; else { vX = max ( dot ( xt , vP ) , 0.01 ) ; vY = dot ( xt , xr ) ; if ( vY <= 0.01 ) xw = ZERO_VALUE_NODES ; else { wc = max ( dot ( vP , we ) , 0.01 ) ; vZ = UNITY_VALUE_NODES ; vX = ( 2.0 * wb * vX ) / wc ; vY = ( 2.0 * wb * vY ) / wc ; vY = min ( min ( vZ , vX ) , vY ) ; vX = sqrt ( pow ( xv [ 0 ] , 2.0 ) + pow ( wc , 2.0 ) - UNITY_VALUE_NODES ) ; wc = pow ( vX - wc , 2.0 ) / pow ( vX + wc , 2.0 ) * ( UNITY_VALUE_NODES + pow ( wc * ( vX + wc ) - UNITY_VALUE_NODES , 2.0 ) / pow ( wc * ( vX - wc ) + UNITY_VALUE_NODES , 2.0 ) ) ; wb = acos ( wb ) ; xw = max ( wc * vY * exp ( - pow ( wb , 2.0 ) / ( 2.0 * pow ( xv [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"xx",qualifier:["vec4"],c:!1},{type:"node_in",name:"xy",qualifier:["vec3"],c:!1},{type:"node_in",name:"xz",qualifier:["float"],c:!1},{type:"node_in",name:"xA",qualifier:["float"],c:!1},{type:"node_in",name:"xB",qualifier:["vec3"],c:!1},{type:"node_in",name:"xC",qualifier:["vec3"],c:!1},{type:"node_in",name:"xD",qualifier:["vec4"],c:!1},{type:"node_in",name:"xE",qualifier:["vec3"],c:!1},{type:"node_in",name:"xF",qualifier:["vec3"],c:!1},{type:"node_in",
name:"xG",qualifier:["vec3"],c:!1},{type:"node_in",name:"xH",qualifier:["float"],c:!1},{type:"node_out",name:"xI",qualifier:["vec4"],c:!1},{type:"node_out",name:"xJ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"xJ = xy + xG * xF * xA ; xI = xx + vec4 ( xG * xE * xz , xA ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",h:[{type:"node_in",name:"xK",qualifier:["vec4"],c:!1},{type:"node_in",name:"xL",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"vV = xK . rgb ; vW = xL ;".split(" ")}]},{type:"nodes_global"},
{type:"textline",a:"void xM ( vec3 vJ , vec3 vK , vec3 vL , vec3 vM , vec3 vN , vec3 vO , vec3 vP , vec2 vQ , vec2 vR , vec4 vS , float vT , vec4 vU , out vec3 vV , out vec3 vW ) { float vX , vY , vZ , v_ , wa , wb , wc ; vec3 wd , we ;".split(" ")},{type:"nodes_main"},{type:"textline",a:["}"]}]};a["include/particles_nodes.glslf"]={type:"group",b:[{type:"var",name:"MAPPING_TRS_MATRIX",a:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",
a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",a:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",a:["0.0"]},{type:"var",name:"RGB_IND",a:["0"]},{type:"var",name:"VALUE_IND",a:["0"]},{type:"var",name:"LAMP_INDEX",a:["0"]},{type:"var",name:"NUM_LIGHTS",a:["0"]},{type:"var",name:"LAMP_IND",a:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",a:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",a:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
a:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",a:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",a:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",a:["0"]},{type:"var",name:"NODE_TEX_ROW",a:["0.0"]},{type:"define",name:"M_PI",a:["3.14159265359"]},{type:"textline",a:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float xN = 0.5 ;".split(" ")},{type:"condition",b:[{type:"if",d:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR",
"USE_NODE_SEPHSV",{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:"vec3 xS ( vec3 xO ) { float xP , xQ ; vec4 xR ; xR = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; xR = mix ( vec4 ( xO . bg , xR . wz ) , vec4 ( xO . gb , xR . xy ) , step ( xO . b , xO . g ) ) ; xR = mix ( vec4 ( xR . xyw , xO . r ) , vec4 ( xO . r , xR . yzx ) , step ( xR . x , xO . r ) ) ; xP = xR . x - min ( xR . w , xR . y ) ; xQ = 1.0e-10 ; return vec3 ( abs ( xR . z + ( xR . w - xR . y ) / ( 6.0 * xP + xQ ) ) , xP / ( xR . x + xQ ) , xR . x ) ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",e:6}],group:{type:"group",b:[{type:"textline",a:"vec3 xW ( vec3 xT ) { vec3 xU ; vec4 xV ; xV = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; xU = abs ( fract ( vec3 ( xT . r , xT . r , xT . r ) + xV . xyz ) * 6.0 - xV . www ) ; return xT . b * mix ( xV . xxx , clamp ( xU - xV . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , xT . g ) ; }".split(" ")}]}}]},
{type:"condition",b:[{type:"if",d:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:"vec3 xY ( vec2 xX ) { return vec3 ( xX * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",e:3}],group:{type:"group",b:[{type:"textline",a:"vec2 x_ ( vec3 xZ ) { return vec2 ( xZ . xy * xN + vec2 ( xN , xN ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",h:[{type:"node_out",name:"yK",qualifier:["vec3"],c:!0},{type:"node_out",name:"yL",qualifier:["float"],c:!0},{type:"node_out",name:"yM",qualifier:["float"],c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_yK"],f:[{type:"textline",a:"yK = normalize ( yB . xyz ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_yL"],f:[{type:"textline",a:"yL = abs ( yB . z ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_yM"],
f:[{type:"textline",a:"yM = length ( yB . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",h:[{type:"node_in",name:"yN",qualifier:["float"],c:!1},{type:"node_in",name:"yO",qualifier:["float"],c:!1},{type:"node_in",name:"yP",qualifier:["float"],c:!1},{type:"node_out",name:"yQ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yQ = vec3 ( yN , yO , yP ) ;".split(" ")}]},{type:"node",name:"COMBHSV",h:[{type:"node_in",name:"yR",qualifier:["float"],c:!1},{type:"node_in",name:"yS",qualifier:["float"],
c:!1},{type:"node_in",name:"yT",qualifier:["float"],c:!1},{type:"node_out",name:"yU",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yU = xW ( vec3 ( yR , yS , yT ) ) ;".split(" ")}]},{type:"node",name:"EMPTY_UV",h:[{type:"node_out",name:"yV",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yV = vec3 ( - UNITY_VALUE_NODES , - UNITY_VALUE_NODES , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",h:[{type:"node_out",name:"yW",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yW = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_UV",h:[{type:"node_out",name:"yX",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yX = xY ( bM ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",h:[{type:"node_out",name:"yY",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yY = 2.0 * vec3 ( bM , ZERO_VALUE_NODES ) - vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",h:[{type:"node_out",name:"yZ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yZ = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_out",name:"y_",qualifier:["float"],c:!1}],f:[{type:"textline",a:["y_","=","UNITY_VALUE_NODES",";"]}]},{type:"node",name:"GEOMETRY_VC2",h:[{type:"node_out",name:"za",qualifier:["float"],c:!1},{type:"node_out",name:"zb",qualifier:["float"],c:!1}],f:[{type:"textline",a:"za = UNITY_VALUE_NODES ; zb = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",h:[{type:"node_out",name:"zc",qualifier:["float"],c:!1},{type:"node_out",name:"zd",qualifier:["float"],
c:!1},{type:"node_out",name:"ze",qualifier:["float"],c:!1}],f:[{type:"textline",a:"zc = UNITY_VALUE_NODES ; zd = UNITY_VALUE_NODES ; ze = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",h:[{type:"node_out",name:"zf",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["zf","=","yE",";"]}]},{type:"node",name:"GEOMETRY_FB",h:[{type:"node_out",name:"zg",qualifier:["float"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["INVERT_FRONTFACING"],f:[{type:"textline",a:"zg = ( gl_FrontFacing ) ? ZERO_VALUE_NODES : UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",a:"zg = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}]}]},{type:"node",name:"GEOMETRY_VW",h:[{type:"node_out",name:"zh",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["zh","=","yj",";"]}]},{type:"node",name:"GEOMETRY_LO",h:[{type:"node_out",name:"zi",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"zi [ 0 ] = yB [ 0 ] ; zi [ 1 ] = yB [ 1 ] ; zi [ 2 ] = yB [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",h:[{type:"node_out",
name:"zj",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"zj = vec3 ( yF . r , - yF . b , yF . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",h:[{type:"node_out",name:"zk",qualifier:["vec3"],c:!1},{type:"node_out",name:"zl",qualifier:["vec3"],c:!1},{type:"node_out",name:"zm",qualifier:["vec3"],c:!1},{type:"node_out",name:"zn",qualifier:["vec3"],c:!1},{type:"node_out",name:"zo",qualifier:["vec3"],c:!1},{type:"node_out",name:"zp",qualifier:["vec3"],c:!1},{type:"node_out",name:"zq",qualifier:["float"],
c:!1},{type:"node_out",name:"zr",qualifier:["float"],c:!1}],f:[{type:"textline",a:"zk = vec3 ( ZERO_VALUE_NODES ) ; zl = vec3 ( ZERO_VALUE_NODES ) ; zm = vec3 ( ZERO_VALUE_NODES ) ; zn = vec3 ( ZERO_VALUE_NODES ) ; zo = vec3 ( ZERO_VALUE_NODES ) ; zp = vec3 ( ZERO_VALUE_NODES ) ; zq = ZERO_VALUE_NODES ; zr = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"HUE_SAT",h:[{type:"node_in",name:"zs",qualifier:["float"],c:!1},{type:"node_in",name:"zt",qualifier:["float"],c:!1},{type:"node_in",name:"zu",
qualifier:["float"],c:!1},{type:"node_in",name:"zv",qualifier:["float"],c:!1},{type:"node_in",name:"zw",qualifier:["vec3"],c:!1},{type:"node_out",name:"zx",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yH = xS ( zw ) ; yH [ 0 ] += ( zs - xN ) ; if ( yH [ 0 ] > UNITY_VALUE_NODES ) yH [ 0 ] -= UNITY_VALUE_NODES ; else if ( yH [ 0 ] < ZERO_VALUE_NODES ) yH [ 0 ] += UNITY_VALUE_NODES ; yH *= vec3 ( UNITY_VALUE_NODES , zt , zu ) ; yH = mix ( vec3 ( UNITY_VALUE_NODES ) , mix ( vec3 ( ZERO_VALUE_NODES ) , yH , step ( vec3 ( ZERO_VALUE_NODES ) , yH ) ) , step ( yH , vec3 ( UNITY_VALUE_NODES ) ) ) ; zx = mix ( zw , xW ( yH ) , zv ) ;".split(" ")}]},
{type:"node",name:"INVERT",h:[{type:"node_in",name:"zy",qualifier:["float"],c:!1},{type:"node_in",name:"zz",qualifier:["vec3"],c:!1},{type:"node_out",name:"zA",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"zA = mix ( zz , vec3 ( UNITY_VALUE_NODES ) - zz , zy ) ;".split(" ")}]},{type:"node",name:"LAMP",h:[{type:"node_out",name:"zB",qualifier:["vec3"],c:!0},{type:"node_out",name:"zC",qualifier:["vec3"],c:!1},{type:"node_out",name:"zD",qualifier:["float"],c:!1},{type:"node_out",name:"zE",qualifier:["float"],
c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_zB"],f:[{type:"textline",a:"zB = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",a:"yC = u_lamp_light_factors [ LAMP_INDEX ] ; yH = u_lamp_light_directions [ LAMP_INDEX ] ; yI = u_lamp_light_positions [ LAMP_INDEX ] ; yu = yC . z ; if ( yu != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",a:"zC = yI - bC ; zD = length ( zC ) ; zC = normalize ( zC ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",
d:["USE_OUT_zE"],f:[{type:"textline",a:"zE = yu / ( yu + zD * zD ) ; yu = yC . x ; yv = yC . y ; if ( yu > - UNITY_VALUE_NODES ) { yw = dot ( zC , yH ) ; yw *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( yw - yu ) / yv ) ; zE *= yw ; }".split(" ")}]}]},{type:"textline",a:["}","else","{"]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_zC"],f:[{type:"textline",a:["zC","=","yH",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_zD"],f:[{type:"textline",a:"zD = length ( yI - bC ) ;".split(" ")}]}]},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_zE"],f:[{type:"textline",a:["zE","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",a:["}"]}]},{type:"node",name:"NORMAL",h:[{type:"node_in",name:"zF",qualifier:["vec3"],c:!1},{type:"node_out",name:"zG",qualifier:["vec3"],c:!0},{type:"node_out",name:"zH",qualifier:["float"],c:!0},{type:"node_param",name:"ya",qualifier:["vec3"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_zG"],f:[{type:"textline",a:["zG","=","ya",";"]}]}]},{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_zH"],f:[{type:"textline",a:"zH = - dot ( zF , ya ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",h:[{type:"node_in",name:"zI",qualifier:["vec3"],c:!1},{type:"node_out",name:"zJ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"zJ = - ( yk * vec4 ( zI , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",h:[{type:"node_in",name:"zK",qualifier:["vec3"],c:!1},{type:"node_in",name:"zL",qualifier:["float"],c:!1},{type:"node_in",name:"zM",
qualifier:["float"],c:!1},{type:"node_in",name:"zN",qualifier:["float"],c:!1},{type:"node_in",name:"zO",qualifier:["vec3"],c:!1},{type:"node_in",name:"zP",qualifier:["vec3"],c:!1},{type:"node_out",name:"zQ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["zQ","=","zK",";"]},{type:"textline",a:"zL ; zM ; zN ; zO ; zP ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",h:[{type:"node_in",name:"zR",qualifier:["vec3"],c:!1},{type:"node_in",name:"zS",qualifier:["float"],c:!1},{type:"node_in",name:"zT",
qualifier:["vec3"],c:!1},{type:"node_out",name:"zU",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["zU","=","zR",";"]},{type:"textline",a:["zS",";","zT",";"]}]},{type:"node",name:"BSDF_GLASS",h:[{type:"node_in",name:"zV",qualifier:["vec3"],c:!1},{type:"node_in",name:"zW",qualifier:["float"],c:!1},{type:"node_in",name:"zX",qualifier:["float"],c:!1},{type:"node_in",name:"zY",qualifier:["vec3"],c:!1},{type:"node_out",name:"zZ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["zZ","=","zV",";"]},{type:"textline",
a:"zW ; zX ; zY ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",h:[{type:"node_in",name:"z_",qualifier:["vec3"],c:!1},{type:"node_in",name:"Aa",qualifier:["float"],c:!1},{type:"node_in",name:"Ab",qualifier:["vec3"],c:!1},{type:"node_out",name:"Ac",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["Ac","=","z_",";"]},{type:"textline",a:["Aa",";","Ab",";"]}]},{type:"node",name:"BSDF_HAIR",h:[{type:"node_in",name:"Ad",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ae",qualifier:["float"],c:!1},{type:"node_in",
name:"Af",qualifier:["float"],c:!1},{type:"node_in",name:"Ag",qualifier:["float"],c:!1},{type:"node_out",name:"Ah",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["Ah","=","Ad",";"]},{type:"textline",a:"Ae ; Af ; Ag ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",h:[{type:"node_in",name:"Ai",qualifier:["vec3"],c:!1},{type:"node_out",name:"Aj",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["Aj","=","Ai",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",h:[{type:"node_in",name:"Ak",qualifier:["vec3"],
c:!1},{type:"node_in",name:"Al",qualifier:["vec3"],c:!1},{type:"node_out",name:"Am",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["Am","=","Ak",";"]},{type:"textline",a:["Al",";"]}]},{type:"node",name:"BSDF_REFRACTION",h:[{type:"node_in",name:"An",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ao",qualifier:["float"],c:!1},{type:"node_in",name:"Ap",qualifier:["float"],c:!1},{type:"node_in",name:"Aq",qualifier:["vec3"],c:!1},{type:"node_out",name:"Ar",qualifier:["vec3"],c:!1}],f:[{type:"textline",
a:"Ar [ 0 ] = Ar [ 1 ] = Ar [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:"An ; Ao ; Ap ; Aq ;".split(" ")}]},{type:"node",name:"BSDF_TOON",h:[{type:"node_in",name:"As",qualifier:["vec3"],c:!1},{type:"node_in",name:"At",qualifier:["float"],c:!1},{type:"node_in",name:"Au",qualifier:["float"],c:!1},{type:"node_in",name:"Av",qualifier:["vec3"],c:!1},{type:"node_out",name:"Aw",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["Aw","=","As",";"]},{type:"textline",a:"At ; Au ; Av ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",h:[{type:"node_in",name:"Ax",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ay",qualifier:["float"],c:!1},{type:"node_in",name:"Az",qualifier:["vec3"],c:!1},{type:"node_out",name:"AA",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["AA","=","Ax",";"]},{type:"textline",a:["Ay",";","Az",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",h:[{type:"node_in",name:"AB",qualifier:["vec3"],c:!1},{type:"node_in",name:"AC",qualifier:["float"],c:!1},{type:"node_in",name:"AD",
qualifier:["vec3"],c:!1},{type:"node_in",name:"AE",qualifier:["float"],c:!1},{type:"node_in",name:"AF",qualifier:["float"],c:!1},{type:"node_in",name:"AG",qualifier:["vec3"],c:!1},{type:"node_out",name:"AH",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"AH [ 0 ] = AH [ 1 ] = AH [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:"AB ; AD ; AE ; AF ; AG ; AC ;".split(" ")}]},{type:"node",name:"EMISSION",h:[{type:"node_in",name:"AI",qualifier:["vec3"],c:!1},{type:"node_in",name:"AJ",qualifier:["float"],
c:!1},{type:"node_out",name:"AK",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["AK","=","AI",";"]},{type:"textline",a:["AJ",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",h:[{type:"node_in",name:"AL",qualifier:["vec3"],c:!1},{type:"node_out",name:"AM",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"AM [ 0 ] = AM [ 1 ] = AM [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["AL",";"]}]},{type:"node",name:"HOLDOUT",h:[{type:"node_out",name:"AN",qualifier:["vec3"],c:!1}],f:[{type:"textline",
a:"AN [ 0 ] = AN [ 1 ] = AN [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",h:[{type:"node_in",name:"AO",qualifier:["vec3"],c:!1},{type:"node_in",name:"AP",qualifier:["float"],c:!1},{type:"node_out",name:"AQ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"AQ [ 0 ] = AQ [ 1 ] = AQ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["AO",";","AP",";"]}]},{type:"node",name:"VOLUME_SCATTER",h:[{type:"node_in",name:"AR",qualifier:["vec3"],c:!1},{type:"node_in",
name:"AS",qualifier:["float"],c:!1},{type:"node_in",name:"AT",qualifier:["float"],c:!1},{type:"node_out",name:"AU",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"AU [ 0 ] = AU [ 1 ] = AU [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:"AR ; AS ; AT ;".split(" ")}]},{type:"node",name:"BUMP",h:[{type:"node_in",name:"AV",qualifier:["float"],c:!1},{type:"node_in",name:"AW",qualifier:["float"],c:!1},{type:"node_in",name:"AX",qualifier:["float"],c:!1},{type:"node_in",name:"AY",qualifier:["vec3"],
c:!1},{type:"node_out",name:"AZ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["AZ","=","AY",";"]},{type:"textline",a:"AV ; AW ; AX ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",h:[{type:"node_in",name:"A_",qualifier:["float"],c:!1},{type:"node_in",name:"Ba",qualifier:["vec3"],c:!1},{type:"node_out",name:"Bb",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["Bb","=","Ba",";"]},{type:"textline",a:["A_",";"]}]},{type:"node",name:"VECT_TRANSFORM",h:[{type:"node_in",name:"Bc",qualifier:["vec3"],
c:!1},{type:"node_out",name:"Bd",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Bd [ 0 ] = Bd [ 1 ] = Bd [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["Bc",";"]}]},{type:"node",name:"BLACKBODY",h:[{type:"node_in",name:"Be",qualifier:["float"],c:!1},{type:"node_out",name:"Bf",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Bf [ 0 ] = Bf [ 1 ] = Bf [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["Be",";"]}]},{type:"node",name:"WAVELENGTH",h:[{type:"node_in",name:"Bg",qualifier:["float"],
c:!1},{type:"node_out",name:"Bh",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Bh [ 0 ] = Bh [ 1 ] = Bh [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["Bg",";"]}]},{type:"node",name:"SEPXYZ",h:[{type:"node_in",name:"Bi",qualifier:["vec3"],c:!1},{type:"node_out",name:"Bj",qualifier:["float"],c:!1},{type:"node_out",name:"Bk",qualifier:["float"],c:!1},{type:"node_out",name:"Bl",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Bj = Bi [ 0 ] ; Bk = Bi [ 1 ] ; Bl = Bi [ 2 ] ;".split(" ")}]},
{type:"node",name:"COMBXYZ",h:[{type:"node_in",name:"Bm",qualifier:["float"],c:!1},{type:"node_in",name:"Bn",qualifier:["float"],c:!1},{type:"node_in",name:"Bo",qualifier:["float"],c:!1},{type:"node_out",name:"Bp",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Bp [ 0 ] = Bm ; Bp [ 1 ] = Bn ; Bp [ 2 ] = Bo ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",h:[{type:"node_in",name:"Bq",qualifier:["vec3"],c:!1},{type:"node_in",name:"Br",qualifier:["float"],c:!1},{type:"node_in",name:"Bs",qualifier:["float"],
c:!1},{type:"node_out",name:"Bt",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yw = Br - Bs * xN ; Bt = max ( ( UNITY_VALUE_NODES + Bs ) * Bq + yw , vec3 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",h:[{type:"node_in",name:"Bu",qualifier:["float"],c:!1},{type:"node_in",name:"Bv",qualifier:["float"],c:!1},{type:"node_out",name:"Bw",qualifier:["float"],c:!1},{type:"node_out",name:"Bx",qualifier:["float"],c:!1},{type:"node_out",name:"By",qualifier:["float"],c:!1}],f:[{type:"textline",
a:"Bw = Bx = By = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["Bu",";","Bv",";"]}]},{type:"node",name:"TEX_IMAGE",h:[{type:"node_in",name:"Bz",qualifier:["vec3"],c:!1},{type:"node_out",name:"BA",qualifier:["vec3"],c:!1},{type:"node_out",name:"BB",qualifier:["float"],c:!1}],f:[{type:"textline",a:"BA [ 0 ] = BA [ 1 ] = BA [ 2 ] = ZERO_VALUE_NODES ; BB = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:["Bz",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",h:[{type:"node_in",name:"BC",qualifier:["vec3"],
c:!1},{type:"node_out",name:"BD",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"BD [ 0 ] = BD [ 1 ] = BD [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["BC",";"]}]},{type:"node",name:"TEX_SKY",h:[{type:"node_in",name:"BE",qualifier:["vec3"],c:!1},{type:"node_out",name:"BF",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"BF [ 0 ] = BF [ 1 ] = BF [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",a:["BE",";"]}]},{type:"node",name:"TEX_NOISE",h:[{type:"node_in",name:"BG",qualifier:["vec3"],
c:!1},{type:"node_in",name:"BH",qualifier:["float"],c:!1},{type:"node_in",name:"BI",qualifier:["float"],c:!1},{type:"node_in",name:"BJ",qualifier:["float"],c:!1},{type:"node_out",name:"BK",qualifier:["vec3"],c:!1},{type:"node_out",name:"BL",qualifier:["float"],c:!1}],f:[{type:"textline",a:"BK [ 0 ] = BK [ 1 ] = BK [ 2 ] = ZERO_VALUE_NODES ; BL = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:"BG ; BH ; BI ; BJ ;".split(" ")}]},{type:"node",name:"TEX_WAVE",h:[{type:"node_in",name:"BM",qualifier:["vec3"],
c:!1},{type:"node_in",name:"BN",qualifier:["float"],c:!1},{type:"node_in",name:"BO",qualifier:["float"],c:!1},{type:"node_in",name:"BP",qualifier:["float"],c:!1},{type:"node_in",name:"BQ",qualifier:["float"],c:!1},{type:"node_out",name:"BR",qualifier:["vec3"],c:!1},{type:"node_out",name:"BS",qualifier:["float"],c:!1}],f:[{type:"textline",a:"BR [ 0 ] = BR [ 1 ] = BR [ 2 ] = ZERO_VALUE_NODES ; BS = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:"BM ; BN ; BO ; BP ; BQ ;".split(" ")}]},{type:"node",
name:"TEX_VORONOI",h:[{type:"node_in",name:"BT",qualifier:["vec3"],c:!1},{type:"node_in",name:"BU",qualifier:["float"],c:!1},{type:"node_out",name:"BV",qualifier:["vec3"],c:!1},{type:"node_out",name:"BW",qualifier:["float"],c:!1}],f:[{type:"textline",a:"BV [ 0 ] = BV [ 1 ] = BV [ 2 ] = ZERO_VALUE_NODES ; BW = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:["BT",";","BU",";"]}]},{type:"node",name:"TEX_MUSGRAVE",h:[{type:"node_in",name:"BX",qualifier:["vec3"],c:!1},{type:"node_in",name:"BY",qualifier:["float"],
c:!1},{type:"node_in",name:"BZ",qualifier:["float"],c:!1},{type:"node_in",name:"B_",qualifier:["float"],c:!1},{type:"node_in",name:"Ca",qualifier:["float"],c:!1},{type:"node_in",name:"Cb",qualifier:["float"],c:!1},{type:"node_in",name:"Cc",qualifier:["float"],c:!1},{type:"node_out",name:"Cd",qualifier:["vec3"],c:!1},{type:"node_out",name:"Ce",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Cd [ 0 ] = Cd [ 1 ] = Cd [ 2 ] = ZERO_VALUE_NODES ; Ce = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",
a:"BX ; BY ; BZ ; B_ ; Ca ; Cb ; Cc ;".split(" ")}]},{type:"node",name:"TEX_GRADIENT",h:[{type:"node_in",name:"Cf",qualifier:["vec3"],c:!1},{type:"node_out",name:"Cg",qualifier:["vec3"],c:!1},{type:"node_out",name:"Ch",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Cg [ 0 ] = Cg [ 1 ] = Cg [ 2 ] = ZERO_VALUE_NODES ; Ch = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:["Cf",";"]}]},{type:"node",name:"TEX_MAGIC",h:[{type:"node_in",name:"Ci",qualifier:["vec3"],c:!1},{type:"node_in",name:"Cj",
qualifier:["float"],c:!1},{type:"node_in",name:"Ck",qualifier:["float"],c:!1},{type:"node_out",name:"Cl",qualifier:["vec3"],c:!1},{type:"node_out",name:"Cm",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Cl [ 0 ] = Cl [ 1 ] = Cl [ 2 ] = ZERO_VALUE_NODES ; Cm = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:"Ci ; Cj ; Ck ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",h:[{type:"node_in",name:"Cn",qualifier:["vec3"],c:!1},{type:"node_in",name:"Co",qualifier:["vec3"],c:!1},{type:"node_in",name:"Cp",
qualifier:["vec3"],c:!1},{type:"node_in",name:"Cq",qualifier:["float"],c:!1},{type:"node_out",name:"Cr",qualifier:["vec3"],c:!1},{type:"node_out",name:"Cs",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Cr [ 0 ] = Cr [ 1 ] = Cr [ 2 ] = ZERO_VALUE_NODES ; Cs = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",a:"Cn ; Co ; Cp ; Cq ;".split(" ")}]},{type:"node",name:"TEX_BRICK",h:[{type:"node_in",name:"Ct",qualifier:["vec3"],c:!1},{type:"node_in",name:"Cu",qualifier:["vec3"],c:!1},{type:"node_in",
name:"Cv",qualifier:["vec3"],c:!1},{type:"node_in",name:"Cw",qualifier:["vec3"],c:!1},{type:"node_in",name:"Cx",qualifier:["float"],c:!1},{type:"node_in",name:"Cy",qualifier:["float"],c:!1},{type:"node_in",name:"Cz",qualifier:["float"],c:!1},{type:"node_in",name:"CA",qualifier:["float"],c:!1},{type:"node_in",name:"CB",qualifier:["float"],c:!1},{type:"node_out",name:"CC",qualifier:["vec3"],c:!1},{type:"node_out",name:"CD",qualifier:["float"],c:!1}],f:[{type:"textline",a:"CC [ 0 ] = CC [ 1 ] = CC [ 2 ] = ZERO_VALUE_NODES ; CD = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",a:"Ct ; Cu ; Cv ; Cw ; Cx ; Cy ; Cz ; CA ; CB ;".split(" ")}]},{type:"node",name:"ADD_SHADER",h:[{type:"node_in",name:"CE",qualifier:["vec3"],c:!1},{type:"node_in",name:"CF",qualifier:["vec3"],c:!1},{type:"node_out",name:"CG",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"CG = clamp ( CE + CF , vec3 ( ZERO_VALUE_NODES ) , vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",h:[{type:"node_in",name:"CH",qualifier:["float"],c:!1},{type:"node_in",name:"CI",
qualifier:["vec3"],c:!1},{type:"node_in",name:"CJ",qualifier:["vec3"],c:!1},{type:"node_out",name:"CK",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yw = clamp ( CH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; CK = yw * CI + ( UNITY_VALUE_NODES - yw ) * CJ ;".split(" ")}]},{type:"node",name:"UV_MERGED",h:[{type:"node_out",name:"CL",qualifier:["vec3"],c:!1},{type:"node_out",name:"CM",qualifier:["vec3"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_CL"],f:[{type:"textline",a:"CL = xY ( bM ) ;".split(" ")}]}]},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_CM"],f:[{type:"textline",a:"CM = vec3 ( bM , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",h:[{type:"node_out",name:"CN",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"CN = vec3 ( bM , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",h:[{type:"node_out",name:"CO",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["CO","=","yG",";"]}]},{type:"node",name:"TEX_COORD_GE",h:[{type:"node_out",name:"CP",
qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"CP = vec3 ( bM , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_OB",h:[{type:"node_out",name:"CQ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"CQ [ 0 ] = CQ [ 1 ] = CQ [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",h:[{type:"node_out",name:"CR",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"CR [ 0 ] = yB [ 0 ] ; CR [ 1 ] = yB [ 1 ] ; CR [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_WI",
h:[{type:"node_out",name:"CS",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"CS [ 0 ] = CS [ 1 ] = CS [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",h:[{type:"node_out",name:"CT",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"CT [ 0 ] = CT [ 1 ] = CT [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",h:[{type:"node_out",name:"CU",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"CU = vec3 ( bM , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",
h:[{type:"node_out",name:"CV",qualifier:["float"],c:!1},{type:"node_out",name:"CW",qualifier:["float"],c:!1},{type:"node_out",name:"CX",qualifier:["float"],c:!1},{type:"node_out",name:"CY",qualifier:["vec3"],c:!1},{type:"node_out",name:"CZ",qualifier:["float"],c:!1},{type:"node_out",name:"C_",qualifier:["vec3"],c:!1},{type:"node_out",name:"Da",qualifier:["vec3"],c:!1},{type:"node_param",name:"yb",qualifier:["varying","vec4"],c:!0},{type:"node_param",name:"yc",qualifier:["varying","vec3"],c:!0},{type:"node_param",
name:"yd",qualifier:["varying","vec3"],c:!0},{type:"node_param",name:"ye",qualifier:["varying","vec3"],c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["PARTICLE_BATCH"],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_CV"],f:[{type:"textline",a:"CV = yb [ 0 ] ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_CW"],f:[{type:"textline",a:"CW = yb [ 1 ] ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_CX"],f:[{type:"textline",a:"CX = yb [ 2 ] ;".split(" ")}]}]},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_CY"],f:[{type:"textline",a:"CY = vec3 ( yc . r , - yc . b , yc . g ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_CZ"],f:[{type:"textline",a:"CZ = yb [ 3 ] ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_C_"],f:[{type:"textline",a:"C_ = vec3 ( yd . r , - yd . b , yd . g ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Da"],f:[{type:"textline",a:"Da = vec3 ( ye . r , - ye . b , ye . g ) ;".split(" ")}]}]}]},
{type:"node_else",f:[{type:"textline",a:"CV = ZERO_VALUE_NODES ; CW = ZERO_VALUE_NODES ; CX = ZERO_VALUE_NODES ; CY = vec3 ( ZERO_VALUE_NODES ) ; CZ = ZERO_VALUE_NODES ; C_ = CY ; Da = CY ;".split(" ")}]}]}]},{type:"node",name:"HAIR_INFO",h:[{type:"node_out",name:"Db",qualifier:["float"],c:!1},{type:"node_out",name:"Dc",qualifier:["float"],c:!1},{type:"node_out",name:"Dd",qualifier:["float"],c:!1},{type:"node_out",name:"De",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Db = ZERO_VALUE_NODES ; Dc = ZERO_VALUE_NODES ; Dd = ZERO_VALUE_NODES ; De = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"OBJECT_INFO",h:[{type:"node_out",name:"Df",qualifier:["vec3"],c:!1},{type:"node_out",name:"Dg",qualifier:["float"],c:!1},{type:"node_out",name:"Dh",qualifier:["float"],c:!1},{type:"node_out",name:"Di",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Dg = ZERO_VALUE_NODES ; Dh = ZERO_VALUE_NODES ; Di = ZERO_VALUE_NODES ; Df = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",h:[{type:"node_in",name:"Dj",qualifier:["float"],c:!1},{type:"node_out",name:"Dk",
qualifier:["float"],c:!1}],f:[{type:"textline",a:["Dk","=","Dj",";"]}]},{type:"node",name:"TANGENT",h:[{type:"node_out",name:"Dl",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Dl = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",h:[{type:"node_in",name:"Dm",qualifier:["float"],c:!1},{type:"node_in",name:"Dn",qualifier:["vec3"],c:!1},{type:"node_out",name:"Do",qualifier:["float"],c:!1},{type:"node_out",name:"Dp",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Do = Dp = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",a:["Dn",";","Dm",";"]}]},{type:"node",name:"LIGHT_PATH",h:[{type:"node_out",name:"Dq",qualifier:["float"],c:!1},{type:"node_out",name:"Dr",qualifier:["float"],c:!1},{type:"node_out",name:"Ds",qualifier:["float"],c:!1},{type:"node_out",name:"Dt",qualifier:["float"],c:!1},{type:"node_out",name:"Du",qualifier:["float"],c:!1},{type:"node_out",name:"Dv",qualifier:["float"],c:!1},{type:"node_out",name:"Dw",qualifier:["float"],c:!1},{type:"node_out",name:"Dx",qualifier:["float"],c:!1},{type:"node_out",
name:"Dy",qualifier:["float"],c:!1},{type:"node_out",name:"Dz",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Dq = Dr = Ds = ZERO_VALUE_NODES ; Dt = Du = Dv = ZERO_VALUE_NODES ; Dw = Dw = Dy = Dz = ZERO_VALUE_NODES ; Dx = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",h:[{type:"node_out",name:"DA",qualifier:["vec3"],c:!1},{type:"node_out",name:"DB",qualifier:["vec3"],c:!1},{type:"node_out",name:"DC",qualifier:["float"],c:!1}],f:[{type:"textline",a:"DA = DB = vec3 ( ZERO_VALUE_NODES ) ; DC = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"SCRIPT",h:[],f:[]},{type:"node",name:"CURVE_VEC",h:[{type:"node_in",name:"DD",qualifier:["float"],c:!1},{type:"node_in",name:"DE",qualifier:["vec3"],c:!1},{type:"node_out",name:"DF",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["DF","=","DE",";"]},{type:"node_condition",b:[{type:"node_if",d:["READ_R"],f:[{type:"textline",a:"DF . r = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * DE . r + 0.5 , NODE_TEX_ROW ) ) . r - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",
d:["READ_G"],f:[{type:"textline",a:"DF . g = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * DE . g + 0.5 , NODE_TEX_ROW ) ) . g - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["READ_B"],f:[{type:"textline",a:"DF . b = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * DE . b + 0.5 , NODE_TEX_ROW ) ) . b - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"textline",a:"DF = mix ( DE , DF , DD ) ;".split(" ")}]},{type:"node",name:"CURVE_RGB",h:[{type:"node_in",name:"DG",qualifier:["float"],
c:!1},{type:"node_in",name:"DH",qualifier:["vec3"],c:!1},{type:"node_out",name:"DI",qualifier:["vec3"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["READ_A"],f:[{type:"textline",a:"yw = texture2D ( u_nodes_texture , vec2 ( DH . r , NODE_TEX_ROW ) ) . a ; yv = texture2D ( u_nodes_texture , vec2 ( DH . g , NODE_TEX_ROW ) ) . a ; yu = texture2D ( u_nodes_texture , vec2 ( DH . b , NODE_TEX_ROW ) ) . a ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"yw = DH . r ; yv = DH . g ; yu = DH . b ;".split(" ")}]}]},
{type:"node_condition",b:[{type:"node_if",d:["READ_R"],f:[{type:"textline",a:"DI . r = texture2D ( u_nodes_texture , vec2 ( yw , NODE_TEX_ROW ) ) . r ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"DI . r = yw ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["READ_G"],f:[{type:"textline",a:"DI . g = texture2D ( u_nodes_texture , vec2 ( yv , NODE_TEX_ROW ) ) . g ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"DI . g = yv ;".split(" ")}]}]},{type:"node_condition",
b:[{type:"node_if",d:["READ_B"],f:[{type:"textline",a:"DI . b = texture2D ( u_nodes_texture , vec2 ( yu , NODE_TEX_ROW ) ) . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"DI . b = yu ;".split(" ")}]}]},{type:"textline",a:"DI = mix ( DH , DI , DG ) ;".split(" ")}]},{type:"node",name:"VALTORGB",h:[{type:"node_in",name:"DJ",qualifier:["float"],c:!1},{type:"node_out",name:"DK",qualifier:["vec3"],c:!1},{type:"node_out",name:"DL",qualifier:["float"],c:!1}],f:[{type:"textline",a:"yC = texture2D ( u_nodes_texture , vec2 ( DJ , NODE_TEX_ROW ) ) ; DK = yC . rgb ; DL = yC . a ;".split(" ")}]},
{type:"node",name:"MAPPING",h:[{type:"node_in",name:"DM",qualifier:["vec3"],c:!1},{type:"node_out",name:"DN",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:["DN","=","DM",";"]},{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",a:"DN = ( MAPPING_TRS_MATRIX * vec4 ( DN , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_SCALE",f:[{type:"textline",a:"DN = DN * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",
b:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",a:"DN = DN + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",a:"DN = max ( DN , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",a:"DN = min ( DN , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["MAPPING_IS_NORMAL"],f:[{type:"textline",a:"DN = normalize ( DN ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ADD",h:[{type:"node_in",name:"DO",qualifier:["float"],c:!1},{type:"node_in",name:"DP",qualifier:["float"],c:!1},{type:"node_out",name:"DQ",qualifier:["float"],c:!1}],f:[{type:"textline",a:"DQ = DO + DP ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"DQ = clamp ( DQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",h:[{type:"node_in",name:"DR",qualifier:["float"],c:!1},{type:"node_in",
name:"DS",qualifier:["float"],c:!1},{type:"node_out",name:"DT",qualifier:["float"],c:!1}],f:[{type:"textline",a:"DT = DR - DS ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"DT = clamp ( DT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",h:[{type:"node_in",name:"DU",qualifier:["float"],c:!1},{type:"node_in",name:"DV",qualifier:["float"],c:!1},{type:"node_out",name:"DW",qualifier:["float"],c:!1}],f:[{type:"textline",
a:"DW = DU * DV ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"DW = clamp ( DW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",h:[{type:"node_in",name:"DX",qualifier:["float"],c:!1},{type:"node_in",name:"DY",qualifier:["float"],c:!1},{type:"node_out",name:"DZ",qualifier:["float"],c:!1}],f:[{type:"textline",a:"DZ = ( DY != ZERO_VALUE_NODES ) ? DX / DY : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"DZ = clamp ( DZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",h:[{type:"node_in",name:"D_",qualifier:["float"],c:!1},{type:"node_in",name:"Ea",qualifier:["float"],c:!1},{type:"node_out",name:"Eb",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Eb = sin ( D_ ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"Eb = clamp ( Eb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",a:["Ea",";"]}]},{type:"node",name:"MATH_COSINE",h:[{type:"node_in",name:"Ec",qualifier:["float"],c:!1},{type:"node_in",name:"Ed",qualifier:["float"],c:!1},{type:"node_out",name:"Ee",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Ee = cos ( Ec ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"Ee = clamp ( Ee , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["Ed",";"]}]},{type:"node",name:"MATH_TANGENT",
h:[{type:"node_in",name:"Ef",qualifier:["float"],c:!1},{type:"node_in",name:"Eg",qualifier:["float"],c:!1},{type:"node_out",name:"Eh",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Eh = tan ( Ef ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"Eh = clamp ( Eh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["Eg",";"]}]},{type:"node",name:"MATH_ARCSINE",h:[{type:"node_in",name:"Ei",qualifier:["float"],c:!1},{type:"node_in",
name:"Ej",qualifier:["float"],c:!1},{type:"node_out",name:"Ek",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Ek = ( Ei <= UNITY_VALUE_NODES && Ei >= - UNITY_VALUE_NODES ) ? asin ( Ei ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"Ek = clamp ( Ek , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["Ej",";"]}]},{type:"node",name:"MATH_ARCCOSINE",h:[{type:"node_in",name:"El",qualifier:["float"],
c:!1},{type:"node_in",name:"Em",qualifier:["float"],c:!1},{type:"node_out",name:"En",qualifier:["float"],c:!1}],f:[{type:"textline",a:"En = ( El <= UNITY_VALUE_NODES && El >= - UNITY_VALUE_NODES ) ? acos ( El ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"En = clamp ( En , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["Em",";"]}]},{type:"node",name:"MATH_ARCTANGENT",h:[{type:"node_in",name:"Eo",
qualifier:["float"],c:!1},{type:"node_in",name:"Ep",qualifier:["float"],c:!1},{type:"node_out",name:"Eq",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Eq = atan ( Eo ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"Eq = clamp ( Eq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["Ep",";"]}]},{type:"node",name:"MATH_POWER",h:[{type:"node_in",name:"Er",qualifier:["float"],c:!1},{type:"node_in",name:"Es",qualifier:["float"],
c:!1},{type:"node_out",name:"Et",qualifier:["float"],c:!1}],f:[{type:"textline",a:"if ( Er < ZERO_VALUE_NODES && Es != floor ( Es ) ) Et = ZERO_VALUE_NODES ; else if ( Es == ZERO_VALUE_NODES )".split(" ")},{type:"textline",a:"Et = UNITY_VALUE_NODES ; else if ( Er < ZERO_VALUE_NODES ) Et = mix ( UNITY_VALUE_NODES , - UNITY_VALUE_NODES , sign ( mod ( - Es , 2.0 ) ) ) * pow ( - Er , Es ) ; else if ( Er == ZERO_VALUE_NODES ) Et = ZERO_VALUE_NODES ; else Et = pow ( Er , Es ) ;".split(" ")},{type:"node_condition",
b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"Et = clamp ( Et , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",h:[{type:"node_in",name:"Eu",qualifier:["float"],c:!1},{type:"node_in",name:"Ev",qualifier:["float"],c:!1},{type:"node_out",name:"Ew",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Ew = ( Eu > ZERO_VALUE_NODES && Ev > ZERO_VALUE_NODES ) ? log2 ( Eu ) / log2 ( Ev ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"Ew = clamp ( Ew , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",h:[{type:"node_in",name:"Ex",qualifier:["float"],c:!1},{type:"node_in",name:"Ey",qualifier:["float"],c:!1},{type:"node_out",name:"Ez",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Ez = min ( Ex , Ey ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"Ez = clamp ( Ez , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",h:[{type:"node_in",name:"EA",qualifier:["float"],c:!1},{type:"node_in",name:"EB",qualifier:["float"],c:!1},{type:"node_out",name:"EC",qualifier:["float"],c:!1}],f:[{type:"textline",a:"EC = max ( EA , EB ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"EC = clamp ( EC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",h:[{type:"node_in",name:"ED",qualifier:["float"],c:!1},
{type:"node_in",name:"EE",qualifier:["float"],c:!1},{type:"node_out",name:"EF",qualifier:["float"],c:!1}],f:[{type:"textline",a:"EF = floor ( ED + xN ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"EF = clamp ( EF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["EE",";"]}]},{type:"node",name:"MATH_LESS_THAN",h:[{type:"node_in",name:"EG",qualifier:["float"],c:!1},{type:"node_in",name:"EH",qualifier:["float"],c:!1},
{type:"node_out",name:"EI",qualifier:["float"],c:!1}],f:[{type:"textline",a:"EI = ( EG < EH ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"EI = clamp ( EI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",h:[{type:"node_in",name:"EJ",qualifier:["float"],c:!1},{type:"node_in",name:"EK",qualifier:["float"],c:!1},{type:"node_out",name:"EL",qualifier:["float"],
c:!1}],f:[{type:"textline",a:"EL = ( EJ > EK ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"EL = clamp ( EL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",h:[{type:"node_in",name:"EM",qualifier:["float"],c:!1},{type:"node_in",name:"EN",qualifier:["float"],c:!1},{type:"node_out",name:"EO",qualifier:["float"],c:!1}],f:[{type:"textline",a:"EO = abs ( EN ) > 0.000001 ? mod ( EM , EN ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"EO = clamp ( EO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",h:[{type:"node_in",name:"EP",qualifier:["float"],c:!1},{type:"node_in",name:"EQ",qualifier:["float"],c:!1},{type:"node_out",name:"ER",qualifier:["float"],c:!1}],f:[{type:"textline",a:"ER = abs ( EP ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MATH_USE_CLAMP"],f:[{type:"textline",a:"ER = clamp ( ER , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",a:["EQ",";"]}]},{type:"node",name:"MIX_RGB_MIX",h:[{type:"node_in",name:"ES",qualifier:["float"],c:!1},{type:"node_in",name:"ET",qualifier:["vec3"],c:!1},{type:"node_in",name:"EU",qualifier:["vec3"],c:!1},{type:"node_out",name:"EV",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( ES , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; EV = mix ( ET , EU , yu ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"EV = clamp ( EV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_ADD",h:[{type:"node_in",name:"EW",qualifier:["float"],c:!1},{type:"node_in",name:"EX",qualifier:["vec3"],c:!1},{type:"node_in",name:"EY",qualifier:["vec3"],c:!1},{type:"node_out",name:"EZ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( EW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; EZ = mix ( EX , EX + EY , yu ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"EZ = clamp ( EZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",h:[{type:"node_in",name:"E_",qualifier:["float"],c:!1},{type:"node_in",name:"Fa",qualifier:["vec3"],c:!1},{type:"node_in",name:"Fb",qualifier:["vec3"],c:!1},{type:"node_out",name:"Fc",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( E_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Fc = mix ( Fa , Fa * Fb , yu ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Fc = clamp ( Fc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",h:[{type:"node_in",name:"Fd",qualifier:["float"],c:!1},{type:"node_in",name:"Fe",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ff",qualifier:["vec3"],c:!1},{type:"node_out",name:"Fg",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( Fd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Fg = mix ( Fe , Fe - Ff , yu ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Fg = clamp ( Fg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",h:[{type:"node_in",name:"Fh",qualifier:["float"],c:!1},{type:"node_in",name:"Fi",qualifier:["vec3"],c:!1},{type:"node_in",name:"Fj",qualifier:["vec3"],c:!1},{type:"node_out",name:"Fk",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( Fh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yv = UNITY_VALUE_NODES - yu ; Fk = vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( yv ) + yu * ( vec3 ( UNITY_VALUE_NODES ) - Fj ) ) * ( vec3 ( UNITY_VALUE_NODES ) - Fi ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Fk = clamp ( Fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",h:[{type:"node_in",name:"Fl",qualifier:["float"],c:!1},{type:"node_in",name:"Fm",qualifier:["vec3"],c:!1},{type:"node_in",name:"Fn",qualifier:["vec3"],c:!1},{type:"node_out",name:"Fo",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( Fl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yv = UNITY_VALUE_NODES - yu ; Fn += step ( Fn , vec3 ( ZERO_VALUE_NODES ) ) ; Fo = yv * Fm + yu * Fm / Fn ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Fo = clamp ( Fo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",h:[{type:"node_in",name:"Fp",qualifier:["float"],c:!1},{type:"node_in",name:"Fq",qualifier:["vec3"],c:!1},{type:"node_in",name:"Fr",qualifier:["vec3"],c:!1},{type:"node_out",name:"Fs",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( Fp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Fs = mix ( Fq , abs ( Fq - Fr ) , yu ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Fs = clamp ( Fs , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",h:[{type:"node_in",name:"Ft",qualifier:["float"],c:!1},{type:"node_in",name:"Fu",qualifier:["vec3"],c:!1},{type:"node_in",name:"Fv",qualifier:["vec3"],c:!1},{type:"node_out",name:"Fw",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( Ft , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Fw = min ( Fu . rgb , Fv . rgb * yu ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Fw = clamp ( Fw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",h:[{type:"node_in",name:"Fx",qualifier:["float"],c:!1},{type:"node_in",name:"Fy",qualifier:["vec3"],c:!1},{type:"node_in",name:"Fz",qualifier:["vec3"],c:!1},{type:"node_out",name:"FA",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( Fx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FA = max ( Fy . rgb , Fz . rgb * yu ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"FA = clamp ( FA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",h:[{type:"node_in",name:"FB",qualifier:["float"],c:!1},{type:"node_in",name:"FC",qualifier:["vec3"],c:!1},{type:"node_in",name:"FD",qualifier:["vec3"],c:!1},{type:"node_out",name:"FE",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( FB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yI = vec3 ( UNITY_VALUE_NODES - yu ) ; FE = mix ( FC * ( yI + 2.0 * yu * FD ) , vec3 ( UNITY_VALUE_NODES ) - ( yI + 2.0 * yu * ( vec3 ( UNITY_VALUE_NODES ) - FD ) ) * ( vec3 ( UNITY_VALUE_NODES ) - FC ) , step ( xN , FC ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"FE = clamp ( FE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",h:[{type:"node_in",name:"FF",qualifier:["float"],c:!1},{type:"node_in",name:"FG",qualifier:["vec3"],c:!1},{type:"node_in",name:"FH",qualifier:["vec3"],c:!1},{type:"node_out",name:"FI",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( FF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yI = vec3 ( UNITY_VALUE_NODES ) - yu * FH ; yH = clamp ( FG / yI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FI = mix ( mix ( yH , vec3 ( UNITY_VALUE_NODES ) , step ( yI , vec3 ( ZERO_VALUE_NODES ) ) ) , FG , step ( FG , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"FI = clamp ( FI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",h:[{type:"node_in",name:"FJ",qualifier:["float"],c:!1},{type:"node_in",name:"FK",qualifier:["vec3"],c:!1},{type:"node_in",name:"FL",qualifier:["vec3"],c:!1},{type:"node_out",name:"FM",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( FJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yI = vec3 ( UNITY_VALUE_NODES - yu ) ; yI = yI + yu * FL ; yH = clamp ( vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( UNITY_VALUE_NODES ) - FK ) / yI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FM = mix ( yH , vec3 ( ZERO_VALUE_NODES ) , step ( yI , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"FM = clamp ( FM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",h:[{type:"node_in",name:"FN",qualifier:["float"],c:!1},{type:"node_in",name:"FO",qualifier:["vec3"],c:!1},{type:"node_in",name:"FP",qualifier:["vec3"],c:!1},{type:"node_out",name:"FQ",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( FN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FQ = FO ; yH = xS ( FP ) ; if ( yH . y != ZERO_VALUE_NODES ) { yI = xS ( FQ ) ; yI . x = yH . x ; yJ = xW ( yI ) ; FQ = mix ( FQ , yJ , yu ) ; }".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"FQ = clamp ( FQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",h:[{type:"node_in",name:"FR",qualifier:["float"],c:!1},{type:"node_in",name:"FS",qualifier:["vec3"],c:!1},{type:"node_in",name:"FT",qualifier:["vec3"],c:!1},{type:"node_out",name:"FU",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( FR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yv = UNITY_VALUE_NODES - yu ; FU = FS ; yJ = xS ( FU ) ; if ( yJ . y != ZERO_VALUE_NODES ) { yI = xS ( FT ) ; yJ . y = yv * yJ . y + yu * yI . y ; FU = xW ( yJ ) ; }".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"FU = clamp ( FU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",h:[{type:"node_in",name:"FV",qualifier:["float"],c:!1},{type:"node_in",name:"FW",qualifier:["vec3"],c:!1},{type:"node_in",name:"FX",qualifier:["vec3"],c:!1},{type:"node_out",name:"FY",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( FV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yv = UNITY_VALUE_NODES - yu ; yJ = xS ( FW ) ; yI = xS ( FX ) ; yJ . z = yv * yJ . z + yu * yI . z ; FY = xW ( yJ ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"FY = clamp ( FY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",h:[{type:"node_in",name:"FZ",qualifier:["float"],c:!1},{type:"node_in",name:"F_",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ga",qualifier:["vec3"],c:!1},{type:"node_out",name:"Gb",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( FZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Gb = F_ ; yI = xS ( Ga ) ; if ( yI . y != ZERO_VALUE_NODES ) { yJ = xS ( Gb ) ; yJ . x = yI . x ; yJ . y = yI . y ; yH = xW ( yJ ) ; Gb = mix ( Gb , yH , yu ) ; }".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Gb = clamp ( Gb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",h:[{type:"node_in",name:"Gc",qualifier:["float"],c:!1},{type:"node_in",name:"Gd",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ge",qualifier:["vec3"],c:!1},{type:"node_out",name:"Gf",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( Gc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yv = UNITY_VALUE_NODES - yu ; yH = Ge + Gd - Ge * Gd ; Gf = Gd * ( vec3 ( yv ) + vec3 ( yu ) * ( ( vec3 ( UNITY_VALUE_NODES ) - Gd ) * Ge + yH ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Gf = clamp ( Gf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",h:[{type:"node_in",name:"Gg",qualifier:["float"],c:!1},{type:"node_in",name:"Gh",qualifier:["vec3"],c:!1},{type:"node_in",name:"Gi",qualifier:["vec3"],c:!1},{type:"node_out",name:"Gj",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"yu = clamp ( Gg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Gj = Gh + yu * ( 2.0 * Gi - vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",a:"Gj = clamp ( Gj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",h:[{type:"node_in",name:"Gk",qualifier:["vec3"],c:!1},{type:"node_in",name:"Gl",qualifier:["float"],c:!1}],f:[{type:"textline",a:"yl = Gk ; yp = Gl ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",h:[{type:"node_in",name:"Gm",qualifier:["vec3"],c:!1},{type:"node_in",name:"Gn",qualifier:["vec3"],c:!1},{type:"node_in",
name:"Go",qualifier:["float"],c:!1},{type:"node_in",name:"Gp",qualifier:["vec3"],c:!0},{type:"node_in",name:"Gq",qualifier:["float"],c:!0},{type:"node_out",name:"Gr",qualifier:["vec3"],c:!1},{type:"node_out",name:"Gs",qualifier:["vec3"],c:!1},{type:"node_out",name:"Gt",qualifier:["vec3"],c:!1},{type:"node_out",name:"Gu",qualifier:["vec3"],c:!1},{type:"node_out",name:"Gv",qualifier:["vec3"],c:!1},{type:"node_out",name:"Gw",qualifier:["vec2"],c:!1},{type:"node_out",name:"Gx",qualifier:["vec2"],c:!1},
{type:"node_out",name:"Gy",qualifier:["vec4"],c:!1},{type:"node_param",name:"yf",qualifier:["const","vec2"],c:!0},{type:"node_param",name:"yg",qualifier:["const","vec3"],c:!1}],f:[{type:"textline",a:"Gt = clamp ( Gm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",a:"Gu = yg [ 0 ] * clamp ( Gn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_NORMAL"],f:[{type:"textline",a:"Gv = normalize ( Gp ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",a:["Gv","=","yG",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["SHADELESS_MAT",{type:"logic_negative_expr",e:1}],f:[{type:"node_condition",b:[{type:"node_if",d:["MATERIAL_EXT"],f:[{type:"textline",a:"Gr = Gq * Gt ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"Gr = ys * Gt ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",a:["Gt","*=","Go",";"]}]}]},{type:"textline",a:"Gs = yt * u_environment_energy * dS ( Gv ) ; Gy = vec4 ( 1.0 ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["NUM_LIGHTS",0,{type:"g_expr",e:2}],f:[{type:"textline",a:"Gw = vec2 ( yf [ 0 ] , yf [ 1 ] ) ;".split(" ")},{type:"textline",a:"Gx = vec2 ( yg [ 1 ] , yg [ 2 ] ) ;".split(" ")}]}]},{type:"textline",a:["yo","=","Gy",";"]}]},{type:"node_else",f:[{type:"textline",a:"Gr = vec3 ( ZERO_VALUE_NODES ) ; Gs = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",h:[{type:"node_in",name:"Gz",qualifier:["vec4"],c:!1},{type:"node_in",name:"GA",
qualifier:["vec3"],c:!1},{type:"node_in",name:"GB",qualifier:["vec3"],c:!1},{type:"node_in",name:"GC",qualifier:["float"],c:!0},{type:"node_in",name:"GD",qualifier:["float"],c:!0},{type:"node_in",name:"GE",qualifier:["float"],c:!0},{type:"node_out",name:"GF",qualifier:["vec3"],c:!0},{type:"node_out",name:"GG",qualifier:["float"],c:!0},{type:"node_out",name:"GH",qualifier:["vec3"],c:!0},{type:"node_out",name:"GI",qualifier:["vec3"],c:!0},{type:"node_out",name:"GJ",qualifier:["vec3"],c:!0},{type:"node_param",
name:"yh",qualifier:["float"],c:!1},{type:"node_param",name:"yi",qualifier:["float"],c:!1}],f:[{type:"textline",a:["GC",";"]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_GF"],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",a:"GF = Gz . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"GF = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",a:["GF","+=",
"GA",";"]}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_GH"],f:[{type:"textline",a:["GH","=","GB",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["MATERIAL_EXT"],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_GI"],f:[{type:"textline",a:"GI = Gz . rgb ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_GJ"],f:[{type:"textline",a:["GJ","=","GA",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_GG"],f:[{type:"textline",a:"GG = clamp ( GE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",a:"yu = max ( max ( GA . r , GA . g ) , GA . b ) * GD ; GG = clamp ( GE * ( UNITY_VALUE_NODES - yu ) + yu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_GG"],f:[{type:"textline",a:"GG = clamp ( yh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",a:"yu = max ( max ( GA . r , GA . g ) , GA . b ) * yi ; GG = yh * ( UNITY_VALUE_NODES - yu ) + yu ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",a:["ym","=","GA",";"]}]},{type:"node_else",f:[{type:"textline",a:"ym = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",a:["yn","=","GB",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"GK",qualifier:["vec3"],c:!1},{type:"node_in",name:"GL",
qualifier:["vec3"],c:!1},{type:"node_in",name:"GM",qualifier:["vec3"],c:!1},{type:"node_out",name:"GN",qualifier:["vec4"],c:!1},{type:"node_out",name:"GO",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"GN = vec4 ( GK + GM * GL , ZERO_VALUE_NODES ) ; GO = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"GP",qualifier:["vec4"],c:!1},{type:"node_out",name:"GQ",qualifier:["vec3"],c:!1},{type:"node_out",name:"GR",qualifier:["vec2"],c:!1},{type:"node_out",
name:"GS",qualifier:["vec3"],c:!1},{type:"node_out",name:"GT",qualifier:["float"],c:!1}],f:[{type:"textline",a:"GR = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["LAMP_TYPE","HEMI",{type:"equal_expr",e:2}],f:[{type:"textline",a:["GT","=","xN",";"]}]},{type:"node_else",f:[{type:"textline",a:["GT","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",a:"GS = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",
b:[{type:"node_if",d:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",e:1},{type:"non_equal_expr",e:2}],f:[{type:"textline",a:"GS *= GP [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["LAMP_TYPE","SPOT",{type:"equal_expr",e:2},"LAMP_TYPE","POINT",{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],f:[{type:"textline",a:"yH = u_light_positions [ LAMP_IND ] ; GQ = yH - yF ;".split(" ")},{type:"textline",a:"yu = length ( GQ ) ; GS *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + yu * yu ) ; GQ = normalize ( GQ ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["LAMP_TYPE","SPOT",{type:"equal_expr",e:2}],f:[{type:"textline",a:"yH = u_light_directions [ LAMP_IND ] ; yu = dot ( GQ , yH ) ; yu *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( yu - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; GS *= yu ;".split(" ")}]}]}]},{type:"node_else",f:[{type:"textline",a:"GQ = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"GU",qualifier:["vec3"],c:!1},{type:"node_in",
name:"GV",qualifier:["vec2"],c:!1},{type:"node_in",name:"GW",qualifier:["vec3"],c:!1},{type:"node_in",name:"GX",qualifier:["float"],c:!1},{type:"node_in",name:"GY",qualifier:["vec2"],c:!1},{type:"node_out",name:"GZ",qualifier:["float"],c:!1}],f:[{type:"textline",a:"GZ = ZERO_VALUE_NODES ; if ( GV . r != ZERO_VALUE_NODES ) { yu = ( UNITY_VALUE_NODES - GX ) * dot ( GW , GU ) + GX ; if ( GY [ 0 ] == ZERO_VALUE_NODES ) { GZ = UNITY_VALUE_NODES ; } else { yu = UNITY_VALUE_NODES + abs ( yu ) ; yu = GY [ 1 ] + ( UNITY_VALUE_NODES - GY [ 1 ] ) * pow ( yu , GY [ 0 ] ) ; GZ = clamp ( yu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } GZ = max ( GZ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"G_",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ha",qualifier:["vec2"],c:!1},{type:"node_in",name:"Hb",qualifier:["vec3"],c:!1},{type:"node_in",name:"Hc",qualifier:["float"],c:!1},{type:"node_out",name:"Hd",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Hd = ZERO_VALUE_NODES ; if ( Ha . r != ZERO_VALUE_NODES ) { yu = ( UNITY_VALUE_NODES - Hc ) * dot ( Hb , G_ ) + Hc ; Hd = max ( yu , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"He",qualifier:["vec3"],c:!1},{type:"node_in",name:"Hf",qualifier:["vec2"],c:!1},{type:"node_in",name:"Hg",qualifier:["vec3"],c:!1},{type:"node_in",name:"Hh",qualifier:["float"],c:!1},{type:"node_in",name:"Hi",qualifier:["vec2"],c:!1},{type:"node_out",name:"Hj",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Hj = ZERO_VALUE_NODES ; if ( Hf . r != ZERO_VALUE_NODES ) { yu = ( UNITY_VALUE_NODES - Hh ) * dot ( Hg , He ) + Hh ; if ( Hi [ 0 ] > ZERO_VALUE_NODES ) { yv = max ( dot ( Hg , yj ) , ZERO_VALUE_NODES ) ; yw = Hi [ 0 ] * Hi [ 0 ] ; yx = UNITY_VALUE_NODES - xN * ( yw / ( yw + 0.33 ) ) ; yH = He - yu * Hg ; yJ = yj - yv * Hg ;".split(" ")},
{type:"textline",a:"if ( length ( yH ) == ZERO_VALUE_NODES || length ( yJ ) == ZERO_VALUE_NODES || abs ( yu ) > UNITY_VALUE_NODES || abs ( yv ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",a:"Hj = yu * yx ; else { yy = acos ( yu ) ; yv = acos ( yv ) ; yH = normalize ( yH ) ; yJ = normalize ( yJ ) ; yz = max ( yy , yv ) ; yA = min ( yy , yv ) ; yA *= 0.95 ; yv = max ( dot ( yH , yJ ) , ZERO_VALUE_NODES ) ; yw = 0.45 * ( yw / ( yw + 0.09 ) ) ; Hj = yu * ( yx + ( yw * yv * sin ( yz ) * tan ( yA ) ) ) ; } } else Hj = yu ; Hj = max ( Hj , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"Hk",qualifier:["vec3"],c:!1},{type:"node_in",name:"Hl",qualifier:["vec2"],c:!1},{type:"node_in",name:"Hm",qualifier:["vec3"],c:!1},{type:"node_in",name:"Hn",qualifier:["float"],c:!1},{type:"node_in",name:"Ho",qualifier:["vec2"],c:!1},{type:"node_out",name:"Hp",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Hp = ZERO_VALUE_NODES ; if ( Hl . r != ZERO_VALUE_NODES ) { yu = ( UNITY_VALUE_NODES - Hn ) * dot ( Hm , Hk ) + Hn ; yA = max ( dot ( Hm , yj ) , ZERO_VALUE_NODES ) ; if ( Ho [ 0 ] <= UNITY_VALUE_NODES ) Hp = yu * pow ( max ( yA * yu , 0.1 ) , Ho [ 0 ] - UNITY_VALUE_NODES ) ; else Hp = yu * pow ( 1.0001 - yA , Ho [ 0 ] - UNITY_VALUE_NODES ) ; Hp = max ( Hp , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"Hq",qualifier:["vec3"],c:!1},{type:"node_in",name:"Hr",qualifier:["vec2"],c:!1},{type:"node_in",name:"Hs",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ht",qualifier:["float"],c:!1},{type:"node_in",name:"Hu",qualifier:["vec2"],c:!1},{type:"node_out",name:"Hv",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Hv = ZERO_VALUE_NODES ; if ( Hr . r != ZERO_VALUE_NODES ) { yA = ( UNITY_VALUE_NODES - Ht ) * dot ( Hs , Hq ) + Ht ; yA = acos ( yA ) ; if ( yA < Hu [ 0 ] ) Hv = UNITY_VALUE_NODES ; else if ( yA > ( Hu [ 0 ] + Hu [ 1 ] ) || Hu [ 1 ] == ZERO_VALUE_NODES ) Hv = ZERO_VALUE_NODES ; else Hv = UNITY_VALUE_NODES - ( ( yA - Hu [ 0 ] ) / Hu [ 1 ] ) ; Hv = max ( Hv , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"Hw",qualifier:["vec3"],c:!1},{type:"node_in",name:"Hx",qualifier:["vec2"],c:!1},{type:"node_in",name:"Hy",qualifier:["vec3"],c:!1},{type:"node_in",name:"Hz",qualifier:["float"],c:!1},{type:"node_in",name:"HA",qualifier:["vec2"],c:!1},{type:"node_out",name:"HB",qualifier:["float"],c:!1}],f:[{type:"textline",a:"HB = ZERO_VALUE_NODES ; if ( Hx . g == UNITY_VALUE_NODES ) { yJ = normalize ( Hw + yj ) ; HB = ( UNITY_VALUE_NODES - Hz ) * max ( dot ( Hy , yJ ) , ZERO_VALUE_NODES ) + Hz ; HB = pow ( HB , HA [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"HC",qualifier:["vec3"],c:!1},{type:"node_in",name:"HD",qualifier:["vec2"],c:!1},{type:"node_in",name:"HE",qualifier:["vec3"],c:!1},{type:"node_in",name:"HF",qualifier:["vec2"],c:!1},{type:"node_out",name:"HG",qualifier:["float"],c:!1}],f:[{type:"textline",a:"HG = ZERO_VALUE_NODES ; if ( HD . g == UNITY_VALUE_NODES ) { yJ = normalize ( HC + yj ) ; yA = max ( dot ( HE , yJ ) , 0.001 ) ;".split(" ")},{type:"textline",a:"yu = max ( dot ( HE , yj ) , 0.01 ) ; yz = max ( dot ( HE , HC ) , 0.01 ) ; yA = tan ( acos ( yA ) ) ; yv = max ( HF [ 0 ] , 0.001 ) ; HG = yz * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * yv * yv ) ) * ( exp ( - ( yA * yA ) / ( yv * yv ) ) / ( sqrt ( yu * yz ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"HH",qualifier:["vec3"],c:!1},{type:"node_in",name:"HI",qualifier:["vec2"],c:!1},{type:"node_in",name:"HJ",qualifier:["vec3"],c:!1},{type:"node_in",name:"HK",qualifier:["vec2"],c:!1},{type:"node_out",name:"HL",qualifier:["float"],c:!1}],f:[{type:"textline",a:"HL = ZERO_VALUE_NODES ; if ( HI . g == UNITY_VALUE_NODES ) { yJ = normalize ( HH + yj ) ; yz = acos ( dot ( yJ , HJ ) ) ; if ( yz < HK [ 0 ] ) HL = UNITY_VALUE_NODES ; else if ( yz >= HK [ 0 ] + HK [ 1 ] || HK [ 1 ] == ZERO_VALUE_NODES ) HL = ZERO_VALUE_NODES ; else HL = UNITY_VALUE_NODES - ( yz - HK [ 0 ] ) / HK [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"HM",qualifier:["vec3"],c:!1},{type:"node_in",name:"HN",qualifier:["vec2"],c:!1},{type:"node_in",name:"HO",qualifier:["vec3"],c:!1},{type:"node_in",name:"HP",qualifier:["float"],c:!1},{type:"node_in",name:"HQ",qualifier:["vec2"],c:!1},{type:"node_out",name:"HR",qualifier:["float"],c:!1}],f:[{type:"textline",a:"HR = ZERO_VALUE_NODES ; if ( HN . g == UNITY_VALUE_NODES ) { if ( HQ [ 0 ] < UNITY_VALUE_NODES || HQ [ 1 ] == ZERO_VALUE_NODES ) HR = ZERO_VALUE_NODES ; else { if ( HQ [ 1 ] < 100.0 ) HQ [ 1 ] = sqrt ( UNITY_VALUE_NODES / HQ [ 1 ] ) ; else HQ [ 1 ] = 10.0 / HQ [ 1 ] ; yJ = normalize ( yj + HM ) ; yz = ( UNITY_VALUE_NODES - HP ) * max ( dot ( HO , yJ ) , ZERO_VALUE_NODES ) + HP ; if ( yz < ZERO_VALUE_NODES ) HR = ZERO_VALUE_NODES ; else { yu = max ( dot ( HO , yj ) , 0.01 ) ; yv = dot ( HO , HM ) ; if ( yv <= 0.01 ) HR = ZERO_VALUE_NODES ; else { yA = max ( dot ( yj , yJ ) , 0.01 ) ; yw = UNITY_VALUE_NODES ; yu = ( 2.0 * yz * yu ) / yA ; yv = ( 2.0 * yz * yv ) / yA ; yv = min ( min ( yw , yu ) , yv ) ; yu = sqrt ( pow ( HQ [ 0 ] , 2.0 ) + pow ( yA , 2.0 ) - UNITY_VALUE_NODES ) ; yA = pow ( yu - yA , 2.0 ) / pow ( yu + yA , 2.0 ) * ( UNITY_VALUE_NODES + pow ( yA * ( yu + yA ) - UNITY_VALUE_NODES , 2.0 ) / pow ( yA * ( yu - yA ) + UNITY_VALUE_NODES , 2.0 ) ) ; yz = acos ( yz ) ; HR = max ( yA * yv * exp ( - pow ( yz , 2.0 ) / ( 2.0 * pow ( HQ [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"HS",qualifier:["vec4"],c:!1},{type:"node_in",name:"HT",qualifier:["vec3"],c:!1},{type:"node_in",name:"HU",qualifier:["float"],c:!1},{type:"node_in",name:"HV",qualifier:["float"],c:!1},{type:"node_in",name:"HW",qualifier:["vec3"],c:!1},{type:"node_in",name:"HX",qualifier:["vec3"],c:!1},{type:"node_in",name:"HY",qualifier:["vec4"],c:!1},{type:"node_in",name:"HZ",qualifier:["vec3"],c:!1},{type:"node_in",name:"H_",qualifier:["vec3"],c:!1},{type:"node_in",
name:"Ia",qualifier:["vec3"],c:!1},{type:"node_in",name:"Ib",qualifier:["float"],c:!1},{type:"node_out",name:"Ic",qualifier:["vec4"],c:!1},{type:"node_out",name:"Id",qualifier:["vec3"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_NODE_B4W_TRANSLUCENCY"],f:[{type:"textline",a:"if ( dot ( HW , HX ) * dot ( yj , HX ) < ZERO_VALUE_NODES ) { yz = HY . x ; yv = HY . y ; yA = HY . z ; yu = HY . w ;".split(" ")},{type:"textline",a:"yw = clamp ( abs ( dot ( HW , HX ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yx = clamp ( dot ( yj , - HW ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yv = pow ( yx , yv ) ;".split(" ")},
{type:"textline",a:"Ic = HS + Ib * vec4 ( Ia * yw * pow ( HZ , vec3 ( yz ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",a:"Ic += yA * mix ( vec4 ( HZ , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , yu ) * Ib * vec4 ( Ia * yw * vec3 ( yv ) , UNITY_VALUE_NODES ) ; Id = HT ; } else {".split(" ")},{type:"textline",a:"Id = HT + Ia * H_ * HV ; Ic = HS + vec4 ( Ia * HZ * HU , HV ) ; }".split(" ")}]},{type:"node_else",f:[{type:"textline",a:"Id = HT + Ia * H_ * HV ; Ic = HS + vec4 ( Ia * HZ * HU , HV ) ;".split(" ")}]}]}]},
{type:"node",name:"RGB",h:[{type:"node_out",name:"Ie",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Ie = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",h:[{type:"node_in",name:"If",qualifier:["vec3"],c:!1},{type:"node_out",name:"Ig",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Ig = dot ( If , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",h:[{type:"node_in",name:"Ih",qualifier:["vec3"],c:!1},{type:"node_out",name:"Ii",qualifier:["float"],c:!0},
{type:"node_out",name:"Ij",qualifier:["float"],c:!0},{type:"node_out",name:"Ik",qualifier:["float"],c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Ii"],f:[{type:"textline",a:"Ii = Ih . r ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Ij"],f:[{type:"textline",a:"Ij = Ih . g ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Ik"],f:[{type:"textline",a:"Ik = Ih . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",h:[{type:"node_in",name:"Il",
qualifier:["vec3"],c:!1},{type:"node_out",name:"Im",qualifier:["float"],c:!0},{type:"node_out",name:"In",qualifier:["float"],c:!0},{type:"node_out",name:"Io",qualifier:["float"],c:!0}],f:[{type:"textline",a:"yJ = xS ( Il ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Im"],f:[{type:"textline",a:"Im = yJ . r ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_In"],f:[{type:"textline",a:"In = yJ . g ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",
d:["USE_OUT_Io"],f:[{type:"textline",a:"Io = yJ . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",h:[{type:"node_in",name:"Ip",qualifier:["float"],c:!1},{type:"node_in",name:"Iq",qualifier:["float"],c:!1},{type:"node_in",name:"Ir",qualifier:["float"],c:!1},{type:"node_out",name:"Is",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Is = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( Ip - Ir ) * Iq ) ) ;".split(" ")}]},{type:"node",name:"GAMMA",h:[{type:"node_in",name:"It",qualifier:["vec3"],
c:!1},{type:"node_in",name:"Iu",qualifier:["float"],c:!1},{type:"node_out",name:"Iv",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Iv = It ; if ( Iv . x > ZERO_VALUE_NODES ) Iv . x = pow ( It . x , Iu ) ; if ( Iv . y > ZERO_VALUE_NODES ) Iv . y = pow ( It . y , Iu ) ; if ( Iv . z > ZERO_VALUE_NODES ) Iv . z = pow ( It . z , Iu ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",h:[{type:"node_in",name:"Iw",qualifier:["vec3"],c:!1},{type:"node_out",name:"Ix",qualifier:["vec3"],c:!1}],f:[{type:"textline",
a:"Ix = max ( vec3 ( ZERO_VALUE_NODES ) , Iw ) ; Ix = pow ( Ix , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",h:[{type:"node_in",name:"Iy",qualifier:["vec3"],c:!1},{type:"node_out",name:"Iz",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Iz = max ( vec3 ( ZERO_VALUE_NODES ) , Iy ) ; Iz = pow ( Iz , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",h:[{type:"node_out",name:"IA",qualifier:["vec3"],c:!1},{type:"node_out",name:"IB",qualifier:["vec3"],
c:!1},{type:"node_out",name:"IC",qualifier:["float"],c:!1}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IC"],f:[{type:"textline",a:"IA [ 2 ] = IA [ 1 ] = IA [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IC"],f:[{type:"textline",a:"IB [ 2 ] = IB [ 1 ] = IB [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IC"],f:[{type:"textline",a:["IC","=","ZERO_VALUE_NODES",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",
h:[{type:"node_in",name:"ID",qualifier:["vec3"],c:!1},{type:"node_out",name:"IE",qualifier:["vec3"],c:!0},{type:"node_out",name:"IF",qualifier:["float"],c:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"],c:!1}],f:[{type:"textline",a:"yC = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , ID ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IE"],f:[{type:"textline",a:"IE = yC . xyz ; br ( IE ) ;".split(" ")}]}]},{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_IF"],f:[{type:"textline",a:"IF = yC . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",h:[{type:"node_in",name:"IG",qualifier:["vec3"],c:!0},{type:"node_in",name:"IH",qualifier:["vec3"],c:!0},{type:"node_in",name:"II",qualifier:["vec3"],c:!0},{type:"node_in",name:"IJ",qualifier:["vec3"],c:!0},{type:"node_out",name:"IK",qualifier:["vec3"],c:!0},{type:"node_out",name:"IL",qualifier:["float"],c:!0},{type:"node_out",name:"IM",qualifier:["vec3"],c:!0},{type:"node_out",
name:"IN",qualifier:["float"],c:!0},{type:"node_out",name:"IO",qualifier:["vec3"],c:!0},{type:"node_out",name:"IP",qualifier:["float"],c:!0},{type:"node_out",name:"IQ",qualifier:["vec3"],c:!0},{type:"node_out",name:"IR",qualifier:["float"],c:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"],c:!1}],f:[{type:"textline",a:"yC = texture2D ( node_TEXTURE_COLOR_var_texture , x_ ( IG ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IK"],
f:[{type:"textline",a:"IK = yC . xyz ; br ( IK ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IL"],f:[{type:"textline",a:"IL = yC . w ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv2"],f:[{type:"textline",a:"yC = texture2D ( node_TEXTURE_COLOR_var_texture , x_ ( IH ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IM"],f:[{type:"textline",a:"IM = yC . xyz ; br ( IM ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",
d:["USE_OUT_IN"],f:[{type:"textline",a:"IN = yC . w ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv3"],f:[{type:"textline",a:"yC = texture2D ( node_TEXTURE_COLOR_var_texture , x_ ( II ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IO"],f:[{type:"textline",a:"IO = yC . xyz ; br ( IO ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IP"],f:[{type:"textline",a:"IP = yC . w ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",
d:["USE_uv4"],f:[{type:"textline",a:"yC = texture2D ( node_TEXTURE_COLOR_var_texture , x_ ( IJ ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IQ"],f:[{type:"textline",a:"IQ = yC . xyz ; br ( IQ ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IR"],f:[{type:"textline",a:"IR = yC . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",h:[{type:"node_in",name:"IS",qualifier:["vec3"],c:!0},{type:"node_in",name:"IT",qualifier:["vec3"],c:!0},{type:"node_in",
name:"IU",qualifier:["vec3"],c:!0},{type:"node_in",name:"IV",qualifier:["vec3"],c:!0},{type:"node_out",name:"IW",qualifier:["vec3"],c:!0},{type:"node_out",name:"IX",qualifier:["float"],c:!0},{type:"node_out",name:"IY",qualifier:["vec3"],c:!0},{type:"node_out",name:"IZ",qualifier:["float"],c:!0},{type:"node_out",name:"I_",qualifier:["vec3"],c:!0},{type:"node_out",name:"Ja",qualifier:["float"],c:!0},{type:"node_out",name:"Jb",qualifier:["vec3"],c:!0},{type:"node_out",name:"Jc",qualifier:["float"],c:!0},
{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"],c:!1}],f:[{type:"textline",a:"yC = texture2D ( node_TEXTURE_NORMAL_var_texture , x_ ( IS ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IW"],f:[{type:"textline",a:"IW = normalize ( yD * ( yC . xyz - xN ) ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IX"],f:[{type:"textline",a:"IX = yC . w ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv2"],
f:[{type:"textline",a:"yC = texture2D ( node_TEXTURE_NORMAL_var_texture , x_ ( IT ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IY"],f:[{type:"textline",a:"IY = normalize ( yD * ( yC . xyz - xN ) ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_IZ"],f:[{type:"textline",a:"IZ = yC . w ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv3"],f:[{type:"textline",a:"yC = texture2D ( node_TEXTURE_NORMAL_var_texture , x_ ( IU ) ) ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_I_"],f:[{type:"textline",a:"I_ = normalize ( yD * ( yC . xyz - xN ) ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Ja"],f:[{type:"textline",a:"Ja = yC . w ;".split(" ")}]}]}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_uv4"],f:[{type:"textline",a:"yC = texture2D ( node_TEXTURE_NORMAL_var_texture , x_ ( IV ) ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Jb"],f:[{type:"textline",a:"Jb = normalize ( yD * ( yC . xyz - xN ) ) ;".split(" ")}]}]},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Jc"],f:[{type:"textline",a:"Jc = yC . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",h:[{type:"node_out",name:"Jd",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Jd = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",h:[{type:"node_in",name:"Je",qualifier:["vec3"],c:!1},{type:"node_in",name:"Jf",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jg",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jh",qualifier:["float"],
c:!0}],f:[{type:"textline",a:"Jg = Je + Jf ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Jh"],f:[{type:"textline",a:"Jh = ( abs ( Jg [ 0 ] ) + abs ( Jg [ 1 ] ) + abs ( Jg [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",h:[{type:"node_in",name:"Ji",qualifier:["vec3"],c:!1},{type:"node_in",name:"Jj",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jk",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jl",qualifier:["float"],c:!0}],f:[{type:"textline",
a:"Jk = Ji - Jj ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Jl"],f:[{type:"textline",a:"Jl = ( abs ( Jk [ 0 ] ) + abs ( Jk [ 1 ] ) + abs ( Jk [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",h:[{type:"node_in",name:"Jm",qualifier:["vec3"],c:!1},{type:"node_in",name:"Jn",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jo",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jp",qualifier:["float"],c:!0}],f:[{type:"textline",a:"Jo = Jm + Jn ;".split(" ")},
{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Jp"],f:[{type:"textline",a:"Jp = length ( Jo ) ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Jo"],f:[{type:"textline",a:"Jo = normalize ( Jo ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",h:[{type:"node_in",name:"Jq",qualifier:["vec3"],c:!1},{type:"node_in",name:"Jr",qualifier:["vec3"],c:!1},{type:"node_out",name:"Js",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jt",qualifier:["float"],c:!0}],f:[{type:"textline",
a:"Js = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_Jt"],f:[{type:"textline",a:"Jt = dot ( Jq , Jr ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",h:[{type:"node_in",name:"Ju",qualifier:["vec3"],c:!1},{type:"node_in",name:"Jv",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jw",qualifier:["vec3"],c:!1},{type:"node_out",name:"Jx",qualifier:["float"],c:!0}],f:[{type:"textline",a:"Jw = cross ( Ju , Jv ) ;".split(" ")},{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_Jx"],f:[{type:"textline",a:"Jx = length ( Jw ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",h:[{type:"node_in",name:"Jy",qualifier:["vec3"],c:!1},{type:"node_in",name:"Jz",qualifier:["vec3"],c:!1},{type:"node_out",name:"JA",qualifier:["vec3"],c:!1},{type:"node_out",name:"JB",qualifier:["float"],c:!0}],f:[{type:"textline",a:"JA = normalize ( Jy ) ;".split(" ")},{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_JB"],f:[{type:"textline",a:"JB = length ( Jy ) ;".split(" ")}]}]},
{type:"textline",a:["Jz",";"]}]},{type:"node",name:"B4W_REFLECT",h:[{type:"node_in",name:"JC",qualifier:["vec3"],c:!1},{type:"node_in",name:"JD",qualifier:["vec3"],c:!1},{type:"node_out",name:"JE",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"JE = reflect ( - JC , JD ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",h:[{type:"node_in",name:"JF",qualifier:["vec3"],c:!1},{type:"node_in",name:"JG",qualifier:["float"],c:!1},{type:"node_in",name:"JH",qualifier:["const","float"],c:!1},{type:"node_in",
name:"JI",qualifier:["const","float"],c:!1},{type:"node_out",name:"JJ",qualifier:["vec3"],c:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"],c:!1}],f:[{type:"textline",a:"yv = length ( yB ) ; if ( yv < JI ) { yq = x_ ( JF ) ; yv = clamp ( xN * ( JI - yv ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yv = JG * yv ;".split(" ")},{type:"textline",a:"yJ = normalize ( yj * yD ) ;".split(" ")},{type:"textline",a:"yw = UNITY_VALUE_NODES / JH ;".split(" ")},{type:"textline",
a:"yr = yJ . xy * yv / ( JH * yJ . z ) ; yv = UNITY_VALUE_NODES ; yu = texture2D ( node_B4W_PARALLAX_var_texture , yq ) . a ;".split(" ")},{type:"textline",a:"for ( float JK = 1.0 ; JK <= JH ; JK ++ ) { if ( yu < yv ) { yv -= yw ; yq -= yr ; yu = texture2D ( node_B4W_PARALLAX_var_texture , yq ) . a ; } }".split(" ")},{type:"textline",a:"yr = yq + yr ; yw = texture2D ( node_B4W_PARALLAX_var_texture , yr ) . a - ( yv + yw ) ; yv = yu - yv ; yw = yv / ( yv - yw ) ;".split(" ")},{type:"textline",a:"yq = yw * yr + ( UNITY_VALUE_NODES - yw ) * yq ; JJ = xY ( yq ) ; } else JJ = JF ;".split(" ")}]},
{type:"node",name:"B4W_CLAMP",h:[{type:"node_in",name:"JL",qualifier:["vec3"],c:!1},{type:"node_out",name:"JM",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"JM = clamp ( JL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",h:[{type:"node_in",name:"JN",qualifier:["vec3"],c:!1},{type:"node_in",name:"JO",qualifier:["float"],c:!1},{type:"node_out",name:"JP",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"JP = JN ; JO ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",
h:[{type:"node_in",name:"JQ",qualifier:["float"],c:!1},{type:"node_in",name:"JR",qualifier:["float"],c:!1},{type:"node_in",name:"JS",qualifier:["float"],c:!1},{type:"node_in",name:"JT",qualifier:["float"],c:!1},{type:"node_in",name:"JU",qualifier:["float"],c:!1},{type:"node_out",name:"JV",qualifier:["float"],c:!0},{type:"node_out",name:"JW",qualifier:["vec4"],c:!0}],f:[{type:"node_condition",b:[{type:"node_if",d:["USE_OUT_JV"],f:[{type:"textline",a:["JV","=","JQ",";"]}]}]},{type:"node_condition",
b:[{type:"node_if",d:["USE_OUT_JW"],f:[{type:"textline",a:"JW = vec4 ( JR , JS , JT , JU ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",h:[{type:"node_out",name:"JX",qualifier:["float"],c:!1}],f:[{type:"textline",a:["JX","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",h:[{type:"node_in",name:"JY",qualifier:["float"],c:!1},{type:"node_in",name:"JZ",qualifier:["float"],c:!1},{type:"node_in",name:"J_",qualifier:["float"],c:!1},{type:"node_out",name:"Ka",qualifier:["float"],c:!1}],f:[{type:"textline",
a:"Ka = smoothstep ( JZ , J_ , JY ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",h:[{type:"node_in",name:"Kb",qualifier:["vec3"],c:!1},{type:"node_in",name:"Kc",qualifier:["float"],c:!1}],f:[{type:"textline",a:"yl = Kb ; yp = Kc ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",h:[{type:"node_in",name:"Kd",qualifier:["vec3"],c:!1},{type:"node_out",name:"Ke",qualifier:["float"],c:!1}],f:[{type:"textline",a:"Ke = ( Kd . r + Kd . g + Kd . b ) / 3.0 ;".split(" ")}]},{type:"node",name:"B4W_SCALTOVEC",
h:[{type:"node_in",name:"Kf",qualifier:["float"],c:!1},{type:"node_out",name:"Kg",qualifier:["vec3"],c:!1}],f:[{type:"textline",a:"Kg [ 0 ] = Kf ; Kg [ 1 ] = Kf ; Kg [ 2 ] = Kf ;".split(" ")}]},{type:"nodes_global"},{type:"textline",a:"void Kh ( in vec3 yj , in mat4 yk , out vec3 yl , out vec3 ym , out vec3 yn , out vec4 yo , out float yp ) { vec2 yq , yr ; float ys , yt , yu , yv , yw , yx , yy , yz , yA ; vec4 yB , yC ; mat3 yD ; vec3 yE , yF , yG , yH , yI , yJ ; yl = vec3 ( ZERO_VALUE_NODES ) ; ym = vec3 ( ZERO_VALUE_NODES ) ; yn = vec3 ( ZERO_VALUE_NODES ) ; yo = vec4 ( ZERO_VALUE_NODES ) ; yp = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",b:[{type:"if",d:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",e:5}],group:{type:"group",b:[{type:"textline",a:"yE = normalize ( bE ) ; yF = yE ;".split(" ")},{type:"condition",b:[{type:"if",d:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["INVERT_FRONTFACING"],group:{type:"group",b:[{type:"textline",a:["if","(","!",
"gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",a:"yF = yF ; else yF = - yF ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",b:[{type:"textline",a:["yG","=","yF",";"]}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:["yG","=","yE",";"]}]}}]},{type:"condition",b:[{type:"if",d:["USE_NODE_GEOMETRY_NO"],group:{type:"group",b:[{type:"textline",a:["yE","=",
"yF",";"]}]}}]}]}}]},{type:"condition",b:[{type:"if",d:["CALC_TBN_SPACE"],group:{type:"group",b:[{type:"textline",a:"yH = cross ( yF , bF . xyz ) * bF . w ; yD = mat3 ( bF . xyz , yH , yF ) ; yD = yD ;".split(" ")}]}}]},{type:"textline",a:"yF = bC ; yB = bD ; ys = u_emit ; yt = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",a:["}"]}]};a["include/particles.glslv"]={type:"group",b:[{type:"var",name:"EPSILON",a:["0.0001"]},{type:"textline",a:"struct Kj { float a ; vec3 b ; float c ; vec3 d ; float e ; vec3 f ; vec3 g ; float h ; } ;".split(" ")},
{type:"condition",b:[{type:"if",d:["COLOR_RAMP_LENGTH",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"void Kp ( inout vec3 Kk , float Kl , vec4 Km , vec4 Kn ) { float Ko ; Ko = Kn . x - Km . x ; Ko = ( Kl - Km . x ) / Ko ; Kk = mix ( Kk , Kn . yzw , clamp ( Ko , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["COLOR_RAMP_LENGTH",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vec3 Kv ( float Kq , float Kr , vec4 Ks [ COLOR_RAMP_LENGTH ] ) { vec3 Kt ; float Ku ; Ku = Kq / Kr ; Kt = Ks [ 0 ] . yzw ;".split(" ")},
{type:"condition",b:[{type:"if",d:["COLOR_RAMP_LENGTH",1,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Kp ( Kt , Ku , Ks [ 0 ] , Ks [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["COLOR_RAMP_LENGTH",2,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Kp ( Kt , Ku , Ks [ 1 ] , Ks [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["COLOR_RAMP_LENGTH",3,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"Kp ( Kt , Ku , Ks [ 2 ] , Ks [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",a:["return","Kt",";","}"]}]}}]},{type:"textline",a:"float KD ( float Kw , float Kx , float Ky , float Kz ) { float KA , KB , KC ; KA = max ( 0.01 , min ( Kx , Ky ) ) ; KB = max ( 0.01 , min ( Kx , Kz ) ) ; KC = Kx - KB ; KB = clamp ( Kw / KA , 0.0 , 1.0 ) - step ( KC , Kw ) * ( Kw - KC ) / KB ; return KB ; } Kj KL ( ) { mat4 KE ; vec3 KF , KG ; float KH , KI , KJ ; Kj KK ; KI = a_p_data [ 0 ] ; KJ = a_p_data [ 1 ] ; if ( u_p_cyclic == 1 ) { KH = mod ( u_p_time , u_p_length ) - KJ ; if ( KH < 0.0 ) KH += u_p_length ; } if ( u_p_cyclic != 1 ) { KH = u_p_time - KJ ; } if ( KH < 0.0 || KH >= KI ) { KK . a = 0.0001 ; KK . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( KH < 0.0 || KH >= KI ) ) {".split(" ")},
{type:"condition",b:[{type:"if",d:["WORLD_SPACE"],group:{type:"group",b:[{type:"textline",a:"KF = a_position ; KG = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"KE = O ( u_model_tsr ) ; KF = ( KE * vec4 ( a_position , 1.0 ) ) . xyz ; KG = ( KE * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",a:"KG = u_p_nfactor * KG ; KG += a_p_vels . xyz ; KG . y -= u_p_gravity * KH / 2.0 ; KI = max ( u_p_mass , EPSILON ) ; KG += ( u_p_wind_fac * u_wind / KI ) * KH / 2.0 ; KK . h = KH ; KK . f = KG ; KK . g = a_normal * a_p_vels . w ; KK . b = KF + KG * KH ; KK . e = a_p_vels . w * KH ;".split(" ")},
{type:"condition",b:[{type:"if",d:["USE_COLOR_RAMP"],group:{type:"group",b:[{type:"textline",a:"KK . a = texture2D ( u_color_ramp_tex , vec2 ( KH / u_p_max_lifetime , 0.5 ) ) . g ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"KK . a = 1.0 ;".split(" ")}]}}]},{type:"condition",b:[{type:"if",d:["COLOR_RAMP_LENGTH",0,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"KK . d = Kv ( KH , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",
b:[{type:"textline",a:"KK . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",a:"KK . c = KD ( KH , a_p_data [ 0 ] , u_p_fade_in , u_p_fade_out ) ; } return KK ; }".split(" ")}]};a["include/particles_nodes.glslv"]={type:"group",b:[{type:"node",name:"TEX_COORD_UV",h:[],f:[{type:"textline",a:"bM = KR + 0.5 ;".split(" ")}]},{type:"node",name:"UV_MERGED",h:[],f:[{type:"textline",a:"bM = KR + 0.5 ;".split(" ")}]},{type:"node",name:"UVMAP",h:[],f:[{type:"textline",a:"bM = KR + 0.5 ;".split(" ")}]},
{type:"node",name:"GEOMETRY_UV",h:[],f:[{type:"textline",a:"bM = KR + 0.5 ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",h:[{type:"node_param",name:"yb",qualifier:["varying","vec4"],c:!0},{type:"node_param",name:"yc",qualifier:["varying","vec3"],c:!0},{type:"node_param",name:"yd",qualifier:["varying","vec3"],c:!0},{type:"node_param",name:"ye",qualifier:["varying","vec3"],c:!0},{type:"node_param",name:"node_PARTICLE_INFO_var_a_p_indices",qualifier:["attribute","float"],c:!0}],f:[{type:"node_condition",
b:[{type:"node_if",d:["PART_INFO_SIZE"],f:[{type:"textline",a:"yb [ 3 ] = KQ ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["PART_INFO_AGE"],f:[{type:"textline",a:"yb [ 1 ] = KP ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["PART_INFO_LT"],f:[{type:"textline",a:"yb [ 2 ] = KS ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["PART_INFO_LOC"],f:[{type:"textline",a:["yc","=","KM",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["PART_INFO_IND"],
f:[{type:"textline",a:"yb [ 0 ] = node_PARTICLE_INFO_var_a_p_indices ;".split(" ")}]}]},{type:"node_condition",b:[{type:"node_if",d:["PART_INFO_VEL"],f:[{type:"textline",a:["yd","=","KN",";"]}]}]},{type:"node_condition",b:[{type:"node_if",d:["PART_INFO_A_VEL"],f:[{type:"textline",a:["ye","=","KO",";"]}]}]}]},{type:"nodes_global"},{type:"textline",a:"void KT ( in vec3 KM , in vec3 KN , in vec3 KO , in float KP , in float KQ , in vec2 KR , in float KS ) {".split(" ")},{type:"condition",b:[{type:"if",
d:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"bM = KR + 0.5 ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",a:["}"]}]};a["include/blending.glslf"]={type:"group",b:[{type:"textline",a:"float KV = 0.0 ; float KW = 1.0 ; vec3 La ( vec3 KX ) { float KY , KZ ; vec4 K_ ; K_ = vec4 ( KV , - KW / 3.0 , 2.0 / 3.0 , - KW ) ; K_ = mix ( vec4 ( KX . bg , K_ . wz ) , vec4 ( KX . gb , K_ . xy ) , step ( KX . b , KX . g ) ) ; K_ = mix ( vec4 ( K_ . xyw , KX . r ) , vec4 ( KX . r , K_ . yzx ) , step ( K_ . x , KX . r ) ) ; KY = K_ . x - min ( K_ . w , K_ . y ) ; KZ = 1.0e-10 ; return vec3 ( abs ( K_ . z + ( K_ . w - K_ . y ) / ( 6.0 * KY + KZ ) ) , KY / ( K_ . x + KZ ) , K_ . x ) ; } vec3 Le ( vec3 Lb ) { vec3 Lc ; vec4 Ld ; Ld = vec4 ( KW , 2.0 / 3.0 , KW / 3.0 , 3.0 ) ; Lc = abs ( fract ( vec3 ( Lb . r , Lb . r , Lb . r ) + Ld . xyz ) * 6.0 - Ld . www ) ; return Lb . b * mix ( Ld . xxx , clamp ( Lc - Ld . xxx , KV , KW ) , Lb . g ) ; } vec3 Li ( vec3 Lf , vec3 Lg , float Lh ) { return mix ( Lf , Lg , Lh ) ; } vec3 Lm ( vec3 Lj , vec3 Lk , float Ll ) { return Ll * Lj + Lk ; } vec3 Lq ( vec3 Ln , vec3 Lo , float Lp ) { return Lo - Lp * Ln ; } vec3 Lv ( vec3 Lr , vec3 Ls , float Lt ) { float Lu ; Lu = KW - Lt ; return ( vec3 ( Lu ) + Lt * Lr ) * Ls ; } vec3 LA ( vec3 Lw , vec3 Lx , float Ly ) { vec3 Lz ; Lz = vec3 ( KW - Ly ) ; return vec3 ( KW ) - ( Lz + Ly * ( vec3 ( KW ) - Lw ) ) * ( vec3 ( KW ) - Lx ) ; } vec3 LF ( vec3 LB , vec3 LC , float LD ) { vec3 LE ; LE = vec3 ( KW - LD ) ; return mix ( LC * ( LE + 2.0 * LD * LB ) , vec3 ( KW ) - ( LE + 2.0 * LD * ( vec3 ( KW ) - LB ) ) * ( vec3 ( KW ) - LC ) , step ( 0.5 , LC ) ) ; } vec3 LJ ( vec3 LG , vec3 LH , float LI ) { return mix ( LH , abs ( LG - LH ) , LI ) ; } vec3 LN ( vec3 LK , vec3 LL , float LM ) { return mix ( LL , LL / ( LK + step ( LK , vec3 ( KV ) ) ) , LM ) ; } vec3 LR ( vec3 LO , vec3 LP , float LQ ) { return mix ( LP , min ( LO , LP ) , LQ ) ; } vec3 LV ( vec3 LS , vec3 LT , float LU ) { return max ( LU * LS , LT ) ; } vec3 Ma ( vec3 LW , vec3 LX , float LY ) { vec3 LZ , L_ ; LZ = La ( LX ) ; if ( LZ . y != KV ) { L_ = La ( LW ) ; L_ = Le ( vec3 ( LZ . x , L_ . yz ) ) ; return mix ( LW , L_ , LY ) ; } return LW ; } vec3 Mg ( vec3 Mb , vec3 Mc , float Md ) { vec3 Me , Mf ; Me = La ( Mb ) ; if ( Me . y != KV ) { Mf = La ( Mc ) ; return Le ( vec3 ( Me . x , mix ( Me . y , Mf . y , Md ) , Me . z ) ) ; } return Mb ; } vec3 Mm ( vec3 Mh , vec3 Mi , float Mj ) { vec3 Mk , Ml ; Mk = La ( Mh ) ; Ml = La ( Mi ) ; return Le ( vec3 ( Mk . xy , mix ( Mk . z , Ml . z , Mj ) ) ) ; } vec3 Ms ( vec3 Mn , vec3 Mo , float Mp ) { vec3 Mq , Mr ; Mq = La ( Mo ) ; if ( Mq . y != KV ) { Mr = La ( Mn ) ; Mr = Le ( vec3 ( Mq . xy , Mr . z ) ) ; return mix ( Mn , Mr , Mp ) ; } return Mn ; } vec3 Mx ( vec3 Mt , vec3 Mu , float Mv ) { vec3 Mw ; Mw = vec3 ( KW ) - ( vec3 ( KW ) - Mu ) * ( vec3 ( KW ) - Mt ) ; return mix ( Mt , ( ( vec3 ( KW ) - Mt ) * Mu * Mt ) + Mt * Mw , Mv ) ; } vec3 MB ( vec3 My , vec3 Mz , float MA ) { return My + MA * ( 2.0 * Mz - KW ) ; } float MH ( float MC , float MD , float ME , float MF ) { float MG ; MG = KW - MF ; return ( MG + ME * MC ) * MD ; } float MN ( float MI , float MJ , float MK , float ML ) { float MM ; MM = KW - ML ; return KW - ( MM + MK * ( KW - MI ) ) * ( KW - MJ ) ; } float MT ( float MO , float MP , float MQ , float MR ) { float MS ; MS = KW - MR ; return mix ( MP * ( MS + 2.0 * MQ * MO ) , KW - ( MS + 2.0 * MQ * ( KW - MO ) ) * ( KW - MP ) , step ( 0.5 , MP ) ) ; }".split(" ")}]};
a["include/fxaa.glslf"]={type:"group",b:[{type:"condition",b:[{type:"ifndef",name:"FXAA_PS3",group:{type:"group",b:[{type:"define",name:"FXAA_PS3",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_360",group:{type:"group",b:[{type:"define",name:"FXAA_360",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_360_OPT",group:{type:"group",b:[{type:"define",name:"FXAA_360_OPT",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_PC",group:{type:"group",b:[{type:"define",name:"FXAA_PC",
a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_PC_CONSOLE",group:{type:"group",b:[{type:"define",name:"FXAA_PC_CONSOLE",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_GLSL_120",group:{type:"group",b:[{type:"define",name:"FXAA_GLSL_120",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_GLSL_130",group:{type:"group",b:[{type:"define",name:"FXAA_GLSL_130",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_HLSL_3",group:{type:"group",b:[{type:"define",
name:"FXAA_HLSL_3",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_HLSL_4",group:{type:"group",b:[{type:"define",name:"FXAA_HLSL_4",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_HLSL_5",group:{type:"group",b:[{type:"define",name:"FXAA_HLSL_5",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_GREEN_AS_LUMA",group:{type:"group",b:[{type:"define",name:"FXAA_GREEN_AS_LUMA",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_EARLY_EXIT",group:{type:"group",
b:[{type:"define",name:"FXAA_EARLY_EXIT",a:["1"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_DISCARD",group:{type:"group",b:[{type:"define",name:"FXAA_DISCARD",a:["0"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",b:[{type:"condition",b:[{type:"ifdef",name:"GL_EXT_gpu_shader4",group:{type:"group",b:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",a:["1"]}]}}]},{type:"condition",b:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",b:[{type:"define",
name:"FXAA_FAST_PIXEL_OFFSET",a:["1"]}]}}]},{type:"condition",b:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",b:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",a:["1"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",b:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",a:["0"]}]}}]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:["FXAA_HLSL_5",1,{type:"equal_expr",e:2}],
group:{type:"group",b:[{type:"define",name:"FXAA_GATHER4_ALPHA",a:["1"]}]}}]},{type:"condition",b:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",b:[{type:"define",name:"FXAA_GATHER4_ALPHA",a:["1"]}]}}]},{type:"condition",b:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",b:[{type:"define",name:"FXAA_GATHER4_ALPHA",a:["1"]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",b:[{type:"define",name:"FXAA_GATHER4_ALPHA",a:["0"]}]}}]}]}}]},{type:"condition",
b:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:[1],group:{type:"group",b:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:[0],group:{type:"group",b:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",a:["4.0"]}]}}]},{type:"condition",b:[{type:"if",d:[0],group:{type:"group",b:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",a:["2.0"]}]}}]}]}}]},{type:"condition",b:[{type:"ifndef",
name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",group:{type:"group",b:[{type:"condition",b:[{type:"if",d:[1],group:{type:"group",b:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",a:["0.125"]}]}},{type:"else",group:{type:"group",b:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",a:["0.25"]}]}}]}]}}]},{type:"condition",b:[{type:"ifndef",name:"FXAA_QUALITY_PRESET",group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PRESET",a:["12"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",
10,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["3"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",a:["3.0"]},{type:"define",name:"FXAA_QUALITY_P2",a:["12.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",11,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["4"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},
{type:"define",name:"FXAA_QUALITY_P2",a:["3.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["12.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",12,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["5"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["12.0"]}]}}]},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",13,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["6"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["12.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",
14,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["7"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P6",a:["12.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",
15,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["8"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",a:["12.0"]}]}}]},{type:"condition",
b:[{type:"if",d:["FXAA_QUALITY_PRESET",20,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["3"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P2",a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",21,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["4"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",
name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",22,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["5"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P4",a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",23,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["6"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["8.0"]}]}}]},{type:"condition",
b:[{type:"if",d:["FXAA_QUALITY_PRESET",24,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["7"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["3.0"]},{type:"define",name:"FXAA_QUALITY_P6",a:["8.0"]}]}}]},{type:"condition",
b:[{type:"if",d:["FXAA_QUALITY_PRESET",25,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["8"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",
a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",26,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["9"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",
a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P8",a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",27,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["10"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",
a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P9",a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",28,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["11"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",
a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P10",a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",
29,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["12"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",a:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P8",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",a:["8.0"]}]}}]},{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PRESET",39,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"define",name:"FXAA_QUALITY_PS",a:["12"]},{type:"define",name:"FXAA_QUALITY_P0",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P2",a:["1.0"]},{type:"define",
name:"FXAA_QUALITY_P3",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P4",a:["1.0"]},{type:"define",name:"FXAA_QUALITY_P5",a:["1.5"]},{type:"define",name:"FXAA_QUALITY_P6",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",a:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",a:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",a:["8.0"]}]}}]},{type:"var",name:"FXAA_QUALITY_P12",a:["0.0"]},{type:"textline",a:"float Np ( float No ) { return clamp ( No , 0.0 , 1.0 ) ; }".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_BLEND4WEB",1,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"vec4 Ns ( sampler2D Nq , vec2 Nr ) { return texture2D ( Nq , Nr ) ; } vec4 Nx ( sampler2D Nt , vec2 Nu , vec2 Nv , vec2 Nw ) { return texture2D ( Nt , Nu + ( Nv * Nw ) ) ; }".split(" ")}]}}]},{type:"textline",a:"vec4 Od ( vec2 Ny , sampler2D Nz , vec2 NA , float NB , float NC , float ND ) { bool NE , NF , NG , NH , NI ; float NJ , NK , NL , NM , NN , NO , NP , NQ , NR , NS , NT , NU , NV , NW , NX ; vec4 NY ; vec2 NZ , N_ , Oa , Ob , Oc ; NZ . x = Ny . x ; NZ . y = Ny . y ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_GATHER4_ALPHA",1,{type:"equal_expr",e:2}],group:{type:"group",b:[]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"NY = Ns ( Nz , NZ ) ; NJ = bB ( NY ) ; NK = bB ( Nx ( Nz , NZ , vec2 ( 0 , 1 ) , NA . xy ) ) ; NL = bB ( Nx ( Nz , NZ , vec2 ( 1 , 0 ) , NA . xy ) ) ; NM = bB ( Nx ( Nz , NZ , vec2 ( 0 , - 1 ) , NA . xy ) ) ; NN = bB ( Nx ( Nz , NZ , vec2 ( - 1 , 0 ) , NA . xy ) ) ;".split(" ")}]}}]},{type:"textline",a:"NO = max ( NK , NJ ) ; NP = min ( NK , NJ ) ; NO = max ( NL , NO ) ; NP = min ( NL , NP ) ; NQ = max ( NM , NN ) ; NR = min ( NM , NN ) ; NO = max ( NQ , NO ) ; NP = min ( NR , NP ) ; NR = NO * NC ; NP = NO - NP ; NR = max ( ND , NR ) ; NE = NP < NR ; if ( NE ) return NY ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_GATHER4_ALPHA",0,{type:"equal_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"NR = bB ( Nx ( Nz , NZ , vec2 ( - 1 , - 1 ) , NA . xy ) ) ; NO = bB ( Nx ( Nz , NZ , vec2 ( 1 , 1 ) , NA . xy ) ) ; NQ = bB ( Nx ( Nz , NZ , vec2 ( 1 , - 1 ) , NA . xy ) ) ; NS = bB ( Nx ( Nz , NZ , vec2 ( - 1 , 1 ) , NA . xy ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[]}}]},{type:"textline",a:"NT = NM + NK ; NU = NN + NL ; NP = 1.0 / NP ; NV = NT + NU ; NT = ( - 2.0 * NJ ) + NT ; NU = ( - 2.0 * NJ ) + NU ; NW = NQ + NO ; NQ = NR + NQ ; NX = ( - 2.0 * NL ) + NW ; NQ = ( - 2.0 * NM ) + NQ ; NR = NR + NS ; NO = NS + NO ; NX = ( abs ( NT ) * 2.0 ) + abs ( NX ) ; NQ = ( abs ( NU ) * 2.0 ) + abs ( NQ ) ; NU = ( - 2.0 * NN ) + NR ; NO = ( - 2.0 * NK ) + NO ; NX = abs ( NU ) + NX ; NQ = abs ( NO ) + NQ ; NW = NR + NW ; NR = NA . x ; NE = NX >= NQ ; NW = NV * 2.0 + NW ; if ( ! NE ) NM = NN ; if ( ! NE ) NK = NL ; if ( NE ) NR = NA . y ; NW = ( NW * ( 1.0 / 12.0 ) ) - NJ ; NL = NM - NJ ; NN = NK - NJ ; NM = NM + NJ ; NK = NK + NJ ; NF = abs ( NL ) >= abs ( NN ) ; NN = max ( abs ( NL ) , abs ( NN ) ) ; if ( NF ) NR = - NR ; NP = Np ( abs ( NW ) * NP ) ; N_ . x = NZ . x ; N_ . y = NZ . y ; Oa . x = ( ! NE ) ? 0.0 : NA . x ; Oa . y = ( NE ) ? 0.0 : NA . y ; if ( ! NE ) N_ . x += NR * 0.5 ; if ( NE ) N_ . y += NR * 0.5 ; Ob . x = N_ . x - Oa . x * FXAA_QUALITY_P0 ; Ob . y = N_ . y - Oa . y * FXAA_QUALITY_P0 ; Oc . x = N_ . x + Oa . x * FXAA_QUALITY_P0 ; Oc . y = N_ . y + Oa . y * FXAA_QUALITY_P0 ; NW = ( ( - 2.0 ) * NP ) + 3.0 ; NL = bB ( Ns ( Nz , Ob ) ) ; NP = NP * NP ; NV = bB ( Ns ( Nz , Oc ) ) ; if ( ! NF ) NM = NK ; NN = NN * 1.0 / 4.0 ; NK = NJ - NM * 0.5 ; NP = NW * NP ; NF = NK < 0.0 ; NL -= NM * 0.5 ; NV -= NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P1 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P1 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P1 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P1 ; if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P2 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P2 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P2 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P2 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",3,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P3 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P3 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P3 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P3 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",4,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P4 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P4 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P4 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P4 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",5,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P5 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P5 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P5 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P5 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",6,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P6 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P6 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P6 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P6 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",7,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P7 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P7 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P7 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P7 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",8,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P8 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P8 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P8 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P8 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",9,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P9 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P9 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P9 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P9 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",10,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P10 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P10 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P10 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P10 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",11,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P11 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P11 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P11 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P11 ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_QUALITY_PS",12,{type:"g_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"if ( NI ) { if ( ! NG ) NL = bB ( Ns ( Nz , Ob . xy ) ) ; if ( ! NH ) NV = bB ( Ns ( Nz , Oc . xy ) ) ; if ( ! NG ) NL = NL - NM * 0.5 ; if ( ! NH ) NV = NV - NM * 0.5 ; NG = abs ( NL ) >= NN ; NH = abs ( NV ) >= NN ; if ( ! NG ) Ob . x -= Oa . x * FXAA_QUALITY_P12 ; if ( ! NG ) Ob . y -= Oa . y * FXAA_QUALITY_P12 ; NI = ( ! NG ) || ( ! NH ) ; if ( ! NH ) Oc . x += Oa . x * FXAA_QUALITY_P12 ; if ( ! NH ) Oc . y += Oa . y * FXAA_QUALITY_P12 ; }".split(" ")}]}}]},
{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:["}"]}]}}]},{type:"textline",a:"} NN = NZ . x - Ob . x ; NM = Oc . x - NZ . x ; if ( ! NE ) NN = NZ . y - Ob . y ; if ( ! NE ) NM = Oc . y - NZ . y ; NH = ( NL < 0.0 ) != NF ; NL = ( NM + NN ) ; NF = ( NV < 0.0 ) != NF ; NL = 1.0 / NL ; NG = NN < NM ; NM = min ( NN , NM ) ; NF = NG ? NH : NF ; NP = NP * NP ; NL = ( NM * ( - NL ) ) + 0.5 ; NP = NP * NB ; NL = NF ? NL : 0.0 ; NP = max ( NL , NP ) ; if ( ! NE ) NZ . x += NP * NR ; if ( NE ) NZ . y += NP * NR ;".split(" ")},
{type:"condition",b:[{type:"if",d:["FXAA_DISCARD",1,{type:"equal_expr",e:2},"FXAA_BLEND4WEB",1,{type:"equal_expr",e:2},{type:"logical_or_expr",e:2}],group:{type:"group",b:[{type:"textline",a:"return Ns ( Nz , NZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",b:[{type:"textline",a:"return vec4 ( Ns ( Nz , NZ ) . xyz , NJ ) ;".split(" ")}]}}]},{type:"textline",a:["}"]}]};a["include/depth_fetch.glslf"]={type:"group",b:[{type:"textline",a:"float Ok ( in sampler2D Oe , in vec2 Of , in vec2 Og ) { float Oh , Oi , Oj ; Oh = texture2D ( Oe , Of ) . r ; Oi = Og . x ; Oj = Og . y ; Oi = 2.0 * Oi / ( Oi + Oj - ( 2.0 * Oh - 1.0 ) * ( Oj - Oi ) ) ; return Oi ; }".split(" ")}]}};b4w.module.animation=function(a,p){var e=p("__animation"),b=p("__armature"),c=p("__obj_util"),m=p("__print"),k=p("__tsr");a.SLOT_0=e.SLOT_0;a.SLOT_1=e.SLOT_1;a.SLOT_2=e.SLOT_2;a.SLOT_3=e.SLOT_3;a.SLOT_4=e.SLOT_4;a.SLOT_5=e.SLOT_5;a.SLOT_6=e.SLOT_6;a.SLOT_7=e.SLOT_7;a.SLOT_ALL=e.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=e.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=e.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=e.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=e.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=e.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=e.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=e.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=e.AB_CYCLIC;a.AB_FINISH_RESET=e.AB_FINISH_RESET;a.AB_FINISH_STOP=e.AB_FINISH_STOP;var r=k.create();a.is_animated=function(a){return e.is_animated(a)};a.get_anim_names=function(a){return e.Ex(a)?e.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!e.is_animated(a))return null;b=b||e.SLOT_0;return e.rF(a,b)};a.apply=function(a,b,c){if(c>e.SLOT_7)m.error("Can't apply animation to slot "+
c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||e.SLOT_0;if(e.is_animated(a)){var k=e.get_slot_num_by_anim(a,b);if(-1!=k&&k!=c){m.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+k+'").');return}}e.IK(a,b)?e.apply(a,b,c):m.error('No fcurves in action "'+b+'"')}};a.remove=function(a){e.remove(a)};a.remove_slot_animation=function(a,b){e.is_animated(a)&&(b=b||e.SLOT_0,e.remove_slot_animation(a,b))};a.apply_def=function(a){e.apply_def(a)};
a.play=function(a,b,c){e.is_animated(a)?(c=c||e.SLOT_0,e.play(a,b,c),e.dK(a,0,c,!0)):m.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){e.is_animated(a)&&(b=b||e.SLOT_0,e.stop(a,b))};a.is_play=function(a,b){if(!e.is_animated(a))return!1;b=b||e.SLOT_0;return e.is_play(a,b)};a.set_frame=function(a,b,c){e.is_animated(a)&&(c=c||e.SLOT_0,e.set_frame(a,b,c))};a.set_first_frame=function(a,b){e.is_animated(a)&&e.set_first_frame(a,b)};a.set_last_frame=function(a,b){if(e.is_animated(a)){b=
b||e.SLOT_0;var c=e.get_anim_start_frame(a,b),k=e.get_anim_length(a,b);e.set_frame(a,c+k-e.xA,b)}};a.get_frame=function(a,b){if(!e.is_animated(a))return 0;b=b||e.SLOT_0;return e.bw(a,b)};a.set_speed=function(a,b,c){e.is_animated(a)&&(c=c||e.SLOT_0,e.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!e.is_animated(a))return 0;b=b||e.SLOT_0;return a.O[b]?e.get_speed(a,b):0};a.get_anim_start_frame=function(a,b){return e.is_animated(a)&&(b=b||e.SLOT_0,a.O[b])?e.get_anim_start_frame(a,b):-1};a.get_anim_length=
function(a,b){return e.is_animated(a)&&(b=b||e.SLOT_0,a.O[b])?e.get_anim_length(a,b):-1};a.set_behavior=function(a,b,c){e.is_animated(a)&&(c=c||e.SLOT_0,e.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!e.is_animated(a))return null;b=b||e.SLOT_0;return e.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,k){k=k||e.SLOT_0;e.is_animated(a)&&e.apply_smoothing(a,b,c,k)};a.frame_to_sec=function(a){return e.frame_to_sec(a)};a.get_bone_translation=function(a,e,g){m.Ia("get_bone_translation","armature.get_bone_tsr");
if(!c.is_armature(a))return null;if(!b.$k(a,e))return m.error('There is no bone: "',e,'" in "',a.name,'".'),null;g||(g=new Float32Array(3));b.get_bone_tsr(a,e,!1,!1,r);g[0]=r[0];g[1]=r[1];g[2]=r[2];return g};a.get_first_armature_object=function(){m.gc("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return e.is_animated(a)&&b?e.get_slot_num_by_anim(a,b):null};a.get_anim_type=function(a,b){return e.is_animated(a)?e.get_anim_type(a,b):null};a.apply_to_first_empty_slot=
function(a,b){return e.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.g.wg};a.set_skel_mix_factor=function(a,b,g){c.is_armature(a)?(b=Math.min(Math.max(b,0),1),a.g.wg!=b&&e.set_skel_mix_factor(a,b,g||0)):m.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var e=p("__anchors");p("__print");a.attach_move_cb=e.attach_move_cb;a.detach_move_cb=e.detach_move_cb;a.is_anchor=e.is_anchor;a.get_element_id=e.get_element_id};b4w.module.armature=function(a,p){var e=p("__armature"),b=p("__obj_util"),c=p("__transform"),m=p("__print");a.get_bone_tsr=function(a,c,h){if(!b.is_armature(a))return null;if(!e.$k(a,c))return m.error('There is no bone: "',c,'" in "',a.name,'".'),null;h||(h=new Float32Array(8));e.get_bone_tsr(a,c,!1,!1,h);return h};a.get_bone_tsr_rel=function(a,c,h){if(!b.is_armature(a))return null;if(!e.$k(a,c))return m.error('There is no bone: "',c,'" in "',a.name,'".'),null;h||(h=new Float32Array(8));e.get_bone_tsr(a,
c,!1,!0,h);return h};a.set_bone_tsr=function(a,r,h){b.is_armature(a)&&(e.$k(a,r)?(e.set_bone_tsr(a,r,h,!1),c.n(a)):m.error('There is no bone: "',r,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,r,h){b.is_armature(a)&&(e.$k(a,r)?(e.set_bone_tsr(a,r,h,!0),c.n(a)):m.error('There is no bone: "',r,'" in "',a.name,'".'))}};b4w.module.assets=function(a,p){var e=p("__assets");a.AT_ARRAYBUFFER=e.AT_ARRAYBUFFER;a.AT_JSON=e.AT_JSON;a.AT_TEXT=e.AT_TEXT;a.AT_AUDIOBUFFER=e.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=e.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=e.AT_AUDIO_ELEMENT;a.enqueue=function(a,c,m,k){if(a.length)if(a.id)e.enqueue(a,c,m,k);else{for(var r=[],h=0;h<a.length;h++){var q=a[h];r.push({id:q[0],type:q[1],url:q[2],Cd:q.Cd?q.Cd:"GET",xi:null,Vg:null,lb:q[3]})}e.enqueue(r,c,m,k)}}};b4w.module.camera=function(a,p){function e(a,c){g.Ia("camera.set_pivot","camera.target_set_trans_pivot");b.is_target_camera(a)?(u.copy(c,a.g.pivot),f.n(a),q.sync_transform(a)):g.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var c=p("__constraints"),m=p("__container"),k=p("__mat4"),r=p("__math"),h=p("__obj_util"),q=p("__physics"),g=p("__print"),y=p("__scenes"),f=p("__transform"),l=p("__tsr"),n=p("__util"),u=p("__vec3"),A=p("__vec4"),B=new Float32Array(2),
H=new Float32Array(3),v=new Float32Array(3),E=new Float32Array(4);new Float32Array(9);var z={},G={};a.MS_STATIC=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.static_setup=function(a,c){if(h.is_camera(a)){b.Cp(a);a.g.Va=b.MS_STATIC;if(c){var e=c.pos||l.get_trans_view(a.g.i);c.look_at?b.set_look_at(a,e,c.look_at):f.set_translation(a,e)}f.n(a);q.sync_transform(a);b.Ml(a)}else g.error("static_setup(): Wrong camera object")};
a.static_set_look_at=function(a,c,e){b.is_static_camera(a)?(c=c||l.get_trans_view(a.g.i),e?b.set_look_at(a,c,e):f.set_translation(a,c),f.n(a),q.sync_transform(a)):g.error("static_set_look_at(): Wrong camera object or camera move style")};a.static_set_rotation=function(a,c){b.is_static_camera(a)?(f.set_rotation(a,c),f.n(a),q.sync_transform(a)):g.error("static_set_rotation(): Wrong camera object or camera move style")};a.static_get_rotation=function(a,c){if(!b.is_static_camera(a))return g.error("static_get_rotation(): Wrong camera object or camera move style"),
null;c=c||new Float32Array(4);return f.get_rotation(a,c)};a.eye_setup=function(a,c){if(h.is_camera(a))if(c&&c.horiz_rot_lim&&("number"!=typeof c.horiz_rot_lim.left||"number"!=typeof c.horiz_rot_lim.right))g.error("eye_setup(): Wrong horizontal limits object.");else if(c&&c.vert_rot_lim&&("number"!=typeof c.vert_rot_lim.down||"number"!=typeof c.vert_rot_lim.up))g.error("eye_setup(): Wrong vertical limits object.");else{b.Cp(a);a.g.Va=b.MS_EYE_CONTROLS;if(c){var e=c.pos||l.get_trans_view(a.g.i);b.UI(a,
e,c.look_at,c.horiz_rot_lim,c.vert_rot_lim)}f.n(a);q.sync_transform(a);b.Ml(a)}else g.error("eye_setup(): Wrong camera object")};a.eye_set_look_at=function(a,e,k){b.is_eye_camera(a)?(e=e||l.get_trans_view(a.g.i),k?b.EI(a,e,k):f.set_translation(a,e),c.correct_up(a,a.g.Fe,!0),f.n(a),q.sync_transform(a)):g.error("eye_set_look_at(): Wrong camera object or camera move style")};a.eye_rotate=function(a,c,e,k,h){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,e,k||!1,h||!1),f.n(a),q.sync_transform(a)):g.error("eye_rotate(): Wrong camera object or camera move style")};
a.eye_set_vertical_limits=function(a,c){b.is_eye_camera(a)?!c||"number"==typeof c.down&&"number"==typeof c.up?(b.uy(a,c),f.n(a),q.sync_transform(a)):g.error("eye_set_vertical_limits(): Incorrect limits object."):g.error("eye_set_vertical_limits(): Wrong camera object or camera move style")};a.eye_get_vertical_limits=function(a,c,f){if(!b.is_eye_camera(a))return g.error("eye_get_vertical_limits(): Wrong camera object or camera move style"),null;a=a.g;return a.ga?(c=c||{},f?(c.down=a.ga.hj,c.up=a.ga.Dk):
(c.down=a.ga.down,c.up=a.ga.up),c.camera_space=f||!1,c):null};a.eye_set_horizontal_limits=function(a,c){b.is_eye_camera(a)?!c||"number"==typeof c.left&&"number"==typeof c.right?(b.qy(a,c),f.n(a),q.sync_transform(a)):g.error("eye_set_horizontal_limits(): Incorrect limits object."):g.error("eye_set_horizontal_limits(): Wrong camera object or camera move style")};a.eye_get_horizontal_limits=function(a,c,f){if(!b.is_eye_camera(a))return g.error("eye_get_horizontal_limits(): Wrong camera object or camera move style"),
null;a=a.g;return a.La?(c=c||{},f?(c.left=a.La.Gj,c.right=a.La.dk):(c.left=a.La.left,c.right=a.La.right),c.camera_space=f||!1,c):null};a.target_setup=function(a,c){if(h.is_camera(a))if(!c.horiz_rot_lim||"number"==typeof c.horiz_rot_lim.left&&"number"==typeof c.horiz_rot_lim.right)if(!c.vert_rot_lim||"number"==typeof c.vert_rot_lim.down&&"number"==typeof c.vert_rot_lim.up){if(c.dist_lim){if("number"!=typeof c.dist_lim.min||"number"!=typeof c.dist_lim.max||c.dist_lim.min>c.dist_lim.max){g.error("target_setup(): Wrong distance limits object");
return}c.dist_lim.min=Math.max(c.dist_lim.min,0);c.dist_lim.max=Math.max(c.dist_lim.max,0)}if(c.cm&&("number"!=typeof c.cm.min_y||"number"!=typeof c.cm.max_y||c.cm.min_y>c.cm.max_y))g.error("target_setup(): Wrong pivot limits object");else{b.Cp(a);a.g.Va=b.MS_TARGET_CONTROLS;var e=c.pos||l.get_trans_view(a.g.i);b.WI(a,e,c.pivot,c.horiz_rot_lim,c.vert_rot_lim,c.dist_lim,c.cm,c.use_panning||!1);f.n(a);q.sync_transform(a);b.Ml(a)}}else g.error("target_setup(): Wrong vertical limits object");else g.error("target_setup(): Wrong horizontal limits object");
else g.error("target_setup(): Wrong camera object")};a.target_rotate=function(a,c,e,k,h){b.is_target_camera(a)?(b.rotate_target_camera(a,c,e,k||!1,h||!1),f.n(a),q.sync_transform(a)):g.error("target_rotate(): Wrong camera object or camera move style")};a.target_set_trans_pivot=function(a,c,e){b.is_target_camera(a)?(c=c||l.get_trans_view(a.g.i),e=e||a.g.pivot,b.set_trans_pivot(a,c,e),f.n(a),q.sync_transform(a)):g.error("target_set_trans_pivot(): Wrong camera object or camera move style")};a.target_set_pivot_translation=
function(a,c){b.is_target_camera(a)?(b.LI(a,c),f.n(a),q.sync_transform(a)):g.error("target_set_pivot_translation(): Wrong camera object or camera move style")};a.target_set_distance=function(a,c){if(b.is_target_camera(a)){var e=f.Uj(a,a.g.pivot),k=Math.max(0,c);f.move_local(a,0,k-e,0);f.n(a);q.sync_transform(a)}else g.error("target_set_distance(): Wrong camera object or camera move style")};a.target_get_distance=function(a){return b.is_target_camera(a)?f.Uj(a,a.g.pivot):(g.error("target_get_distance(): Wrong camera object or camera move style"),
0)};a.target_zoom_object=function(a,c){if(b.is_target_camera(a)){var e=f.get_object_center(c,!1,H),k=f.get_object_size(c),m=y.get_active(),m=h.R(a,m).M[0],m=b.Xv(m)/2,k=k/Math.sin(m),m=f.Uj(a,e);b.set_trans_pivot(a,l.get_trans_view(a.g.i),e);f.n(a);f.move_local(a,0,k-m,0);f.n(a);q.sync_transform(a)}else g.error("target_zoom_object(): Wrong camera object or camera move style")};a.target_get_pivot=function(a,c){if(!b.is_target_camera(a))return g.error("target_get_pivot(): Wrong camera object or camera move style"),
null;c=c||new Float32Array(3);u.copy(a.g.pivot,c);return c};a.target_set_distance_limits=function(a,c){if(b.is_target_camera(a)){if(c){if("number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max){g.error("target_set_distance_limits(): Wrong limits object");return}c.min=Math.max(c.min,0);c.max=Math.max(c.max,0)}b.pI(a,c);f.n(a);q.sync_transform(a)}else g.error("target_set_distance_limits(): Wrong camera object or camera move style")};a.target_get_distance_limits=function(a,c){if(!b.is_target_camera(a))return g.error("target_get_distance_limits(): Wrong camera object or camera move style"),
null;var f=a.g;return f.Oa?(c=c||{},c.min=f.Oa.min,c.max=f.Oa.max,c):null};a.target_set_vertical_limits=function(a,c){b.is_target_camera(a)?!c||"number"==typeof c.down&&"number"==typeof c.up?(b.uy(a,c),f.n(a),q.sync_transform(a)):g.error("target_set_vertical_limits(): Wrong limits object"):g.error("target_set_vertical_limits(): Wrong camera object or camera move style")};a.target_get_vertical_limits=function(a,c,f){if(!b.is_target_camera(a))return g.error("target_get_vertical_limits(): Wrong camera object or camera move style"),
null;a=a.g;return a.ga?(c=c||{},f?(c.down=a.ga.hj,c.up=a.ga.Dk):(c.down=a.ga.down,c.up=a.ga.up),c.camera_space=f||!1,c):null};a.target_set_horizontal_limits=function(a,c){b.is_target_camera(a)?!c||"number"==typeof c.left&&"number"==typeof c.right?(b.qy(a,c),f.n(a),q.sync_transform(a)):g.error("target_set_horizontal_limits(): Wrong limits object"):g.error("target_set_horizontal_limits(): Wrong camera object or camera move style")};a.target_get_horizontal_limits=function(a,c,f){if(!b.is_target_camera(a))return g.error("target_get_horizontal_limits(): Wrong camera object or camera move style"),
null;a=a.g;return a.La?(c=c||{},f?(c.left=a.La.Gj,c.right=a.La.dk):(c.left=a.La.left,c.right=a.La.right),c.camera_space=f||!1,c):null};a.target_set_pivot_limits=function(a,c){b.is_target_camera(a)?c&&("number"!=typeof c.min_y||"number"!=typeof c.max_y||c.min_y>c.max_y)?g.error("target_set_pivot_limits(): Wrong limits object"):(b.HI(a,c),f.n(a),q.sync_transform(a)):g.error("target_set_pivot_limits(): Wrong camera object or camera move style")};a.target_get_pivot_limits=function(a,c){if(!b.is_target_camera(a))return g.error("target_get_pivot_limits(): Wrong camera object or camera move style"),
null;var f=a.g;return f.he?(c=c||{},c.min_y=f.he.min_y,c.max_y=f.he.max_y,c):null};a.target_pan_pivot=function(a,c,e){if(b.is_target_camera(a)){var k=a.g;k.use_panning&&(H[0]=c,H[1]=0,H[2]=e,l.transform_dir_vec3(H,k.i,H),u.add(k.pivot,H,k.pivot),c=l.get_trans_view(k.i),u.add(c,H,c),f.n(a),q.sync_transform(a))}else g.error("target_pan_pivot(): wrong object")};a.target_switch_panning=function(a,c){if(!b.is_target_camera(a))return g.error("target_switch_panning(): Wrong camera object or camera move style"),
null;a.g.use_panning=c};a.hover_setup_rel=function(c,e){a.hover_setup(c,{pos:e.pos,pivot:e.pivot});var g="undefined"==typeof e.dist_interval?0:Math.max(e.dist_interval,0),k="undefined"==typeof e.angle_interval?0:Math.max(e.angle_interval,0),h="undefined"==typeof e.t?.5:n.clamp(e.t,0,1),l=a.hover_get_distance_limits(c,z);l.min=Math.max(l.min-h*g,0);l.max+=(1-h)*g;g=a.hover_get_vertical_limits(c,G);g.down=n.clamp(g.down+h*k,-Math.PI/2,0);g.up=n.clamp(g.up-(1-h)*k,-Math.PI/2,0);b.hover_set_distance_limits(c,
l);b.hover_set_vertical_limits(c,g);f.n(c);q.sync_transform(c);b.Ml(c)};a.hover_setup=function(a,c){if(h.is_camera(a)){if(c.dist_lim){if("number"!=typeof c.dist_lim.min||"number"!=typeof c.dist_lim.max||c.dist_lim.min>c.dist_lim.max){g.error("hover_setup(): Wrong distance limits object");return}c.dist_lim.min=Math.max(c.dist_lim.min,0);c.dist_lim.max=Math.max(c.dist_lim.max,0)}if(c.hover_angle_lim&&("number"!=typeof c.hover_angle_lim.down||"number"!=typeof c.hover_angle_lim.up||c.hover_angle_lim.down<
c.hover_angle_lim.up))g.error("hover_setup(): Wrong hover angle limits object");else if(c.horiz_trans_lim&&("number"!=typeof c.horiz_trans_lim.min||"number"!=typeof c.horiz_trans_lim.max||c.horiz_trans_lim.min>c.horiz_trans_lim.max))g.error("hover_setup(): Wrong horizontal translation limits object");else if(c.vert_trans_lim&&("number"!=typeof c.vert_trans_lim.min||"number"!=typeof c.vert_trans_lim.max||c.vert_trans_lim.min>c.vert_trans_lim.max))g.error("hover_setup(): Wrong vertical translation limits object");
else{b.Cp(a);a.g.Va=b.MS_HOVER_CONTROLS;var e=c.pos||l.get_trans_view(a.g.i);b.VI(a,e,c.pivot,c.dist_lim,c.hover_angle_lim,c.horiz_trans_lim,c.vert_trans_lim,c.enable_horiz_rot||!1);f.n(a);q.sync_transform(a);b.Ml(a)}}else g.error("hover_setup(): Wrong camera object")};a.hover_rotate=function(a,c,e,k,h){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,e,k||!1,h||!1),f.n(a),q.sync_transform(a)):g.error("hover_rotate(): Wrong camera object or camera move style")};a.hover_set_pivot_translation=function(a,
c){b.is_hover_camera(a)?(b.set_hover_pivot(a,c),f.n(a),q.sync_transform(a)):g.error("hover_set_pivot_translation(): Wrong camera object or camera move style")};a.hover_get_pivot=function(a,c){if(!b.is_hover_camera(a))return g.error("hover_get_pivot(): Wrong camera object or camera move style"),null;c=c||new Float32Array(3);u.copy(a.g.fb,c);return c};a.hover_get_distance=function(a){return b.is_hover_camera(a)?f.Uj(a,a.g.fb):(g.error("hover_get_distance(): Wrong camera object or camera move style"),
0)};a.hover_set_vertical_limits=function(a,c){b.is_hover_camera(a)?"number"!=typeof c.down||"number"!=typeof c.up||c.down<c.up?g.error("hover_set_vertical_limits(): Wrong limits object"):(b.hover_set_vertical_limits(a,c),f.n(a),q.sync_transform(a)):g.error("hover_set_vertical_limits(): Wrong camera object or camera move style")};a.hover_get_vertical_limits=function(a,c){if(!b.is_hover_camera(a))return g.error("hover_get_vertical_limits(): Wrong camera object or camera move style"),null;var f=a.g;
c=c||{};c.down=f.ga.down;c.up=f.ga.up;return c};a.hover_set_distance_limits=function(a,c){b.is_hover_camera(a)?"number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max?g.error("hover_set_distance_limits(): Wrong limits object"):(c.min=Math.max(c.min,0),c.max=Math.max(c.max,0),b.hover_set_distance_limits(a,c),f.n(a),q.sync_transform(a)):g.error("hover_set_distance_limits(): Wrong camera object or camera move style")};a.hover_get_distance_limits=function(a,c){if(!b.is_hover_camera(a))return g.error("hover_get_distance_limits(): Wrong camera object or camera move style"),
null;var f=a.g;c=c||{};c.min=f.Oa.min;c.max=f.Oa.max;return c};a.hover_set_vert_trans_limits=function(a,c){b.is_hover_camera(a)?c&&("number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max)?g.error("hover_set_vert_trans_limits(): Wrong limits object"):(b.OI(a,c),f.n(a),q.sync_transform(a)):g.error("hover_set_vert_trans_limits(): Wrong camera object or camera move style")};a.hover_get_vert_trans_limits=function(a,c){if(!b.is_hover_camera(a))return g.error("hover_get_vert_trans_limits(): Wrong camera object or camera move style"),
null;var f=a.g;return f.jc?(c=c||{},c.min=f.jc.min,c.max=f.jc.max,c):null};a.hover_set_horiz_trans_limits=function(a,c){b.is_hover_camera(a)?c&&("number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max)?g.error("hover_set_horiz_trans_limits(): Wrong limits object"):(b.yI(a,c),f.n(a),q.sync_transform(a)):g.error("hover_set_horiz_trans_limits(): Wrong camera object or camera move style")};a.hover_get_horiz_trans_limits=function(a,c){if(!b.is_hover_camera(a))return g.error("hover_get_horiz_trans_limits(): Wrong camera object or camera move style"),
null;var f=a.g;return f.ic?(c=c||{},c.min=f.ic.min,c.max=f.ic.max,c):null};a.hover_switch_horiz_rotation=function(a,c){if(!b.is_hover_camera(a))return g.error("hover_switch_horiz_rotation(): Wrong camera object or camera move style"),null;a.g.zl=c};a.is_static_camera=b.is_static_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,c){if(!h.is_camera(a))return g.error("set_move_style(): Wrong camera object"),!1;
if(c!=b.MS_STATIC&&c!=b.MS_EYE_CONTROLS&&c!=b.MS_TARGET_CONTROLS&&c!=b.MS_HOVER_CONTROLS)return g.error("set_move_style(): Wrong move style"),!1;b.set_move_style(a,c);f.n(a);q.sync_transform(a);return!0};a.get_move_style=function(a){return h.is_camera(a)?b.get_move_style(a):(g.error("get_move_style(): Wrong camera object"),null)};a.set_translation=function(a,c){if(h.is_camera(a)){var e=a.g;if(b.is_target_camera(a)){var k=l.get_trans_view(e.i),k=u.subtract(c,k,H);u.add(k,e.pivot,e.pivot)}else b.is_hover_camera(a)&&
(k=l.get_trans_view(e.i),k=u.subtract(c,k,H),u.add(k,e.fb,e.fb));f.set_translation(a,c);f.n(a);q.sync_transform(a)}else g.error("set_translation(): Wrong camera object")};a.get_translation=function(a,b){if(!h.is_camera(a))return g.error("get_translation(): Wrong camera object"),null;b=b||new Float32Array(3);return f.get_translation(a,b)};a.rotate_camera=function(a,c,e,k,l){h.is_camera(a)?(k=k||!1,l=l||!1,b.is_target_camera(a)?b.rotate_target_camera(a,c,e,k,l):b.is_eye_camera(a)?b.rotate_eye_camera(a,
c,e,k,l):b.is_hover_camera(a)?b.rotate_hover_camera(a,c,e,k,l):b.is_static_camera(a)?g.warn("rotate_camera(): not supported for STATIC cameras"):g.error("rotate_camera(): Wrong camera move style"),f.n(a),q.sync_transform(a)):g.error("rotate_camera(): Wrong camera object")};a.set_velocities=function(a,b){if(h.is_camera(a)){var c=a.g;"number"==typeof b.trans&&(c.Fm=n.clamp(b.trans,0,Infinity));"number"==typeof b.rot&&(c.Em=n.clamp(b.rot,0,Infinity));"number"==typeof b.zoom&&(c.Gm=n.clamp(b.zoom,0,.99))}else g.error("set_velocities(): Wrong camera object")};
a.get_velocities=function(a,b){if(!h.is_camera(a))return g.error("get_velocities(): Wrong camera object"),null;var c=a.g;b=b||{};b.trans=c.Fm;b.rot=c.Em;b.zoom=c.Gm;return b};a.is_look_up=function(a){if(!h.is_camera(a))return g.error("is_look_up(): Wrong camera object"),!1;a=l.get_quat_view(a.g.i);return 0<=n.quat_to_dir(a,n.AXIS_MY,H)[1]};a.get_camera_angles=function(a,c){if(!h.is_camera(a))return g.error("get_camera_angles(): Wrong camera object"),null;c=c||new Float32Array(2);b.get_camera_angles(a,
c);return c};a.get_camera_angles_char=function(a,c){if(!h.is_camera(a))return g.error("get_camera_angles_char(): Wrong camera object"),null;c=c||new Float32Array(2);b.get_camera_angles_char(a,c);return c};a.set_stereo_distance=function(a,c){if(h.is_camera(a))for(var f=y.get_active(),f=h.R(a,f).M,e=0;e<f.length;e++){var k=f[e];k.type!=b.Hb&&k.type!=b.Mb||b.KI(k,c,k.ke)}else g.error("set_stereo_distance(): Wrong camera object")};a.get_stereo_distance=function(a){if(!h.is_camera(a))return g.error("get_stereo_distance(): Wrong camera object"),
0;var c=y.get_active();a=h.R(a,c).M;for(c=0;c<a.length;c++){var f=a[c];if(f.type==b.Hb||f.type==b.Mb)return f.vk}return 0};a.set_eye_distance=function(a,c){if(h.is_camera(a)){var f=y.get_active(),f=h.R(a,f).M;b.set_eye_distance(f,c)}else g.error("set_eye_distance(): Wrong camera object")};a.get_eye_distance=function(a){if(!h.is_camera(a))return g.error("get_eye_distance(): Wrong camera object"),0;var c=y.get_active();a=h.R(a,c).M;for(c=0;c<a.length;c++){var f=a[c];if(f.type==b.Hb||f.type==b.Mb||f.type==
b.dd||f.type==b.ed)return f.ke}return 0};a.set_vertical_axis=function(a,b){h.is_camera(a)?(u.copy(b,a.g.Fe),f.n(a),q.sync_transform(a)):g.error("set_vertical_axis(): Wrong camera object")};a.get_vertical_axis=function(a,b){if(h.is_camera(a))return b||(b=u.create()),u.copy(a.g.Fe,b),b;g.error("get_vertical_axis(): Wrong camera object")};a.translate_view=function(a,c,f,e){if(h.is_camera(a)){var l=y.get_active();a=h.R(a,l).M;for(l=0;l<a.length;l++){var m=a[l];m.Zb||b.$g(m,m.Sa);var n=H;n[0]=-c;n[1]=
-f;n[2]=0;k.translate(m.nb,n,m.nb);k.rotateZ(m.nb,e,m.nb);b.Su(m);b.mq(m)}}else g.error("translate_view(): Wrong camera object")};a.get_view_vector=function(a,b){if(!h.is_camera(a))return g.error("get_view_vector(): Wrong camera object"),null;b=b||new Float32Array(3);var c=l.get_quat_view(a.g.i);n.quat_to_dir(c,n.AXIS_MY,b);return b};a.get_fov=function(a){if(!h.is_camera(a))return g.error("get_fov(): Wrong camera object"),0;var b=y.get_active();a=h.R(a,b).M;return n.deg_to_rad(a[0].Mc)};a.set_fov=
function(a,c){if(h.is_camera(a))for(var f=y.get_active(),f=h.R(a,f).M,e=0;e<f.length;e++){var k=f[e];k.Mc=n.rad_to_deg(c);k.Zb||b.$g(k,k.Sa);b.Su(k);b.mq(k)}else g.error("set_fov(): Wrong camera object")};a.set_hmd_fov=function(a,c,f){var e;if(!(e=h.is_camera(a)))a:{if(h.is_camera(a)){e=y.get_active();e=h.R(a,e).M;for(var k=0;k<e.length;k++){var l=e[k];if(l.type==b.dd||l.type==b.ed){e=!0;break a}}}else g.error("is_hmd_camera(): Wrong camera object");e=!1}e?c&&f&&b.set_hmd_fov(a,c,f):g.error("set_hmd_fov(): Wrong camera object")};
a.correct_up=function(a,b,e){h.is_camera(a)?(b=b||a.g.Fe,c.correct_up(a,b,e||!1),f.n(a),q.sync_transform(a)):g.error("correct_up(): Wrong camera object")};a.set_ortho_scale=function(a,c){if(h.is_camera(a)&&b.is_ortho_camera(a)){var f=a.g;if(b.is_target_camera(a)){var e=l.get_trans_view(f.i),e=u.dist(e,f.pivot);f.Aj=c/2*f.zj/e}else b.is_hover_camera(a)?(e=l.get_trans_view(f.i),e=u.distance(e,f.fb),f.Aj=c/2*f.zj/e):(f=y.get_active(),h.R(a,f).M[0].top=c/2);b.gK(a)}else g.error("set_ortho_scale(): Wrong camera object")};
a.get_ortho_scale=function(a){if(!h.is_camera(a)||!b.is_ortho_camera(a))return g.error("get_ortho_scale(): Wrong camera object"),0;var c=y.get_active();return 2*h.R(a,c).M[0].top};a.is_ortho_camera=function(a){return h.is_camera(a)?b.is_ortho_camera(a):(g.error("is_ortho_camera(): Wrong camera object"),!1)};a.calc_ray=function(a,c,e,k){if(!h.is_camera(a))return g.error("calc_ray(): Wrong camera object"),null;var q=y.get_active(),p=h.R(a,q).M[0];k&&3==k.length?g.gc('dest parameter in the function "calc_ray" should be type of parametric line.'):
k=k||new Float32Array(6);switch(p.type){case b.pc:case b.nf:case b.Hb:case b.Mb:var A=Math.tan(p.Mc*Math.PI/360),K=A*p.Sa,q=H;c=m.Wk(c,e,B,p);q[0]=(2*c[0]/p.width-1)*K;q[1]=-1;q[2]=(2*c[1]/p.height-1)*A;l.transform_dir_vec3(q,a.g.i,q);u.normalize(q,q);3==k.length?u.copy(q,k):(a=f.get_translation(a,v),r.set_pline_initial_point(k,a),r.set_pline_directional_vec(k,q));return k;case b.fd:return q=H,c=m.Wk(c,e,B,p),q[0]=(2*c[0]/p.width-1)*p.top*p.Sa,q[1]=0,q[2]=(2*c[1]/p.height-1)*p.top,l.transform_vec3(q,
a.g.i,q),u.copy(q,k),a=l.get_quat_view(a.g.i,E),u.transformQuat(n.AXIS_MY,a,q),r.set_pline_directional_vec(k,q),k;default:return g.error("calc_ray(): Non-compatible camera"),k}};a.project_point=function(a,c,f){if(!h.is_camera(a))return g.error("project_point(): Wrong camera object"),null;f=f||new Float32Array(2);return b.project_point(a,c,f)};a.has_distance_limits=function(a){return(b.is_target_camera(a)||b.is_hover_camera(a))&&null!==a.g.Oa};a.has_vertical_rot_limits=function(a){return(b.is_eye_camera(a)||
b.is_target_camera(a)||b.is_hover_camera(a))&&null!==a.g.ga};a.has_vertical_limits=function(a){g.Ia("has_vertical_limits","has_vertical_rot_limits");return b.is_target_camera(a)||b.is_eye_camera(a)?null!==a.g.ga:(g.error("has_vertical_limits(): Wrong camera object"),!1)};a.has_horizontal_rot_limits=function(a){return(b.is_target_camera(a)||b.is_eye_camera(a))&&null!==a.g.La};a.has_horizontal_limits=function(a){g.Ia("has_horizontal_limits","has_horizontal_rot_limits");return b.is_target_camera(a)||
b.is_eye_camera(a)?null!==a.g.La:(g.error("has_horizontal_limits(): Wrong camera object"),!1)};a.has_vertical_trans_limits=function(a){return b.is_hover_camera(a)&&null!==a.g.jc};a.has_horizontal_trans_limits=function(a){return b.is_hover_camera(a)&&null!==a.g.ic};a.move_pivot=function(a,c,e){g.Ia("move_pivot","target_pan_pivot");if(b.is_target_camera(a)){var k=a.g;if(k.use_panning){var h=l.get_trans_view(k.i),m=u.subtract(h,k.pivot,v);H[0]=c;H[1]=0;H[2]=e;u.scale(H,u.len(m),H);l.transform_dir_vec3(H,
k.i,H);u.add(k.pivot,H,k.pivot);u.add(h,H,h);f.n(a);q.sync_transform(a)}}else g.error("move_pivot(): wrong object")};a.set_velocity_params=function(a,b){g.Ia("set_velocity_params","set_velocities");if(h.is_camera(a)){var c=a.g;c.Fm=n.clamp(b[0],0,Infinity);c.Em=n.clamp(b[1],0,Infinity);c.Gm=n.clamp(b[2],0,.99)}else g.error("set_velocity_params(): Wrong camera object")};a.get_velocity_params=function(a,b){g.Ia("get_velocity_params","get_velocities");if(!h.is_camera(a))return g.error("get_velocity_params(): Wrong camera object"),
null;b=b||new Float32Array(3);var c=a.g;b[0]=c.Fm;b[1]=c.Em;b[2]=c.Gm;return b};a.clear_horizontal_limits=function(a){g.gc('camera.clear_horizontal_limits() deprecated, use camera.target_set_horizontal_limits(), camera.eye_set_horizontal_limits() or camera.hover_set_horiz_trans_limits() with passing null as the "limits" argument.');h.is_camera(a)?b.is_target_camera(a)||b.is_eye_camera(a)?a.g.La=null:b.is_hover_camera(a)&&(a.g.ic=null):g.error("clear_horizontal_limits(): Wrong camera object")};a.clear_vertical_limits=
function(a){g.gc('camera.clear_vertical_limits() deprecated, use camera.target_set_vertical_limits(), camera.eye_set_vertical_limits() or camera.hover_set_vert_trans_limits() with passing null as the "limits" argument.');h.is_camera(a)?b.is_target_camera(a)||b.is_eye_camera(a)?a.g.ga=null:b.is_hover_camera(a)&&(a.g.jc=null):g.error("clear_vertical_limits(): Wrong camera object")};a.clear_hover_angle_limits=function(){g.gc("camera.clear_hover_angle_limits() deprecated, HOVER camera always has hover angle limits")};
a.set_look_at=function(a,e,k,h){g.Se("camera.set_look_at",["camera.static_set_look_at","camera.eye_set_look_at"]);h=h||a.g.Fe;b.set_look_at(a,e,k);c.correct_up(a,h,!0);f.n(a);q.sync_transform(a)};a.rotate_eye_camera=function(a,c,e,k,h){g.Se("camera.rotate_eye_camera",["camera.eye_rotate","camera.rotate_camera"]);b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,e,k,h),f.n(a),q.sync_transform(a)):g.error("rotate_eye_camera(): wrong object")};a.rotate_target_camera=function(a,c,e,k,h){g.Se("camera.rotate_target_camera",
["camera.target_rotate","camera.rotate_camera"]);b.is_target_camera(a)?(b.rotate_target_camera(a,c,e,k,h),f.n(a),q.sync_transform(a)):g.error("rotate_target_camera(): wrong object")};a.set_trans_pivot=function(a,c,e){g.Ia("camera.set_trans_pivot","camera.target_set_trans_pivot");b.is_target_camera(a)?(b.set_trans_pivot(a,c,e),f.n(a),q.sync_transform(a)):g.error("set_trans_pivot(): Wrong object or camera move style")};a.zoom_object=function(a,c){g.Ia("camera.zoom_object","camera.target_zoom_object");
if(b.is_target_camera(a)){f.get_object_center(c,!1,H);e(a,H);f.n(a);var k=f.get_object_size(c),l=y.get_active(),l=h.R(a,l).M[0],l=b.Xv(l)/2,k=k/Math.sin(l),l=f.Uj(a,H);f.move_local(a,0,k-l,0);f.n(a);q.sync_transform(a)}else g.error("zoom_object(): wrong object")};a.set_pivot=e;a.rotate_hover_camera=function(a,c,e,k,h){g.Ia("camera.rotate_hover_camera","camera.hover_rotate");b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,e,k,h),f.n(a),q.sync_transform(a)):g.error("rotate_hover_camera(): wrong object")};
a.get_hover_cam_pivot=function(a,c){g.Ia("camera.get_hover_cam_pivot","camera.hover_get_pivot");if(!b.is_hover_camera(a))return g.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));u.copy(a.g.fb,c);return c};a.get_eye=function(a,c){g.Ia("camera.get_eye","camera.get_translation");return h.is_camera(a)?b.get_eye(a,c):(g.error("get_eye(): Wrong object"),null)};a.get_pivot=function(a,c){g.Ia("camera.get_pivot","camera.target_get_pivot");if(!b.is_target_camera(a))return g.error("get_pivot(): Wrong object or camera move style"),
null;c||(c=new Float32Array(3));u.copy(a.g.pivot,c);return c};a.hover_cam_set_translation=function(a,c){g.Ia("camera.hover_cam_set_translation","camera.set_translation");if(b.is_hover_camera(a)){var e=a.g,k=l.get_trans_view(e.i),k=u.subtract(c,k,H);u.add(k,e.fb,e.fb);f.set_translation(a,c);f.n(a);q.sync_transform(a)}else g.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,c){g.Ia("camera.set_hover_pivot","camera.hover_set_pivot_translation");b.is_hover_camera(a)?(b.set_hover_pivot(a,
c),f.n(a),q.sync_transform(a)):g.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){g.Ia("camera.get_hover_angle_limits","camera.hover_get_vertical_limits");if(!b.is_hover_camera(a))return g.error("get_hover_angle_limits(): wrong object"),null;c=c||new Float32Array(2);c[0]=a.g.ga.down;c[1]=a.g.ga.up;return c};a.get_cam_dist_limits=function(a,c){g.Se("camera.get_cam_dist_limits",["camera.hover_get_distance_limits","camera.target_get_distance_limits"]);
if(!b.is_hover_camera(a)&&!b.is_target_camera(a))return g.error("get_cam_dist_limits(): wrong object"),null;if(a.g.Oa)c=c||new Float32Array(2),c[0]=a.g.Oa.max,c[1]=a.g.Oa.min;else return null;return c};a.apply_vertical_limits=function(c,e,k,h){g.Se("camera.apply_vertical_limits",["camera.eye_set_vertical_limits","camera.target_set_vertical_limits","camera.hover_set_vert_trans_limits"]);if(b.is_target_camera(c)){var l=z;l.down=e;l.up=k;l.camera_space=h==f.SPACE_LOCAL;a.target_set_vertical_limits(c,
l)}else b.is_eye_camera(c)?(l=z,l.down=e,l.up=k,l.camera_space=h==f.SPACE_LOCAL,a.eye_set_vertical_limits(c,l)):b.is_hover_camera(c)?(l=z,l.min=e,l.max=k,a.hover_set_vert_trans_limits(c,l)):g.error("apply_vertical_limits(): wrong object")};a.apply_hover_angle_limits=function(b,c,f){g.Ia("camera.apply_hover_angle_limits","camera.hover_set_vertical_limits");z.down=c;z.up=f;a.hover_set_vertical_limits(b,z)};a.apply_distance_limits=function(c,f,e){g.Se("camera.apply_distance_limits",["camera.target_set_distance_limits",
"camera.hover_set_distance_limits"]);if(b.is_target_camera(c)){var k=z;k.min=f;k.max=e;a.target_set_distance_limits(c,k)}else b.is_hover_camera(c)?(k=z,k.min=f,k.max=e,a.hover_set_distance_limits(c,k)):g.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(b){g.Ia("camera.clear_distance_limits","camera.target_set_distance_limits");a.target_set_distance_limits(b,null)};a.get_vertical_limits=function(a,c){g.Se("camera.get_vertical_limits",["camera.eye_get_vertical_limits",
"camera.target_get_vertical_limits","camera.hover_get_vert_trans_limits"]);if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return g.error("get_vertical_limits(): wrong object"),null;var f=a.g;c=c||new Float32Array(2);if(b.is_eye_camera(a)||b.is_target_camera(a)){if(f.ga)return c[0]=f.ga.down,c[1]=f.ga.up,c}else if(b.is_hover_camera(a)&&f.jc)return c[0]=f.jc.min,c[1]=f.jc.max,c;return null};a.apply_horizontal_limits=function(c,e,k,h){g.Se("camera.apply_horizontal_limits",["camera.eye_set_horizontal_limits",
"camera.target_set_horizontal_limits","camera.hover_set_horiz_trans_limits"]);if(b.is_target_camera(c)){var l=z;l.left=e;l.right=k;l.camera_space=h==f.SPACE_LOCAL;a.target_set_horizontal_limits(c,l)}else b.is_eye_camera(c)?(l=z,l.left=e,l.right=k,l.camera_space=h==f.SPACE_LOCAL,a.eye_set_horizontal_limits(c,l)):b.is_hover_camera(c)?(l=z,l.min=e,l.max=k,a.hover_set_horiz_trans_limits(c,l)):g.error("apply_horizontal_limits(): wrong object")};a.get_horizontal_limits=function(a,c){g.Se("camera.get_horizontal_limits",
["camera.eye_get_horizontal_limits","camera.target_get_horizontal_limits","camera.hover_get_horiz_trans_limits"]);if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return g.error("get_horizontal_limits(): wrong object"),null;var f=a.g;c=c||new Float32Array(2);if(b.is_eye_camera(a)||b.is_target_camera(a)){if(f.La)return c[0]=f.La.left,c[1]=f.La.right,c}else if(b.is_hover_camera(a)&&f.ic)return c[0]=f.ic.min,c[1]=f.ic.max,c;return null};a.get_frustum_planes=function(a,b){if(!h.is_camera(a))return g.error("get_frustum_planes(): Wrong camera object"),
null;var c=y.get_active(),c=h.R(a,c).M[0].qj;A.copy(c.left,b.left);A.copy(c.right,b.right);A.copy(c.top,b.top);A.copy(c.bottom,b.bottom);A.copy(c.near,b.near);A.copy(c.far,b.far);return b}};b4w.module.config=function(a,p){var e=p("__config");a.P_LOW=e.P_LOW;a.P_HIGH=e.P_HIGH;a.P_ULTRA=e.P_ULTRA;a.P_CUSTOM=e.P_CUSTOM;a.set=e.set;a.get=e.get;a.reset=e.reset;a.get_std_assets_path=e.get_std_assets_path};b4w.module.controls=function(a,p){var e=p("__controls"),b=p("__print");a.CT_POSITIVE=e.CT_POSITIVE;a.CT_CONTINUOUS=e.CT_CONTINUOUS;a.CT_TRIGGER=e.CT_TRIGGER;a.CT_SHOT=e.CT_SHOT;a.CT_LEVEL=e.CT_LEVEL;a.CT_CHANGE=e.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;
a.KEY_8=56;a.KEY_9=57;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=
187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=e.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=e.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=e.PL_MULTITOUCH_MOVE_PAN;a.PL_MULTITOUCH_MOVE_ROTATE=e.PL_MULTITOUCH_MOVE_ROTATE;a.create_gamepad_btns_sensor=e.create_gamepad_btns_sensor;a.create_gamepad_axes_sensor=e.create_gamepad_axes_sensor;
a.create_custom_sensor=e.create_custom_sensor;a.create_keyboard_sensor=e.create_keyboard_sensor;a.create_collision_sensor=function(a,b,k){return e.create_collision_sensor(a,b||"ANY",k||!1)};a.create_collision_impulse_sensor=e.create_collision_impulse_sensor;a.create_ray_sensor=function(a,b,k,r,h,q,g){return e.create_ray_sensor(a,b,k,r||"ANY",h||!1,q||!1,g||!1)};a.create_mouse_click_sensor=e.create_mouse_click_sensor;a.create_mouse_wheel_sensor=e.create_mouse_wheel_sensor;a.create_mouse_move_sensor=
e.create_mouse_move_sensor;a.create_touch_move_sensor=e.create_touch_move_sensor;a.create_touch_zoom_sensor=e.create_touch_zoom_sensor;a.create_touch_rotate_sensor=e.create_touch_rotate_sensor;a.create_touch_click_sensor=e.create_touch_click_sensor;a.create_motion_sensor=e.create_motion_sensor;a.create_vertical_velocity_sensor=e.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=e.create_gyro_angles_sensor;a.create_gyro_quat_sensor=e.create_gyro_quat_sensor;a.create_gyro_delta_sensor=e.create_gyro_delta_sensor;
a.create_hmd_quat_sensor=e.create_hmd_quat_sensor;a.create_hmd_position_sensor=e.create_hmd_position_sensor;a.create_timer_sensor=function(a,b){return e.create_timer_sensor(a,b||!1)};a.reset_timer_sensor=e.reset_timer_sensor;a.create_elapsed_sensor=e.create_elapsed_sensor;a.create_timeline_sensor=e.create_timeline_sensor;a.create_selection_sensor=function(a,b){return e.create_selection_sensor(a,b||!1)};a.create_callback_sensor=function(a,b){return e.create_callback_sensor(a,b||0)};a.set_custom_sensor=
function(a,b){e.lI(a,b)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=e.get_sensor_value;a.get_sensor_payload=e.get_sensor_payload;a.create_sensor_manifold=function(a,b,k,r,h,q,g){h=h||e.uv;e.create_sensor_manifold(a,b,k,r,h,q,void 0===g?null:g)};a.create_kb_sensor_manifold=function(a,b,k,r,h,q){r=e.create_keyboard_sensor(r);e.create_sensor_manifold(a,b,k,[r],e.uv,h,void 0===q?null:q)};a.check_sensor_manifolds=function(a){return e.check_sensor_manifold(a,null)};a.check_sensor_manifold=
e.check_sensor_manifold;a.remove_sensor_manifold=e.remove_sensor_manifold;a.reset=e.reset;a.register_keyboard_events=function(){b.gc("controls.register_keyboard_events() deprecated")};a.register_mouse_events=function(){b.gc("controls.register_mouse_events() deprecated")};a.register_wheel_events=function(){b.gc("controls.register_wheel_events() deprecated")};a.register_touch_events=function(){b.gc("controls.register_touch_events() deprecated")};a.register_device_orientation=function(){b.gc("controls.register_device_orientation() deprecated")};
a.unregister_keyboard_events=function(){b.gc("controls.unregister_keyboard_events() deprecated")};a.unregister_mouse_events=function(){b.gc("controls.unregister_mouse_events() deprecated")};a.unregister_wheel_events=function(){b.gc("controls.unregister_wheel_events() deprecated")};a.unregister_touch_events=function(){b.gc("controls.unregister_touch_events() deprecated")};a.unregister_device_orientation=function(){b.gc("controls.unregister_device_orientation() deprecated")}};b4w.module.constraints=function(a,p){var e=p("__camera"),b=p("__constraints"),c=p("__obj_util"),m=p("__physics"),k=p("__print"),r=p("__transform");a.append_stiff=function(a,c,e,k,f){f=f||1;c instanceof Array&&2==c.length?b.VB(a,c[0],c[1],e,k,f):b.zu(a,c,e,k,f);r.n(a);m.sync_transform(a)};a.append_semi_stiff=function(a,c,e,k){b.UB(a,c,e,k);r.n(a);m.sync_transform(a)};a.append_semi_stiff_cam=function(a,c,g,p,f,l,n,u){e.is_eye_camera(a)?(f=f||-Math.PI/2,l=l||Math.PI/2,n=n||Math.PI/2,u=u||-Math.PI/2,
b.TB(a,c,g,p,f,l,n,u),r.n(a),m.sync_transform(a)):k.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_semi_soft_cam=function(a,c,g,p){if(e.is_eye_camera(a)){if(!p||0>p)p=.25;b.SB(a,c,g,p);r.n(a);m.sync_transform(a)}else k.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_stiff_trans=function(a,c,e){b.XB(a,c,e);r.n(a);m.sync_transform(a)};a.append_copy_trans=function(a,c,e){b.MB(a,c,e);r.n(a);
m.sync_transform(a)};a.append_stiff_trans_rot=function(a,c,e,k){b.YB(a,c,e,k);r.n(a);m.sync_transform(a)};a.append_track=function(a,c){3==c.length?b.bC(a,c):b.aC(a,c);r.n(a);m.sync_transform(a)};a.append_follow=function(a,c,e,k){3==c.length?b.PB(a,c,e,k):b.OB(a,c,e,k);r.n(a);m.sync_transform(a)};a.append_stiff_viewport=function(a,c,e){b.append_stiff_viewport(a,c,e);r.n(a);m.sync_transform(a)};a.remove=function(a){a.ib&&b.remove(a)};a.get_parent=function(a){k.Ia("constraints.get_parent","objects.get_parent");
return c.get_parent(a)}};b4w.module.container=function(a,p){var e=p("__container"),b=p("__print");a.get_canvas=e.get_canvas;a.get_canvas_hud=e.get_canvas_hud;a.get_container=e.get_container;a.insert_to_container=function(a,m){2!=arguments.length?b.error("insert_to_container(): two arguments required"):a&&m&&e.insert_to_container(a,m)};a.set_canvas_offsets=e.set_canvas_offsets;a.update_canvas_offsets=e.update_canvas_offsets;a.client_to_canvas_coords=e.client_to_canvas_coords;a.force_offsets_updating=e.force_offsets_updating;
a.resize=function(a,m,k){a&&m||b.warn("Wrong canvas container dimensions: "+a+"x"+m+". Zero dimensions aren't allowed. Resized to: "+e.Gp+"x"+e.Fp+".");e.resize(a,m,k)}};b4w.module.data=function(a,p){var e=p("__data"),b=p("__loader");p("__print");a.load=e.load;a.unload=function(a){e.unload(a|0)};a.set_debug_resources_root=e.set_debug_resources_root;a.is_primary_loaded=e.is_primary_loaded;a.is_idle=b.ei;a.load_and_add_new=e.load;a.cleanup=a.unload;a.activate_media=e.activate_media};b4w.module.debug=function(a,p){function e(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var f=d.split(" ")[0];f in b||(b[f]=0);b[f]++}}c=a=0;for(f in b)switch(f){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[f];break;default:a+=b[f]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function c(a){a.sort(function(a,b){return b.fr.ALU_OPS-a.fr.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.fr,f=c.QK,e=m(c.XD),e=e?"\t\t("+e.join(", ")+")":"\t\t(NA)";A.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,e);A.groupCollapsed("directives");for(var e=c.Fb.Eg,g=0;g<e.length;g++){var k=e[g];A.log(k[0],k[1])}A.groupEnd();A.groupCollapsed("vert src");
A.log(c.PK);A.groupEnd();A.groupCollapsed("vert stats");for(var h in f)"ALU_OPS"!=h&&"TEX_OPS"!=h&&A.log(h,f[h]);A.groupEnd();A.groupCollapsed("frag src");A.log(c.aF);A.groupEnd();A.groupCollapsed("frag stats");for(h in d)"ALU_OPS"!=h&&"TEX_OPS"!=h&&A.log(h,d[h]);A.groupEnd();A.groupEnd()}}function m(a){for(var b=H.tj(),c=0;c<b.length;c++)for(var d=b[c],f=l.Pa(d,"MESH",l.DATA_ID_ALL),e=0;e<f.length;e++){var g=n.R(f[e],d);if(g&&g.P.length)for(var g=g.P,k=0;k<g.length;k++){var h=g[k];if(h.$b==a&&h.Cc.length)return h.Cc}}return null}
function k(a,b){function c(){J.push(c);C=b;return a.apply(a,arguments)}return c}function r(a,b,c){if(typeof b!=typeof a)throw"Wrong expected data type.";if(a.length!=b.length)throw"Wrong expected vector length.";c=c?c:1E-6;for(var d=0;d<a.length;d++)if(b[d]>a[d]+c||b[d]<a[d]-c)throw"Wrong result.";}p("__config");var h=p("__controls"),q=p("__container"),g=p("__debug"),y=p("__extensions"),f=p("__loader"),l=p("__objects"),n=p("__obj_util"),u=p("__physics"),A=p("__print"),B=p("__renderer"),H=p("__scenes"),
v=p("__scenegraph"),E=p("__sfx"),z=p("__shaders"),G=p("__textures"),d=p("__util"),F=p("__vec3"),J=[],C="",D=!0,O=new Float32Array(2);a.WM_NONE=g.WM_NONE;a.WM_OPAQUE_WIREFRAME=g.WM_OPAQUE_WIREFRAME;a.WM_TRANSPARENT_WIREFRAME=g.WM_TRANSPARENT_WIREFRAME;a.WM_FRONT_BACK_VIEW=g.WM_FRONT_BACK_VIEW;a.WM_DEBUG_SPHERES=g.WM_DEBUG_SPHERES;a.physics_stats=function(){u.eE()};a.physics_id=function(a){A.log("O",u.LE(a));for(var b=u.pF().ub.v,c=0;c<b.length;c++){var d=b[c];d.o.C==a&&A.log("B",d)}};a.visible_objects=
function(){for(var a=H.get_active(),b=l.Pa(a,"MESH",l.DATA_ID_ALL),a=[H.Z(a,"MAIN_OPAQUE"),H.Z(a,"MAIN_BLEND"),H.Z(a,"MAIN_GLOW")],c=0;c<a.length;c++){var d=a[c],f=d.v;if(f.length){A.group(d.type,"DYNAMIC");for(var e=0;e<b.length;e++){var g=b[e],k=g.g;if("DYNAMIC"==k.type)for(var h=0;h<f.length;h++){var m=f[h];if(m.Ib&&m.$e==k){A.Ur(g.name,g);break}}}A.groupEnd();A.groupCollapsed(d.type,"STATIC");for(e=0;e<b.length;e++)if(g=b[e],k=g.g,"DYNAMIC"!=k.type)for(h=0;h<f.length;h++)if(m=f[h],m.Ib&&m.$e==
k){A.Ur(g.name,g);break}A.groupEnd()}}};a.object_info=function(a){for(var b=H.get_active(),c=l.Pa(b,"MESH",l.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];if(f.name==a){A.log("Object",f);for(var e=H.kr(b),g=0;g<e.length;g++){for(var k=e[g],h=k.v,m=[],n=0;n<h.length;n++)h[n].$e==f.g&&m.push(h[n]);A.log("Subscene "+k.type,m)}}}};a.objects_stat=function(){var a=H.get_active();console.log("Armatures: "+l.Pa(a,"ARMATURE",l.DATA_ID_ALL).length);console.log("Cameras: "+l.Pa(a,"CAMERA",l.DATA_ID_ALL).length);
console.log("Curves: "+l.Pa(a,"CURVE",l.DATA_ID_ALL).length);console.log("Empties: "+l.Pa(a,"EMPTY",l.DATA_ID_ALL).length);console.log("Lamps: "+l.Pa(a,"LAMP",l.DATA_ID_ALL).length);console.log("Meshes: "+l.Pa(a,"MESH",l.DATA_ID_ALL).length);console.log("Speakers: "+l.Pa(a,"SPEAKER",l.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=H.get_active(),b=[H.Z(b,"MAIN_OPAQUE"),H.Z(b,"MAIN_BLEND"),H.Z(b,"MAIN_GLOW")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.v,f=0;f<d.length;f++){var e=
d[f].H;e&&(a+=e.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=H.get_active(),b=[H.Z(b,"MAIN_OPAQUE"),H.Z(b,"MAIN_BLEND"),H.Z(b,"MAIN_GLOW")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.v,f=0;f<d.length;f++){var e=d[f].H;e&&(a+=e.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=H.get_active(),b=[H.Z(a,"MAIN_OPAQUE"),H.Z(a,"MAIN_BLEND"),H.Z(a,"MAIN_GLOW")],c=0,d=0;d<b.length;d++){var f=b[d];f&&(c+=f.v.length)}a=H.Ry(a,["MAIN_PLANE_REFLECT","MAIN_PLANE_REFLECT_BLEND",
"MAIN_CUBE_REFLECT","MAIN_CUBE_REFLECT_BLEND"]);for(d=0;d<a.length;d++)f=a[d],c="MAIN_PLANE_REFLECT"==f.type||"MAIN_PLANE_REFLECT_BLEND"==f.type?c+f.v.length:c+6*f.v.length;return c};a.num_shaders=function(){return d.Il(z.aw())};a.geometry_stats=function(){for(var a=H.get_active(),b=H.kr(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var f=d.v,e=0;e<f.length;e++){var g=f[e].H,k=f[e].$e;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||k.Eo||k.Do)&&(a[g.id]=g)}}var f=
d=c=b=0,h;for(h in a)g=a[h],g=g.X,g.Cn&&(d++,f+=g.Cn/1048576),b++,c+=g.tv/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:f}};a.num_textures=function(){for(var a=[],b=0,c=H.get_active(),c=[H.Z(c,"MAIN_OPAQUE"),H.Z(c,"MAIN_BLEND"),H.Z(c,"MAIN_GLOW")],d=0;d<c.length;d++){var f=c[d];if(f)for(var f=f.v,e=0;e<f.length;e++){var g=f[e].H;if(g)for(var g=g.Y,k=0;k<g.length;k++){var h=g[k];if("IMAGE"===h.source||"ENVIRONMENT_MAP"===h.source){var l=h.Ra;-1===a.indexOf(l)&&(a.push(l),h=h.width*
h.height*4/1048576/h.zq,h*=1.3333,b+=h)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=H.get_active(),c=H.kr(c),d=0;d<c.length;d++){var f=c[d];if("SINK"!=f.type){var e=f.j,g=[e.Db,e.od];g.push.apply(g,f.hf);for(f=0;f<g.length;f++){var k=g[f];G.Ej(k)&&-1==a.indexOf(k)&&(a.push(k),b+=e.width*e.height*G.RF(k))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=H.get_active();(a=H.Z(a,"MAIN_OPAQUE"))&&H.gx(a.j,a,[1,1,0])};
a.make_light_frustum_shot=function(){var a=H.get_active(),b=H.Z(a,"MAIN_OPAQUE"),a=H.Ry(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],f;switch(c){case 0:f=[1,0,0];break;case 1:f=[0,1,0];break;case 2:f=[0,0,1];break;default:f=[1,0,1]}H.gx(d.j,b,f)}};a.scenegraph_to_dot=function(){for(var a=H.tj(),b=0;b<a.length;b++)A.log("\n"+v.bE(H.pr(a[b])))};a.scenes_to_dot=function(){};a.loading_graph_to_dot=function(){A.log("\n"+f.WF())};a.controls_info=h.debug;a.object_distance=function(a,b){var c=
m_tsr.get_trans_view(a.g.i),d=m_tsr.get_trans_view(b.g.i);return F.dist(c,d)};a.msg=g.msg;a.fbmsg=g.fbmsg;a.print_telemetry=g.print_telemetry;a.plot_telemetry=g.plot_telemetry;a.fbres=function(a,b){function c(){g.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),f=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),g=new Float32Array([-1,0,0]),k=new Float32Array([0,-1,0]),h=new Float32Array([0,
0,-1]);if(!d.Bg(a,d.mu))throw"Wrong VEC3_IDENT";if(!d.Bg(b,d.lu))throw"Wrong QUAT4_IDENT";if(!d.Bg(c,d.AXIS_X))throw"Wrong AXIS_X";if(!d.Bg(f,d.AXIS_Y))throw"Wrong AXIS_Y";if(!d.Bg(e,d.AXIS_Z))throw"Wrong AXIS_Z";if(!d.Bg(g,d.AXIS_MX))throw"Wrong AXIS_MX";if(!d.Bg(k,d.AXIS_MY))throw"Wrong AXIS_MY";if(!d.Bg(h,d.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=E.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==E.rr(c)&&E.mute(c,!0)}};a.check_finite=function(a){g.check_finite(a)};
a.set_debug_params=function(a){var b=H.get_active();if(b=H.Z(b,"WIREFRAME")){if("number"==typeof a.wireframe_mode)switch(a.wireframe_mode){case g.WM_NONE:case g.WM_OPAQUE_WIREFRAME:case g.WM_TRANSPARENT_WIREFRAME:case g.WM_FRONT_BACK_VIEW:case g.WM_DEBUG_SPHERES:H.SI(b,a.wireframe_mode);break;default:A.error("set_debug_params(): Wrong wireframe mode")}"object"==typeof a.wireframe_edge_color&&H.RI(b,a.wireframe_edge_color)}else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return A.DF()};
a.get_warning_quantity=function(){return A.UF()};a.clear_errors_warnings=function(){return A.clear_errors_warnings()};a.analyze_shaders=function(a){var d=z.aw(),f=0,g;for(g in d)a&&-1===g.indexOf(a)||f++;var f="of "+f+" analyzing...",k={};for(g in d)if(!a||-1!==g.indexOf(a)){var h=d[g],l;var m=h.Lt;l=h.Pv;var n=y.lr();if(n){m=n.getTranslatedShaderSource(m);l=n.getTranslatedShaderSource(l);m=m.replace("#version","#version 400 //");l=l.replace("#version","#version 400 //");var n=b("/nvidia_vert",m),
q=e(n),r=b("/nvidia_frag",l),p=e(r);l={PK:m,TN:n,QK:q,aF:l,nM:r,fr:p}}else A.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),l=void 0;n=h.Fb;m=n.Gk+" + "+n.oj;l.XD=h;l.Fb=n;h=k[m]=k[m]||[];h.push(l);A.log(f)}for(m in k)A.group("%c"+m,"color: #800"),h=k[m],c(h),A.groupEnd()};a.fake_load=g.fake_load;a.test_performance=function(a){if(y.Qn()){var b=v.GD();H.Tv(b);for(var c=v.Eb(b,"PERFORMANCE"),b=0;10>b;b++)B.ij(c);window.setTimeout(function(){g.OH(c);a(c.zf)},
100)}else a(-1)};a.start_debug=function(a){J=[];D=!0;a=p(a);for(var b in a)"function"===typeof a[b]&&(a[b]=k(a[b],b))};a.check_debug_result=function(){return D};a.test=function(a,b){try{return b(),!0}catch(c){return D=!1,console.error(a+" test was failed. ",c),!1}};a.pix=function(a,b){var c=H.get_active(),c=H.Z(c,b),d=q.lw(),f=q.kw(),e=d/2,g=f/2;q.resize(d,f,!1);if(c)d=c.j,c=q.Wk(e,g,O,c.j),c[1]=d.height-c[1],c=B.Bs(d.Zd,c[0],c[1]),r(a,c);else throw"Couldn't find subscene \""+b+'".';};a.eqs=function(a,
b){if(JSON.stringify(a)!=JSON.stringify(b))throw"Wrong result. Function: "+C;};a.eqv=r;a.eqf=function(a,b,c){if("number"!=typeof b)throw"Wrong expected data type.";c=c?c:1E-6;if(b>a+c||b<a-c)throw"Wrong result.";};a.eq=function(a,b){if(a!==b)throw"Wrong result.";};a.stat=function(a){a=p(a);for(var b in a)-1==J.indexOf(a[b])&&console.warn(b+" function wasn't called.")};a.ok=function(a){if(!Boolean(a))throw"Wrong result. Function: "+C;}};b4w.module.geometry=function(a,p){var e=p("__batch"),b=p("__geometry"),c=p("__print"),m=p("__renderer");a.extract_vertex_array=function(a,m,h){if(!b.yj(a))return c.error("Wrong object:",a.name),null;if(a=e.Ja(a,m,"MAIN")){if((m=a.X)&&m.sb&&m.sb[h])return b.EE(m,h);c.error("Attribute not found:"+h);return null}c.error("Wrong material:",m);return null};a.extract_index_array=function(a,m){if(!b.yj(a))return c.error("Wrong object:",a.name),null;var h=e.Ja(a,m,"MAIN");if(h){if((h=h.X)&&h.sb)return h.Ig;
c.error("Buffer data not found");return null}c.error("Wrong material:",m);return null};a.update_vertex_array=function(a,m,h,q){var g=["MAIN","SHADOW","COLOR_ID"];if(b.yj(a))for(var p=0;p<g.length;p++){var f=e.Ja(a,m,g[p]);f&&(f=f.X)&&f.sb&&f.sb[h]&&b.mz(f,h,0,q)}else c.error("Wrong object:",a.name)};a.override_geometry=function(a,r,h,q,g){var p=["MAIN","SHADOW","COLOR_ID"];if(b.yj(a))if(h instanceof Uint16Array||h instanceof Uint32Array)if(q instanceof Float32Array)for(var f=0;f<p.length;f++){var l=
e.Ja(a,r,p[f]);if(l){var n=l.X;if(n){b.nz(n,l.Cf,h);var u=0,A;for(A in n.sb)var B=n.sb[A],u=u+q.length/3*B.fe;n.oc=new Float32Array(u);var u=n.oc,H=0;for(A in n.sb)switch(B=n.sb[A],A){case "a_position":u.set(q,H);B.offset=H;B.length=q.length;H+=B.length;break;case "a_normal":var v;g&&(v=b.Qu(h,q,q));var E=b.Pu(h,q,v);u.set(E,H);B.offset=H;B.length=q.length;H+=B.length;break;case "a_tangent":B.offset=H;B.length=q.length/3*B.fe;for(var E=new Float32Array(B.length),z=0;z<E.length;z+=4)E[z]=1,E[z+3]=
1;u.set(E,H);H+=B.length;break;default:B.offset=H,B.length=q.length/3*B.fe,E=new Float32Array(B.length),u.set(E,H),H+=B.length}b.Et(n);m.Vp(l);(l=e.sd(a,l))&&l.X&&(l.X=n)}}}else c.error("Wrong positions_array type");else c.error("Wrong ibo_array type");else c.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,e,h){b.check_shape_keys(a)?b.yr(a,e)?b.Au(a,e,parseFloat(h)):c.error("Wrong key name:",e):c.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return b.check_shape_keys(a)};
a.get_shape_keys_names=function(a){return b.check_shape_keys(a)?b.get_shape_keys_names(a):(c.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,e){return b.check_shape_keys(a)?b.yr(a,e)?b.get_shape_key_value(a,e):(c.error("Wrong key name:",e),null):(c.error("Wrong object:",a.name),null)};a.draw_line=function(a,r,h){h=h||!1;if(r instanceof Float32Array){if(a=e.or(a))b.draw_line(a,r,h),m.Vp(a)}else c.error("Wrong positions type")}};b4w.module.hud=function(a,p){var e=p("__hud");p("__print");a.draw_mixer_strip=e.draw_mixer_strip;a.plot_array=e.plot_array};b4w.module.input=function(a,p){function e(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=[],c=0;c<a.length;c++)a[c]&&b.push(c);return b}var b=p("__input"),c=p("__camera"),m=p("__container"),k=p("__obj_util"),r=p("__print"),h=p("__scenes"),q=p("__vec4"),g=q.create(),y=q.create();a.DPAD_UP_GAMEPAD_BTN=b.DPAD_UP_GAMEPAD_BTN;a.DPAD_DOWN_GAMEPAD_BTN=b.DPAD_DOWN_GAMEPAD_BTN;a.DPAD_RIGHT_GAMEPAD_BTN=b.DPAD_RIGHT_GAMEPAD_BTN;a.DPAD_LEFT_GAMEPAD_BTN=
b.DPAD_LEFT_GAMEPAD_BTN;a.FACE_UP_GAMEPAD_BTN=b.FACE_UP_GAMEPAD_BTN;a.FACE_DOWN_GAMEPAD_BTN=b.FACE_DOWN_GAMEPAD_BTN;a.FACE_RIGHT_GAMEPAD_BTN=b.FACE_RIGHT_GAMEPAD_BTN;a.FACE_LEFT_GAMEPAD_BTN=b.FACE_LEFT_GAMEPAD_BTN;a.R1_GAMEPAD_BTN=b.R1_GAMEPAD_BTN;a.R2_GAMEPAD_BTN=b.R2_GAMEPAD_BTN;a.L1_GAMEPAD_BTN=b.L1_GAMEPAD_BTN;a.L2_GAMEPAD_BTN=b.L2_GAMEPAD_BTN;a.SELECT_GAMEPAD_BTN=b.SELECT_GAMEPAD_BTN;a.START_GAMEPAD_BTN=b.START_GAMEPAD_BTN;a.LEFT_ANALOG_GAMEPAD_BTN=b.LEFT_ANALOG_GAMEPAD_BTN;a.RIGHT_ANALOG_GAMEPAD_BTN=
b.RIGHT_ANALOG_GAMEPAD_BTN;a.MAIN_GAMEPAD_BTN=b.MAIN_GAMEPAD_BTN;a.HMD_ORIENTATION_QUAT=b.HMD_ORIENTATION_QUAT;a.HMD_POSITION=b.HMD_POSITION;a.MOUSE_LOCATION=b.MOUSE_LOCATION;a.MOUSE_DOWN_WHICH=b.MOUSE_DOWN_WHICH;a.MOUSE_UP_WHICH=b.MOUSE_UP_WHICH;a.MOUSE_WHEEL=b.MOUSE_WHEEL;a.KEYBOARD_UP=b.KEYBOARD_UP;a.KEYBOARD_DOWN=b.KEYBOARD_DOWN;a.TOUCH_START=b.TOUCH_START;a.TOUCH_MOVE=b.TOUCH_MOVE;a.TOUCH_END=b.TOUCH_END;a.GYRO_ORIENTATION_QUAT=b.GYRO_ORIENTATION_QUAT;a.GYRO_ORIENTATION_ANGLES=b.GYRO_ORIENTATION_ANGLES;
var f={};f[b.DEVICE_HMD]=[b.HMD_ORIENTATION_QUAT,b.HMD_POSITION];f[b.DEVICE_MOUSE]=[b.MOUSE_LOCATION];var l={};l[b.DEVICE_MOUSE]=[b.MOUSE_LOCATION,b.MOUSE_DOWN_WHICH,b.MOUSE_UP_WHICH,b.MOUSE_WHEEL];l[b.DEVICE_KEYBOARD]=[b.KEYBOARD_UP,b.KEYBOARD_DOWN];l[b.DEVICE_TOUCH]=[b.TOUCH_START,b.TOUCH_MOVE,b.TOUCH_END];l[b.DEVICE_GYRO]=[b.GYRO_ORIENTATION_QUAT,b.GYRO_ORIENTATION_ANGLES];a.DEVICE_GYRO=b.DEVICE_GYRO;a.DEVICE_HMD=b.DEVICE_HMD;a.DEVICE_MOUSE=b.DEVICE_MOUSE;a.DEVICE_KEYBOARD=b.DEVICE_KEYBOARD;a.DEVICE_TOUCH=
b.DEVICE_TOUCH;a.can_use_device=b.can_use_device;a.get_device_by_type_element=b.get_device_by_type_element;a.switch_prevent_default=function(a,c){a&&b.switch_prevent_default(a,c)};a.register_device=function(a){a.type!=b.DEVICE_HMD?r.error("register_device is undefined for device."):b.register_device(a)};a.reset_device=function(a){a&&a.type==b.DEVICE_HMD?b.reset_device(a):r.error("reset_device is undefined for device.")};a.get_vector_param=function(a,c,e){if(a.type in f&&0<=f[a.type].indexOf(c))return b.get_vector_param(a,
c,e);r.error("device hasn't param: ",c)};a.attach_param_cb=function(a,c,f){if(a.type in l&&0<=l[a.type].indexOf(c))return b.attach_param_cb(a,c,f);r.error("device hasn't param: ",c)};a.detach_param_cb=function(a,c,f){if(a.type in l&&0<=l[a.type].indexOf(c))return b.detach_param_cb(a,c,f);r.error("device hasn't param: ",c)};a.enable_split_screen=function(a){var f=b.get_device_by_type_element(b.DEVICE_HMD);if(!f||!f.$f)return!1;var e=b.get_vector_param(f,b.eA,g),l=b.get_vector_param(f,b.fA,y);e&&e&&
c.set_hmd_fov(a,e,l);if(e=b.SF(f,b.dA))l=h.get_active(),a=k.R(a,l).M,c.set_eye_distance(a,e);a={};a.distortion_coefs=[f.distortion_coefs[0],f.distortion_coefs[1]];a.chromatic_aberration_coefs=[f.chromatic_aberration_coefs[0],f.chromatic_aberration_coefs[1],f.chromatic_aberration_coefs[2],f.chromatic_aberration_coefs[3]];a.enable_hmd_stereo=!0;a.base_line_factor=f.xg&&f.Lf?(f.xg-f.yg)/f.Lf:.5;a.inter_lens_factor=f.Jg&&f.th?f.Jg/f.th-.5:0;h.set_hmd_params(a);a=1+f.distortion_coefs[0]+f.distortion_coefs[1];
h.lH(a,a);a=m.get_container();m.resize(a.clientWidth,a.clientHeight,!0);b.reset_device(f);return!0};a.disable_split_screen=function(){var a=b.get_device_by_type_element(b.DEVICE_HMD);if(!a||!a.$f)return!1;h.set_hmd_params({enable_hmd_stereo:!1});a=m.get_container();m.resize(a.clientWidth,a.clientHeight,!0);return!0};a.set_gamepad_btn_key=function(a,c,f){var g=e().length;if(a>g-1)r.error("Wrong gamepad number. Available gamepads: "+g);else{switch(a){case 0:a=b.Lk;break;case 1:a=b.Nm;break;case 2:a=
b.Om;break;case 3:a=b.Pm;break;default:a=b.Lk}a=b.get_device_by_type_element(a);b.set_gamepad_btn_key(a,c,f)}};a.get_pressed_gmpd_btn=b.get_pressed_gmpd_btn;a.check_enable_gamepad_indices=e};b4w.module.lights=function(a,p){function e(a){for(var b=h.get_active(),e=m.Pa(b,"LAMP",m.DATA_ID_ALL),k=0;k<e.length;k++){var n=e[k];if("SUN"==n.Qa.type){var p=n;break}}if(!p)r.error("There is no sun on the scene");else if("number"==typeof a.hor_position&&"number"==typeof a.vert_position){e=y.deg_to_rad(180-a.hor_position);a=y.deg_to_rad(90-a.vert_position);k=p.g;q.set_rotation_euler(p,[a,e,0]);e=new Float32Array(3);n=g.get_quat_view(k.i);y.quat_to_dir(n,y.AXIS_Y,e);k=g.get_trans_view(k.i);k=f.length(k);
f.copy(e,l);f.scale(l,k,l);q.set_translation(p,l);q.n(p);e=p.Qa;if(e.Dv){var u=b.world.light_settings.environment_energy,k=b.world.horizon_color,n=b.world.zenith_color,d=Math.cos(Math.abs(a));a=Math.max(Math.min(3*d,1),0)*e.wv;u*=Math.max(d,.1);c.Ss(e,a);h.set_environment_colors(b,u,k,n)}h.rp(p,b)}}function b(a){if(k.is_lamp(a))return a.Qa.type;r.error("get_light_type(): Wrong object");return!1}var c=p("__lights"),m=p("__objects"),k=p("__obj_util"),r=p("__print"),h=p("__scenes"),q=p("__transform"),
g=p("__tsr"),y=p("__util"),f=p("__vec3"),l=new Float32Array(3),n,u=60;a.get_lamps=function(a){var b=h.get_active(),b=m.Pa(b,"LAMP",m.DATA_ID_ALL);if(!a)return b;for(var c=[],f=0;f<b.length;f++){var e=b[f];e.Qa.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=h.get_active(),a=m.Pa(a,"LAMP",m.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var f=a[c];if("SUN"==f.Qa.type){b=f;break}}return b?(b=b.Qa.direction,a=y.rad_to_deg(Math.atan2(b[2],b[0]))+90,180<a&&(a-=360),b=y.rad_to_deg(Math.atan2(b[1],
Math.sqrt(b[0]*b[0]+b[2]*b[2]))),c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=e;a.set_day_time=function(a){for(var b=h.get_active(),b=m.Pa(b,"LAMP",m.DATA_ID_ALL),c=0;c<b.length;c++){var f=b[c];if("SUN"==f.Qa.type){var g=f;break}}g?(g=-Math.cos(a/12*Math.PI)*u,b={},b.hor_position=12>a?15*a:15*(a-24),b.vert_position=g,e(b)):r.error("There is no sun on the scene")};a.set_date=function(a){(n=a.getDate())?1582==n&&10==a.kN&&4<a.aE&&15>a.aE&&r.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):
r.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){u=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(k.is_lamp(a))var c=a.Qa;else return r.error("get_light_params(): Wrong object"),null;if(a=b(a))switch(a){case "SPOT":var f={light_type:a,light_color:c.color,light_energy:c.Ud,light_spot_blend:c.sm,light_spot_size:c.Ii,light_distance:c.distance};break;case "POINT":f={light_type:a,light_color:c.color,light_energy:c.Ud,light_distance:c.distance};break;default:f=
{light_type:a,light_color:c.color,light_energy:c.Ud}}return f?f:null};a.get_light_type=b;a.set_light_params=function(a,b){if(k.is_lamp(a)){var f=a.Qa,e=h.get_active();"number"==typeof b.light_energy&&c.Ss(f,b.light_energy);"object"==typeof b.light_color&&c.ry(f,b.light_color);"number"==typeof b.light_spot_blend&&c.BI(f,b.light_spot_blend);"number"==typeof b.light_spot_size&&c.CI(f,b.light_spot_size);"number"==typeof b.light_distance&&c.AI(f,b.light_distance);h.rp(a,e);m.KJ(e)}else r.error("set_light_params(): Wrong object")}};b4w.module.logic_nodes=function(a,p){var e=p("__logic_nodes");a.append_custom_callback=function(a,c){e.NB(a,c)};a.remove_custom_callback=function(a){e.TH(a)};a.run_entrypoint=function(a,c){e.gI(a,c)}};b4w.module.material=function(a,p){function e(a,b){for(var c=a.u[0].P,e=0;e<c.length;e++){var g=c[e];if(-1<g.Cc.indexOf(b))return"MAIN"==g.type}return!1}function b(a,b){var c=m.Ja(a,b,"MAIN");return Boolean(c&&c.Yc[0])}function c(a,b){var c=m.Ja(a,b,"MAIN");return Boolean(c&&c.Yc[1])}var m=p("__batch"),k=p("__config"),r=p("__obj_util"),h=p("__print"),q=p("__shaders"),g=p("__util"),y=k.q;a.inherit_material=function(a,b,c,e){r.di(c)&&r.di(a)?m.inherit_material(a,b,c,e):h.error("Wrong or batched object(s)")};
a.get_materials_names=function(a){var b=[];a=a.u;for(var c=0;c<a.length;c++)for(var e=a[c].P,g=0;g<e.length;g++)for(var k=0;k<e[g].Cc.length;k++)-1==b.indexOf(e[g].Cc[k])&&b.push(e[g].Cc[k]);return b};a.set_diffuse_color=function(a,b,c){var e=m.Ja(a,b,"MAIN");e?(e.vc.set(c),(a=m.sd(a,b,"MAIN"))&&a.vc.set(c)):h.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=m.Ja(a,b,"MAIN");if(c){var e=new Float32Array(4);e.set(c.vc);return e}h.error('Couldn\'t get property "diffuse_color"!')};
a.set_diffuse_intensity=function(a,b,c){var e=m.Ja(a,b,"MAIN");if(e){if(e.Dg=c,a=m.sd(a,b,"MAIN"))a.Dg=c}else h.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=m.Ja(a,b,"MAIN");if(c)return c.Dg;h.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var e=m.Ja(a,b,"MAIN");e?(e.ff.set(c),(a=m.sd(a,b,"MAIN"))&&a.ff.set(c)):h.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=m.Ja(a,
b,"MAIN");if(c){var e=Array(3);e[0]=c.ff[0];e[1]=c.ff[1];e[2]=c.ff[2];return e}h.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var e=m.Ja(a,b,"MAIN");if(e){if(e.Hi=c,a=m.sd(a,b,"MAIN"))a.Hi=c}else h.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=m.Ja(a,b,"MAIN");if(c)return c.Hi;h.error('Couldn\'t get property "specular_color_factor"!')};a.set_specular_intensity=function(a,c,e){b(a,c)||h.error('Property "specular_intensity" is missing!');
m.Ja(a,c,"MAIN").Yc[0]=e;(a=m.sd(a,c,"MAIN"))&&(a.Yc[0]=e)};a.get_specular_intensity=function(a,c){b(a,c)||h.error('Property "specular_intensity" is missing!');return m.Ja(a,c,"MAIN").Yc[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,e){c(a,b)||h.error('Property "specular_hardness" is missing!');m.Ja(a,b,"MAIN").Yc[1]=e;(a=m.sd(a,b,"MAIN"))&&(a.Yc[1]=e)};a.get_specular_hardness=function(a,b){c(a,b)||h.error('Property "specular_hardness" is missing!');return m.Ja(a,b,"MAIN").Yc[1]};
a.check_specular_hardness=c;a.set_emit_factor=function(a,b,c){var e=m.Ja(a,b,"MAIN");if(e){if(e.Df=c,a=m.sd(a,b,"MAIN"))a.Df=c}else h.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=m.Ja(a,b,"MAIN");if(c)return c.Df;h.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var e=m.Ja(a,b,"MAIN");if(e){if(e.pf=c,a=m.sd(a,b,"MAIN"))a.pf=c}else h.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=
m.Ja(a,b,"MAIN");if(c)return c.pf;h.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var e=m.Ja(a,b,"MAIN");if(e){if(e.Cg=c,a=m.sd(a,b,"MAIN"))a.Cg=c}else h.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=m.Ja(a,b,"MAIN");if(c)return c.Cg;h.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var e=m.Ja(a,b,"MAIN");if(e){if(e.vg=c,a=m.sd(a,b,"MAIN"))a.vg=c}else h.error('Couldn\'t set property "alpha_factor"!')};
a.get_alpha_factor=function(a,b){var c=m.Ja(a,b,"MAIN");if(c)return c.vg;h.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return h.error("missing arguments in get_material_params"),null;if(!e(a,b))return null;var c=m.Ja(a,b,"MAIN");if(!c)return null;var g={};"MAIN"==c.type&&(g.reflect_factor=c.reflect_factor,g.fresnel=c.se[2],g.fresnel_factor=5*(1-c.se[3]),g.parallax_scale=c.parallax_scale,g.parallax_steps=m.hc(c,"PARALLAX_STEPS")[1]);return g};
a.get_water_material_params=function(a,b){if(!a||!b)return h.error("missing arguments in get_water_material_params"),null;if(!e(a,b))return null;var c=m.Ja(a,b,"MAIN");if(!c||!c.qh)return null;if(!c)return h.error("material not found"),null;var g={};if("MAIN"==c.type){if(y.hk){var k=g.shallow_water_col=Array(3);k[0]=c.shallow_water_col[0];k[1]=c.shallow_water_col[1];k[2]=c.shallow_water_col[2];k=g.shore_water_col=Array(3);k[0]=c.shore_water_col[0];k[1]=c.shore_water_col[1];k[2]=c.shore_water_col[2];
g.shallow_water_col_fac=c.shallow_water_col_fac;g.shore_water_col_fac=c.shore_water_col_fac}g.foam_factor=c.foam_factor;g.norm_uv_velocity=c.Ik;g.absorb_factor=m.hc(c,"ABSORB")[1];g.sss_strength=m.hc(c,"SSS_STRENGTH")[1];g.sss_width=m.hc(c,"SSS_WIDTH")[1];g.dst_noise_scale0=m.hc(c,"DST_NOISE_SCALE_0")[1];g.dst_noise_scale1=m.hc(c,"DST_NOISE_SCALE_1")[1];g.dst_noise_freq0=m.hc(c,"DST_NOISE_FREQ_0")[1];g.dst_noise_freq1=m.hc(c,"DST_NOISE_FREQ_1")[1];g.dir_min_shore_fac=m.hc(c,"DIR_MIN_SHR_FAC")[1];
g.dir_freq=m.hc(c,"DIR_FREQ")[1];g.dir_noise_scale=m.hc(c,"DIR_NOISE_SCALE")[1];g.dir_noise_freq=m.hc(c,"DIR_NOISE_FREQ")[1];g.dir_min_noise_fac=m.hc(c,"DIR_MIN_NOISE_FAC")[1];g.dst_min_fac=m.hc(c,"DST_MIN_FAC")[1];g.waves_hor_fac=m.hc(c,"WAVES_HOR_FAC")[1]}return g};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(e(a,b)){var g=m.Ja(a,b,"MAIN");if(g){var k=[g];(g=m.sd(a,b,"MAIN"))&&k.push(g);for(a=0;a<k.length;a++)g=k[a],"number"==typeof c.material_reflectivity&&(g.reflect_factor=c.material_reflectivity),
"number"==typeof c.material_fresnel&&(g.se[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(g.se[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(g.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=q.r(parseFloat(c.material_parallax_steps)),m.ya(g,"PARALLAX_STEPS",b),m.Rb(g,!0))}else h.error("material not found")}else h.error("setting material params is not possible");else h.error("missing arguments in set_material_params")};
a.set_water_material_params=function(a,b,c){if(a&&b&&c)if(e(a,b)){var g=m.Ja(a,b,"MAIN");if(g){var k=[g];(g=m.sd(a,b,"MAIN"))&&k.push(g);for(a=0;a<k.length;a++)g=k[a],y.hk&&("object"==typeof c.shallow_water_col&&g.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(g.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&g.shore_water_col.set(c.shore_water_col),"number"==typeof c.shore_water_col_fac&&(g.shore_water_col_fac=c.shore_water_col_fac)),
y.shore_smoothing&&g.Ap&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?m.ya(g,"SHORE_SMOOTHING",1):m.ya(g,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=q.r(parseFloat(c.absorb_factor)),m.ya(g,"ABSORB",b))),"number"==typeof c.foam_factor&&y.mj&&(g.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&(g.Ik=c.norm_uv_velocity),y.water_dynamic&&g.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?m.ya(g,"DYNAMIC",1):m.ya(g,"DYNAMIC",0)),"number"==typeof c.waves_height&&
(b=q.r(parseFloat(c.waves_height)),m.ya(g,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=q.r(parseFloat(c.waves_length)),m.ya(g,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=q.r(parseFloat(c.sss_strength)),m.ya(g,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=q.r(parseFloat(c.sss_width)),m.ya(g,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=q.r(parseFloat(c.dst_noise_scale0)),m.ya(g,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=q.r(parseFloat(c.dst_noise_scale1)),
m.ya(g,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=q.r(parseFloat(c.dst_noise_freq0)),m.ya(g,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=q.r(parseFloat(c.dst_noise_freq1)),m.ya(g,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=q.r(parseFloat(c.dir_min_shore_fac)),m.ya(g,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=q.r(parseFloat(c.dir_freq)),m.ya(g,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=q.r(parseFloat(c.dir_noise_scale)),
m.ya(g,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=q.r(parseFloat(c.dir_noise_freq)),m.ya(g,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=q.r(parseFloat(c.dir_min_noise_fac)),m.ya(g,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=q.r(parseFloat(c.dst_min_fac)),m.ya(g,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=q.r(parseFloat(c.waves_hor_fac)),m.ya(g,"WAVES_HOR_FAC",b))),m.Rb(g,!0)}else h.error("material not found")}else h.error("setting water material params is not possible");
else h.error("missing arguments in set_water_material_params")};a.set_line_params=function(a,b){var c=m.or(a);c?(g.ud(b.color)&&c.vc.set(b.color),g.ud(b.width)&&(c.oo=b.width)):h.error("Couldn't set line params!")};a.get_line_params=function(a){if(a=m.or(a))return{color:new Float32Array(a.vc),width:a.oo};h.error("Couldn't get line params");return null}};b4w.module.math=function(a,p){var e=p("__vec3"),b=p("__util"),c=p("__math"),m=new Float32Array(3);a.create_pline_from_points=function(a,b){var h=new Float32Array(6);c.II(h,a);e.subtract(b,a,m);c.set_pline_directional_vec(h,m);return h};a.create_pline_from_point_vec=function(a,b){var e=new Float32Array(6);c.II(e,a);c.set_pline_directional_vec(e,b);return e};a.create_pline=function(){return new Float32Array(6)};a.get_pline_directional_vec=c.get_pline_directional_vec;a.get_pline_initial_point=c.get_pline_initial_point;
a.set_pline_initial_point=c.set_pline_initial_point;a.set_pline_directional_vec=c.set_pline_directional_vec;a.line_plane_intersect=b.line_plane_intersect;a.calc_pline_point=c.calc_pline_point;a.point_plane_dist=c.point_plane_dist};b4w.module.particles=function(a,p){var e=p("__particles"),b=p("__print");a.set_size=function(a,m,k){e.Tj(a)?e.set_size(a,m,k):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,m,k){e.Tj(a)?e.set_normal_factor(a,m,k):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,m,k){e.Tj(a)?(k=Math.min(k,1),k=Math.max(k,0),e.set_factor(a,m,k)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){p("__config");var e=p("__ipc"),b=p("__physics"),c=p("__print"),m=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.T(a)?b.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.T(a)?b.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return b.T(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,e){b.T(a)?b.set_gravity(a,e):c.error("No physics for object "+a.name)};a.set_damping=function(a,e,h){b.T(a)?b.F("set_damping",a.o.C,e,h):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.T(a)){var e=a.xe;b.F("set_damping",a.o.C,e.Kq,e.Js)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,e,h){b.T(a)?b.set_transform(a,e,h):c.error("No physics for object "+a.name)};a.sync_transform=
function(a){b.T(a)?b.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a,e,h,m){b.T(a)?b.apply_velocity(a,e,h,m):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a,e,h,m){b.T(a)?b.apply_velocity_world(a,e,h,m):c.error("No physics for object "+a.name)};a.apply_force=function(a,e,h,m){b.T(a)?b.apply_force(a,e,h,m,!1):c.error("No physics for object "+a.name)};a.apply_force_world=function(a,e,h,m){b.T(a)?b.apply_force(a,e,h,m,!0):c.error("No physics for object "+
a.name)};a.apply_torque=function(a,e,h,m){b.T(a)?b.apply_torque(a,e,h,m):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,e){b.T(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_throttle(a,m.clamp(e,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,e,h){if(b.T(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");e=m.clamp(e,0,1);var q=a.l.jj;-1==h||1==h?q=Math.max(-1,Math.min(q+h*e,1)):
0==h&&0<=q?(q-=e,q=Math.max(0,q)):0==h&&0>q?(q+=e,q=Math.min(0,q)):c.error("Wrong steering direction");b.vehicle_throttle(a,m.clamp(q,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,e){b.T(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_steer(a,m.clamp(e,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,e,h){if(b.T(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");e=m.clamp(e,
0,1);var q=a.l.qk;-1==h||1==h?q=Math.max(-1,Math.min(q+h*e,1)):0==h&&0<=q?(q-=e,q=Math.max(0,q)):0==h&&0>q?(q+=e,q=Math.min(0,q)):c.error("Wrong steering direction");b.vehicle_steer(a,m.clamp(q,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,e){b.T(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_brake(a,m.clamp(e,0,1))):c.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,e){if(b.T(a)){b.is_vehicle_chassis(a)||
b.is_vehicle_hull(a)||c.error("Wrong object");e=m.clamp(e,-1,1);var h=a.l.Tk;b.vehicle_brake(a,m.clamp(h+h*e,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.T(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.bd.name;c.error("Wrong object");return null};a.get_vehicle_throttle=
function(a){if(!b.T(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.jj;c.error("Wrong object");return null};a.get_vehicle_steering=function(a){if(!b.T(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.qk;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.T(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.Tk;
c.error("Wrong object")};a.get_vehicle_speed=function(a){if(!b.T(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,e,h){b.T(a)?b.set_character_move_dir(a,e,h):c.error("No physics for object "+a.name)};a.set_character_move_type=function(a,e){b.T(a)?b.set_character_move_type(a,e):c.error("No physics for object "+
a.name)};a.set_character_walk_velocity=function(a,e){b.T(a)?b.set_character_walk_velocity(a,e):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,e){b.T(a)?b.set_character_run_velocity(a,e):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,e){b.T(a)?b.set_character_fly_velocity(a,e):c.error("No physics for object "+a.name)};a.character_jump=function(a){b.T(a)?b.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=
function(a,e,h){b.T(a)?b.character_rotation_inc(a,e,h):c.error("No physics for object "+a.name)};a.set_character_rotation=function(a,e,h){b.T(a)?b.set_character_rotation(a,e,h):c.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,e){b.T(a)?b.set_character_rotation_v(a,e):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,e){b.T(a)?b.set_character_rotation_h(a,e):c.error("No physics for object "+a.name)};a.append_collision_test=function(a,e,h,
m){b.T(a)?b.append_collision_test(a,e,h,m||!1):c.error("No physics for object "+a.name)};a.remove_collision_test=function(a,e,h){b.T(a)?b.remove_collision_test(a,e||"ANY",h):c.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,e){b.T(a)?b.apply_collision_impulse_test(a,e):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.T(a)?b.clear_collision_impulse_test(a):c.error("No physics for object "+a.name)};a.append_ray_test=function(a,
e,h,m,g,p){a=a||null;if(null==a||b.T(a))return b.append_ray_test(a,e,h,m,g,p||!1,!1,!1,!1);c.error("No physics for object "+a.name)};a.append_ray_test_ext=function(a,e,h,m,g,p,f,l,n){a=a||null;if(null==a||b.T(a))return b.append_ray_test(a,e,h,m,g,p||!1,f||!1,l||!1,n||!1);c.error("No physics for object "+a.name)};a.remove_ray_test=function(a){b.Nw(a)?b.remove_ray_test(a):c.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,e,h){b.Nw(a)?b.change_ray_test_from_to(a,e,h):c.error("Wrong ray test ID")};
a.apply_constraint=function(a,e,h,m,g,p,f,l,n,u){b.T(e)&&b.T(g)?b.apply_constraint(a,e,h,m,g,p,f,l,n,u):c.error("Wrong objects")};a.clear_constraint=function(a){b.T(a)&&b.ZF(a)?b.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,e,h,m,g,p){b.T(a)&&b.T(m)?b.pull_to_constraint_pivot(a,e,h,m,g,p):c.error("Wrong objects")};a.get_worker_listeners=e.get_worker_listeners};b4w.module.rgb=function(a,p){p("__print");var e=p("__util"),b=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,b,e){var p=new Float32Array(3);p[0]=a;p[1]=b;p[2]=e;return p};a.set=function(a,b,e,p){p[0]=a;p[1]=b;p[2]=e;return p};a.css_to_rgb=function(a,b,k,p){p=p||new Float32Array(3);p[0]=a/255;p[1]=b/255;p[2]=k/255;e.Ky(p,p);return p};a.rgb_to_css=function(a){a=e.Rr(a,b);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};a.rgb_to_css_hex=
function(a){function m(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a}a=e.Rr(a,b);return"#"+m(a[0])+m(a[1])+m(a[2])}};
b4w.module.rgba=function(a,p){p("__print");var e=p("__util"),b=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,b,e,p){var h=new Float32Array(4);h[0]=a;h[1]=b;h[2]=e;h[3]=p;return h};a.set=function(a,b,e,p,h){h[0]=a;h[1]=b;h[2]=e;h[3]=p;return h};a.css_to_rgba=function(a,b,k,p,h){h=h||new Float32Array(4);h[0]=a/255;h[1]=b/255;h[2]=k/255;h[3]=p;e.Ky(h,h);return h};a.rgba_to_css=function(a){var m=e.Rr(a,b);return[Math.round(255*m[0]),Math.round(255*
m[1]),Math.round(255*m[2]),a[3]]}};b4w.module.scenes=function(a,p){var e=p("__batch"),b=p("__camera"),c=p("__data"),m=p("__graph"),k=p("__objects"),r=p("__obj_util"),h=p("__physics"),q=p("__print"),g=p("__scenes"),y=p("__util");a.DATA_ID_ALL=k.DATA_ID_ALL;a.set_active=function(a){var b=g.tj();g.set_active(y.keysearch("name",a,b))};a.get_active=function(){return g.ma()?g.get_active().name:""};a.get_scenes=function(){for(var a=g.tj(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(g.ma())return g.Hl(g.get_active());
q.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=k.Jb(k.Ip,a,b|0);if(c)return c;q.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=k.Jb(k.Hp,a,b,c|0))return a;q.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=k.Jb(k.cc,a,b|0);if(c)return c;q.error("get object "+a+": not found")};a.get_world_by_name=function(a,b){var c=k.get_world_by_name(a,b|0);if(c)return c;q.error("get object "+a+": not found")};
a.get_object_data_id=function(a){return g.get_object_data_id(a)};a.pick_object=k.pick_object;a.outlining_is_enabled=function(a){return a&&a.g&&a.g.Kb};a.set_outline_intensity=function(a,b){a&&a.g&&a.g.Kb?k.set_outline_intensity(a,b):q.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.g&&a.g.Kb)return a.g.Yf;q.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,e){a&&a.g&&a.g.Kb?k.apply_outline_anim(a,b,c,e):q.error("apply_outline_anim(): wrong object")};
a.apply_outline_anim_def=function(a){if(a&&a.g&&a.g.Kb){var b=a.g.Wj;k.apply_outline_anim(a,b.Xj,b.Yj,b.Zj)}else q.error("apply_outline_anim_def(): wrong object")};a.clear_outline_anim=function(a){a&&a.g&&a.g.Kb?k.clear_outline_anim(a):q.error("clear_outline_anim(): wrong object")};a.set_outline_color=g.set_outline_color;a.get_outline_color=function(a){var b=g.get_active();if(b=g.Z(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.Xf),a};a.set_hmd_params=function(a){g.ma()?a&&(!a.distortion_coefs||
a.distortion_coefs instanceof Array||(a.distortion_coefs=null),!a.chromatic_aberration_coefs||a.chromatic_aberration_coefs instanceof Array||(a.chromatic_aberration_coefs=null),"number"!=typeof a.base_line_factor&&(a.base_line_factor=null),"number"!=typeof a.inter_lens_factor&&(a.inter_lens_factor=null),"boolean"!=typeof a.enable_hmd_stereo&&(a.enable_hmd_stereo=null),g.set_hmd_params(a)):q.error("No active scene")};a.get_shadow_params=function(){if(!g.ma())return q.error("No active scene"),!1;var a=
g.get_active(),b=g.Z(a,"SHADOW_CAST");if(!b)return null;var c=a.k.mc,e=g.Z(a,"MAIN_OPAQUE"),h=g.Z(a,"SHADOW_RECEIVE"),k={};k.csm_resolution=c.csm_resolution;k.self_shadow_polygon_offset=b.self_shadow_polygon_offset;h&&(k.self_shadow_normal_offset=h.self_shadow_normal_offset);k.enable_csm=c.enable_csm;k.csm_num=c.csm_num;k.csm_first_cascade_border=c.csm_first_cascade_border;k.first_cascade_blur_radius=c.first_cascade_blur_radius;k.csm_last_cascade_border=c.csm_last_cascade_border;k.last_cascade_blur_radius=
c.last_cascade_blur_radius;k.fade_last_cascade=c.fade_last_cascade;k.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(k.csm_borders=g.AF(a,e.j),k.blur_radii=new Float32Array(c.csm_num),k.blur_radii.set(e.j.Jo.subarray(0,c.csm_num))):(k.csm_borders=null,k.blur_radii=null);return k};a.set_shadow_params=function(a){if(g.ma()){var c=g.get_active();"number"==typeof a.self_shadow_polygon_offset&&m.ea(c.k.jb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});
var h=g.Z(c,"SHADOW_RECEIVE");h&&("number"==typeof a.self_shadow_normal_offset&&(h.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(h.pcf_blur_radius=a.pcf_blur_radius));var k=g.Z(c,"MAIN_BLEND");k&&("number"==typeof a.self_shadow_normal_offset&&(k.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(k.pcf_blur_radius=a.pcf_blur_radius),k.ia=!0);k=c.k.mc;"number"==typeof a.csm_first_cascade_border&&(k.csm_first_cascade_border=
a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(k.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(k.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(k.last_cascade_blur_radius=a.last_cascade_blur_radius);if(h){for(var p=h.v,y=0;y<p.length;y++){var H=p[y];H.$e.Xc&&(H=H.H,e.Bu(H,k),e.Rb(H))}h.ia=!0}h=r.R(c.tg,c).M;for(y=0;y<h.length;y++)b.Ct(h[y],k);g.Ms(c)}else q.error("No active scene")};
a.get_environment_colors=function(){if(!g.ma())return q.error("No active scene"),!1;var a=g.get_active();return g.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(g.ma()){var e=g.get_active(),h=g.Z(e,"MAIN_OPAQUE");g.set_environment_colors(e,a||0==a?parseFloat(a):h.Ef,b||0==b?b:h.be,c||0==c?c:h.ne)}else q.error("No active scene")};a.get_fog_color_density=function(a){if(!g.ma())return q.error("No active scene"),!1;var b=g.get_active();return g.get_fog_color_density(b,a)};a.set_fog_color_density=
function(a){if(g.ma()){var b=g.get_active();g.set_fog_color_density(b,a)}else q.error("No active scene")};a.get_ssao_params=function(){if(!g.ma())return q.error("No active scene"),!1;var a=g.get_active();return g.get_ssao_params(a)};a.set_ssao_params=function(a){if(g.ma()){var b=g.get_active();g.set_ssao_params(b,a)}else q.error("No active scene")};a.get_color_correction_params=function(){if(!g.ma())return q.error("No active scene"),null;var a=g.get_active(),a=g.Z(a,"COMPOSITING");if(!a)return null;
var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(g.ma()){var b=g.get_active();if(b=g.Z(b,"COMPOSITING"))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.ia=!0}else q.error("No active scene")};a.get_sky_params=function(){if(!g.ma())return q.error("No active scene"),
!1;var a=g.get_active();return g.get_sky_params(a)};a.set_sky_params=function(a){if(g.ma()){var b=g.get_active();g.set_sky_params(b,a)}else q.error("No active scene")};a.get_dof_params=function(){if(!g.ma())return q.error("No active scene"),!1;var a=g.get_active();return g.Z(a,"DOF")?g.get_dof_params(a):null};a.set_dof_params=function(a){if(g.ma()){var b=g.get_active();g.set_dof_params(b,a)}else q.error("No active scene")};a.get_god_rays_params=function(){if(!g.ma())return q.error("No active scene"),
!1;var a=g.get_active();return g.Z(a,"GOD_RAYS")?g.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(g.ma()){var b=g.get_active();g.set_god_rays_params(b,a)}else q.error("No active scene")};a.get_bloom_params=function(){if(!g.ma())return q.error("No active scene"),!1;var a=g.get_active();return g.Z(a,"BLOOM")?g.get_bloom_params(a):null};a.set_bloom_params=function(a){if(g.ma()){var b=g.get_active();g.set_bloom_params(b,a)}else q.error("No active scene")};a.get_glow_material_params=
function(){if(!g.ma())return q.error("No active scene"),!1;var a=g.get_active();return g.Z(a,"GLOW_COMBINE")?g.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(g.ma()){var b=g.get_active();g.set_glow_material_params(b,a)}else q.error("No active scene")};a.get_wind_params=function(){if(!g.ma())return q.error("No active scene"),!1;var a=g.get_active();return g.get_wind_params(a)};a.set_wind_params=function(a){if(g.ma()){var b=g.get_active();k.set_wind_params(b,a)}else q.error("No active scene")};
a.get_water_surface_level=function(a,b){if(!g.ma())return q.error("No active scene"),0;var c=g.get_active();return c.k.Sb?g.get_water_surface_level(c,a,b):(q.error("No water parameters on the active scene"),0)};a.set_water_params=function(a){if(g.ma()){var b=g.get_active();g.set_water_params(b,a)}else q.error("No active scene")};a.get_water_mat_params=function(a){if(g.ma()){var b=g.get_active();g.get_water_mat_params(b,a)}else q.error("No active scene")};a.update_scene_materials_params=function(){if(g.ma()){var a=
g.get_active();g.tz(a)}else q.error("No active scene")};a.hide_object=function(a,b){b=b||!1;!r.is_mesh(a)&&!r.is_empty(a)||r.oa(a)?b?g.Zk(a,!0):g.Xu(a,!0):q.error("show/hide is only supported for dynamic objects.")};a.show_object=function(a,b){b=b||!1;!r.is_mesh(a)&&!r.is_empty(a)||r.oa(a)?b?g.Zk(a,!1):g.Xu(a,!1):q.error("show/hide is only supported for dynamic objects.")};a.is_hidden=function(a){if(r.di(a)||r.is_empty(a)||r.is_lamp(a))return g.is_hidden(a);q.error("show/hide is only supported for dynamic meshes/empties and lamps");
return!1};a.is_visible=function(a){return a.g.is_visible};a.check_object=function(a){q.Ia("scenes.check_object","scenes.check_object_by_name");return g.ma()?k.uH(a,g.get_active()):(q.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return k.Jb(k.Ip,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return k.Jb(k.Hp,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return k.Jb(k.cc,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=g.get_active();a||(a="ALL");
b||0===b||(b=k.DATA_ID_ALL);return k.Pa(c,a,b)};a.get_object_name=function(a){return a?a.ri:(q.error("Wrong object name"),"")};a.get_object_name_hierarchy=function(a){if(!a)return q.error("Wrong object name"),null;for(var b=[];a;)b.push(a.ri),a=r.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(q.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){q.Ia("scenes.get_object_dg_parent","objects.get_dg_parent");return r.get_dg_parent(a)};a.get_object_children=
function(a){return a.Kc.slice(0)};a.get_first_character=function(){for(var a=k.Pa(g.get_active(),"MESH",k.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(h.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);if(!g.ma())return q.error("No active scene"),!1;var c=g.get_active();return g.get_shore_dist(c,a,b)};a.get_cam_water_depth=function(){return g.get_cam_water_depth()};a.get_type_mesh_object=function(a){return r.is_mesh(a)?a.g.type:null};a.get_meta_tags=function(){if(!g.ma())return q.error("No active scene"),
!1;var a=g.get_active();return g.get_meta_tags(a)};a.append_object=function(a,b){if(a.g.Ew){if(b)var c=g.tj(),c=y.keysearch("name",b,c);else c=g.get_active();g.append_object(c,a,!0)}else q.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){if((r.is_mesh(a)||r.is_empty(a))&&r.oa(a)){for(var b=a.u,e=0;e<b.length;e++)c.LH(b[e].Ca,a,!1);k.remove_object(a)}else q.error("Can't remove object \""+a.name+'". It must be dynamic and type of MESH or EMPTY.')};a.marker_frame=
function(a){var b=g.get_active();if(b.timeline_markers&&a in b.timeline_markers)return g.marker_frame(b,a);q.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=g.get_active();return(a=g.Z(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=g.get_active();(b=g.Z(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=
a.mb_factor)):q.error("The motion blur subscene doesn't exist.")};a.can_select_objects=function(){var a=g.get_active();return Boolean(g.Z(a,"COLOR_PICKING"))}};b4w.module.sfx=function(a,p){var e=p("__obj_util"),b=p("__scenes"),c=p("__sfx"),m=p("__print");a.play=function(a,b,e){c.play(a,b||0,e||0)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_playing(a)};a.is_playing=function(a){return c.is_playing(a)};a.stop=function(a){c.stop(a)};a.pause=function(a){c.gJ(a)};a.resume=function(a){c.iJ(a)};a.playrate=function(a,b){c.playrate(a,b)};a.get_playrate=function(a){return c.get_playrate(a)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=
function(a){return c.is_cyclic(a)};a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,e){c.speaker_reset_speed(a,b,e)};a.get_volume=function(a){return a&&"object"===typeof a?c.get_volume(a):c.KF()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.FI(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.nH(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.pG()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};
a.check_active_speakers=c.check_active_speakers;a.set_compressor_params=function(a){c.set_compressor_params(b.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(b.get_active())};a.duck=function(a,b,e){a&&"object"===typeof a?c.duck(a,b,e):c.rE(b,e)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.JJ()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;a.detect_video_container=c.detect_video_container;
a.set_positional_params=c.set_positional_params;a.get_positional_params=c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response;a.get_duration=function(a){if(a&&e.is_speaker(a))return c.get_duration(a);m.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,p){var e=p("__print"),b=p("__scenes"),c=p("__textures"),m=p("__obj_util");a.get_canvas_texture_context=function(a,b){e.Ia("get_canvas_texture_context","get_canvas_ctx");b||(b=0);var h=c.wF(a,b);if(h)return h;e.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,b){e.Ia("update_canvas_texture_context","update_canvas_ctx");b||(b=0);c.XJ(a,b)||e.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,m){m||
(m=0);b.get_active().b4w_use_nla&&c.Kt(a,m)?e.error("NLA texture can't be controlled directly through API."):c.play_video(a,m)||e.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,m){m||(m=0);b.get_active().b4w_use_nla&&c.Kt(a,m)?e.error("NLA texture can't be controlled directly through API."):c.pause_video(a,m)||e.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a,m){m||(m=0);b.get_active().b4w_use_nla&&c.Kt(a,m)?e.error("NLA texture can't be controlled directly through API."):
c.reset_video(a,m)||e.error('Texture with name "'+a+'" not found!')};a.get_canvas_ctx=function(a,b){if(m.is_mesh(a)){var h=c.xF(a,b);if(h)return h;e.error("Couldn't find canvas texture with this name: "+b)}else e.error("Object must be type of mesh.");return null};a.update_canvas_ctx=function(a,b){if(m.is_mesh(a)){if(c.YJ(a,b))return!0;e.error("Couldn't find canvas texture with this name: "+b)}else e.error("Object must be type of mesh.");return!1}};b4w.module.time=function(a,p){var e=p("__time");a.set_timeout=e.set_timeout;a.clear_timeout=e.clear_timeout;a.get_timeline=e.get_timeline;a.animate=e.animate;a.clear_animation=e.clear_animation};b4w.module.transform=function(a,p){var e=p("__obj_util"),b=p("__physics"),c=p("__print"),m=p("__quat"),k=p("__transform"),r=p("__tsr"),h=p("__util"),q=new Float32Array(4),g=new Float32Array(3),y=new Float32Array(4);a.SPACE_LOCAL=k.SPACE_LOCAL;a.SPACE_WORLD=k.SPACE_WORLD;a.set_translation=function(a,h,m,q){e.oa(a)?(g[0]=h,g[1]=m,g[2]=q,k.set_translation(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,h,m,q){e.oa(a)?(g[0]=h,g[1]=
m,g[2]=q,k.set_translation_rel(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,g){e.oa(a)?(k.set_translation(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,g){e.oa(a)?(k.set_translation_rel(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_obj_rel=function(a,l,m,q,p){e.oa(a)?(g[0]=l,g[1]=m,g[2]=q,
l=r.get_trans_view(p.g.i),p=r.get_quat_view(p.g.i),h.transform_vec3(g,1,p,l,g),k.set_translation(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));k.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));k.get_translation_rel(a,b);return b};a.set_rotation=function(a,g,h,m,q){e.oa(a)?(y[0]=g,y[1]=h,y[2]=m,y[3]=q,k.set_rotation(a,y),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,g,h,m,q){e.oa(a)?(y[0]=g,y[1]=h,y[2]=m,y[3]=q,k.set_rotation_rel(a,y),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_v=function(a,g){e.oa(a)?(k.set_rotation(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,g){e.oa(a)?(k.set_rotation_rel(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.get_rotation=function(a,b){b||(b=new Float32Array(4));k.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));k.get_rotation_rel(a,b);return b};a.set_rotation_euler=function(a,h,m,q){e.oa(a)?(g[0]=h,g[1]=m,g[2]=q,k.set_rotation_euler(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,h,m,q){e.oa(a)?(g[0]=h,g[1]=m,g[2]=q,k.set_rotation_euler_rel(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,g){e.oa(a)?(k.set_rotation_euler(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=function(a,g){e.oa(a)?(k.set_rotation_euler_rel(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,b){e.oa(a)?(k.set_scale(a,b),k.n(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,b){e.oa(a)?(k.set_scale_rel(a,
b),k.n(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return k.get_scale(a)};a.get_scale_rel=function(a){return k.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)c.error("Wrong object: "+a.name);else{for(var g=0;g<a.Kc.length;g++)if(!e.oa(a.Kc[g])){c.error('Wrong object: "'+a.Kc[g].name+'" is not dynamic.');return}k.set_translation(a,[0,0,0]);k.set_rotation(a,[0,0,0,1]);k.set_scale(a,1);k.n(a);b.sync_transform(a)}};a.get_object_size=function(a){return e.is_mesh(a)?
k.get_object_size(a):(c.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,b,g){return e.is_mesh(a)?k.get_object_center(a,b,g):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,g,h,m){e.oa(a)?(k.move_local(a,g,h,m),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,g){if(e.oa(a)){var n=m.setAxisAngle(h.AXIS_X,g,y);k.Is(a,n);k.n(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.rotate_y_local=function(a,g){if(e.oa(a)){var n=m.setAxisAngle(h.AXIS_Y,g,y);k.Is(a,n);k.n(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,g){if(e.oa(a)){var n=m.setAxisAngle(h.AXIS_Z,g,y);k.Is(a,n);k.n(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return k.get_object_bounding_box(a)};a.set_tsr=function(a,g){e.oa(a)?(k.set_tsr(a,g),k.n(a),b.sync_transform(a)):
c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,g){e.oa(a)?(k.set_tsr_rel(a,g),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_tsr=function(a,b){b||(b=new Float32Array(8));k.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));k.get_tsr_rel(a,b);return b};a.distance=function(a,b){return k.distance(a,b)};a.set_matrix=function(a,g){e.oa(a)?(r.from_mat4(g,q),k.set_tsr(a,q),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_matrix_rel=function(a,g){e.oa(a)?(r.from_mat4(g,q),k.set_tsr_rel(a,q),k.n(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_matrix=function(a,b){b||(b=new Float32Array(16));k.get_tsr(a,q);r.to_mat4(q,b);return b};a.get_matrix_rel=function(a,b){b||(b=new Float32Array(16));k.get_tsr_rel(a,q);r.to_mat4(q,b);return b}};b4w.module.tsr=function(a,p){function e(a,b,c,q){q||(q=m.create());e(a,b,c,q);return q}var b=p("__mat4"),c=p("__print"),m=p("__tsr");a.create=m.create;a.from_values=m.from_values;a.copy=m.copy;a.identity=m.identity;a.create_sep=function(a,b,h,m){c.Ia("create_sep","set_sep");return e(a,b,h,m)};a.set_sep=m.set_sep;a.set_trans=m.set_trans;a.set_scale=m.set_scale;a.set_transcale=m.set_transcale;a.set_quat=m.set_quat;a.get_trans_view=m.get_trans_view;a.get_scale=m.get_scale;a.get_quat_view=m.get_quat_view;
a.invert=m.invert;a.to_mat4=function(a,c){c||(c=b.create());m.to_mat4(a,c);return c};a.from_mat4=m.from_mat4;a.multiply=m.multiply;a.transform_vec3=m.transform_vec3;a.transform_vec3_inv=m.transform_vec3_inv;a.transform_vectors=m.transform_vectors;a.transform_dir_vectors=m.transform_dir_vectors;a.transform_dir_vec3=m.transform_dir_vec3;a.transform_tangents=m.transform_tangents;a.translate=m.translate;a.interpolate=function(a,b,c,e){e||(e=m.create());m.interpolate(a,b,c,e);return e}};b4w.module.util=function(a,p){var e=p("__obj_util"),b=p("__print"),c=p("__quat"),m=p("__util"),k=p("__vec3"),r=new Float32Array(6);a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.XYX=m.XYX;a.YZY=m.YZY;a.ZXZ=m.ZXZ;a.XZX=m.XZX;a.YXY=m.YXY;a.ZYZ=m.ZYZ;a.XYZ=m.XYZ;a.YZX=m.YZX;a.ZXY=m.ZXY;a.XZY=m.XZY;a.YXZ=m.YXZ;a.ZYX=m.ZYX;a.f32=function(a){return new Float32Array(a||
0)};a.assert=m.assert;a.keyfind=m.keyfind;a.keysearch=m.keysearch;a.matrix_to_quat=function(a){return m.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));return m.euler_to_quat(a,b)};a.ordered_angles_to_quat=function(a,b,e){e||(e=c.create());return m.ordered_angles_to_quat(a,b,e)};a.quat_to_ordered_angles=function(a,b,c){c||(c=k.create());return m.quat_to_ordered_angles(a,b,c)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));return m.quat_to_euler(a,b)};a.sign=m.sign;
a.clamp=m.clamp;a.quat_to_dir=m.quat_to_dir;a.ground_project_quat=function(a,b){return m.quat_project(a,m.AXIS_MY,m.AXIS_Y,m.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return m.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,c,e,p,f){return 0!=k.dot(e,p)?(b.error("Wrong in-plane direction"),null):m.quat_project(a,c,e,p,f)};a.hash_code=m.hash_code;a.smooth=m.smooth;a.smooth_v=m.smooth_v;a.is_vector=m.is_vector;a.correct_cam_quat_up=m.correct_cam_quat_up;a.quat_to_angle_axis=m.quat_to_angle_axis;
a.random_from_array=m.random_from_array;a.xz_direction=m.xz_direction;a.line_plane_intersect=function(a,c,e,k,f){b.Ia("util.line_plane_intersect","math.line_plane_intersect");r[0]=e[0];r[1]=e[1];r[2]=e[2];r[3]=k[0];r[4]=k[1];r[5]=k[2];return m.line_plane_intersect(a,c,r,f)};a.is_mesh=function(a){b.Ia("util.is_mesh","objects.is_mesh");return e.is_mesh(a)};a.is_armature=function(a){b.Ia("util.is_armature","objects.is_armature");return e.is_armature(a)};a.angle_wrap_0_2pi=m.angle_wrap_0_2pi;a.angle_wrap_periodic=
m.angle_wrap_periodic;a.smooth_step=m.smooth_step;a.lerp=m.lerp;a.deg_to_rad=m.deg_to_rad;a.rad_to_deg=m.rad_to_deg;a.dir_to_quat=m.dir_to_quat};"object"==typeof module&&module.Xq&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){p("__print");var e=p("__version");a.version=e.version;a.version_str=e.version_str;a.type=e.type;a.date=e.date;a.date_str=e.date_str};"object"==typeof module&&module.Xq&&b4w.module.version(exports);b4w.module.objects=function(a,p){var e=p("__geometry"),b=p("__objects"),c=p("__batch"),m=p("__obj_util"),k=p("__print"),r=p("__scenes");a.get_meta_tags=function(a){if(a)return b.get_meta_tags(a)};a.copy=function(a,c,g){return m.is_mesh(a)?m.oa(a)?e.yj(a)||e.check_shape_keys(a)||!g?-1==b.Pa(r.get_active(),"MESH",b.DATA_ID_ALL).indexOf(a)?(k.error('object "'+a.name+'" does not belong to the active scene.'),!1):b.copy(a,c||"",g):(k.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(k.error('object "'+a.name+'" is not dynamic.'),!1):(k.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,b,e){m.di(a)?c.set_nodemat_value(a,b,e):k.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.')};a.get_nodemat_value=function(a,b){return m.di(a)?c.get_nodemat_value(a,b):(k.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.'),null)};a.set_nodemat_rgb=function(a,b,e,p,f){m.di(a)?c.set_nodemat_rgb(a,
b,e,p,f):k.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.')};a.get_nodemat_rgb=function(a,b,e){if(!m.di(a))return k.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.'),null;e||(e=new Float32Array(3));return c.get_nodemat_rgb(a,b,e)};a.update_boundings=function(a){m.is_mesh(a)?e.yj(a)||e.check_shape_keys(a)?b.update_boundings(a):k.error('object "'+a.name+'" has not dynamic geometry.'):k.error('The type of the object "'+a.name+'" is not "MESH".')};
a.get_parent=m.get_parent;a.get_dg_parent=m.get_dg_parent;a.is_mesh=m.is_mesh;a.is_armature=m.is_armature;a.is_speaker=m.is_speaker;a.is_camera=m.is_camera;a.is_lamp=m.is_lamp;a.is_empty=m.is_empty;a.is_line=m.is_line;a.is_world=m.is_world;a.get_selectable_objects=function(){return b.get_selectable_objects()};a.get_outlining_objects=function(){return b.get_outlining_objects()}};b4w.module.main=function(a,p){function e(){}function b(){}function c(){}function m(){window.performance||(K.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(K.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});S.ty(0)}function k(a,b){for(var c=null,d=b?ca:Aa,e=0;e<d.length;e++){var f=d[e];try{c=a.getContext(f,Y)}catch(g){}if(c)break}c&&B.jE(c);return c}function r(a,c,e){a.addEventListener("webglcontextlost",
function(a){a.preventDefault();K.error("WebGL context lost");q()},!1);G.Ed(e);var g=G.gw();g&&K.log("%cRENDERER INFO:","color: #00a",e.getParameter(g.UNMASKED_VENDOR_WEBGL)+", "+e.getParameter(g.UNMASKED_RENDERER_WEBGL));w.Ed(e);d.Ed(e);P.Ed(e);N.Ed(e);z.Ed(e);H.Ed(e);E.TI(a);H.init(a,c);t.vy(a.width,a.height,1);Q.init();b=f();y()}function h(){e=function(){}}function q(){g()||(x=performance.now()/1E3,Q.pause(),T.pause(),P.pause(),l.pause())}function g(){return fa<x}function y(){R(y);var a=performance.now()/
1E3;ba||(ba=a);var c=a-ba;if(!(c<1/ka.ve)){for(var d=S.get_timeline(),f=0;f<aa.length;f++)aa[f](d,c);g()||(fa>ba&&(c-=fa-Math.max(x,ba)),d+=c,S.ty(d),z.update(),u.update(),E.update(),f=c,E.is_primary_loaded()&&(J.reset(),Z.update(f),D.update(d,f),C.update(d,f),Q.update(d,f),f&&n.update(f),E.is_primary_loaded()&&(T.update(d,f),E.is_primary_loaded()&&(F.update(),v.update(d,f),E.is_primary_loaded()&&(l.update(),O.update(d,f),ea.update(),e(f,d),E.is_primary_loaded()&&(t.update(d,f),l.wz(),ha&&(ha(ga.toDataURL()),
ha=null)))))),b(c));ba=a}}function f(){var a=60,b=0,d=ka.Nv,e=ka.TE;return function(f){f<1/ka.ve||(a=M.smooth(1/f,a,f,d),f=T.FF(),b=(b+1)%e,0==b&&c(Math.round(a),f))}}var l=p("__anchors"),n=p("__animation"),u=p("__assets"),A=p("__config"),B=p("__compat"),H=p("__container"),v=p("__controls"),E=p("__data"),z=p("__debug"),G=p("__extensions"),d=p("__geometry"),F=p("__input"),J=p("__hud"),C=p("__nla"),D=p("__logic_nodes"),O=p("__objects"),T=p("__physics"),K=p("__print"),w=p("__renderer"),t=p("__scenes"),
Q=p("__sfx"),N=p("__shaders"),P=p("__textures"),S=p("__time"),Z=p("__transform"),M=p("__util"),U=p("__version"),ea=p("__particles"),Y=A.context,ka=A.q,ga=null,ma=null,ba=0,x=0,fa=0,aa=[],ha=null,Aa=["webgl","experimental-webgl"],ca=["webgl2","experimental-webgl2"],R=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/ka.ve)}}();
a.init=function(a,b){A.GI();K.NI(ka.console_verbose);var c=U.version_str()+" "+U.type()+" ("+U.date_str()+")";K.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;m();ga=a;b?(J.init(b),ma=b):(A.q.show_hud_debug_info=!1,A.I.vo=!1);B.eC();B.sq("Chrome")||B.sq("Firefox")||(ka.Hc=!1);c=k(a,ka.Hc);!c&&ka.Hc&&(ka.Hc=!1,c=k(a,!1));if(!c)return null;K.log("%cINIT WEBGL "+(ka.Hc?"2":"1"),"color: #00a");window.MM=c;r(ga,ma,c);A.gC();B.xI(c);N.MG();ka.Yn&&(a.style["touch-action"]=
"none");K.log("%cSET PRECISION:","color: #00a",ka.precision);return c};a.resize=function(a,b,c){K.Ia("main.resize","container.resize");H.resize(a,b,c)};a.set_fps_callback=function(a){c=a};a.clear_fps_callback=function(){c=function(){}};a.set_render_callback=function(a){e=a};a.clear_render_callback=function(){h()};a.global_timeline=function(){K.Ia("main.global_timeline","time.get_timeline");return S.get_timeline()};a.pause=q;a.resume=function(){g()&&(fa=performance.now()/1E3,Q.resume(),T.resume(),
P.play(!0),l.resume())};a.is_paused=g;a.reset=function(){E.unload(0);ma=ga=null;fa=x=ba=0;c=function(){};b=function(){};e=function(){};aa.length=0;S.reset()};a.canvas_data_url=function(a){ha=a};a.get_canvas_elem=function(){K.Ia("main.get_canvas_elem","container.get_canvas");return ga};a.detect_mobile=function(){return B.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<aa.length;b++)if(aa[b]==a)return;aa.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<aa.length;b++)if(aa[b]==a){aa.splice(b,
1);break}}};b4w.module.nla=function(a,p){var e=p("__nla"),b=p("__time"),c=p("__print"),m=p("__util");a.set_frame=function(a){a=m.clamp(a,e.get_frame_start(),e.get_frame_end());e.check_logic_nodes()?c.error("The active scene is using NLA script."):e.set_frame(a,b.get_timeline())};a.get_frame=function(){return e.get_frame(b.get_timeline())};a.stop=function(){e.check_logic_nodes()?c.error("The active scene is using NLA script."):e.jt()};a.play=function(a){e.check_logic_nodes()?c.error("The active scene is using NLA script."):
e.Rx(a)};a.is_play=function(){return e.is_play()};a.get_frame_start=function(){return e.get_frame_start()};a.get_frame_end=function(){return e.get_frame_end()};a.check_nla=function(){return e.check_nla()};a.check_nla_scripts=function(){return e.check_logic_nodes()};a.check_logic_nodes=function(){return e.check_logic_nodes()};a.set_range=function(a,b){e.check_logic_nodes()?c.error("The active scene is using NLA script."):(b=parseFloat(b)||e.get_frame_end(),a=parseFloat(a)||e.get_frame_end(),b=m.clamp(b,
e.get_frame_start(),e.get_frame_end()),a=m.clamp(a,e.get_frame_start(),b),e.set_range(a,b))};a.reset_range=function(){e.check_logic_nodes()?c.error("The active scene is using NLA script."):e.reset_range()};a.set_cyclic=function(a){e.check_logic_nodes()?c.error("The active scene is using NLA script."):e.set_cyclic(a)};a.clear_callback=function(){e.check_logic_nodes()?c.error("The active scene is using NLA script."):e.clear_callback()}};b4w.module.app=function(a,p){function e(){var a=D.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=D.is_paused(),D.pause()):a||D.resume()},!1)}function b(a,b,c,d){var e=document.createElement("canvas"),f=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=f.offsetWidth+"px";e.style.height=f.offsetHeight+"px";e.width=f.offsetWidth*window.devicePixelRatio;e.height=f.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;f||(T.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body);f.appendChild(e);if(!D.init(e,b))return c&&B("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&G.insert_to_container(b,"LAST");return!0}function c(a,b){a?(b&&(document.getElementById(b).style.display="block"),P=document.getElementById(a)):(P=document.createElement("div"),
P.innerHTML=0,P.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",G.insert_to_container(P,"JUST_AFTER_CANVAS"))}function m(a,b){var c=String(a);b&&(c+="/"+String(b));P.innerHTML=c}function k(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function r(){var a=G.get_container();G.resize(a.clientWidth,a.clientHeight,!0)}function h(a,b,c){var d=Math.max(v.hover_get_distance(a),1),e=w.get_rotation(a,
ga);b=t.quat_to_dir(e,b,Y);b[1]=0;Q.normalize(b,b);Q.scale(b,d*c,b);c=w.get_translation(a,ka);Q.add(c,b,c);v.set_translation(a,c)}function q(a,b){var c=v.hover_get_vertical_limits(a,ba);if(c.up!=c.down){var d=v.get_camera_angles(a,ea)[1],c=(c.down-d)/(c.down-c.up),d=v.hover_get_distance_limits(a,ba),c=Math.max(c,2/d.max);v.hover_rotate(a,0,c*b)}}function g(a,b,c,d){w.move_local(a,5*b,5*c,5*d)}function y(a,b,c){var d=v.target_get_distance(a),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));w.move_local(a,
0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function f(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function l(a,b,c,d,e){e?(e=v.target_get_pivot(a,Y),a=v.get_translation(a),a=Q.dist(e,a)+d,d=0<b?f(b,-c,a,d):f(-b,c/(1-c),a,d)):d-=2*b*c;return d}function n(a,b,c,e,f){function k(a,b,c,e){if(1==c){v.get_velocities(a,A);var f=G?.003*A.trans:.003*A.rot;c=d.get_sensor_value(a,b,0);d.get_sensor_payload(a,b,0)===d.PL_SINGLE_TOUCH_MOVE?(Fb+="X"==e?-c*f:0,tc+="Y"==e?-c*f:0):d.get_sensor_payload(a,b,0)===d.PL_MULTITOUCH_MOVE_PAN&&
(a=G?.003*A.rot:7.5E-4*A.trans,Oa+="X"==e?-c*a:0,sb+="Y"==e?-c*a:0)}}function m(a,b,c,e){if(1==c){c=d.get_sensor_value(a,b,1);v.get_velocities(a,A);if(G)f=.003*A.trans,g=7.5E-4*A.rot;else var f=.003*A.rot,g=7.5E-4*A.trans;if(1===d.get_sensor_payload(a,b,0))Ia+="X"==e?-c*f:0,va+="Y"==e?-c*f:0;else if(2===d.get_sensor_payload(a,b,0)||3===d.get_sensor_payload(a,b,0))wa+="X"==e?-c*g:0,Ba+="Y"==e?-c*g:0}}function n(a){return a[0]&&(a[1]||a[2])}function p(a,b,c){if(1==c)switch(c=d.get_sensor_value(a,b,
0),v.get_velocities(a,A),b){case "FORWARD":B?H[0]=1:G?(b=v.get_camera_angles(a,ea)[1],b=Math.abs(b)>=Math.PI/4?t.AXIS_MZ:t.AXIS_MY,h(a,b,.5*A.trans*c)):D?y(a,-A.zoom,c):g(a,0,-A.trans*c,0);break;case "BACKWARD":B?H[0]=-1:G?(b=v.get_camera_angles(a,ea)[1],b=Math.abs(b)>=Math.PI/4?t.AXIS_Z:t.AXIS_Y,h(a,b,.5*A.trans*c)):D?y(a,A.zoom,c):g(a,0,A.trans*c,0);break;case "UP":G?q(a,30*-A.zoom*c):B||g(a,0,0,-A.trans*c);break;case "DOWN":G?q(a,30*A.zoom*c):B||g(a,0,0,A.trans*c);break;case "LEFT":B?H[1]=1:G?
h(a,t.AXIS_MX,.5*A.trans*c):g(a,-A.trans*c,0,0);break;case "RIGHT":B?H[1]=-1:G?h(a,t.AXIS_X,.5*A.trans*c):g(a,A.trans*c,0,0);break;case "ROT_LEFT":D?v.target_rotate(a,2*-A.rot*c,0):v.eye_rotate(a,2*A.rot*c,0);break;case "ROT_RIGHT":D?v.target_rotate(a,2*A.rot*c,0):v.eye_rotate(a,2*-A.rot*c,0);break;case "ROT_UP":D?v.target_rotate(a,0,2*-A.rot*c):v.eye_rotate(a,0,2*A.rot*c);break;case "ROT_DOWN":D?v.target_rotate(a,0,2*A.rot*c):v.eye_rotate(a,0,2*-A.rot*c)}else switch(b){case "FORWARD":case "BACKWARD":B&&
(H[0]=0);break;case "LEFT":case "RIGHT":B&&(H[1]=0)}B&&(O.set_character_move_dir(B,H[0],H[1]),a=v.get_camera_angles_char(a,U),O.set_character_rotation(B,a[0],a[1]))}S=a;Z=b;M=c;var r=K.get_active_camera();u(r);var D=!1,B=null,G=!1;switch(v.get_move_style(r)){case v.MS_TARGET_CONTROLS:D=!a;break;case v.MS_EYE_CONTROLS:B=K.get_first_character();break;case v.MS_STATIC:return;case v.MS_HOVER_CONTROLS:G=!0}var A=v.get_velocities(r,ma);a=d.create_elapsed_sensor();if(O.has_simulated_physics(r)){var F=d.create_collision_sensor(r,
null,!0);d.create_sensor_manifold(r,"CAMERA_COLLISION",d.CT_POSITIVE,[F],null,function(a,b){var c=d.get_sensor_payload(a,b,0).coll_dist;if(0>c){var e=d.get_sensor_payload(a,b,0).coll_norm,f=Y;Q.scale(e,-.25*c,f);c=w.get_translation(a,ka);Q.add(c,f,c);w.set_translation_v(a,c)}})}if(B){var F=w.get_translation(r),E=w.get_rotation(r),E=t.cam_quat_to_mesh_quat(E);F[1]-=.5;O.set_transform(B,F,E);z.append_stiff_trans(r,B,[0,.5,0]);var H=new Float32Array(2),J=!0;O.set_character_move_type(B,O.CM_FLY);d.create_kb_sensor_manifold(r,
"TOGGLE_CHAR_MOVE_TYPE",d.CT_SHOT,d.KEY_C,function(){J=!J;O.set_character_move_type(B,J?O.CM_FLY:O.CM_WALK)})}if(b)b=F=E=I=P=T=d.create_custom_sensor(0);else{b=d.create_keyboard_sensor(d.KEY_W);var F=d.create_keyboard_sensor(d.KEY_S),E=d.create_keyboard_sensor(d.KEY_A),I=d.create_keyboard_sensor(d.KEY_D),P=d.create_keyboard_sensor(d.KEY_R),T=d.create_keyboard_sensor(d.KEY_F)}var ba=d.create_keyboard_sensor(d.KEY_UP),ga=d.create_keyboard_sensor(d.KEY_DOWN),Da=d.create_keyboard_sensor(d.KEY_LEFT),ia=
d.create_keyboard_sensor(d.KEY_RIGHT);G||(d.create_sensor_manifold(r,"FORWARD",d.CT_CONTINUOUS,[a,b],null,p),d.create_sensor_manifold(r,"BACKWARD",d.CT_CONTINUOUS,[a,F],null,p));D?(d.create_sensor_manifold(r,"ROT_UP",d.CT_CONTINUOUS,[a,ba,P],n,p),d.create_sensor_manifold(r,"ROT_DOWN",d.CT_CONTINUOUS,[a,ga,T],n,p),d.create_sensor_manifold(r,"ROT_LEFT",d.CT_CONTINUOUS,[a,Da,E],n,p),d.create_sensor_manifold(r,"ROT_RIGHT",d.CT_CONTINUOUS,[a,ia,I],n,p)):G?(d.create_sensor_manifold(r,"LEFT",d.CT_CONTINUOUS,
[a,Da,E],n,p),d.create_sensor_manifold(r,"RIGHT",d.CT_CONTINUOUS,[a,ia,I],n,p),d.create_sensor_manifold(r,"FORWARD",d.CT_CONTINUOUS,[a,ba,b],n,p),d.create_sensor_manifold(r,"BACKWARD",d.CT_CONTINUOUS,[a,ga,F],n,p),d.create_sensor_manifold(r,"UP",d.CT_CONTINUOUS,[a,T],n,p),d.create_sensor_manifold(r,"DOWN",d.CT_CONTINUOUS,[a,P],n,p)):(d.create_sensor_manifold(r,"UP",d.CT_CONTINUOUS,[a,P],n,p),d.create_sensor_manifold(r,"DOWN",d.CT_CONTINUOUS,[a,T],n,p),d.create_sensor_manifold(r,"LEFT",d.CT_CONTINUOUS,
[a,E],n,p),d.create_sensor_manifold(r,"RIGHT",d.CT_CONTINUOUS,[a,I],n,p),d.create_sensor_manifold(r,"ROT_UP",d.CT_CONTINUOUS,[a,ba],n,p),d.create_sensor_manifold(r,"ROT_DOWN",d.CT_CONTINUOUS,[a,ga],n,p),d.create_sensor_manifold(r,"ROT_LEFT",d.CT_CONTINUOUS,[a,Da],n,p),d.create_sensor_manifold(r,"ROT_RIGHT",d.CT_CONTINUOUS,[a,ia],n,p));if(!c){var ta=0;c=d.create_mouse_wheel_sensor(e);var Ha=0;b=d.create_touch_zoom_sensor(e);d.create_sensor_manifold(r,"MOUSE_WHEEL",d.CT_LEVEL,[c],null,function(a,b,
c){1==c&&(b=d.get_sensor_value(a,b,0),v.get_velocities(a,A),D||G?ta=l(a,b,A.zoom,ta,D):(A.trans*=1+b*A.zoom,v.set_velocities(a,A)))});d.create_sensor_manifold(r,"TOUCH_ZOOM",d.CT_LEVEL,[b],null,function(a,b,c){1==c&&(c=d.get_sensor_value(a,b,0),v.get_velocities(a,A),d.get_sensor_payload(a,b,0)===d.PL_MULTITOUCH_MOVE_ZOOM&&(Ha=l(a,c,.03*A.zoom,Ha,D)))});d.create_sensor_manifold(r,"ZOOM_INTERPOL",d.CT_POSITIVE,[a],null,function(a,b){if(D||G)if(1E-5<Math.abs(ta)||1E-5<Math.abs(Ha)){var c=d.get_sensor_value(a,
b,0),e=t.smooth(ta,0,c,.1*N);ta-=e;c=t.smooth(Ha,0,c,.15*N);Ha-=c;G?q(a,-(e+c)):(e=v.target_get_distance(a)+e+c,e=Math.max(e,.001),v.target_set_distance(a,e))}else Ha=ta=0})}var Ia=0,va=0,wa=0,Ba=0;if(f){f=d.create_mouse_move_sensor("X",window);c=d.create_mouse_move_sensor("Y",window);b=d.create_mouse_click_sensor(e);var F=d.create_mouse_click_sensor(window),Fa=!1,E=function(a){a[2]?Fa=!0:a[0]||(Fa=!1);return Fa&&a[0]};d.create_sensor_manifold(r,"MOUSE_X",d.CT_POSITIVE,[F,f,b],E,m,"X");d.create_sensor_manifold(r,
"MOUSE_Y",d.CT_POSITIVE,[F,c,b],E,m,"Y");f=C.get_device_by_type_element(C.DEVICE_MOUSE,window);C.switch_prevent_default(f,!1)}else f=d.create_mouse_move_sensor("X",e),c=d.create_mouse_move_sensor("Y",e),b=d.create_mouse_click_sensor(e),d.create_sensor_manifold(r,"MOUSE_X",d.CT_LEVEL,[b,f],null,m,"X"),d.create_sensor_manifold(r,"MOUSE_Y",d.CT_LEVEL,[b,c],null,m,"Y");var Fb=0,tc=0,Oa=0,sb=0;f=d.create_touch_move_sensor("X",e);e=d.create_touch_move_sensor("Y",e);d.create_sensor_manifold(r,"TOUCH_X",
d.CT_LEVEL,[f],null,k,"X");d.create_sensor_manifold(r,"TOUCH_Y",d.CT_LEVEL,[e],null,k,"Y");d.create_sensor_manifold(r,"ROT_TRANS_INTERPOL",d.CT_POSITIVE,[a],null,function(a,b){if(1E-5<Math.abs(Ia)||1E-5<Math.abs(va)||1E-5<Math.abs(Fb)||1E-5<Math.abs(tc)||1E-5<Math.abs(wa)||1E-5<Math.abs(Ba)||1E-5<Math.abs(Oa)||1E-5<Math.abs(sb)){var c=d.get_sensor_value(a,b,0),e=t.smooth(Ia,0,c,.08*N),f=t.smooth(va,0,c,.08*N);Ia-=e;va-=f;var g=t.smooth(Fb,0,c,.12*N),k=t.smooth(tc,0,c,.12*N);Fb-=g;tc-=k;var l=t.smooth(wa,
0,c,.08*N),m=t.smooth(Ba,0,c,.08*N);wa-=l;Ba-=m;var n=t.smooth(Oa,0,c,.12*N),c=t.smooth(sb,0,c,.12*N);Oa-=n;sb-=c;D?(v.target_rotate(a,e+g,f+k),f=v.target_get_distance(a),v.target_pan_pivot(a,f*(l+n),f*(m+c))):G?(e+g&&h(a,t.AXIS_X,.2*(e+g)),f+k&&(m=v.get_camera_angles(a,ea)[1],h(a,Math.abs(m)>Math.PI/4?t.AXIS_Z:t.AXIS_Y,.2*(f+k))),v.hover_rotate(a,l+n,0)):(v.eye_rotate(a,.5*(e+g),.5*(f+k)),B&&(l=v.get_camera_angles_char(a,U),O.set_character_rotation(B,l[0],l[1])))}});d.create_kb_sensor_manifold(r,
"DEC_STEREO_DIST",d.CT_SHOT,d.KEY_LEFT_SQ_BRACKET,function(a){var b=v.get_stereo_distance(a);v.set_stereo_distance(a,.9*b)});d.create_kb_sensor_manifold(r,"INC_STEREO_DIST",d.CT_SHOT,d.KEY_RIGHT_SQ_BRACKET,function(a){var b=v.get_stereo_distance(a);v.set_stereo_distance(a,1.1*b)})}function u(a){var b=v.get_move_style(a),c=d.create_callback_sensor(function(){var c=v.get_move_style(a),d=c!=b;b=c;return d});d.create_sensor_manifold(a,"CHANGE_MOVE_STYLE",d.CT_POSITIVE,[c],null,function(){A();n(S,Z,M)})}
function A(){for(var a=K.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL CHANGE_MOVE_STYLE".split(" "),c=0;c<b.length;c++)d.remove_sensor_manifold(a,b[c]);v.get_move_style(a)==v.MS_EYE_CONTROLS&&K.get_first_character()&&z.remove(a)}function B(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=
0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function H(a,b,c,
d,e){function f(){var h=performance.now()-g;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&D.remove_loop_cb(f)}var g=performance.now();D.append_loop_cb(f)}p("animation");var v=p("camera"),E=p("config"),z=p("constraints"),G=p("container"),d=p("controls"),F=p("data"),J=p("debug"),C=p("input"),D=p("main"),O=p("physics"),T=p("print"),K=p("scenes"),w=p("transform"),t=p("util"),Q=p("vec3"),N=1,P=null,S=!1,Z=!1,M=!1,U=new Float32Array(2),ea=new Float32Array(2),Y=new Float32Array(3),ka=new Float32Array(3);new Float32Array(3);
var ga=new Float32Array(4),ma={},ba={};a.init=function(a){function f(){var a=b(l,O,v,n),d=G.get_canvas();if(a){var g=G.get_container();r();C&&(c(q,t),D.set_fps_callback(m));w&&e();p&&D.append_loop_cb(function(){g.style.height=g.clientWidth/p+"px"});k&&D.append_loop_cb(function(){var a=g.clientWidth,b=g.clientHeight;a==d.clientWidth&&b==d.clientHeight||G.resize(a,b,!0)});B&&D.append_loop_cb(function(){G.force_offsets_updating()});h(d,!0)}else h(d,!1)}function g(a){a.keyCode==d.KEY_P&&(D.is_paused()?
D.resume():D.pause())}function h(){}a=a||{};var k=!1,l=null,n=null,q=null,p=0,t=null,u=!0,w=!0,v=!0,z=!1,C=!1,y=!1,B=!1,A;for(A in a)switch(A){case "canvas_container_id":l=a.canvas_container_id;break;case "callback":h=a.callback;break;case "autoresize":k=a.autoresize;break;case "do_not_use_onload":break;case "show_hud_debug_info":y=a.show_hud_debug_info;break;case "sfx_mix_mode":z=a.sfx_mix_mode;break;case "show_fps":C=a.show_fps;break;case "track_container_position":B=a.track_container_position;
break;case "fps_wrapper_id":t=a.fps_wrapper_id;break;case "fps_elem_id":q=a.fps_elem_id;break;case "error_purge_elements":n=a.error_purge_elements;break;case "report_init_failure":v=a.report_init_failure;break;case "pause_invisible":w=a.pause_invisible;break;case "key_pause_enabled":u=a.key_pause_enabled;break;case "force_container_ratio":p=a.force_container_ratio;break;default:E.set(A,a[A])}u&&document.addEventListener("keydown",g,!1);E.set("show_hud_debug_info",y);E.set("sfx_mix_mode",z);var O=
y||z||null;"complete"==document.readyState?window.setTimeout(f,0):window.addEventListener("load",f,!1);window.addEventListener("unload",function(){F.cleanup()},!1)};a.resize_to_container=r;a.set_onclick=function(a,b){var c=k(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=k(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=k(a);c.addEventListener("keypress",function(a){b(a.keyCode,
c.value)},!1)};a.enable_camera_controls=n;a.disable_camera_controls=A;a.set_camera_move_style=function(a){T.Se("app.set_camera_move_style",["camera.static_setup","camera.eye_setup","camera.target_setup","camera.hover_setup","camera.hover_setup_rel"]);var b=K.get_active_camera();v.set_move_style(b,a)};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,f){if(1==f)switch(f=d.get_sensor_value(a,b,0),b){case "FORWARD":e?O.vehicle_throttle(a,1):w.move_local(a,0,
0,1*f);break;case "BACKWARD":e?O.vehicle_throttle(a,-1):w.move_local(a,0,0,-1*f);break;case "LEFT":e?O.vehicle_steer(a,-1):w.move_local(a,1*f,0,0);break;case "RIGHT":e?O.vehicle_steer(a,1):w.move_local(a,-1*f,0,0)}else switch(b){case "FORWARD":case "BACKWARD":e&&O.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":e&&O.vehicle_steer(a,0)}}var e=O.is_vehicle_chassis(a)||O.is_vehicle_hull(a),f=d.create_elapsed_sensor(),g=d.create_keyboard_sensor(d.KEY_W),h=d.create_keyboard_sensor(d.KEY_S),k=d.create_keyboard_sensor(d.KEY_A),
l=d.create_keyboard_sensor(d.KEY_D),m=d.create_keyboard_sensor(d.KEY_UP),n=d.create_keyboard_sensor(d.KEY_DOWN),q=d.create_keyboard_sensor(d.KEY_LEFT),p=d.create_keyboard_sensor(d.KEY_RIGHT);d.create_sensor_manifold(a,"FORWARD",d.CT_CONTINUOUS,[f,g,m],b,c);d.create_sensor_manifold(a,"BACKWARD",d.CT_CONTINUOUS,[f,h,n],b,c);d.create_sensor_manifold(a,"LEFT",d.CT_CONTINUOUS,[f,k,q],b,c);d.create_sensor_manifold(a,"RIGHT",d.CT_CONTINUOUS,[f,l,p],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD",
"BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)d.remove_sensor_manifold(a,b[c])};a.enable_controls=function(){T.gc("app.enable_controls() deprecated")};a.disable_controls=function(){T.gc("app.disable_controls() deprecated")};a.enable_debug_controls=function(){d.create_kb_sensor_manifold(null,"CAMERA_SHOT",d.CT_SHOT,d.KEY_K,function(){J.make_camera_frustum_shot()});d.create_kb_sensor_manifold(null,"LIGHT_SHOT",d.CT_SHOT,d.KEY_L,function(){J.make_light_frustum_shot()});d.create_kb_sensor_manifold(null,
"TELEMETRY",d.CT_SHOT,d.KEY_T,function(){J.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",
d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||
document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=B;a.get_url_params=function(a){a=!!a;var b=decodeURIComponent(location.href.toString());if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},
d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g,h){function k(e){a&&(l[b]=f+e+g,c>d&&e<=d||c<d&&e>=d)&&(l[b]=f+d+g,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+
m])b="moz"+m;else return;H(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),f())}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},H(a,c,d,e,g))};a.queue_animate=function(b){if(b.length){var c=b.shift(),d=c.elem,e=c.prop,f=c.from,g=c.to,h=c.duration,k=c.opt_prefix,l=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,f,g,h,k,l,m):"attr"==c.type&&a.attr_animate(d,
e,f,g,h,m)}};a.set_camera_smooth_factor=function(a){N=a};a.get_camera_smooth_factor=function(){return N}};b4w.module.camera_anim=function(a,p){function e(a,c,d,e,f){d=g.angle_wrap_0_2pi(c-d);d=Math.min(d,2*Math.PI-d);c=g.angle_wrap_0_2pi(e-c);c=Math.min(c,2*Math.PI-c);if(1E-6>Math.abs(d)||1E-6>2*Math.PI-Math.abs(d))d=0;if(1E-6>Math.abs(c)||1E-6>2*Math.PI-Math.abs(c))c=0;b.is_eye_camera(a)?(f[0]=c,f[1]=d):(f[0]=d,f[1]=c);return f}var b=p("camera"),c=p("controls"),m=p("print"),k=p("scenes"),r=p("time"),h=p("transform"),q=p("tsr"),g=p("util"),y=p("vec3"),f=p("quat"),l=new Float32Array(2),n=new Float32Array(2),
u=new Float32Array(3),A=new Float32Array(3),B=new Float32Array(3),H=new Float32Array(4),v=q.create(),E=q.create(),z=q.create(),G={},d=!1,F=!1,J=!1,C=!1;a.track_to_target=function(a,d,e,k,n,q,p,r){if(!b.is_eye_camera(a))m.error("track_to_target(): wrong object");else if(a&&d){if(g.is_vector(d))var v=d;else v=B,h.get_object_center(d,!1,v);d=e||1;e=k||2;var z=n||1;n=q||1;A[0]=0;A[1]=-1;A[2]=0;var C=h.get_rotation(a);q=g.quat_to_dir(C,A);k=b.get_camera_angles(a,l);var G=h.get_translation(a);y.subtract(v,
G,u);y.normalize(u,u);var F=f.rotationTo(q,u,f.create());f.multiply(F,C,H);g.correct_cam_quat_up(H,!1);y.subtract(v,G,A);var E=y.length(A)*(1-1/e),v=Math.asin(u[1]);e=Math.acos(-u[2]/Math.abs(Math.cos(v)));0<u[0]&&(e=2*Math.PI-e);var J=e-k[0],ka=v-k[1];B[0]=0;B[1]=0;B[2]=-1;e=h.get_rotation(a);0>g.quat_to_dir(e,B)[1]?(ka=0<q[1]?v-Math.PI+k[1]:v+Math.PI+k[1],J=0<J?-Math.PI+J:Math.PI+J):Math.abs(J)>Math.PI&&(J=0<J?J-2*Math.PI:J+2*Math.PI);var ga=0,v=c.create_elapsed_sensor();q=Math.abs(J/d);d=Math.abs(ka/
d);var ma=q>d?q:d,ba=ma+z,x=ba+n,fa=x+z,aa=J,ha=ka,Aa=E,ca=function(){c.remove_sensor_manifold(a,"TRACK_TO_TARGET");p&&p()};c.create_sensor_manifold(a,"TRACK_TO_TARGET",c.CT_CONTINUOUS,[v],null,function(a,d,e){if(e)if(b.is_eye_camera(a))if(e=c.get_sensor_value(a,d,0),ga+=e,ga<ma){var f=J/ma*e;e*=ka/ma;d=ga/ma;d=6*d*(1-d);f*=d;e*=d;aa-=f;ha-=e;b.eye_rotate(a,f,e)}else ga<ba?(aa&&(b.eye_rotate(a,aa,ha),aa=0,r&&r()),d=(ga-ma)/z,e=-E*e/z,Aa-=f,h.move_local(a,0,6*e*d*(1-d),0)):ga<x?Aa&&(h.move_local(a,
0,Aa,0),Aa=0):ga<fa?(d=(ga-x)/z,e=E*e/z,e=6*e*d*(1-d),h.move_local(a,0,e,0)):(h.set_translation_v(a,G),ca());else ca()})}};a.auto_rotate=function(a,d,f){function h(d,f,k){if(1==k)if(k=b.get_move_style(d),k==b.MS_STATIC)q();else if(k!=b.MS_TARGET_CONTROLS&&k!=b.MS_EYE_CONTROLS||!b.has_horizontal_rot_limits(d))r=null,f=c.get_sensor_value(d,f,0),b.rotate_camera(d,f*a,0);else{k=k==b.MS_EYE_CONTROLS?b.eye_get_horizontal_limits(d,G):b.target_get_horizontal_limits(d,G);if(null===r||k.left!=r.left||k.right!=
r.right){r=r||{};r.left=k.left;r.right=k.right;u=Math.min(.2,g.angle_wrap_0_2pi(r.right-r.left)/2);k=p;var m=r,x=b.get_camera_angles(k,l)[0];k=e(k,x,m.left,m.right,n);v=a*Math.min(1,k[0]/.2,k[1]/.2)}f=c.get_sensor_value(d,f,0);k=b.get_camera_angles(d,l)[0];k=e(d,k,r.left,r.right,n);k[1]>u&&k[0]>u?v=g.sign(v)*a:k[1]<u?v-=Math.pow(a,2)/.4*f:k[0]<u&&(v+=Math.pow(a,2)/.4*f);b.rotate_camera(d,f*v,0)}}function q(){c.remove_sensor_manifold(p,"AUTO_ROTATE");c.remove_sensor_manifold(p,"DISABLE_AUTO_ROTATE");
d()}d=d||function(){};var p=k.get_active_camera();if(b.is_static_camera(p))m.error("auto_rotate(): Wrong camera move style");else{var r={},u=0,v=0;if(c.check_sensor_manifold(p,"AUTO_ROTATE"))q();else{var z=c.create_mouse_move_sensor("X"),C=c.create_mouse_move_sensor("Y"),y=c.create_mouse_click_sensor(),B=c.create_touch_move_sensor(),A=c.create_touch_zoom_sensor(),F=c.create_elapsed_sensor();f=f?c.create_mouse_wheel_sensor():c.create_custom_sensor(0);c.create_sensor_manifold(p,"DISABLE_AUTO_ROTATE",
c.CT_LEVEL,[z,C,y,B,A,f],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]||a[5]},q);c.create_sensor_manifold(p,"AUTO_ROTATE",c.CT_CONTINUOUS,[F],function(a){return a[0]},h)}}};a.is_auto_rotate=function(){var a=k.get_active_camera();return c.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=k.get_active_camera();return b.get_move_style(a)==b.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,c,e,f,k){if(b.get_move_style(a)!=b.MS_STATIC)m.error("move_camera_to_point(): wrong camera type");
else if(!d)if(a)if(c){e=e||1;f=f||.01;var l=g.is_vector(a)?a:h.get_tsr(a,v),n=g.is_vector(c)?c:h.get_tsr(c,E);c=y.distance(q.get_trans_view(l),q.get_trans_view(n))/e;e=g.quat_to_dir(q.get_quat_view(l),g.AXIS_MY,u);var p=g.quat_to_dir(q.get_quat_view(n),g.AXIS_MY,A);e=Math.min(Math.abs(y.dot(e,p)),1);f=1E3*Math.max(c,Math.acos(e)/f);d=!0;var C=r.animate(0,1,f,function(b){var c=q.interpolate(l,n,g.smooth_step(b),z);J?(r.clear_animation(C),d=J=!1):(h.set_tsr(a,c),1==b&&(d=!1,k&&k()))})}else m.error("move_camera_to_point(): you must specify the point object");
else m.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=function(a,c,d,e,f){if(b.get_move_style(a)==b.MS_STATIC)m.error("rotate_camera(): not supported for STATIC cameras");else if(!F)if(a)if(c||d){F=!0;var g=0,h=0,k=0!=c?c:d,l=r.animate(0,k,e||1E3,function(e){C?(r.clear_animation(l),F=C=!1):(g-=e,h-=e,d&&c?b.rotate_camera(a,g,h):d?b.rotate_camera(a,0,h):c&&b.rotate_camera(a,g,0),h=g=e,e==k&&(F=!1,f&&f()))})}else m.error("rotate_camera(): you must specify the rotation angle");
else m.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){J=!0};a.stop_cam_rotating=function(){C=!0};a.is_moving=function(){return d};a.is_rotating=function(){return F}};b4w.module.gyroscope=function(a,p){function e(a){var e=c.create_gyro_angles_sensor(),m=c.create_gyro_quat_sensor(),p=!0;c.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",c.CT_CONTINUOUS,[e,m],null,function(a,e,m){if(0<m)if(b.is_eye_camera(a))e=c.get_sensor_payload(a,e,1),m=h.transformQuat(r.AXIS_Z,e,y),b.set_vertical_axis(a,m),k.set_rotation_v(a,e);else{g=c.get_sensor_payload(a,e,0);p&&(q[0]=g[0],q[1]=g[1],q[2]=g[2],p=!1);m=e=0;0==window.orientation&&(e=g[1]-q[1],m=g[0]-q[0],g[1]>l&&g[1]<f&&(m=0));
if(180==window.orientation){e=g[1]-q[1];0>g[1]&&(e=-e);m=q[0]-g[0];if(e>Math.PI/2||e<-Math.PI/2)e=0;g[1]>-f&&g[1]<-l&&(m=0)}if(-90==window.orientation){e=g[0]-q[0];if(e>Math.PI/2||e<-Math.PI/2)e=0;m=q[1]-g[1];if(g[0]>n||g[0]<u)m=0}if(90==window.orientation){e=q[0]-g[0];if(e>Math.PI/2||e<-Math.PI/2)e=0;m=g[1]-q[1];if(g[0]>n||g[0]<u)m=0}b.rotate_camera(a,m,e);q[0]=g[0];q[1]=g[1];q[2]=g[2]}})}var b=p("camera"),c=p("controls"),m=p("scenes"),k=p("transform"),r=p("util"),h=p("vec3"),q=new Float32Array(3),
g=new Float32Array(3),y=h.create(),f=r.deg_to_rad(110),l=r.deg_to_rad(70),n=r.deg_to_rad(70),u=-r.deg_to_rad(70);a.enable_camera_rotation=function(){var a=m.get_active_camera();e(a)};a.disable_camera_rotation=function(){var a=m.get_active_camera();c.remove_sensor_manifold(a,"CAMERA_ROTATE_GYRO")}};b4w.module.hmd=function(a,p){function e(a,d){if(d){var e=r.get_active_camera();if(e){b.is_eye_camera(e)||(l=b.is_target_camera(e),n=b.is_hover_camera(e),u=b.is_static_camera(e),b.eye_setup(e));var e=c.create_elapsed_sensor(),p=!1;c.create_sensor_manifold(null,"HMD_ROTATE_CAMERA",c.CT_CONTINUOUS,[e,d],null,function(d,e,l){if(0<l&&(l=r.get_active_camera())&&(!p&&m.enable_split_screen(l)&&(y=h.get_rotation(l,y),p=!0),p&&b.is_eye_camera(l)&&(d=c.get_sensor_payload(d,e,1))))if(1==a){var n=g.transformQuat(q.AXIS_Z,
d,A);b.set_vertical_axis(l,n);h.set_rotation_v(l,d)}else if(2==a||3==a){e=h.get_rotation(l,E);e=k.invert(e,E);var u=k.multiply(y,e,E);e=b.get_vertical_axis(l,A);Math.abs(e[2])<Math.PI/4?n=g.cross(e,q.AXIS_Z,B):Math.abs(e[1])<Math.PI/4&&(n=g.cross(e,q.AXIS_Y,B));g.normalize(n,n);var u=g.transformQuat(n,u,H),w=g.dot(e,u),u=g.scaleAndAdd(u,e,-w,H);g.normalize(u,u);e=g.cross(e,n,A);n=Math.acos(q.clamp(g.dot(n,u),0,1));e=q.sign(g.dot(u,e));f+=n*e;n=k.setAxisAngle(q.AXIS_Y,-f,E);3!=a&&(e=q.quat_project(d,
q.AXIS_MY,q.AXIS_Y,q.AXIS_MZ,z),e=k.invert(e,z),d=k.multiply(e,d,z));d=k.multiply(n,d,v);n=g.transformQuat(q.AXIS_Z,d,A);b.set_vertical_axis(l,n);h.set_rotation_v(l,d);k.copy(d,y)}})}}}var b=p("camera"),c=p("controls"),m=p("input"),k=p("quat"),r=p("scenes"),h=p("transform"),q=p("util"),g=p("vec3"),y=k.create(),f=0,l=!1,n=!1,u=!1,A=g.create(),B=g.create(),H=g.create(),v=k.create(),E=k.create(),z=k.create();a.HMD_NONE_MOUSE_ALL_AXES=0;a.HMD_ALL_AXES_MOUSE_NONE=1;a.HMD_ROLL_PITCH_MOUSE_YAW=2;a.HMD_ALL_AXES_MOUSE_YAW=
3;a.enable_hmd=function(a){var b=null;m.can_use_device(m.DEVICE_GYRO)?b=c.create_gyro_quat_sensor():m.can_use_device(m.DEVICE_HMD)&&(b=c.create_hmd_quat_sensor());e(a,b)};a.check_browser_support=function(){return Boolean(m.can_use_device(m.DEVICE_HMD))};a.get_hmd_device=function(){return null};a.reset=function(){m.reset_device(m.DEVICE_HMD)};a.disable_hmd=function(){c.remove_sensor_manifold(null,"HMD_ROTATE_CAMERA");m.disable_split_screen();var a=r.get_active_camera();l?b.target_setup(a):n?b.hover_setup(a):
u&&b.static_setup(a);b.set_vertical_axis(a,q.AXIS_Y);var d=h.get_rotation(a,v);h.set_rotation_v(a,d)}};b4w.module.mixer=function(a,p){function e(){H=B.length=0;v=b();E=new Float32Array(v.length);z=new Float32Array(v.length);var a=n.get_speaker_objects();if(a.length){B.push(c());for(var d=0;d<a.length;d++)B.push(k(a[d]));B.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function b(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/
99;return a}function c(){var a=m("MASTER");a.s.push(["VOLUME",n.get_volume(null),0,1,50,!1]);var b=n.get_compressor_params();b&&(a.s.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.s.push(["KNEE",b.knee,0,40,40,!1]),a.s.push(["RATIO",b.ratio,1,20,20,!1]),a.s.push(["ATTACK",b.attack,0,1,1E3,!1]),a.s.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=n.is_muted(null)?1:0;a.je=-1;return a}function m(a){return{id:a,s:[],yh:0,mute:-1,je:-1,$a:null}}function k(a){var b=m(l.get_object_name(a));b.mute=n.is_muted(a)?
1:0;b.je=0;b.$a=a;return b}function r(a){if(a.$a){a.s.length=0;a.s.push(["VOLUME",n.get_volume(a.$a),0,1,50,!1]);var b=n.get_positional_params(a.$a);b&&(a.s.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.s.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.s.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=n.get_filter_params(a.$a))a.s.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.s.push(["EQ_Q",b.Q,0,10,100,!1]),a.s.push(["EQ_GAIN",b.gain,-70,30,100,!1]);u.clamp(a.yh,0,a.s.length-1)}}function h(a){for(var b=
0;b<B.length;b++){var c=B[b];if(c!=a&&1==c.je)return!0}return!1}function q(a){for(var b=0;b<B.length;b++){var c=B[b];c!=a&&0==c.mute&&0==c.je&&n.mute(c.$a,!1)}}function g(){if(0==B.length)return[0,-1];var a=8*Math.floor(H/8),b=a+7,a=u.clamp(a,0,B.length-1),b=u.clamp(b,0,B.length-1);return[a,b]}var y=p("controls"),f=p("hud"),l=p("scenes"),n=p("sfx"),u=p("util"),A="SWITCH_STRIP SWITCH_STRIP_HOLD SWITCH_PARAM INC_DEC INC_DEC_HOLD MUTE_SOLO".split(" "),B=[],H=0,v=null,E=null,z=null;a.enable_mixer_controls=
function(){function a(b,c,d){if(1==d){var e=Boolean(y.get_sensor_value(b,c,2))?-1:1,f=B[H];if(f)switch(d=f.s[f.yh],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=u.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?n.set_volume(f.$a,d[1]):n.set_volume(null,d[1]);break;case "DIST_REF":e=n.get_positional_params(f.$a);e.dist_ref=d[1];n.set_positional_params(f.$a,e);break;case "ATTENUATION":e=n.get_positional_params(f.$a);e.attenuation=d[1];n.set_positional_params(f.$a,e);
break;case "DIST_MAX":e=n.get_positional_params(f.$a);e.dist_max=d[1];n.set_positional_params(f.$a,e);break;case "EQ_FREQ":e=n.get_filter_params(f.$a);e.freq=d[1];n.set_filter_params(f.$a,e);break;case "EQ_Q":e=n.get_filter_params(f.$a);e.Q=d[1];n.set_filter_params(f.$a,e);break;case "EQ_GAIN":e=n.get_filter_params(f.$a);e.gain=d[1];n.set_filter_params(f.$a,e);break;case "THRESHOLD":f=n.get_compressor_params();f.threshold=d[1];n.set_compressor_params(f);break;case "KNEE":f=n.get_compressor_params();
f.knee=d[1];n.set_compressor_params(f);break;case "RATIO":f=n.get_compressor_params();f.ratio=d[1];n.set_compressor_params(f);break;case "ATTACK":f=n.get_compressor_params();f.attack=d[1];n.set_compressor_params(f);break;case "RELEASE":f=n.get_compressor_params();f.release=d[1];n.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?y.reset_timer_sensor(b,c,6,.35):y.reset_timer_sensor(b,c,6,.05)}else y.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(y.get_sensor_value(a,
c,0))?-1:1;if(B.length){1==d&&H<B.length-1?H++:-1==d&&0<H&&H--;d=g();for(var e=d[0];e<=d[1];e++)r(B[e])}"SWITCH_STRIP"==c?y.reset_timer_sensor(a,c,5,.15+.3):y.reset_timer_sensor(a,c,5,.15)}else y.reset_timer_sensor(a,c,5,10)}e();var c=y.create_keyboard_sensor(y.KEY_LEFT_SQ_BRACKET),k=y.create_keyboard_sensor(y.KEY_RIGHT_SQ_BRACKET),l=y.create_keyboard_sensor(y.KEY_SEMI_COLON),m=y.create_keyboard_sensor(y.KEY_SINGLE_QUOTE),p=y.create_keyboard_sensor(y.KEY_SHIFT),A=y.create_timer_sensor(.15,!0),K=y.create_timer_sensor(.05,
!0),c=[c,k,l,m,p,A,K];y.create_sensor_manifold(null,"SWITCH_STRIP",y.CT_TRIGGER,c,function(a){return(a[0]||a[1])&&!a[4]},b);y.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",y.CT_SHOT,c,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);y.create_sensor_manifold(null,"SWITCH_PARAM",y.CT_SHOT,c,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(y.get_sensor_value(a,b,0))?-1:1,d=B[H];d&&(1==c&&d.yh<d.s.length-1?d.yh++:-1==c&&0<d.yh&&d.yh--)});y.create_sensor_manifold(null,"INC_DEC",y.CT_TRIGGER,
c,function(a){return(a[2]||a[3])&&!a[4]},a);y.create_sensor_manifold(null,"INC_DEC_HOLD",y.CT_SHOT,c,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);y.create_sensor_manifold(null,"MUTE_SOLO",y.CT_SHOT,c,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(y.get_sensor_value(a,b,2))){var c=B[H];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,n.mute(c.$a,!0),1==c.je&&(c.je=0,h(c)||q(c))):(c.mute=0,h(c)||n.mute(c.$a,!1)):0==c.mute?(c.mute=1,n.mute(null,!0)):(c.mute=0,n.mute(null,!1)))}else if((c=
B[H])&&0<=c.je)if(0==c.je){c.je=1;n.mute(c.$a,!1);1==c.mute&&(c.mute=0);for(var d=0;d<B.length;d++){var e=B[d];e!=c&&0==e.mute&&0==e.je&&n.mute(e.$a,!0)}}else c.je=0,h(c)?n.mute(c.$a,!0):q(c)});c=y.create_elapsed_sensor();y.create_sensor_manifold(null,"MIXER_DRAW",y.CT_CONTINUOUS,[c],null,function(){if(B[H])for(var a=g(),b=a[0];b<=a[1];b++){var c=B[b];f.draw_mixer_strip(c.id,b==H,b%8,c.s,c.yh,c.mute,c.je);if(c.$a&&n.get_filter_params(c.$a)){n.get_filter_freq_response(c.$a,v,E,z);for(c=0;c<E.length;c++)E[c]=
20*Math.log(E[c])/Math.LN10;f.plot_array("EQ",b%8,E,20,2E4,-10,10)}}});c=y.create_timer_sensor(1,!0);y.create_sensor_manifold(null,"MIXER_UPDATE",y.CT_TRIGGER,[c],null,function(){for(var a=g(),b=a[0];b<=a[1];b++)r(B[b])})};a.disable_mixer_controls=function(){for(var a=0;A.length;a++)y.remove_sensor_manifold(null,A[a])}};b4w.module.npc_ai=function(a,p){function e(a,b){var c=b.destination,e=B;l.get_translation(b.empty,e);var f=H;l.get_translation(b.collider,f);var k=0;b.Kk?k=b.Kk:b.qg&&(k=b.qg,b.type==F&&(k*=.5),b.type==C&&(k*=a));switch(b.type){case F:if(b.random&&b.Xg){c[0]=(12*Math.random()-6)*b.speed+e[0];c[2]=(12*Math.random()-6)*b.speed+e[2];var m=G,e=v,q=b.speed,p=b.rot_speed;l.get_rotation(b.collider,m);u.transformQuat(n.AXIS_Z,m,e);e[1]=0;u.normalize(e,e);m=.5*q/Math.sin(p/2);q=u.dist(c,f);q<2*m&&u.scaleAndAdd(c,
e,2*m-q,c);b.Xg=!1}c[1]=f[1];k&&(c[1]+=k);break;case J:case C:b.random&&b.Xg&&(b.type==C?(b.speed=Math.random()+.1,m=b.bH-b.hH):m=b.max_height-b.min_height,c[0]=10*Math.random()-5+e[0],c[1]=f[1]+(Math.random()*m-.5*m),c[2]=10*Math.random()-5+e[2],b.Xg=!1),k&&(c[1]=f[1]+k)}var c=B,e=H,q=v,f=d,y=b.rig,m=b.collider,k=b.destination,A=b.speed,M=b.actions,U=h.get_current_anim_name(y);if(!h.is_play(y)||!M.Ll||-1==M.Ll.indexOf(U)){l.get_translation(m,c);var p=k[0]-c[0],ea=k[2]-c[2],p=Math.sqrt(p*p+ea*ea);
if(p>2*A*a)b.state=20,n.xz_direction(k,c,q),M=b.rig,h.is_animated(M)&&(y=b.speed,A=h.get_frame(M),M=h.get_anim_length(M),y*=M/24*(1-A/M),.9>p/y&&u.scaleAndAdd(k,q,y-p,k)),p=G,y=E,l.get_rotation(b.collider,p),u.transformQuat(n.AXIS_Z,p,e),y[0]=e[0],y[1]=0,y[2]=e[2],u.normalize(y,y),A=u.dot(y,q),M=a/(Math.abs(Math.acos(A))/Math.PI)*b.rot_speed*b.Ks,g.rotationTo(y,q,f),g.rotationTo(n.AXIS_Z,y,p),1<=Math.abs(A)?g.copy(p,f):(g.multiply(f,p,f),g.slerp(p,f,Math.min(M,1),f)),q=a,b.type!=J&&(q=Math.max(q,
1/60),p=z,y=G,g.setAxisAngle(n.AXIS_X,-Math.asin(e[1]),y),g.setAxisAngle(n.AXIS_X,-Math.atan(b.qg/(b.speed*q)),p),g.slerp(y,p,q,p),g.multiply(f,p,f)),l.set_rotation_v(m,f),e=v,m=E,n.quat_to_dir(f,n.AXIS_Z,e),u.scale(e,b.speed*a,m),u.add(m,c,m),m[1]=b.type!=F?(k[1]-c[1])*a*.1+c[1]:k[1],l.set_translation_v(b.collider,m);else if(b.type==F)M.move?U&&-1!=M.move.indexOf(U)&&h.is_play(y)?b.state=20:(b.state=10,b.Xg=!0):(b.state=10,b.Xg=!0);else if(b.type==C||b.type==J)b.Xg=!0;if(r(b)&&(c=b.rig,!h.is_play(c))){f=
null;switch(b.state){case 10:f=b.actions;f=f.Ll?n.random_from_array(f.Ll):null;break;case 20:f=h.get_current_anim_name(b.rig),e=k=b.actions,e.Wf&&-1==e.Wf.indexOf(f)&&e.move&&-1!=e.move.indexOf(f)&&.33<Math.random()?(k=b.actions,f=k.Wf[k.move.indexOf(f)]):(e=b.actions,e.move&&(-1!=e.move.indexOf(f)||!e.Wf&&!e.Og||!e.Og&&!f||e.Wf&&-1!=e.Wf.indexOf(f)||e.Og&&-1!=e.Og.indexOf(f))?(k=b.actions,k.Wf?(e=k.Wf.indexOf(f),-1!=e?(f=e+1,f=f<k.move.length?f:0,f=k.move[f]):f=-1!=k.move.indexOf(f)?f:n.random_from_array(k.move)):
f=n.random_from_array(k.move)):(e=b.actions,f=e.Og&&-1==e.Og.indexOf(f)&&e.move&&-1==e.move.indexOf(f)?n.random_from_array(k.Og):null))}f&&(h.apply(c,f),h.set_behavior(c,h.AB_FINISH_RESET),h.set_frame(c,0),h.play(c))}}}function b(a,b,c,d){if(d)if(1==c)switch(d.type){case J:a:{for(c=0;3>c;c++){var e=q.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.qg=a<d.min_height?10:a>d.max_height?-10:0;break;case F:a=q.get_sensor_payload(a,b,0).hit_fract;d.qg=d.Tx==a?0:1-100*a;d.Tx=a;
break;case C:a=q.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.qg=100*a-1,d.qg=.1>d.qg?.05:0):"CLOSE_WATER"==b&&(d.Kk=100*a,d.Kk=d.Kk<d.hH?-.02:d.Kk>d.bH?.02:0)}else d.qg=0}function c(){for(var a=0;a<A.length;a++){var b=A[a];m(b);k(b);b.rig&&h.get_current_anim_name(b.rig)&&h.play(b.rig)}}function m(a){var c=u.create(),d=a.collider;switch(a.type){case J:var e=q.create_ray_sensor(d,c,[0,-100,0],"TERRAIN",!0),f=q.create_ray_sensor(d,c,[0,-100,0],"STONE",!0),c=q.create_ray_sensor(d,c,[0,-100,
0],"WATER",!0),e=[e,f,c];q.create_sensor_manifold(d,"CLOSE_GROUND",q.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},b,a);break;case F:e=q.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];q.create_sensor_manifold(d,"CLOSE_GROUND",q.CT_CONTINUOUS,e,null,b,a);break;case C:e=q.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0),c=q.create_ray_sensor(d,c,[0,100,0],"WATER",!0),e=[e],q.create_sensor_manifold(d,"CLOSE_WATER",q.CT_CONTINUOUS,[c],null,b,a),q.create_sensor_manifold(d,"CLOSE_GROUND",
q.CT_CONTINUOUS,e,null,b,a)}}function k(a){function b(c,d,e){1==e?(l.get_translation(a.empty,a.destination),a.Ks=4):a.Ks=1}var c=a.collider;if(a.type==F){var d=q.create_collision_sensor(c,"CONSTRUCTION",!1);q.create_sensor_manifold(c,"CONSTRUCTION_COLL",q.CT_CONTINUOUS,[d],null,b)}}function r(a){var b=a.rig;if(!h.is_play(b))return!0;b=h.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.Ll)return!1;if(-1==c.Ll.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||
c.Og&&-1!=c.Og.indexOf(b)||c.Wf&&-1!=c.Wf.indexOf(b))return!1;break;default:return!1}return!0}var h=p("animation"),q=p("controls"),g=p("quat"),y=p("scenes"),f=p("time"),l=p("transform"),n=p("util"),u=p("vec3"),A=[];new Float32Array(9);var B=new Float32Array(3),H=new Float32Array(3),v=new Float32Array(3),E=new Float32Array(3),z=new Float32Array(4),G=new Float32Array(4),d=new Float32Array(4),F=a.NT_WALKING=10,J=a.NT_FLYING=20,C=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);
a.start=[];a.ended=[];a.Nn=[];a.qg=null;a.Tx=null;a.Kk=null;a.Xg=!0;a.Ks=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.Nn[b]=!1;A.push(a)};a.enable_animation=function(){if(A.length){c();var a=q.create_elapsed_sensor();q.create_sensor_manifold(A[0].collider,"ELAPSED",q.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=q.get_sensor_value(a,b,0),b=0;b<A.length;b++){c=A[b];var d=a;if(y.is_visible(c.obj))if(c.random)e(d,c);else{for(var g=f.get_timeline(),
h=0;h<c.path.length;h++)if(!c.ended[h]){c.Nn[h]||(c.Nn[h]=!0,c.destination[0]=c.path[h][0],c.destination[1]=c.path[h][1],c.destination[2]=c.path[h][2],c.start[h]=g+c.delay[h]);if(g<c.start[h])break;e(d,c);c.ended[h]=c.Xg;break}a:{for(d=0;d<c.path.length;d++)if(0==c.ended[d]){d=!1;break a}d=!0}if(d)for(d=0;d<c.path.length;d++)c.Nn[d]=!1,c.ended[d]=!1}}})}};a.disable_animation=function(){if(!(0>=A.length))for(var a=0;a<A.length;a++){var b=A[a];q.check_sensor_manifolds(b.collider)&&q.remove_sensor_manifold(b.collider);
h.is_play(b.rig)&&h.stop(b.rig)}}};b4w.module.mouse=function(a,p){function e(){1==J&&(J=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);f.remove_sensor_manifold(u.get_active_camera(),"SMOOTH_PL")}function b(a){2==J&&(J=0);a.removeEventListener("mousedown",m,!1);a.removeEventListener("mouseup",k,!1);a.removeEventListener("mousemove",c,!1);f.remove_sensor_manifold(u.get_active_camera(),"SMOOTH_DRAG")}function c(a){d()&&(z[0]+=2*(a.clientX-v),z[1]+=
2*(a.clientY-E),v=a.clientX,E=a.clientY);a.preventDefault()}function m(a){v=a.clientX;E=a.clientY;a.currentTarget.addEventListener("mousemove",c,!1);a.preventDefault()}function k(a){a.currentTarget.removeEventListener("mousemove",c,!1);a.preventDefault()}function r(a,b,c,d){if(.01<Math.abs(z[0])||.01<Math.abs(z[1]))b=f.get_sensor_value(a,b,0),a=A.smooth(z[0],0,b,.1*H),b=A.smooth(z[1],0,b,.1*H),z[0]-=a,z[1]-=b,d(4E-4*-a,4E-4*-b)}function h(a,b){var c=u.get_first_character(),d=u.get_active_camera();
g.eye_rotate(d,a,b);c&&(d=g.get_camera_angles_char(d,G),l.set_character_rotation(c,d[0],d[1]))}function q(a){a=y.client_to_canvas_coords(a.clientX,a.clientY,G);(a=u.pick_object(a[0],a[1]))?(u.outlining_is_enabled(a)&&u.set_outline_intensity(a,1),u.outlining_is_enabled(F)&&a!=F&&u.set_outline_intensity(F,0)):u.outlining_is_enabled(F)&&u.set_outline_intensity(F,0);F=a}var g=p("camera"),y=p("container"),f=p("controls"),l=p("physics"),n=p("print"),u=p("scenes"),A=p("util"),B=p("main"),H=1,v=0,E=0,z=new Float32Array(2),
G=new Float32Array(2),d=null,F=null,J=0;a.request_pointerlock=function(a,c,d,e,g,k){function l(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){b(a);a.addEventListener("mousemove",e,!1);var g=u.get_active_camera();if(!f.check_sensor_manifold(g,"SMOOTH_PL")){var h=f.create_elapsed_sensor();f.create_sensor_manifold(g,"SMOOTH_PL",f.CT_CONTINUOUS,[h],null,r,k)}c()}else a.removeEventListener("mousemove",e,!1),J=0,document.removeEventListener("pointerlockchange",
l,!1),document.removeEventListener("webkitpointerlockchange",l,!1),document.removeEventListener("mozpointerlockchange",l,!1),d()}if(1!=J){J=1;c=c||function(){};d=d||function(){};k=k||h;g=g||function(){return!0};e=e||function(a){if(g()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;z[0]+=b;z[1]+=a}};document.addEventListener("pointerlockchange",
l,!1);document.addEventListener("webkitpointerlockchange",l,!1);document.addEventListener("mozpointerlockchange",l,!1);var m=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof m?m.apply(a):n.error("Pointer lock is not available")}};a.exit_pointerlock=e;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b,c){2!=J&&(J=2,e(),d=b||function(){return!0},
c=c||h,a.addEventListener("mousedown",m,!1),a.addEventListener("mouseup",k,!1),a=u.get_active_camera(),f.check_sensor_manifold(a,"SMOOTH_DRAG")||(b=f.create_elapsed_sensor(),f.create_sensor_manifold(a,"SMOOTH_DRAG",f.CT_CONTINUOUS,[b],null,r,c)))};a.exit_mouse_drag=b;a.enable_mouse_hover_outline=function(){B.detect_mobile()||y.get_canvas().addEventListener("mousemove",q)};a.disable_mouse_hover_outline=function(){B.detect_mobile()||(y.get_canvas().removeEventListener("mousemove",q),F&&u.set_outline_intensity(F,
0))};a.get_coords_x=function(a,b){var c=b?a.targetTouches:a.touches;return"clientX"in a?a.clientX:c&&"clientX"in c[0]?c[0].clientX:-1};a.get_coords_y=function(a,b){var c=b?a.targetTouches:a.touches;return"clientY"in a?a.clientY:c&&"clientY"in c[0]?c[0].clientY:-1};a.set_plock_smooth_factor=function(a){H=a};a.get_plock_smooth_factor=function(){return H}};b4w.module.preloader=function(a,p){var e=p("app"),b,c,m,k,r,h,q,g,y,f=null;a.create_simple_preloader=function(a){var e=null,g=null,p="#bf9221",q="#000",y;for(y in a)switch(y){case "canvas_container_id":e=a.canvas_container_id;break;case "background_container_id":g=a.background_container_id;break;case "bg_color":q=a.bg_color;break;case "bar_color":p=a.bar_color;break;case "preloader_fadeout":b=a.preloader_fadeout}a=document.createElement("div");y=document.createElement("div");a.id="simple_preloader_container";
var v=document.createElement("div"),E=document.createElement("div"),g=document.getElementById(g);f=document.getElementById(e);a.style.cssText="z-index: 4;background-color: "+q+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";y.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";v.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
p+";border-radius: 0px;";E.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+y.appendChild(v);y.appendChild(E);a.appendChild(y);document.body.appendChild(a);c="SIMPLE";m=a;k=v;r=E;h=g};a.create_rotation_preloader=function(a){var b=null,e=null,g="rgba(0,0,0,0)",k="",p="",v="rgba(0,0,0,0)",y;for(y in a)switch(y){case "canvas_container_id":b=a.canvas_container_id;
break;case "background_container_id":e=a.background_container_id;break;case "frame_bg_color":g=a.frame_bg_color;break;case "bg_color":v=a.bg_color;break;case "frame_class":k=a.frame_class;break;case "anim_elem_class":p=a.anim_elem_class}a=document.createElement("div");y=document.createElement("div");var z=document.createElement("div"),G=document.createElement("div"),e=document.getElementById(e);f=document.getElementById(b);a.style.cssText="z-index: 4;background-color: "+v+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
y.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+g+";";z.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";G.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";z.className=p;y.appendChild(z);y.className=k;y.appendChild(G);
a.appendChild(y);f.appendChild(a);c="ROTATION";m=a;q=z;r=G;h=e};a.create_advanced_preloader=function(a){var b=a.preloader_width,b=b/(b-a.img_width),e=document.getElementById(a.preloader_bar_id),p=document.getElementById(a.fill_band_id),q=document.getElementById(a.preloader_caption_id),H=document.getElementById(a.preloader_container_id),v=document.getElementById(a.background_container_id);f=document.getElementById(a.canvas_container_id);c="ADVANCED";k=e;g=p;y=b;r=q;m=H;h=v};a.update_preloader=function(a){r.innerHTML=
a+"%";"SIMPLE"==c&&(k.style.width=a+"%");"ADVANCED"==c&&(k.style.width=a/y+"%",g.style.width=100-a+"%");"ROTATION"==c&&(q.style.transform="rotate("+a+"deg)");100==a&&(b?(e.css_animate(h,"opacity",1,0,1500,null,null,function(){h.parentNode.removeChild(h)}),e.css_animate(m,"opacity",1,0,1E3,null,null,function(){m.parentNode.removeChild(m)})):(m.parentNode.removeChild(m),h&&h.parentNode.removeChild(h)))}};b4w.module.storage=function(a,p){function e(a){m=a;if(!k){try{k=window.localStorage;try{k.tmp=null,delete k.tmp}catch(b){c.warn("localStorage quota is limited. Disabling localStorage"),k=null}}catch(e){c.warn("Applying chrome localStorage bug workaround"),k=null}k||(c.warn("localStorage is not available, initializing temporary storage"),k={})}}function b(){return k[m]?JSON.parse(k[m]):{}}var c=p("__print"),m="",k=null;a.init=e;a.set=function(a,c){var e=b();e[a]=String(c);k[m]=JSON.stringify(e)};a.cleanup=
function(){delete k[m]};a.get=function(a){var c=b();return c[a]?c[a]:""};a.debug=function(){c.log(b())};e("b4w")};b4w.module.screenshooter=function(a,p){var e=p("main");a.shot=function(){e.canvas_data_url(function(a){var c=window.document.createElement("a");document.body.appendChild(c);c.style.display="none";c.href=a;c.download="screenshot.png";c.click();document.body.removeChild(c)})}};
