b4w.register("ping_pong_game",function(m,c){function r(){var a=d.create_keyboard_sensor(d.KEY_Z),b=d.create_keyboard_sensor(d.KEY_X),a=[a,b],b=function(a,b,f){if(1==f)switch(b){case "UP":h=1;break;case "DOWN":h=-1}else switch(b){case "UP":case "DOWN":h=0}};d.create_sensor_manifold(null,"UP",d.CT_TRIGGER,a,function(a){return a[0]},b);d.create_sensor_manifold(null,"DOWN",d.CT_TRIGGER,a,function(a){return a[1]},b)}var g=c("scenes"),n=c("main"),p=c("transform"),k=c("sfx"),d=c("controls"),h=0,l,q,u;m.init=
function(){l=g.get_object_by_name("udar1");q=g.get_object_by_name("udar2");u=g.get_object_by_name("udar3");var a=g.get_object_by_name("bg_sound");k.play(a);r()};var y=function(){return{radius:10,color:"#FFCC00",x:0,y:0,yspeed:7,xspeed:9,bounce:1.1,render:function(){var a=this.x/100,b=this.y/100;this.obj_b4w;p.set_translation(this.obj_b4w,a,.22,b)},move:function(a){this.x+=this.xspeed*a*60;this.y+=this.yspeed*a*60}}},v=function(){return{w:10,h:100,x:0,y:0,speed:20,color:"#CCFF00",render:function(){var a=
this.x/100,b=this.y/100;this.obj_b4w;p.set_translation(this.obj_b4w,a,.22,b)}}},w=function(){return{rate:0}},x=function(){var a=this;this.params={width:1500,height:500,state:"loading",maxRate:10};document.addEventListener("keydown",function(b){a.keyDownEvent.call(a,b)});return this};x.prototype={startGame:function(){this.objects={ball:new y,player1:new w,player2:new w,bracket1:new v,bracket2:new v};this.objects.ball.obj_b4w=g.get_object_by_name("Sphere");this.objects.bracket1.obj_b4w=g.get_object_by_name("bracket1");
this.objects.bracket2.obj_b4w=g.get_object_by_name("bracket2");this.params.state="game";this.params.lastGoalBracket=this.objects.bracket1;this.params.lastGoalPlayer="player1";this.objects.bracket1.x=50;this.objects.bracket1.y=this.params.height/2-this.objects.bracket1.h/2;this.objects.bracket2.x=this.params.width-50;this.objects.bracket2.y=this.params.height/2-this.objects.bracket1.h/2;n.append_loop_cb(this.loop)},loop:function(f,b){var t=1,e=b;.002<b&&(t=Math.ceil(b/.002),e=b/t);for(var c=1;c<=t;c++)a.logic(),
a.physic(e),a.ai(),a.render(),a.movement()},movement:function(){1==h?a.objects.bracket1.y+=a.objects.bracket1.speed/10:-1==h&&(a.objects.bracket1.y-=a.objects.bracket1.speed/10)},logic:function(){var f=a.objects.ball;"game"==this.params.state&&(0>f.x+f.radius/2&&(this.objects.player2.rate++,this.params.state="playerwait",this.params.lastGoalBracket=this.objects.bracket2,this.params.lastGoalPlayer="player2"),f.x+f.radius/2>a.params.width&&(this.objects.player1.rate++,this.params.state="playerwait",
this.params.lastGoalBracket=this.objects.bracket1,this.params.lastGoalPlayer="player1"),this.objects.player1.rate===this.params.maxRate&&(alert("1 \u0438\u0433\u0440\u043e\u043a \u0432\u044b\u0438\u0433\u0440\u0430\u043b"),location.reload(),this.gameRestart()),this.objects.player2.rate===this.params.maxRate&&(alert("2 \u0438\u0433\u0440\u043e\u043a \u0432\u044b\u0438\u0433\u0440\u0430\u043b"),location.reload(),this.gameRestart()))},physic:function(f){var b=a.objects.ball,c=a.objects.bracket1,e=a.objects.bracket2;
a.objects.ball.move(f);0>b.x+b.radius/2&&(a.objects.ball.xspeed=-a.objects.ball.xspeed);b.x+b.radius/2>a.params.width&&(a.objects.ball.xspeed=-a.objects.ball.xspeed);if(b.y+b.radius/2>a.params.height||0>b.y+b.radius/2)a.objects.ball.yspeed=-a.objects.ball.yspeed,k.play(q);60>=b.x&&b.y>=c.y&&b.y<=c.y+c.h&&(b.xspeed=-b.xspeed,b.xspeed*=b.bounce,b.yspeed=b.yspeed*b.bounce-.1,k.play(l));b.x>=this.params.width-50&&b.y>=e.y&&b.y<=e.y+e.h&&(b.xspeed=-b.xspeed,b.xspeed*=b.bounce,b.yspeed=b.yspeed*b.bounce-
.1,k.play(u));"playerwait"===this.params.state&&(b.xspeed=0,b.yspeed=0,"player1"===this.params.lastGoalPlayer&&(b.x=this.params.lastGoalBracket.x+this.params.lastGoalBracket.w+b.radius+1,b.y=this.params.lastGoalBracket.y+this.params.lastGoalBracket.h/2),"player2"===this.params.lastGoalPlayer&&(b.x=this.params.lastGoalBracket.x-b.radius-1,b.y=this.params.lastGoalBracket.y+this.params.lastGoalBracket.h/2));0>=c.y&&(c.y=1);0>=e.y&&(e.y=1);c.y+c.h>=this.params.height&&(c.y=this.params.height-c.h);e.y+
e.h>=this.params.height&&(e.y=this.params.height-e.h)},ai:function(){"game"==a.params.state&&0<a.objects.ball.xspeed&&(a.objects.bracket2.y=a.objects.bracket2.y<a.objects.ball.y-50?a.objects.bracket2.y+.8:a.objects.bracket2.y-.8)},render:function(){a.objects.ball.render();a.objects.bracket1.render();a.objects.bracket2.render()},renderRate:function(c){var b=a.objects.player1.rate+" : "+a.objects.player2.rate;c.fillStyle="#000000";c.font="20px Arial";c.fillText(b,a.params.width/2,50)},keyDownEvent:function(c){c=
c.keyCode;49===c&&(a.objects.bracket1.y+=a.objects.bracket1.speed);50===c&&(a.objects.bracket1.y-=a.objects.bracket1.speed);57===c&&(a.objects.bracket2.y+=a.objects.bracket2.speed);48===c&&(a.objects.bracket2.y-=a.objects.bracket2.speed);69===c&&this.restartBall();82===c&&this.restartGame();32===c&&"playerwait"===a.params.state&&this.kickBall()},kickBall:function(){this.objects.ball.xspeed=7;this.objects.ball.yspeed=5;this.params.state="game"},stopGame:function(){this.params.state="stop";cancelAnimationFrame(this.requestLoop);
document.removeEventListener("keydown",this.keyDownEvent);delete this.objects},pauseGame:function(){this.state="pause"},restartBall:function(){this.objects.ball.x=a.params.width/2;this.objects.ball.y=a.params.height/2;this.objects.ball.xspeed=3;this.objects.ball.yspeed=3},restartGame:function(){this.stopGame();this.startGame()}};var a=new x;m.game=a});b4w.register("ping_pong",function(m,c){function r(c,d){d?k.load(q+"ping_pong.json",g):console.log("b4w init failure")}function g(c,d){d?(n.enable_camera_controls(),h.init(),h.game.startGame()):console.log("b4w load failure")}var n=c("app"),p=c("config"),k=c("data"),d=c("version"),h=c("ping_pong_game"),l="DEBUG"===d.type(),q=p.get_std_assets_path()+"ping_pong/";m.init=function(){n.init({canvas_container_id:"main_canvas_container",callback:r,show_fps:l,console_verbose:l,autoresize:!0})}});b4w.require("ping_pong").init();
